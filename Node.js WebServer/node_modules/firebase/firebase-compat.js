!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";!function(e){var t,n,o,r,i,s,a,c,l,u;function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function d(e){return e="string"!=typeof e?String(e):e}function f(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function p(t){this.map={},t instanceof p?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function y(e){var t=new FileReader,n=m(t);return t.readAsArrayBuffer(e),n}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(o&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(r&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(i&&o&&a(e))this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=m(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(e,t){var n,r=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(n=t.method||this.method||"GET",e=n.toUpperCase(),-1<l.indexOf(e)?e:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function b(e){var n=new FormData;return e.trim().split("&").forEach(function(e){var t;e&&(e=(t=e.split("=")).shift().replace(/\+/g," "),t=t.join("=").replace(/\+/g," "),n.append(decodeURIComponent(e),decodeURIComponent(t)))}),n}function I(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}e.fetch||(t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),r="FormData"in e,(i="ArrayBuffer"in e)&&(s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&-1<s.indexOf(Object.prototype.toString.call(e))}),p.prototype.append=function(e,t){e=h(e),t=d(t);var n=this.map[e];this.map[e]=n?n+","+t:t},p.prototype.delete=function(e){delete this.map[h(e)]},p.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},p.prototype.set=function(e,t){this.map[h(e)]=d(t)},p.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},p.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),f(n)},p.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),f(t)},p.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),f(n)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries),l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},_.call(w.prototype),_.call(I.prototype),I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},I.error=function(){var e=new I(null,{status:0,statusText:""});return e.type="error",e},u=[301,302,303,307,308],I.redirect=function(e,t){if(-1===u.indexOf(t))throw new RangeError("Invalid status code");return new I(null,{status:t,headers:{location:e}})},e.Headers=p,e.Request=w,e.Response=I,e.fetch=function(n,s){return new Promise(function(r,e){var t=new w(n,s),i=new XMLHttpRequest;i.onload=function(){var n,e={status:i.status,statusText:i.statusText,headers:(t=i.getAllResponseHeaders()||"",n=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),e=t.shift().trim();e&&(t=t.join(":").trim(),n.append(e,t))}),n)};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var t="response"in i?i.response:i.responseText;r(new I(t,e))},i.onerror=function(){e(new TypeError("Network request failed"))},i.ontimeout=function(){e(new TypeError("Network request failed"))},i.open(t.method,t.url,!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&o&&(i.responseType="blob"),t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})},e.fetch.polyfill=!0)}("undefined"!=typeof self?self:void 0);var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){var t={exports:{}};return e(t,t.exports),t.exports}function m(e){try{return!!e()}catch(e){return!0}}function y(e){return"object"==typeof e?null!==e:"function"==typeof e}function n(e){return h?u.createElement(e):{}}function f(e){if(!y(e))throw TypeError(String(e)+" is not an object");return e}function r(e,t){if(!y(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!y(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!y(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}function g(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function l(t,n){try{b(v,t,n)}catch(e){v[t]=n}return n}function c(e,t){return S.call(e,t)}function a(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++k+C).toString(36)}function i(e){return c(R,e)||(A&&c(P,e)?R[e]=P[e]:R[e]=x("Symbol."+e)),R[e]}var s=function(e){return e&&e.Math==Math&&e},v=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof e&&e)||Function("return this")(),o=!1,d=!m(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),u=v.document,h=y(u)&&y(u.createElement),p=!d&&!m(function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}),_=Object.defineProperty,w={f:d?_:function(e,t,n){if(f(e),t=r(t,!0),f(n),p)try{return _(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},b=d?function(e,t,n){return w.f(e,t,g(1,n))}:function(e,t,n){return e[t]=n,e},I="__core-js_shared__",T=v[I]||l(I,{}),E=t(function(e){(e.exports=function(e,t){return T[e]||(T[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})}),S={}.hasOwnProperty,k=0,C=Math.random(),A=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),N=A&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,R=E("wks"),P=v.Symbol,x=N?P:P&&P.withoutSetter||a,O={};O[i("toStringTag")]="z";var D="[object z]"===String(O),L=Function.toString;"function"!=typeof T.inspectSource&&(T.inspectSource=function(e){return L.call(e)});var M,F,U,j,q,V,B,K,z=T.inspectSource,W=v.WeakMap,s="function"==typeof W&&/native code/.test(z(W)),$=E("keys"),e=function(e){return $[e]||($[e]=a(e))},H={},I=v.WeakMap;B=s?(M=new I,F=M.get,U=M.has,j=M.set,q=function(e,t){return j.call(M,e,t),t},V=function(e){return F.call(M,e)||{}},function(e){return U.call(M,e)}):(K=e("state"),H[K]=!0,q=function(e,t){return b(e,K,t),t},V=function(e){return c(e,K)?e[K]:{}},function(e){return c(e,K)});function G(e){return J.call(e).slice(8,-1)}var Q={set:q,get:V,has:B,enforce:function(e){return B(e)?V(e):q(e,{})},getterFor:function(n){return function(e){var t;if(!y(e)||(t=V(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}},Y=t(function(e){var t=Q.get,o=Q.enforce,a=String(String).split("String");(e.exports=function(e,t,n,r){var i=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,r=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||c(n,"name")||b(n,"name",t),o(n).source=a.join("string"==typeof t?t:"")),e!==v?(i?!r&&e[t]&&(s=!0):delete e[t],s?e[t]=n:b(e,t,n)):s?e[t]=n:l(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||z(this)})}),J={}.toString,X=i("toStringTag"),Z="Arguments"==G(function(){return arguments}()),ee=D?G:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),X))?e:Z?G(t):"Object"==(e=G(t))&&"function"==typeof t.callee?"Arguments":e};D||Y(Object.prototype,"toString",D?{}.toString:function(){return"[object "+ee(this)+"]"},{unsafe:!0});function te(e){return isNaN(e=+e)?0:(0<e?de:he)(e)}function ne(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function re(e){return me(ne(e))}function ie(e){return"function"==typeof e?e:void 0}function se(e,t){return arguments.length<2?ie(_e[e])||ie(v[e]):_e[e]&&_e[e][t]||v[e]&&v[e][t]}function oe(e){return 0<e?we(te(e),9007199254740991):0}function ae(e,t){var n,r=re(e),i=0,s=[];for(n in r)!c(H,n)&&c(r,n)&&s.push(n);for(;t.length>i;)c(r,n=t[i++])&&(~Te(s,n)||s.push(n));return s}function ce(e,t){for(var n=Ae(t),r=w.f,i=ve.f,s=0;s<n.length;s++){var o=n[s];c(e,o)||r(e,o,i(t,o))}}function le(e,t){var n,r,i,s=e.target,o=e.global,a=e.stat,c=o?v:a?v[s]||l(s,{}):(v[s]||{}).prototype;if(c)for(n in t){if(r=t[n],i=e.noTargetGet?(i=Le(c,n))&&i.value:c[n],!De(o?n:s+(a?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;ce(r,i)}(e.sham||i&&i.sham)&&b(r,"sham",!0),Y(c,n,r,e)}}function ue(e){return Object(ne(e))}var he=Math.ceil,de=Math.floor,O=function(s){return function(e,t){var n,r=String(ne(e)),i=te(t),e=r.length;return i<0||e<=i?s?"":void 0:(t=r.charCodeAt(i))<55296||56319<t||i+1===e||(n=r.charCodeAt(i+1))<56320||57343<n?s?r.charAt(i):t:s?r.slice(i,i+2):n-56320+(t-55296<<10)+65536}},W={codeAt:O(!1),charAt:O(!0)},s={}.propertyIsEnumerable,fe=Object.getOwnPropertyDescriptor,pe={f:fe&&!s.call({1:2},1)?function(e){e=fe(this,e);return!!e&&e.enumerable}:s},ge="".split,me=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==G(e)?ge.call(e,""):Object(e)}:Object,ye=Object.getOwnPropertyDescriptor,ve={f:d?ye:function(e,t){if(e=re(e),t=r(t,!0),p)try{return ye(e,t)}catch(e){}if(c(e,t))return g(!pe.f.call(e,t),e[t])}},_e=v,we=Math.min,be=Math.max,Ie=Math.min,I=function(a){return function(e,t,n){var r,i=re(e),s=oe(i.length),o=function(e,t){e=te(e);return e<0?be(e+t,0):Ie(e,t)}(n,s);if(a&&t!=t){for(;o<s;)if((r=i[o++])!=r)return!0}else for(;o<s;o++)if((a||o in i)&&i[o]===t)return a||o||0;return!a&&-1}},Te={includes:I(!0),indexOf:I(!1)}.indexOf,Ee=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Se=Ee.concat("length","prototype"),ke={f:Object.getOwnPropertyNames||function(e){return ae(e,Se)}},Ce={f:Object.getOwnPropertySymbols},Ae=se("Reflect","ownKeys")||function(e){var t=ke.f(f(e)),n=Ce.f;return n?t.concat(n(e)):t},Ne=/#|\.prototype\./,D=function(e,t){e=Pe[Re(e)];return e==Oe||e!=xe&&("function"==typeof t?m(t):!!t)},Re=D.normalize=function(e){return String(e).replace(Ne,".").toLowerCase()},Pe=D.data={},xe=D.NATIVE="N",Oe=D.POLYFILL="P",De=D,Le=ve.f,O=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Me=e("IE_PROTO"),Fe=Object.prototype,Ue=O?Object.getPrototypeOf:function(e){return e=ue(e),c(e,Me)?e[Me]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Fe:null},s=i("iterator"),I=!1;[].keys&&("next"in(Xt=[].keys())?(Zt=Ue(Ue(Xt)))!==Object.prototype&&(tn=Zt):I=!0),c(tn=null==tn?{}:tn,s)||b(tn,s,function(){return this});function je(){}function qe(e){return"<script>"+e+"</"+$e+">"}var Ve,D={IteratorPrototype:tn,BUGGY_SAFARI_ITERATORS:I},Be=Object.keys||function(e){return ae(e,Ee)},Ke=d?Object.defineProperties:function(e,t){f(e);for(var n,r=Be(t),i=r.length,s=0;s<i;)w.f(e,n=r[s++],t[n]);return e},ze=se("document","documentElement"),We="prototype",$e="script",He=e("IE_PROTO"),Ge=function(){try{Ve=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e;Ge=Ve?function(e){e.write(qe("")),e.close();var t=e.parentWindow.Object;return e=null,t}(Ve):((e=n("iframe")).style.display="none",ze.appendChild(e),e.src=String("javascript:"),(e=e.contentWindow.document).open(),e.write(qe("document.F=Object")),e.close(),e.F);for(var t=Ee.length;t--;)delete Ge[We][Ee[t]];return Ge()};H[He]=!0;function Qe(e,t,n){e&&!c(e=n?e:e.prototype,tt)&&et(e,tt,{configurable:!0,value:t})}function Ye(){return this}function Je(){return this}function Xe(e,t,n,r,i,s,o){function a(e){if(e===i&&p)return p;if(!ot&&e in d)return d[e];switch(e){case"keys":case ct:case lt:return function(){return new n(this,e)}}return function(){return new n(this)}}!function(e,t,n){t+=" Iterator";e.prototype=Ze(rt,{next:g(1,n)}),Qe(e,t,!1),nt[t]=Ye}(n,t,r);var c,l,u=t+" Iterator",h=!1,d=e.prototype,f=d[at]||d["@@iterator"]||i&&d[i],p=!ot&&f||a(i);if((r="Array"==t&&d.entries||f)&&(e=Ue(r.call(new e)),st!==Object.prototype&&e.next&&(Ue(e)!==st&&(it?it(e,st):"function"!=typeof e[at]&&b(e,at,Je)),Qe(e,u,!0))),i==ct&&f&&f.name!==ct&&(h=!0,p=function(){return f.call(this)}),d[at]!==p&&b(d,at,p),nt[t]=p,i)if(c={values:a(ct),keys:s?p:a("keys"),entries:a(lt)},o)for(l in c)!ot&&!h&&l in d||Y(d,l,c[l]);else le({target:t,proto:!0,forced:ot||h},c);return c}var Ze=Object.create||function(e,t){var n;return null!==e?(je[We]=f(e),n=new je,je[We]=null,n[He]=e):n=Ge(),void 0===t?n:Ke(n,t)},et=w.f,tt=i("toStringTag"),nt={},rt=D.IteratorPrototype,it=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return f(e),function(e){if(!y(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(t),r?n.call(e,t):e.__proto__=t,e}}():void 0),st=D.IteratorPrototype,ot=D.BUGGY_SAFARI_ITERATORS,at=i("iterator"),ct="values",lt="entries",ut=W.charAt,ht="String Iterator",dt=Q.set,ft=Q.getterFor(ht);Xe(String,"String",function(e){dt(this,{type:ht,string:String(e),index:0})},function(){var e=ft(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(n=ut(t,n),e.index+=n.length,{value:n,done:!1})});var pt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},gt=i("unscopables"),mt=Array.prototype;null==mt[gt]&&w.f(mt,gt,{configurable:!0,value:Ze(null)});var O=function(e){mt[gt][e]=!0},yt="Array Iterator",vt=Q.set,_t=Q.getterFor(yt),wt=Xe(Array,"Array",function(e,t){vt(this,{type:yt,target:re(e),index:0,kind:t})},function(){var e=_t(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");nt.Arguments=nt.Array,O("keys"),O("values"),O("entries");var bt,It=i("iterator"),Tt=i("toStringTag"),Et=wt.values;for(bt in pt){var St=v[bt],kt=St&&St.prototype;if(kt){if(kt[It]!==Et)try{b(kt,It,Et)}catch(mp){kt[It]=Et}if(kt[Tt]||b(kt,Tt,bt),pt[bt])for(var Ct in wt)if(kt[Ct]!==wt[Ct])try{b(kt,Ct,wt[Ct])}catch(mp){kt[Ct]=wt[Ct]}}}function At(e,t,n){for(var r in t)Y(e,r,t[r],n);return e}function Nt(e){var t=se(e),e=w.f;d&&t&&!t[Ft]&&e(t,Ft,{configurable:!0,get:function(){return this}})}function Rt(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function Pt(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}function xt(e){return void 0!==e&&(nt.Array===e||jt[Ut]===e)}function Ot(r,i,e){if(Rt(r),void 0===i)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}}function Dt(e){if(null!=e)return e[qt]||e["@@iterator"]||nt[ee(e)]}function Lt(t,e,n,r){try{return r?e(f(n)[0],n[1]):e(n)}catch(e){n=t.return;throw void 0!==n&&f(n.call(t)),e}}var Mt=v.Promise,Ft=i("species"),Ut=i("iterator"),jt=Array.prototype,qt=i("iterator"),Vt=t(function(e){function d(e,t){this.stopped=e,this.result=t}(e.exports=function(e,t,n,r,i){var s,o,a,c,l,u,h=Ot(t,n,r?2:1);if(i)s=e;else{if("function"!=typeof(i=Dt(e)))throw TypeError("Target is not iterable");if(xt(i)){for(o=0,a=oe(e.length);o<a;o++)if((c=r?h(f(u=e[o])[0],u[1]):h(e[o]))&&c instanceof d)return c;return new d(!1)}s=i.call(e)}for(l=s.next;!(u=l.call(s)).done;)if("object"==typeof(c=Lt(s,h,u.value,r))&&c&&c instanceof d)return c;return new d(!1)}).stop=function(e){return new d(!0,e)}}),Bt=i("iterator"),Kt=!1;try{var zt=0,Wt={next:function(){return{done:!!zt++}},return:function(){Kt=!0}};Wt[Bt]=function(){return this},Array.from(Wt,function(){throw 2})}catch(mp){}function $t(e,t){if(!t&&!Kt)return!1;var n=!1;try{var r={};r[Bt]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}function Ht(e,t){var n;return void 0===(e=f(e).constructor)||null==(n=f(e)[Jt])?t:Rt(n)}function Gt(e){var t;on.hasOwnProperty(e)&&(t=on[e],delete on[e],t())}function Qt(e){return function(){Gt(e)}}var Yt,Jt=i("species"),Xt=se("navigator","userAgent")||"",Zt=/(iphone|ipod|ipad).*applewebkit/i.test(Xt),en=v.location,s=v.setImmediate,tn=v.clearImmediate,nn=v.process,I=v.MessageChannel,rn=v.Dispatch,sn=0,on={},an="onreadystatechange",D=function(e){Gt(e.data)},W=function(e){v.postMessage(e+"",en.protocol+"//"+en.host)};s&&tn||(s=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return on[++sn]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Yt(sn),sn},tn=function(e){delete on[e]},"process"==G(nn)?Yt=function(e){nn.nextTick(Qt(e))}:rn&&rn.now?Yt=function(e){rn.now(Qt(e))}:I&&!Zt?(I=(Wt=new I).port2,Wt.port1.onmessage=D,Yt=Ot(I.postMessage,I,1)):!v.addEventListener||"function"!=typeof postMessage||v.importScripts||m(W)||"file:"===en.protocol?Yt=an in n("script")?function(e){ze.appendChild(n("script"))[an]=function(){ze.removeChild(this),Gt(e)}}:function(e){setTimeout(Qt(e),0)}:(Yt=W,v.addEventListener("message",D,!1)));var cn,ln,un,hn,dn,fn,pn,gn,W={set:s,clear:tn},D=ve.f,mn=W.set,s=v.MutationObserver||v.WebKitMutationObserver,yn=v.process,tn=v.Promise,vn="process"==G(yn),D=D(v,"queueMicrotask"),D=D&&D.value;D||(cn=function(){var e,t;for(vn&&(e=yn.domain)&&e.exit();ln;){t=ln.fn,ln=ln.next;try{t()}catch(e){throw ln?hn():un=void 0,e}}un=void 0,e&&e.enter()},hn=vn?function(){yn.nextTick(cn)}:s&&!Zt?(dn=!0,fn=document.createTextNode(""),new s(cn).observe(fn,{characterData:!0}),function(){fn.data=dn=!dn}):tn&&tn.resolve?(pn=tn.resolve(void 0),gn=pn.then,function(){gn.call(pn,cn)}):function(){mn.call(v,cn)});function _n(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=Rt(n),this.reject=Rt(r)}function wn(e,t){return f(e),y(t)&&t.constructor===e?t:((0,(e=Tn.f(e)).resolve)(t),e.promise)}function bn(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}var In=D||function(e){e={fn:e,next:void 0};un&&(un.next=e),ln||(ln=e,hn()),un=e},Tn={f:function(e){return new _n(e)}},tn=v.process,D=tn&&tn.versions,tn=D&&D.v8;tn?ur=(lr=tn.split("."))[0]+lr[1]:Xt&&(!(lr=Xt.match(/Edge\/(\d+)/))||74<=lr[1])&&(lr=Xt.match(/Chrome\/(\d+)/))&&(ur=lr[1]);function En(e){var t;return!(!y(e)||"function"!=typeof(t=e.then))&&t}function Sn(h,d,f){var p;d.notified||(d.notified=!0,p=d.reactions,In(function(){for(var e=d.value,t=1==d.state,n=0;p.length>n;){var r,i,s,o=p[n++],a=t?o.ok:o.fail,c=o.resolve,l=o.reject,u=o.domain;try{a?(t||(2===d.rejection&&Xn(h,d),d.rejection=1),!0===a?r=e:(u&&u.enter(),r=a(e),u&&(u.exit(),s=!0)),r===o.promise?l(Vn("Promise-chain cycle")):(i=En(r))?i.call(r,c,l):c(r)):l(e)}catch(e){u&&!s&&u.exit(),l(e)}}d.reactions=[],d.notified=!1,f&&!d.rejection&&Yn(h,d)}))}function kn(e,t,n){var r;Gn?((r=Bn.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),v.dispatchEvent(r)):r={promise:t,reason:n},(t=v["on"+e])?t(r):e===Qn&&function(e,t){var n=v.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)}function Cn(t,n,r,i){return function(e){t(n,r,e,i)}}function An(e,t,n,r){t.done||(t.done=!0,(t=r?r:t).value=n,t.state=2,Sn(e,t,!0))}var Nn,Rn,Pn,xn,On=ur&&+ur,Dn=W.set,Ln=i("species"),Mn="Promise",Fn=Q.get,Un=Q.set,jn=Q.getterFor(Mn),qn=Mt,Vn=v.TypeError,Bn=v.document,Kn=v.process,zn=se("fetch"),Wn=Tn.f,$n=Wn,Hn="process"==G(Kn),Gn=!!(Bn&&Bn.createEvent&&v.dispatchEvent),Qn="unhandledrejection",D=De(Mn,function(){if(!(z(qn)!==String(qn))){if(66===On)return!0;if(!Hn&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=On&&/native code/.test(qn))return!1;function e(e){e(function(){},function(){})}var t=qn.resolve(1);return(t.constructor={})[Ln]=e,!(t.then(function(){})instanceof e)}),tn=D||!$t(function(e){qn.all(e).catch(function(){})}),Yn=function(r,i){Dn.call(v,function(){var e,t=i.value,n=Jn(i);if(n&&(e=bn(function(){Hn?Kn.emit("unhandledRejection",t,r):kn(Qn,r,t)}),i.rejection=Hn||Jn(i)?2:1,e.error))throw e.value})},Jn=function(e){return 1!==e.rejection&&!e.parent},Xn=function(e,t){Dn.call(v,function(){Hn?Kn.emit("rejectionHandled",e):kn("rejectionhandled",e,t.value)})},Zn=function(n,r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(n===e)throw Vn("Promise can't be resolved itself");var i=En(e);i?In(function(){var t={done:!1};try{i.call(e,Cn(Zn,n,t,r),Cn(An,n,t,r))}catch(e){An(n,t,e,r)}}):(r.value=e,r.state=1,Sn(n,r,!1))}catch(e){An(n,{done:!1},e,r)}}};D&&(qn=function(e){Pt(this,qn,Mn),Rt(e),Nn.call(this);var t=Fn(this);try{e(Cn(Zn,this,t),Cn(An,this,t))}catch(e){An(this,t,e)}},(Nn=function(e){Un(this,{type:Mn,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=At(qn.prototype,{then:function(e,t){var n=jn(this),r=Wn(Ht(this,qn));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Hn?Kn.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Sn(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Rn=function(){var e=new Nn,t=Fn(e);this.promise=e,this.resolve=Cn(Zn,e,t),this.reject=Cn(An,e,t)},Tn.f=Wn=function(e){return e===qn||e===Pn?new Rn:$n(e)},"function"==typeof Mt&&(xn=Mt.prototype.then,Y(Mt.prototype,"then",function(e,t){var n=this;return new qn(function(e,t){xn.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof zn&&le({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return wn(qn,zn.apply(v,arguments))}}))),le({global:!0,wrap:!0,forced:D},{Promise:qn}),Qe(qn,Mn,!1),Nt(Mn),Pn=se(Mn),le({target:Mn,stat:!0,forced:D},{reject:function(e){var t=Wn(this);return t.reject.call(void 0,e),t.promise}}),le({target:Mn,stat:!0,forced:D},{resolve:function(e){return wn(this,e)}}),le({target:Mn,stat:!0,forced:tn},{all:function(e){var a=this,t=Wn(a),c=t.resolve,l=t.reject,n=bn(function(){var r=Rt(a.resolve),i=[],s=0,o=1;Vt(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]=e,--o||c(i))},l)}),--o||c(i)});return n.error&&l(n.value),t.promise},race:function(e){var n=this,r=Wn(n),i=r.reject,t=bn(function(){var t=Rt(n.resolve);Vt(e,function(e){t.call(n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}}),le({target:"Promise",stat:!0},{allSettled:function(e){var a=this,t=Tn.f(a),c=t.resolve,n=t.reject,r=bn(function(){var r=Rt(a.resolve),i=[],s=0,o=1;Vt(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--o||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--o||c(i))})}),--o||c(i)});return r.error&&n(r.value),t.promise}});Xt=!!Mt&&m(function(){Mt.prototype.finally.call({then:function(){}},function(){})});le({target:"Promise",proto:!0,real:!0,forced:Xt},{finally:function(t){var n=Ht(this,se("Promise")),e="function"==typeof t;return this.then(e?function(e){return wn(n,t()).then(function(){return e})}:t,e?function(e){return wn(n,t()).then(function(){throw e})}:t)}}),"function"!=typeof Mt||Mt.prototype.finally||Y(Mt.prototype,"finally",se("Promise").prototype.finally),_e.Promise;var er=Q.set,tr=Q.getterFor("AggregateError"),nr=function(e,t){var n=this;if(!(n instanceof nr))return new nr(e,t);it&&(n=it(new Error(t),Ue(n)));var r=[];return Vt(e,r.push,r),d?er(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==t&&b(n,"message",String(t)),n};nr.prototype=Ze(Error.prototype,{constructor:g(5,nr),message:g(5,""),name:g(5,"AggregateError")}),d&&w.f(nr.prototype,"errors",{get:function(){return tr(this).errors},configurable:!0}),le({global:!0},{AggregateError:nr}),le({target:"Promise",stat:!0},{try:function(e){var t=Tn.f(this),e=bn(e);return(e.error?t.reject:t.resolve)(e.value),t.promise}});var rr="No one promise resolved";le({target:"Promise",stat:!0},{any:function(e){var c=this,t=Tn.f(c),l=t.resolve,u=t.reject,n=bn(function(){var r=Rt(c.resolve),i=[],s=0,o=1,a=!1;Vt(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(c,e).then(function(e){n||a||(a=!0,l(e))},function(e){n||a||(n=!0,i[t]=e,--o||u(new(se("AggregateError"))(i,rr)))})}),--o||u(new(se("AggregateError"))(i,rr))});return n.error&&u(n.value),t.promise}});function ir(e,t){var n;return new(void 0===(n=or(e)&&("function"==typeof(n=e.constructor)&&(n===Array||or(n.prototype))||y(n)&&null===(n=n[ar]))?void 0:n)?Array:n)(0===t?0:t)}function sr(e){throw e}var or=Array.isArray||function(e){return"Array"==G(e)},ar=i("species"),cr=[].push,lr=function(d){var f=1==d,p=2==d,g=3==d,m=4==d,y=6==d,v=5==d||y;return function(e,t,n,r){for(var i,s,o=ue(e),a=me(o),c=Ot(t,n,3),l=oe(a.length),u=0,r=r||ir,h=f?r(e,l):p?r(e,0):void 0;u<l;u++)if((v||u in a)&&(s=c(i=a[u],u,o),d))if(f)h[u]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return u;case 2:cr.call(h,i)}else if(m)return!1;return y?-1:g||m?m:h}},ur={forEach:lr(0),map:lr(1),filter:lr(2),some:lr(3),every:lr(4),find:lr(5),findIndex:lr(6)},hr=Object.defineProperty,dr={},W=function(e,t){if(c(dr,e))return dr[e];var n=[][e],r=!!c(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=c(t,0)?t[0]:sr,s=c(t,1)?t[1]:void 0;return dr[e]=!!n&&!m(function(){if(r&&!d)return 1;var e={length:-1};r?hr(e,1,{enumerable:!0,get:sr}):e[1]=1,n.call(e,i,s)})},fr=ur.find,D="find",pr=!0,tn=W(D);D in[]&&Array(1)[D](function(){pr=!1}),le({target:"Array",proto:!0,forced:pr||!tn},{find:function(e){return fr(this,e,1<arguments.length?arguments[1]:void 0)}}),O(D);var gr=Function.call,Xt=function(e,t,n){return Ot(gr,v[e].prototype[t],n)};Xt("Array","find");var mr=ur.findIndex,lr="findIndex",yr=!0,tn=W(lr);lr in[]&&Array(1)[lr](function(){yr=!1}),le({target:"Array",proto:!0,forced:yr||!tn},{findIndex:function(e){return mr(this,e,1<arguments.length?arguments[1]:void 0)}}),O(lr),Xt("Array","findIndex");function vr(e,t,n){(t=r(t))in e?w.f(e,t,g(0,n)):e[t]=n}D=!$t(function(e){Array.from(e)});le({target:"Array",stat:!0,forced:D},{from:function(e){var t,n,r,i,s,o,a=ue(e),c="function"==typeof this?this:Array,l=arguments.length,u=1<l?arguments[1]:void 0,h=void 0!==u,e=Dt(a),d=0;if(h&&(u=Ot(u,2<l?arguments[2]:void 0,2)),null==e||c==Array&&xt(e))for(n=new c(t=oe(a.length));d<t;d++)o=h?u(a[d],d):a[d],vr(n,d,o);else for(s=(i=e.call(a)).next,n=new c;!(r=s.call(i)).done;d++)o=h?Lt(i,u,[r.value,d],!0):r.value,vr(n,d,o);return n.length=d,n}}),_e.Array.from;var _r,wr,br=ur.some,tn=!!(wr=[]["some"])&&m(function(){wr.call(null,_r||function(){throw 1},1)}),O=W("some");le({target:"Array",proto:!0,forced:!tn||!O},{some:function(e){return br(this,e,1<arguments.length?arguments[1]:void 0)}}),Xt("Array","some");function Ir(e){return y(e)&&c(Rr,ee(e))}var Tr,lr="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,D=w.f,Er=v.Int8Array,Sr=Er&&Er.prototype,W=v.Uint8ClampedArray,tn=W&&W.prototype,kr=Er&&Ue(Er),Cr=Sr&&Ue(Sr),O=Object.prototype,W=(O.isPrototypeOf,i("toStringTag")),Ar=a("TYPED_ARRAY_TAG"),Nr=lr&&!!it&&"Opera"!==ee(v.opera),lr=!1,Rr={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(Tr in Rr)v[Tr]||(Nr=!1);if((!Nr||"function"!=typeof kr||kr===Function.prototype)&&(kr=function(){throw TypeError("Incorrect invocation")},Nr))for(Tr in Rr)v[Tr]&&it(v[Tr],kr);if((!Nr||!Cr||Cr===O)&&(Cr=kr.prototype,Nr))for(Tr in Rr)v[Tr]&&it(v[Tr].prototype,Cr);if(Nr&&Ue(tn)!==Cr&&it(tn,Cr),d&&!c(Cr,W))for(Tr in lr=!0,D(Cr,W,{get:function(){return y(this)?this[Ar]:void 0}}),Rr)v[Tr]&&b(v[Tr],Ar,Tr);var tn=function(e){if(Ir(e))return e;throw TypeError("Target is not a typed array")},D=function(e,t,n){if(d){if(n)for(var r in Rr){r=v[r];r&&c(r.prototype,e)&&delete r.prototype[e]}Cr[e]&&!n||Y(Cr,e,!n&&Nr&&Sr[e]||t)}},W=i("iterator"),lr=v.Uint8Array,Pr=wt.values,xr=wt.keys,Or=wt.entries,Dr=tn,tn=D,D=lr&&lr.prototype[W],lr=!!D&&("values"==D.name||null==D.name),D=function(){return Pr.call(Dr(this))};tn("entries",function(){return Or.call(Dr(this))}),tn("keys",function(){return xr.call(Dr(this))}),tn("values",D,!lr),tn(W,D,!lr);var Lr=Object.assign,Mr=Object.defineProperty,D=!Lr||m(function(){if(d&&1!==Lr({b:1},Lr(Mr({},"a",{enumerable:!0,get:function(){Mr(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return 1;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=Lr({},e)[n]||Be(Lr({},t)).join("")!=r})?function(e,t){for(var n=ue(e),r=arguments.length,i=1,s=Ce.f,o=pe.f;i<r;)for(var a,c=me(arguments[i++]),l=s?Be(c).concat(s(c)):Be(c),u=l.length,h=0;h<u;)a=l[h++],d&&!o.call(c,a)||(n[a]=c[a]);return n}:Lr;le({target:"Object",stat:!0,forced:Object.assign!==D},{assign:D}),_e.Object.assign;var Fr=pe.f,lr=function(a){return function(e){for(var t,n=re(e),r=Be(n),i=r.length,s=0,o=[];s<i;)t=r[s++],d&&!Fr.call(n,t)||o.push(a?[t,n[t]]:n[t]);return o}},D={entries:lr(!0),values:lr(!1)},Ur=D.entries;le({target:"Object",stat:!0},{entries:function(e){return Ur(e)}}),_e.Object.entries;var jr=D.values;le({target:"Object",stat:!0},{values:function(e){return jr(e)}}),_e.Object.values;function qr(e){if(y(t=e)&&(void 0!==(n=t[Vr])?!!n:"RegExp"==G(t)))throw TypeError("The method doesn't accept regular expressions");var t,n;return e}var Vr=i("match"),Br=i("match"),lr=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[Br]=!1,"/./"[t](n)}catch(e){}}return!1};le({target:"String",proto:!0,forced:!lr("includes")},{includes:function(e){return!!~String(ne(this)).indexOf(qr(e),1<arguments.length?arguments[1]:void 0)}}),Xt("String","includes");var Kr,D=ve.f,zr="".startsWith,Wr=Math.min,lr=lr("startsWith"),Kr=!(lr||(!(Kr=D(String.prototype,"startsWith"))||Kr.writable));le({target:"String",proto:!0,forced:!Kr&&!lr},{startsWith:function(e){var t=String(ne(this));qr(e);var n=oe(Wr(1<arguments.length?arguments[1]:void 0,t.length)),e=String(e);return zr?zr.call(t,e,n):t.slice(n,n+e.length)===e}}),Xt("String","startsWith"),le({target:"String",proto:!0},{repeat:"".repeat||function(e){var t=String(ne(this)),n="",r=te(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}}),Xt("String","repeat");var $r,Hr=i("species"),Gr=i("isConcatSpreadable"),Qr=9007199254740991,Yr="Maximum allowed index exceeded",lr=51<=On||!m(function(){var e=[];return e[Gr]=!1,e.concat()[0]!==e}),Xt=($r="concat",51<=On||!m(function(){var e=[];return(e.constructor={})[Hr]=function(){return{foo:1}},1!==e[$r](Boolean).foo}));le({target:"Array",proto:!0,forced:!lr||!Xt},{concat:function(e){for(var t,n,r,i=ue(this),s=ir(i,0),o=0,a=-1,c=arguments.length;a<c;a++)if(function(e){if(!y(e))return!1;var t=e[Gr];return void 0!==t?!!t:or(e)}(r=-1===a?i:arguments[a])){if(n=oe(r.length),Qr<o+n)throw TypeError(Yr);for(t=0;t<n;t++,o++)t in r&&vr(s,o,r[t])}else{if(Qr<=o)throw TypeError(Yr);vr(s,o++,r)}return s.length=o,s}});function Jr(e){var t=_e.Symbol||(_e.Symbol={});c(t,e)||ii(t,e,{value:ri.f(e)})}function Xr(e,t){var n=vi[e]=Ze(di[ci]);return li(n,{type:ai,tag:e,description:t}),d||(n.description=t),n}function Zr(t,e){f(t);var n=re(e),e=Be(n).concat(Ci(n));return si(e,function(e){d&&!ki.call(n,e)||Si(t,e,n[e])}),t}var ei=ke.f,ti={}.toString,ni="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Xt={f:function(e){return ni&&"[object Window]"==ti.call(e)?function(e){try{return ei(e)}catch(e){return ni.slice()}}(e):ei(re(e))}},ri={f:i},ii=w.f,si=ur.forEach,oi=e("hidden"),ai="Symbol",ci="prototype",ur=i("toPrimitive"),li=Q.set,ui=Q.getterFor(ai),hi=Object[ci],di=v.Symbol,fi=se("JSON","stringify"),pi=ve.f,gi=w.f,mi=Xt.f,yi=pe.f,vi=E("symbols"),_i=E("op-symbols"),wi=E("string-to-symbol-registry"),bi=E("symbol-to-string-registry"),e=E("wks"),E=v.QObject,Ii=!E||!E[ci]||!E[ci].findChild,Ti=d&&m(function(){return 7!=Ze(gi({},"a",{get:function(){return gi(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=pi(hi,t);r&&delete hi[t],gi(e,t,n),r&&e!==hi&&gi(hi,t,r)}:gi,Ei=N?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof di},Si=function(e,t,n){e===hi&&Si(_i,t,n),f(e);t=r(t,!0);return f(n),c(vi,t)?(n.enumerable?(c(e,oi)&&e[oi][t]&&(e[oi][t]=!1),n=Ze(n,{enumerable:g(0,!1)})):(c(e,oi)||gi(e,oi,g(1,{})),e[oi][t]=!0),Ti(e,t,n)):gi(e,t,n)},ki=function(e){var t=r(e,!0),e=yi.call(this,t);return!(this===hi&&c(vi,t)&&!c(_i,t))&&(!(e||!c(this,t)||!c(vi,t)||c(this,oi)&&this[oi][t])||e)},E=function(e,t){var n=re(e),e=r(t,!0);if(n!==hi||!c(vi,e)||c(_i,e)){t=pi(n,e);return!t||!c(vi,e)||c(n,oi)&&n[oi][e]||(t.enumerable=!0),t}},N=function(e){var e=mi(re(e)),t=[];return si(e,function(e){c(vi,e)||c(H,e)||t.push(e)}),t},Ci=function(e){var t=e===hi,e=mi(t?_i:re(e)),n=[];return si(e,function(e){!c(vi,e)||t&&!c(hi,e)||n.push(vi[e])}),n};A||(Y((di=function(){if(this instanceof di)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=a(e),n=function(e){this===hi&&n.call(_i,e),c(this,oi)&&c(this[oi],t)&&(this[oi][t]=!1),Ti(this,t,g(1,e))};return d&&Ii&&Ti(hi,t,{configurable:!0,set:n}),Xr(t,e)})[ci],"toString",function(){return ui(this).tag}),Y(di,"withoutSetter",function(e){return Xr(a(e),e)}),pe.f=ki,w.f=Si,ve.f=E,ke.f=Xt.f=N,Ce.f=Ci,ri.f=function(e){return Xr(i(e),e)},d&&(gi(di[ci],"description",{configurable:!0,get:function(){return ui(this).description}}),Y(hi,"propertyIsEnumerable",ki,{unsafe:!0}))),le({global:!0,wrap:!0,forced:!A,sham:!A},{Symbol:di}),si(Be(e),function(e){Jr(e)}),le({target:ai,stat:!0,forced:!A},{for:function(e){var t=String(e);if(c(wi,t))return wi[t];e=di(t);return wi[t]=e,bi[e]=t,e},keyFor:function(e){if(!Ei(e))throw TypeError(e+" is not a symbol");if(c(bi,e))return bi[e]},useSetter:function(){Ii=!0},useSimple:function(){Ii=!1}}),le({target:"Object",stat:!0,forced:!A,sham:!d},{create:function(e,t){return void 0===t?Ze(e):Zr(Ze(e),t)},defineProperty:Si,defineProperties:Zr,getOwnPropertyDescriptor:E}),le({target:"Object",stat:!0,forced:!A},{getOwnPropertyNames:N,getOwnPropertySymbols:Ci}),le({target:"Object",stat:!0,forced:m(function(){Ce.f(1)})},{getOwnPropertySymbols:function(e){return Ce.f(ue(e))}}),fi&&(qi=!A||m(function(){var e=di();return"[null]"!=fi([e])||"{}"!=fi({a:e})||"{}"!=fi(Object(e))}),le({target:"JSON",stat:!0,forced:qi},{stringify:function(e,t,n){for(var r,i=[e],s=1;s<arguments.length;)i.push(arguments[s++]);if((y(r=t)||void 0!==e)&&!Ei(e))return or(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ei(t))return t}),i[1]=t,fi.apply(null,i)}})),di[ci][ur]||b(di[ci],ur,di[ci].valueOf),Qe(di,ai),H[oi]=!0,Jr("asyncIterator");var Ai,Ni,Ri,Pi,xi,E=w.f,Oi=v.Symbol;!d||"function"!=typeof Oi||"description"in Oi.prototype&&void 0===Oi().description||(Ai={},ce(Ni=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Ni?new Oi(e):void 0===e?Oi():Oi(e);return""===e&&(Ai[t]=!0),t},Oi),(Ki=Ni.prototype=Oi.prototype).constructor=Ni,Ri=Ki.toString,Pi="Symbol(test)"==String(Oi("test")),xi=/^Symbol\((.*)\)[^)]+$/,E(Ki,"description",{configurable:!0,get:function(){var e=y(this)?this.valueOf():this,t=Ri.call(e);if(c(Ai,e))return"";t=Pi?t.slice(7,-1):t.replace(xi,"$1");return""===t?void 0:t}}),le({global:!0,forced:!0},{Symbol:Ni})),Jr("hasInstance"),Jr("isConcatSpreadable"),Jr("iterator"),Jr("match"),Jr("matchAll"),Jr("replace"),Jr("search"),Jr("species"),Jr("split"),Jr("toPrimitive"),Jr("toStringTag"),Jr("unscopables"),Qe(Math,"Math",!0),Qe(v.JSON,"JSON",!0),_e.Symbol,Jr("asyncDispose"),Jr("dispose"),Jr("observable"),Jr("patternMatch"),Jr("replaceAll"),ri.f("iterator");var Di=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Li=t(function(e){function n(e){t(e,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var t=w.f,r=a("meta"),i=0,s=Object.isExtensible||function(){return!0},o=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!y(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!c(e,r)){if(!s(e))return"F";if(!t)return"E";n(e)}return e[r].objectID},getWeakData:function(e,t){if(!c(e,r)){if(!s(e))return!0;if(!t)return!1;n(e)}return e[r].weakData},onFreeze:function(e){return Di&&o.REQUIRED&&s(e)&&!c(e,r)&&n(e),e}};H[r]=!0}),N=function(o,e,t){function n(e){var n=f[e];Y(f,e,"add"==e?function(e){return n.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(u&&!y(e))&&n.call(this,0===e?0:e)}:"get"==e?function(e){return u&&!y(e)?void 0:n.call(this,0===e?0:e)}:"has"==e?function(e){return!(u&&!y(e))&&n.call(this,0===e?0:e)}:function(e,t){return n.call(this,0===e?0:e,t),this})}var r,i,s,a,c,l=-1!==o.indexOf("Map"),u=-1!==o.indexOf("Weak"),h=l?"set":"add",d=v[o],f=d&&d.prototype,p=d,g={};return De(o,"function"!=typeof d||!(u||f.forEach&&!m(function(){(new d).entries().next()})))?(p=t.getConstructor(e,o,l,h),Li.REQUIRED=!0):De(o,!0)&&(i=(r=new p)[h](u?{}:-0,1)!=r,s=m(function(){r.has(1)}),a=$t(function(e){new d(e)}),c=!u&&m(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),a||(((p=e(function(e,t){Pt(e,p,o);var n,r,i,s,n=(n=new d,r=e,e=p,it&&"function"==typeof(i=r.constructor)&&i!==e&&y(s=i.prototype)&&s!==e.prototype&&it(n,s),n);return null!=t&&Vt(t,n[h],n,l),n})).prototype=f).constructor=p),(s||c)&&(n("delete"),n("has"),l&&n("get")),(c||i)&&n(h),u&&f.clear&&delete f.clear),g[o]=p,le({global:!0,forced:p!=d},g),Qe(p,o),u||t.setStrong(p,o,l),p},Mi=w.f,Fi=Li.fastKey,Ui=Q.set,ji=Q.getterFor,qi={getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=a(e),s=c(e,t);return s?s.value=n:(i.last=s={index:r=Fi(t,!0),key:t,value:n,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=s),n&&(n.next=s),d?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}var o=e(function(e,t){Pt(e,o,n),Ui(e,{type:n,index:Ze(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=t&&Vt(t,e[i],e,r)}),a=ji(n),c=function(e,t){var n,r=a(e),e=Fi(t);if("F"!==e)return r.index[e];for(n=r.first;n;n=n.next)if(n.key==t)return n};return At(o.prototype,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t,n=a(this),r=c(this,e);return r&&(t=r.next,e=r.previous,delete n.index[r.index],r.removed=!0,e&&(e.next=t),t&&(t.previous=e),n.first==r&&(n.first=t),n.last==r&&(n.last=e),d?n.size--:this.size--),!!r},forEach:function(e){for(var t,n=a(this),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),At(o.prototype,r?{get:function(e){e=c(this,e);return e&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),d&&Mi(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(e,t,n){var r=t+" Iterator",i=ji(t),s=ji(r);Xe(e,t,function(e,t){Ui(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),Nt(t)}};N("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},qi),_e.Map;ur=function(e){var t,n,r,i,s=arguments.length,o=1<s?arguments[1]:void 0;return Rt(this),(t=void 0!==o)&&Rt(o),null==e?new this:(n=[],t?(r=0,i=Ot(o,2<s?arguments[2]:void 0,2),Vt(e,function(e){n.push(i(e,r++))})):Vt(e,n.push,n),new this(n))};le({target:"Map",stat:!0},{from:ur});E=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)};le({target:"Map",stat:!0},{of:E});function Vi(){for(var e,t=f(this),n=Rt(t.delete),r=!0,i=0,s=arguments.length;i<s;i++)e=n.call(t,arguments[i]),r=r&&e;return!!r}le({target:"Map",proto:!0,real:!0,forced:o},{deleteAll:function(){return Vi.apply(this,arguments)}});function Bi(e){return Map.prototype.entries.call(e)}le({target:"Map",proto:!0,real:!0,forced:o},{every:function(e){var n=f(this),t=Bi(n),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);return!Vt(t,function(e,t){if(!r(t,e,n))return Vt.stop()},void 0,!0,!0).stopped}}),le({target:"Map",proto:!0,real:!0,forced:o},{filter:function(e){var n=f(this),t=Bi(n),r=Ot(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(n,se("Map"))),s=Rt(i.set);return Vt(t,function(e,t){r(t,e,n)&&s.call(i,e,t)},void 0,!0,!0),i}}),le({target:"Map",proto:!0,real:!0,forced:o},{find:function(e){var n=f(this),t=Bi(n),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);return Vt(t,function(e,t){if(r(t,e,n))return Vt.stop(t)},void 0,!0,!0).result}}),le({target:"Map",proto:!0,real:!0,forced:o},{findKey:function(e){var n=f(this),t=Bi(n),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);return Vt(t,function(e,t){if(r(t,e,n))return Vt.stop(e)},void 0,!0,!0).result}}),le({target:"Map",stat:!0},{groupBy:function(e,n){var r=new this;Rt(n);var i=Rt(r.has),s=Rt(r.get),o=Rt(r.set);return Vt(e,function(e){var t=n(e);i.call(r,t)?s.call(r,t).push(e):o.call(r,t,[e])}),r}});le({target:"Map",proto:!0,real:!0,forced:o},{includes:function(r){return Vt(Bi(f(this)),function(e,t){if((n=t)===(t=r)||n!=n&&t!=t)return Vt.stop();var n},void 0,!0,!0).stopped}}),le({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;Rt(t);var r=Rt(n.set);return Vt(e,function(e){r.call(n,t(e),e)}),n}}),le({target:"Map",proto:!0,real:!0,forced:o},{keyOf:function(n){return Vt(Bi(f(this)),function(e,t){if(t===n)return Vt.stop(e)},void 0,!0,!0).result}}),le({target:"Map",proto:!0,real:!0,forced:o},{mapKeys:function(e){var n=f(this),t=Bi(n),r=Ot(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(n,se("Map"))),s=Rt(i.set);return Vt(t,function(e,t){s.call(i,r(t,e,n),t)},void 0,!0,!0),i}}),le({target:"Map",proto:!0,real:!0,forced:o},{mapValues:function(e){var n=f(this),t=Bi(n),r=Ot(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(n,se("Map"))),s=Rt(i.set);return Vt(t,function(e,t){s.call(i,e,r(t,e,n))},void 0,!0,!0),i}}),le({target:"Map",proto:!0,real:!0,forced:o},{merge:function(e){for(var t=f(this),n=Rt(t.set),r=0;r<arguments.length;)Vt(arguments[r++],n,t,!0);return t}}),le({target:"Map",proto:!0,real:!0,forced:o},{reduce:function(n){var r=f(this),e=Bi(r),i=arguments.length<2,s=i?void 0:arguments[1];if(Rt(n),Vt(e,function(e,t){s=i?(i=!1,t):n(s,t,e,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return s}}),le({target:"Map",proto:!0,real:!0,forced:o},{some:function(e){var n=f(this),t=Bi(n),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);return Vt(t,function(e,t){if(r(t,e,n))return Vt.stop()},void 0,!0,!0).stopped}}),le({target:"Map",proto:!0,real:!0,forced:o},{update:function(e,t){var n=f(this),r=arguments.length;Rt(t);var i=n.has(e);if(!i&&r<3)throw TypeError("Updating absent value");r=i?n.get(e):Rt(2<r?arguments[2]:void 0)(e,n);return n.set(e,t(r,e,n)),n}});var Ki=function(e,t){var n,r=f(this),i=2<arguments.length?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(e)?(n=r.get(e),"function"==typeof t&&(n=t(n),r.set(e,n))):"function"==typeof i&&(n=i(),r.set(e,n)),n};le({target:"Map",proto:!0,real:!0,forced:o},{upsert:Ki}),le({target:"Map",proto:!0,real:!0,forced:o},{updateOrInsert:Ki}),N("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},qi),_e.Set,le({target:"Set",stat:!0},{from:ur}),le({target:"Set",stat:!0},{of:E});le({target:"Set",proto:!0,real:!0,forced:o},{addAll:function(){return function(){for(var e=f(this),t=Rt(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e}.apply(this,arguments)}}),le({target:"Set",proto:!0,real:!0,forced:o},{deleteAll:function(){return Vi.apply(this,arguments)}});function zi(e){return Set.prototype.values.call(e)}le({target:"Set",proto:!0,real:!0,forced:o},{every:function(e){var t=f(this),n=zi(t),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);return!Vt(n,function(e){if(!r(e,e,t))return Vt.stop()},void 0,!1,!0).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{difference:function(e){var t=f(this),n=new(Ht(t,se("Set")))(t),r=Rt(n.delete);return Vt(e,function(e){r.call(n,e)}),n}}),le({target:"Set",proto:!0,real:!0,forced:o},{filter:function(e){var t=f(this),n=zi(t),r=Ot(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(t,se("Set"))),s=Rt(i.add);return Vt(n,function(e){r(e,e,t)&&s.call(i,e)},void 0,!1,!0),i}}),le({target:"Set",proto:!0,real:!0,forced:o},{find:function(e){var t=f(this),n=zi(t),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);return Vt(n,function(e){if(r(e,e,t))return Vt.stop(e)},void 0,!1,!0).result}}),le({target:"Set",proto:!0,real:!0,forced:o},{intersection:function(e){var t=f(this),n=new(Ht(t,se("Set"))),r=Rt(t.has),i=Rt(n.add);return Vt(e,function(e){r.call(t,e)&&i.call(n,e)}),n}}),le({target:"Set",proto:!0,real:!0,forced:o},{isDisjointFrom:function(e){var t=f(this),n=Rt(t.has);return!Vt(e,function(e){if(!0===n.call(t,e))return Vt.stop()}).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{isSubsetOf:function(e){var t=function(e){var t=Dt(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return f(t.call(e))}(this),n=f(e),r=n.has;return"function"!=typeof r&&(n=new(se("Set"))(e),r=Rt(n.has)),!Vt(t,function(e){if(!1===r.call(n,e))return Vt.stop()},void 0,!1,!0).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{isSupersetOf:function(e){var t=f(this),n=Rt(t.has);return!Vt(e,function(e){if(!1===n.call(t,e))return Vt.stop()}).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{join:function(e){var t=f(this),n=zi(t),t=void 0===e?",":String(e),e=[];return Vt(n,e.push,e,!1,!0),e.join(t)}}),le({target:"Set",proto:!0,real:!0,forced:o},{map:function(e){var t=f(this),n=zi(t),r=Ot(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(t,se("Set"))),s=Rt(i.add);return Vt(n,function(e){s.call(i,r(e,e,t))},void 0,!1,!0),i}}),le({target:"Set",proto:!0,real:!0,forced:o},{reduce:function(t){var n=f(this),e=zi(n),r=arguments.length<2,i=r?void 0:arguments[1];if(Rt(t),Vt(e,function(e){i=r?(r=!1,e):t(i,e,e,n)},void 0,!1,!0),r)throw TypeError("Reduce of empty set with no initial value");return i}}),le({target:"Set",proto:!0,real:!0,forced:o},{some:function(e){var t=f(this),n=zi(t),r=Ot(e,1<arguments.length?arguments[1]:void 0,3);return Vt(n,function(e){if(r(e,e,t))return Vt.stop()},void 0,!1,!0).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{symmetricDifference:function(e){var t=f(this),n=new(Ht(t,se("Set")))(t),r=Rt(n.delete),i=Rt(n.add);return Vt(e,function(e){r.call(n,e)||i.call(n,e)}),n}}),le({target:"Set",proto:!0,real:!0,forced:o},{union:function(e){var t=f(this),t=new(Ht(t,se("Set")))(t);return Vt(e,Rt(t.add),t),t}});var Wi=Math.floor;le({target:"Number",stat:!0},{isInteger:function(e){return!y(e)&&isFinite(e)&&Wi(e)===e}}),_e.Number.isInteger;var $i=function(e,t){return($i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var Hi=function(){return(Hi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Gi(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Qi(e,o,a,c){return new(a=a||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}s((c=c.apply(e,o||[])).next())})}function Yi(n,r){var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],s=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function Ji(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xi(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function Zi(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}function es(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}function ts(e){return e=es(e),os.encodeByteArray(e,!0)}var ns=!1,rs="${JSCORE_VERSION}",is=function(e,t){if(!e)throw ss(t)},ss=function(e){return new Error("Firebase Database ("+rs+") INTERNAL ASSERT FAILED: "+e)},os={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var s=e[i],o=i+1<e.length,a=o?e[i+1]:0,c=i+2<e.length,l=c?e[i+2]:0,u=(15&a)<<2|l>>6,l=63&l;c||(l=64,o||(u=64)),r.push(n[s>>2],n[(3&s)<<4|a>>4],n[u],n[l])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(es(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i,s,o,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(s=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&s)):239<a&&a<365?(i=((7&a)<<18|(63&(s=e[n++]))<<12|(63&(o=e[n++]))<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],o=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&o))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var s=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==s||null==o||null==a||null==c)throw Error();r.push(s<<2|o>>4),64!==a&&(r.push(o<<4&240|a>>2),64!==c&&r.push(a<<6&192|c))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},as=function(e){return ts(e).replace(/\./g,"")},cs=function(e){try{return os.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ls(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=ls(e[n],t[n]));return e}var us=(hs.prototype.wrapCallback=function(n){var r=this;return function(e,t){e?r.reject(e):r.resolve(t),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(e):n(e,t))}},hs);function hs(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}function ds(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,t=e.sub||e.user_id;if(!t)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");e=Hi({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e);return[as(JSON.stringify({alg:"none",type:"JWT"})),as(JSON.stringify(e)),""].join(".")}function fs(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ps(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fs())}function gs(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function ms(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ys(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function vs(){var e=fs();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function _s(){return!0===ns}function ws(){return"indexedDB"in self&&null!=indexedDB}function bs(){return new Promise(function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}function Is(){return!(!navigator||!navigator.cookieEnabled)}var Ts,Es="FirebaseError",Ss=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}$i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(ks,Ts=Error),ks);function ks(e,t,n){t=Ts.call(this,t)||this;return t.code=e,t.customData=n,t.name=Es,Object.setPrototypeOf(t,ks.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,Cs.prototype.create),t}var Cs=(As.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},s=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(Ns,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+s+").";return new Ss(s,e,i)},As);function As(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var Ns=/\{\$([^}]+)}/g;function Rs(e){return JSON.parse(e)}function Ps(e){return JSON.stringify(e)}function xs(e){var t={},n={},r={},i="";try{var s=e.split("."),t=Rs(cs(s[0])||""),n=Rs(cs(s[1])||""),i=s[2],r=n.d||{};delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function Os(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ds(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Ls(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ms(e,t,n){var r,i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function Fs(e,t){if(e===t)return 1;for(var n=Object.keys(e),r=Object.keys(t),i=0,s=n;i<s.length;i++){var o=s[i];if(!r.includes(o))return;var a=e[o],c=t[o];if(Us(a)&&Us(c)){if(!Fs(a,c))return}else if(a!==c)return}for(var l=0,u=r;l<u.length;l++){o=u[l];if(!n.includes(o))return}return 1}function Us(e){return null!==e&&"object"==typeof e}function js(e){for(var n=[],t=0,r=Object.entries(e);t<r.length;t++){var i=r[t];!function(t,e){Array.isArray(e)?e.forEach(function(e){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}(i[0],i[1])}return n.length?"&"+n.join("&"):""}function qs(e){var n={};return e.replace(/^\?/,"").split("&").forEach(function(e){var t;e&&(e=(t=e.split("="))[0],t=t[1],n[decodeURIComponent(e)]=decodeURIComponent(t))}),n}function Vs(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}var Bs=(Ks.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Ks.prototype.compress_=function(e,t){t=t||0;var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}for(var s,o=this.chain_[0],a=this.chain_[1],c=this.chain_[2],l=this.chain_[3],u=this.chain_[4],r=0;r<80;r++)var h=r<40?r<20?(s=l^a&(c^l),1518500249):(s=a^c^l,1859775393):r<60?(s=a&c|l&(a|c),2400959708):(s=a^c^l,3395469782),i=(o<<5|o>>>27)+s+u+h+n[r]&4294967295,u=l,l=c,c=4294967295&(a<<30|a>>>2),a=o,o=i;this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},Ks.prototype.update=function(e,t){if(null!=e){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++r,++s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++r,++s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}},Ks.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,n=0;n<5;n++)for(var i=24;0<=i;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},Ks);function Ks(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}function zs(e,t){t=new Ws(e,t);return t.subscribe.bind(t)}var Ws=($s.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},$s.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},$s.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},$s.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=Hs),void 0===r.error&&(r.error=Hs),void 0===r.complete&&(r.complete=Hs);n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),n},$s.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},$s.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},$s.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},$s.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},$s);function $s(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function Hs(){}function Gs(e,t,n,r){var i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Qs(e,t){return e+" failed: "+t+" argument "}function Ys(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Qs(e,t)+"must be a valid function.")}function Js(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Qs(e,t)+"must be a valid context object.")}function Xs(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t}var Zs=1e3,eo=2,to=144e5,no=.5;function ro(e,t,n){void 0===n&&(n=eo);n=(t=void 0===t?Zs:t)*Math.pow(n,e),e=Math.round(no*n*(Math.random()-.5)*2);return Math.min(to,n+e)}function io(e){return e&&e._delegate?e._delegate:e}var so=(oo.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},oo.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},oo.prototype.setServiceProps=function(e){return this.serviceProps=e,this},oo.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},oo);function oo(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var ao="[DEFAULT]",co=(lo.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){e=new us;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise},lo.prototype.getImmediate=function(t){var e=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),t=null!==(t=null==t?void 0:t.optional)&&void 0!==t&&t;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(t)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(e){if(t)return null;throw e}},lo.prototype.getComponent=function(){return this.component},lo.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ao})}catch(e){}try{for(var r=Ji(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var s=Xi(i.value,2),o=s[0],a=s[1],c=this.normalizeInstanceIdentifier(o);try{var l=this.getOrInitializeService({instanceIdentifier:c});a.resolve(l)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},lo.prototype.clearInstance=function(e){this.instancesDeferred.delete(e=void 0===e?ao:e),this.instancesOptions.delete(e),this.instances.delete(e)},lo.prototype.delete=function(){return Qi(this,void 0,void 0,function(){var t;return Yi(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(Zi(Zi([],Xi(t.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),Xi(t.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return e.sent(),[2]}})})},lo.prototype.isComponentSet=function(){return null!=this.component},lo.prototype.isInitialized=function(e){return this.instances.has(e=void 0===e?ao:e)},lo.prototype.getOptions=function(e){return this.instancesOptions.get(e=void 0===e?ao:e)||{}},lo.prototype.initialize=function(e){var t,n,r=(e=void 0===e?{}:e).options,r=void 0===r?{}:r,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(this.name+"("+i+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var s=this.getOrInitializeService({instanceIdentifier:i,options:r});try{for(var o=Ji(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=Xi(a.value,2),l=c[0],u=c[1];i===this.normalizeInstanceIdentifier(l)&&u.resolve(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},lo.prototype.onInit=function(e,t){var n=this.normalizeInstanceIdentifier(t),r=null!==(t=this.onInitCallbacks.get(n))&&void 0!==t?t:new Set;r.add(e),this.onInitCallbacks.set(n,r);t=this.instances.get(n);return t&&e(t,n),function(){r.delete(e)}},lo.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var s=Ji(i),o=s.next();!o.done;o=s.next()){var a=o.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},lo.prototype.getOrInitializeService=function(e){var t=e.instanceIdentifier,n=e.options,r=void 0===n?{}:n,e=this.instances.get(t);if(!e&&this.component&&(e=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t)===ao?void 0:n,options:r}),this.instances.set(t,e),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(e,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,e)}catch(e){}return e||null},lo.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=ao),!this.component||this.component.multipleInstances?e:ao},lo.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},lo);function lo(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}var uo=(ho.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},ho.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},ho.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new co(e,this);return this.providers.set(e,t),t},ho.prototype.getProviders=function(){return Array.from(this.providers.values())},ho);function ho(e){this.name=e,this.providers=new Map}var fo,po=[];(qi=fo=fo||{})[qi.DEBUG=0]="DEBUG",qi[qi.VERBOSE=1]="VERBOSE",qi[qi.INFO=2]="INFO",qi[qi.WARN=3]="WARN",qi[qi.ERROR=4]="ERROR",qi[qi.SILENT=5]="SILENT";function go(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),s=vo[t];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[s].apply(console,Zi(["["+i+"]  "+e.name+":"],n))}}var mo={debug:fo.DEBUG,verbose:fo.VERBOSE,info:fo.INFO,warn:fo.WARN,error:fo.ERROR,silent:fo.SILENT},yo=fo.INFO,vo=((ur={})[fo.DEBUG]="log",ur[fo.VERBOSE]="log",ur[fo.INFO]="info",ur[fo.WARN]="warn",ur[fo.ERROR]="error",ur),_o=(Object.defineProperty(wo.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in fo))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),wo.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?mo[e]:e},Object.defineProperty(wo.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(wo.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),wo.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.DEBUG],e)),this._logHandler.apply(this,Zi([this,fo.DEBUG],e))},wo.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.VERBOSE],e)),this._logHandler.apply(this,Zi([this,fo.VERBOSE],e))},wo.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.INFO],e)),this._logHandler.apply(this,Zi([this,fo.INFO],e))},wo.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.WARN],e)),this._logHandler.apply(this,Zi([this,fo.WARN],e))},wo.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.ERROR],e)),this._logHandler.apply(this,Zi([this,fo.ERROR],e))},wo);function wo(e){this.name=e,this._logLevel=yo,this._logHandler=go,this._userLogHandler=null,po.push(this)}function bo(o,t){for(var e=0,n=po;e<n.length;e++)!function(e){var s=null;t&&t.level&&(s=mo[t.level]),e.userLogHandler=null===o?null:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=n.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(function(e){return e}).join(" ");t>=(null!=s?s:e.logLevel)&&o({level:fo[t].toLowerCase(),message:i,args:n,type:e.name})}}(n[e])}class Io{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if(function(e){e=e.getComponent();return"VERSION"===(null==e?void 0:e.type)}(e)){e=e.getImmediate();return`${e.library}/${e.version}`}return null}).filter(e=>e).join(" ")}}const To="@firebase/app",Eo=new _o("@firebase/app");var So;const ko="[DEFAULT]",Co={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Ao=new Map,No=new Map;function Ro(t,n){try{t.container.addComponent(n)}catch(e){Eo.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function Po(e,t){e.container.addOrOverwriteComponent(t)}function xo(e){var t=e.name;if(No.has(t))return Eo.debug(`There were multiple attempts to register component ${t}.`),!1;No.set(t,e);for(const n of Ao.values())Ro(n,e);return!0}function Oo(e,t){return e.container.getProvider(t)}const Do=new Cs("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class Lo{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new so("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Do.create("app-deleted",{appName:this._name})}}const Mo="9.0.1";function Fo(e,t={}){if("object"!=typeof t){const r=t;t={name:r}}var n=Object.assign({name:ko,automaticDataCollectionEnabled:!1},t);const r=n.name;if("string"!=typeof r||!r)throw Do.create("bad-app-name",{appName:String(r)});t=Ao.get(r);if(t){if(Fs(e,t.options)&&Fs(n,t.config))return t;throw Do.create("duplicate-app",{appName:r})}const i=new uo(r);for(const s of No.values())i.addComponent(s);n=new Lo(e,n,i);return Ao.set(r,n),n}function Uo(e=ko){var t=Ao.get(e);if(!t)throw Do.create("no-app",{appName:e});return t}async function jo(e){var t=e.name;Ao.has(t)&&(Ao.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function qo(e,t,n){var r;let i=null!==(r=Co[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);e=i.match(/\s|\//),n=t.match(/\s|\//);if(e||n){const s=[`Unable to register library "${i}" with version "${t}":`];return e&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),e&&n&&s.push("and"),n&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Eo.warn(s.join(" "))}xo(new so(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function Vo(e,t){if(null!==e&&"function"!=typeof e)throw Do.create("invalid-log-argument");bo(e,t)}function Bo(e){var t;t=e,po.forEach(function(e){e.setLogLevel(t)})}xo(new so("platform-logger",e=>new Io(e),"PRIVATE")),qo(To,"0.7.0",So),qo("fire-js","");var Ko=Object.freeze({__proto__:null,SDK_VERSION:Mo,_DEFAULT_ENTRY_NAME:ko,_addComponent:Ro,_addOrOverwriteComponent:Po,_apps:Ao,_clearComponents:function(){No.clear()},_components:No,_getProvider:Oo,_registerComponent:xo,_removeServiceInstance:function(e,t,n=ko){Oo(e,t).clearInstance(n)},deleteApp:jo,getApp:Uo,getApps:function(){return Array.from(Ao.values())},initializeApp:Fo,onLog:Vo,registerVersion:qo,setLogLevel:Bo,FirebaseError:Ss});class zo{constructor(e,t){this._delegate=e,this.firebase=t,Ro(e,new so("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),jo(this._delegate)))}_getService(e,t=ko){this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null===(e=n.getComponent())||void 0===e?void 0:e.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=ko){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Ro(this._delegate,e)}_addOrOverwriteComponent(e){Po(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Wo=new Cs("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function $o(i){const n={},s={__esModule:!0,initializeApp:function(e,t={}){e=Fo(e,t);if(Os(n,e.name))return n[e.name];t=new i(e,s);return n[e.name]=t},app:o,registerVersion:qo,setLogLevel:Bo,onLog:Vo,apps:null,SDK_VERSION:Mo,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;xo(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw Wo.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&ls(e,n.serviceProps),s[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?s[t]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:Ko}};function o(e){if(e=e||ko,!Os(n,e))throw Wo.create("no-app",{appName:e});return n[e]}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(n).map(e=>n[e])}}),o.App=i,s}E=function e(){const t=$o(zo);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){ls(t,e)},createSubscribe:zs,ErrorFactory:Cs,deepExtend:ls}),t}();const Ho=new _o("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Ho.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const $M=self.firebase.SDK_VERSION;$M&&0<=$M.indexOf("LITE")&&Ho.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Go=E;qo("@firebase/app-compat","0.1.1",void 0);Go.registerVersion("firebase","9.0.1","app-compat");function Qo(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function Yo(n,r,i){var s,e=new Promise(function(e,t){Qo(s=n[r].apply(n,i)).then(e,t)});return e.request=s,e}function Jo(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function Xo(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return Yo(this[n],e,arguments)})})}function Zo(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function ea(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=Yo(e,n,arguments)).then(function(e){if(e)return new na(e,t.request)});var e,t})})}function ta(e){this._index=e}function na(e,t){this._cursor=e,this._request=t}function ra(e){this._store=e}function ia(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function sa(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new ia(n)}function oa(e){this._db=e}function aa(e,t,n){var t=Yo(indexedDB,"open",[e,t]),r=t.request;return r&&(r.onupgradeneeded=function(e){n&&n(new sa(r.result,e.oldVersion,r.transaction))}),t.then(function(e){return new oa(e)})}function ca(e){return Yo(indexedDB,"deleteDatabase",[e])}Jo(ta,"_index",["name","keyPath","multiEntry","unique"]),Xo(ta,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),ea(ta,"_index",IDBIndex,["openCursor","openKeyCursor"]),Jo(na,"_cursor",["direction","key","primaryKey","value"]),Xo(na,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(na.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),Qo(t._request).then(function(e){if(e)return new na(e,t._request)})})})}),ra.prototype.createIndex=function(){return new ta(this._store.createIndex.apply(this._store,arguments))},ra.prototype.index=function(){return new ta(this._store.index.apply(this._store,arguments))},Jo(ra,"_store",["name","keyPath","indexNames","autoIncrement"]),Xo(ra,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),ea(ra,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Zo(ra,"_store",IDBObjectStore,["deleteIndex"]),ia.prototype.objectStore=function(){return new ra(this._tx.objectStore.apply(this._tx,arguments))},Jo(ia,"_tx",["objectStoreNames","mode"]),Zo(ia,"_tx",IDBTransaction,["abort"]),sa.prototype.createObjectStore=function(){return new ra(this._db.createObjectStore.apply(this._db,arguments))},Jo(sa,"_db",["name","version","objectStoreNames"]),Zo(sa,"_db",IDBDatabase,["deleteObjectStore","close"]),oa.prototype.transaction=function(){return new ia(this._db.transaction.apply(this._db,arguments))},Jo(oa,"_db",["name","version","objectStoreNames"]),Zo(oa,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[ra,ta].forEach(function(e){i in e.prototype&&(e.prototype[i.replace("open","iterate")]=function(){var e=(n=arguments,Array.prototype.slice.call(n)),t=e[e.length-1],n=this._store||this._index,r=n[i].apply(n,e.slice(0,-1));r.onsuccess=function(){t(r.result)}})})}),[ta,ra].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});const la=1e4,ua="w:0.5.0",ha="FIS_v2",da="https://firebaseinstallations.googleapis.com/v1",fa=36e5;const pa=new Cs("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ga(e){return e instanceof Ss&&e.code.includes("request-failed")}function ma({projectId:e}){return`${da}/projects/${e}/installations`}function ya(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function va(e,t){t=(await t.json()).error;return pa.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function _a({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function wa(e,{refreshToken:t}){const n=_a(e);return n.append("Authorization",(t=t,`${ha} ${t}`)),n}async function ba(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Ia(t){return new Promise(e=>{setTimeout(e,t)})}const Ta=/^[cdef][\w-]{21}$/,Ea="";function Sa(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return Ta.test(e)?e:Ea}catch(e){return Ea}}function ka(e){return`${e.appName}!${e.appId}`}const Ca=new Map;function Aa(e,t){e=ka(e);Na(e,t),function(e,t){const n=function(){!Ra&&"BroadcastChannel"in self&&(Ra=new BroadcastChannel("[Firebase] FID Change"),Ra.onmessage=e=>{Na(e.data.key,e.data.fid)});return Ra}();n&&n.postMessage({key:e,fid:t});0===Ca.size&&Ra&&(Ra.close(),Ra=null)}(e,t)}function Na(e,t){e=Ca.get(e);if(e)for(const n of e)n(t)}let Ra=null;const Pa="firebase-installations-database",xa=1,Oa="firebase-installations-store";let Da=null;function La(){return Da=Da||aa(Pa,xa,e=>{0===e.oldVersion&&e.createObjectStore(Oa)}),Da}async function Ma(e,t){var n=ka(e);const r=await La(),i=r.transaction(Oa,"readwrite"),s=i.objectStore(Oa);var o=await s.get(n);return await s.put(t,n),await i.complete,o&&o.fid===t.fid||Aa(e,t.fid),t}async function Fa(e){e=ka(e);const t=await La(),n=t.transaction(Oa,"readwrite");await n.objectStore(Oa).delete(e),await n.complete}async function Ua(e,t){var n=ka(e);const r=await La(),i=r.transaction(Oa,"readwrite"),s=i.objectStore(Oa);var o=await s.get(n),t=t(o);return void 0===t?await s.delete(n):await s.put(t,n),await i.complete,!t||o&&o.fid===t.fid||Aa(e,t.fid),t}async function ja(t){let n;var e=await Ua(t,e=>{e=function(e){e=e||{fid:Sa(),registrationStatus:0};return Va(e)}(e),e=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await qa(e);for(;1===t.registrationStatus;)await Ia(100),t=await qa(e);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await ja(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(pa.create("app-offline"));return{installationEntry:t,registrationPromise:n}}t={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},e=async function(t,n){try{var e=await async function(e,{fid:t}){const n=ma(e);var r=_a(e),e={fid:t,authVersion:ha,appId:e.appId,sdkVersion:ua};const i={method:"POST",headers:r,body:JSON.stringify(e)},s=await ba(()=>fetch(n,i));if(s.ok){e=await s.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:ya(e.authToken)}}throw await va("Create Installation",s)}(t,n);return Ma(t,e)}catch(e){throw ga(e)&&409===e.customData.serverCode?await Fa(t):await Ma(t,{fid:n.fid,registrationStatus:0}),e}}(e,t);return{installationEntry:t,registrationPromise:e}}}(t,e);return n=e.registrationPromise,e.installationEntry});return e.fid===Ea?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function qa(e){return Ua(e,e=>{if(!e)throw pa.create("installation-not-found");return Va(e)})}function Va(e){return 1===(t=e).registrationStatus&&t.registrationTime+la<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Ba({appConfig:e,platformLoggerProvider:t},n){const r=([i,{fid:s}]=[e,n],`${ma(i)}/${s}/authTokens:generate`);var i,s;const o=wa(e,n),a=t.getImmediate({optional:!0});a&&o.append("x-firebase-client",a.getPlatformInfoString());t={installation:{sdkVersion:ua}};const c={method:"POST",headers:o,body:JSON.stringify(t)},l=await ba(()=>fetch(r,c));if(l.ok)return ya(await l.json());throw await va("Generate Auth Token",l)}async function Ka(r,i=!1){let s;var e=await Ua(r.appConfig,e=>{if(!Wa(e))throw pa.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+fa}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await za(e.appConfig);for(;1===n.authToken.requestStatus;)await Ia(100),n=await za(e.appConfig);var r=n.authToken;return 0===r.requestStatus?Ka(e,t):r}(r,i),e;if(!navigator.onLine)throw pa.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var e=await Ba(t,n),r=Object.assign(Object.assign({},n),{authToken:e});return await Ma(t.appConfig,r),e}catch(e){throw!ga(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(n=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await Ma(t.appConfig,n)):await Fa(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function za(e){return Ua(e,e=>{if(!Wa(e))throw pa.create("not-registered");var t=e.authToken;return 1===(t=t).requestStatus&&t.requestTime+la<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Wa(e){return void 0!==e&&2===e.registrationStatus}async function $a(e,t=!1){return await async function(e){var{registrationPromise:e}=await ja(e);e&&await e}(e.appConfig),(await Ka(e,t)).token}function Ha(e){return pa.create("missing-app-config-values",{valueName:e})}const Ga="installations";xo(new so(Ga,e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:function(e){if(!e||!e.options)throw Ha("App Configuration");if(!e.name)throw Ha("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw Ha(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),platformLoggerProvider:Oo(e,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),xo(new so("installations-internal",e=>{const t=Oo(e.getProvider("app").getImmediate(),Ga).getImmediate();return{getId:()=>async function(e){const{installationEntry:t,registrationPromise:n}=await ja(e.appConfig);return(n||Ka(e)).catch(console.error),t.fid}(t),getToken:e=>$a(t,e)}},"PRIVATE")),qo("@firebase/installations","0.5.0");const Qa="analytics",Ya="firebase_id",Ja="origin",Xa=6e4,Za="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ec="https://www.googletagmanager.com/gtag/js",tc=new _o("@firebase/analytics");function nc(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function rc(r,i,s,o){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await nc(r);for(const l of e){var o=c.find(e=>e.measurementId===l),a=o&&n[o.appId];if(!a){t=[];break}t.push(a)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){tc.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){r=r[i];try{if(r)await t[r];else{const a=await nc(n);var o=a.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){tc.error(e)}e("config",i,s)}(r,i,s,o,t,n):r("set",t)}catch(e){tc.error(e)}}}const ic=new Cs("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),sc=30;const oc=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function ac(e){var t,{appId:n,apiKey:e}=e,e={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":e})},n=Za.replace("{app-id}",n);const r=await fetch(n,e);if(200===r.status||304===r.status)return r.json();{let e="";try{var i=await r.json();null!==(t=i.error)&&void 0!==t&&t.message&&(e=i.error.message)}catch(e){}throw ic.create("config-fetch-failed",{httpStatus:r.status,responseMessage:e})}}async function cc(e,t=oc,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw ic.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw ic.create("no-api-key")}e=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new hc;return setTimeout(async()=>{o.abort()},void 0!==n?n:Xa),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=oc){const{appId:o,measurementId:a}=n;try{await lc(i,e)}catch(e){if(a)return tc.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}try{const c=await ac(n);return s.deleteThrottleMetadata(o),c}catch(e){if(!uc(e)){if(s.deleteThrottleMetadata(o),a)return tc.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}const l=503===Number(e.customData.httpStatus)?ro(r,s.intervalMillis,sc):ro(r,s.intervalMillis),u={throttleEndTimeMillis:Date.now()+l,backoffCount:r+1};return s.setThrottleMetadata(o,u),tc.debug(`Calling attemptFetch again in ${l} millis`),t(n,u,i,s)}}({appId:r,apiKey:i,measurementId:s},e,o,t)}function lc(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(ic.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function uc(e){if(e instanceof Ss&&e.customData){e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}}class hc{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function dc(t,e,n,r,i,s,o){const a=cc(t);a.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&tc.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>tc.error(e)),e.push(a);var c=async function(){if(!ws())return tc.warn(ic.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await bs()}catch(e){return tc.warn(ic.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[e,c]=await Promise.all([a,c]);!function(){var e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(ec))return t}()&&function(e,t){const n=document.createElement("script");n.src=`${ec}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,e.measurementId),i("js",new Date);const l=null!==(o=null==o?void 0:o.config)&&void 0!==o?o:{};return l[Ja]="firebase",l.update=!0,null!=c&&(l[Ya]=c),i("config",e.measurementId,l),e.measurementId}class fc{constructor(e){this.app=e}_delete(){return delete pc[this.app.options.appId],Promise.resolve()}}let pc={},gc=[];const mc={};let yc="dataLayer",vc="gtag",_c,wc,bc=!1;function Ic(e){if(bc)throw ic.create("already-initialized");e.dataLayerName&&(yc=e.dataLayerName),e.gtagName&&(vc=e.gtagName)}function Tc(e,t,n){!function(){const e=[];var t;ms()&&e.push("This is a browser extension environment."),Is()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=ic.create("invalid-analytics-context",{errorInfo:t}),tc.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw ic.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw ic.create("no-api-key");tc.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=pc[s])throw ic.create("already-exists",{id:s});return bc||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(yc),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=rc(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(pc,gc,mc,yc,vc),wc=r,_c=i,bc=!0),pc[s]=dc(e,gc,mc,t,_c,yc,n),new fc(e)}async function Ec(){if(ms())return!1;if(!Is())return!1;if(!ws())return!1;try{return await bs()}catch(e){return!1}}function Sc(e,t,n){e=io(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(wc,pc[e.app.options.appId],t,n).catch(e=>tc.error(e))}function kc(e,t,n){e=io(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(wc,pc[e.app.options.appId],t,n).catch(e=>tc.error(e))}function Cc(e,t,n){e=io(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(wc,pc[e.app.options.appId],t,n).catch(e=>tc.error(e))}function Ac(e,t){e=io(e),async function(e,t){e=await e,window[`ga-disable-${e}`]=!t}(pc[e.app.options.appId],t).catch(e=>tc.error(e))}function Nc(e,t,n,r){e=io(e),async function(e,t,n,r,i){i&&i.global?e("event",n,r):(t=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:t})))}(wc,pc[e.app.options.appId],t,n,r).catch(e=>tc.error(e))}xo(new so(Qa,(e,{options:t})=>{return Tc(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),xo(new so("analytics-internal",function(e){try{const r=e.getProvider(Qa).getImmediate();return{logEvent:(e,t,n)=>Nc(r,e,t,n)}}catch(e){throw ic.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),qo("@firebase/analytics","0.7.0");var Rc,Pc;class xc{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Nc(this._delegate,e,t,n)}setCurrentScreen(e,t){Sc(this._delegate,e,t)}setUserId(e,t){kc(this._delegate,e,t)}setUserProperties(e,t){Cc(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Ac(this._delegate,e)}}(o=Rc=Rc||{}).ADD_SHIPPING_INFO="add_shipping_info",o.ADD_PAYMENT_INFO="add_payment_info",o.ADD_TO_CART="add_to_cart",o.ADD_TO_WISHLIST="add_to_wishlist",o.BEGIN_CHECKOUT="begin_checkout",o.CHECKOUT_PROGRESS="checkout_progress",o.EXCEPTION="exception",o.GENERATE_LEAD="generate_lead",o.LOGIN="login",o.PAGE_VIEW="page_view",o.PURCHASE="purchase",o.REFUND="refund",o.REMOVE_FROM_CART="remove_from_cart",o.SCREEN_VIEW="screen_view",o.SEARCH="search",o.SELECT_CONTENT="select_content",o.SELECT_ITEM="select_item",o.SELECT_PROMOTION="select_promotion",o.SET_CHECKOUT_OPTION="set_checkout_option",o.SHARE="share",o.SIGN_UP="sign_up",o.TIMING_COMPLETE="timing_complete",o.VIEW_CART="view_cart",o.VIEW_ITEM="view_item",o.VIEW_ITEM_LIST="view_item_list",o.VIEW_PROMOTION="view_promotion",o.VIEW_SEARCH_RESULTS="view_search_results";const Oc=e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("analytics").getImmediate();return new xc(t,e)};Pc={Analytics:xc,settings:Ic,isSupported:Ec,EventName:Rc},Go.INTERNAL.registerComponent(new so("analytics-compat",Oc,"PUBLIC").setServiceProps(Pc).setMultipleInstances(!0)),Go.registerVersion("@firebase/analytics-compat","0.1.1");const Dc=new Map,Lc={activated:!1,tokenObservers:[]},Mc={enabled:!1};function Fc(e){return Dc.get(e)||Lc}function Uc(e,t){Dc.set(e,t)}const jc="https://content-firebaseappcheck.googleapis.com/v1beta",qc="exchangeDebugToken",Vc={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Bc{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new us,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new us,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}const Kc=new Cs("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error."});function zc(){return self.grecaptcha}function Wc(e){if(!Fc(e).activated)throw Kc.create("use-before-activation",{appName:e.name})}async function $c({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());t={method:"POST",body:JSON.stringify(t),headers:r};let s;try{s=await fetch(e,t)}catch(e){throw Kc.create("fetch-network-error",{originalErrorMessage:e.message})}if(200!==s.status)throw Kc.create("fetch-status-error",{httpStatus:s.status});let o;try{o=await s.json()}catch(e){throw Kc.create("fetch-parse-error",{originalErrorMessage:e.message})}e=o.ttl.match(/^([\d.]+)(s)$/);if(!e||!e[2]||isNaN(Number(e[1])))throw Kc.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});t=1e3*Number(e[1]),e=Date.now();return{token:o.attestationToken,expireTimeMillis:e+t,issuedAtTimeMillis:e}}const Hc="firebase-app-check-database",Gc=1,Qc="firebase-app-check-store",Yc="debug-token";let Jc=null;function Xc(){return Jc||(Jc=new Promise((t,n)=>{try{const e=indexedDB.open(Hc,Gc);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(Kc.create("storage-open",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(Qc,{keyPath:"compositeKey"})}}catch(e){n(Kc.create("storage-open",{originalErrorMessage:e.message}))}}),Jc)}async function Zc(e,t){const n=await Xc(),r=n.transaction(Qc,"readwrite"),i=r.objectStore(Qc),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{n(Kc.create("storage-set",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}async function el(e){const t=await Xc(),r=t.transaction(Qc,"readonly"),n=r.objectStore(Qc),i=n.get(e);return new Promise((t,n)=>{i.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)},r.onerror=e=>{n(Kc.create("storage-get",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}function tl(e){return`${e.options.appId}-${e.name}`}const nl=new _o("@firebase/app-check");async function rl(t){if(ws()){let e=void 0;try{e=await el(tl(t))}catch(e){nl.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function il(e,t){return ws()?Zc(tl(e),t).catch(e=>{nl.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function sl(){let e=void 0;try{e=await el(Yc)}catch(e){}if(e)return e;var t,n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return t=n,Zc(Yc,t).catch(e=>nl.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),console.log(`App Check debug token: ${n}. You will need to add it to your app's App Check settings in the Firebase console for it to work`),n}const ol={error:"UNKNOWN_ERROR"};async function al(e,t=!1){var n,r=e.app;Wc(r);const i=Fc(r);let s=i.token,o=void 0;if(s||(n=await i.cachedTokenPromise)&&hl(n)&&(s=n,Uc(r,Object.assign(Object.assign({},i),{token:s})),ul(r,{token:s.token})),!t&&s&&hl(s))return{token:s.token};if(Mc.enabled){var a=await $c(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${jc}/projects/${n}/apps/${r}:${qc}?key=${e}`,body:{debug_token:t}}}(r,await async function(){var e=Mc;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}()),e.platformLoggerProvider);return await il(r,a),Uc(r,Object.assign(Object.assign({},i),{token:a})),{token:a.token}}try{s=await i.provider.getToken()}catch(e){nl.error(e),o=e}let c;return s?(c={token:s.token},Uc(r,Object.assign(Object.assign({},i),{token:s})),await il(r,s)):c=(a=o,{token:function(e){return os.encodeString(JSON.stringify(e),!1)}(ol),error:a}),ul(r,c),c}function cl(e,t,n,r){var{app:i}=e;const s=Fc(i);t={next:n,error:r,type:t};const o=Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,t]});if(o.tokenRefresher||(e=function(n){const{app:r}=n;return new Bc(async()=>{var e=Fc(r);let t;if(t=e.token?await al(n,!0):await al(n),t.error)throw t.error},()=>!0,()=>{var e=Fc(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},Vc.RETRIAL_MIN_WAIT,Vc.RETRIAL_MAX_WAIT)}(e),o.tokenRefresher=e),!o.tokenRefresher.isRunning()&&s.isTokenAutoRefreshEnabled&&o.tokenRefresher.start(),s.token&&hl(s.token)){const a=s.token;Promise.resolve().then(()=>n({token:a.token})).catch(()=>{})}else null==s.token&&s.cachedTokenPromise.then(e=>{e&&hl(e)&&n({token:e.token})}).catch(()=>{});Uc(i,o)}function ll(e,t){const n=Fc(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),Uc(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function ul(e,t){for(const n of Fc(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function hl(e){return 0<e.expireTimeMillis-Date.now()}class dl{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){var{tokenObservers:e}=Fc(this.app);for(const t of e)ll(this.app,t.next);return Promise.resolve()}}const fl="https://www.google.com/recaptcha/api.js";function pl(t,n){var e=Fc(t);const r=new us;Uc(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=`fire_app_check_${t.name}`,s=document.createElement("div");s.id=i,s.style.display="none",document.body.appendChild(s);const o=zc();return o?o.ready(()=>{gl(t,n,o,i),r.resolve(o)}):function(e){const t=document.createElement("script");t.src=`${fl}`,t.onload=e,document.head.appendChild(t)}(()=>{const e=zc();if(!e)throw new Error("no recaptcha");e.ready(()=>{gl(t,n,e,i),r.resolve(e)})}),r.promise}function gl(e,t,n,r){r=n.render(r,{sitekey:t,size:"invisible"}),t=Fc(e);Uc(e,Object.assign(Object.assign({},t),{reCAPTCHAState:Object.assign(Object.assign({},t.reCAPTCHAState),{widgetId:r})}))}class ml{constructor(e){this._siteKey=e}async getToken(){if(!this._app||!this._platformLoggerProvider)throw Kc.create("use-before-activation",{appName:""});var e=await async function(r){Wc(r);const i=await Fc(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=Fc(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}(this._app).catch(e=>{throw Kc.create("recaptcha-error")});return $c(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${jc}/projects/${n}/apps/${r}:exchangeRecaptchaToken?key=${e}`,body:{recaptcha_token:t}}}(this._app,e),this._platformLoggerProvider)}initialize(e){this._app=e,this._platformLoggerProvider=Oo(e,"platform-logger"),pl(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof ml&&this._siteKey===e._siteKey}}class yl{constructor(e){this._customProviderOptions=e}async getToken(){if(!this._app)throw Kc.create("use-before-activation",{appName:""});var e=await this._customProviderOptions.getToken(),t=function(e){e=xs(e).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof yl&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function vl(e=Uo(),t){const n=Oo(e=io(e),"app-check");if(n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw Kc.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=Fc(t),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=e,i.cachedTokenPromise=rl(t).then(e=>(e&&hl(e)&&Uc(t,Object.assign(Object.assign({},Fc(t)),{token:e})),e)),i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,Uc(t,i),i.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),r}const _l="app-check-internal";xo(new so("app-check",e=>{var t=e.getProvider("app").getImmediate(),e=e.getProvider("platform-logger");return t=t,e=e,new dl(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(_l).initialize()})),xo(new so(_l,e=>{var t,e=e.getProvider("app-check").getImmediate();return t=e,{getToken:e=>al(t,e),addTokenListener:e=>cl(t,"INTERNAL",e),removeTokenListener:e=>ll(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),qo("@firebase/app-check","0.4.0"),function(){var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}();if("string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){const t=Mc;t.enabled=!0;const n=new us;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(sl())}}();const wl=new Cs("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class bl{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new ml(e):new yl({getToken:e.getToken}),this._delegate=vl(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw wl.create("use-before-activation",{appName:this.app.name});!function(e,t){const n=Fc(e=e.app);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),Uc(e,Object.assign(Object.assign({},n),{isTokenAutoRefreshEnabled:t}))}(this._delegate,e)}getToken(e){if(!this._delegate)throw wl.create("use-before-activation",{appName:this.app.name});return async function(e,t){if((t=await al(e,t)).error)throw t.error;return{token:t.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw wl.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),cl(e,"EXTERNAL",r,i),()=>ll(e.app,r)}(this._delegate,e,t)}}Go.INTERNAL.registerComponent(new so("appCheck-compat",e=>{e=e.getProvider("app-compat").getImmediate();return new bl(e)},"PUBLIC")),Go.registerVersion("@firebase/app-check-compat","0.1.1");const Il={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Tl={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};const El=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Sl=new Cs("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),kl=new _o("@firebase/auth");function Cl(e,...t){kl.logLevel<=fo.ERROR&&kl.error(`Auth (${Mo}): ${e}`,...t)}function Al(e,...t){throw Rl(e,...t)}function Nl(e,...t){return Rl(e,...t)}function Rl(e,...t){if("string"==typeof e)return Sl.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function Pl(e,t,...n){if(!e)throw Rl(t,...n)}function xl(e){e="INTERNAL ASSERTION FAILED: "+e;throw Cl(e),new Error(e)}function Ol(e,t){e||xl(t)}const Dl=new Map;function Ll(e){Ol(e instanceof Function,"Expected a class definition");let t=Dl.get(e);return t?Ol(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Dl.set(e,t)),t}function Ml(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Fl(){return"http:"===Ul()||"https:"===Ul()}function Ul(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class jl{constructor(e,t){Ol((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=ps()||ys()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Fl()||ms()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ql(e,t){Ol(e.emulator,"Emulator should always be set here");var{url:e}=e.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}class Vl{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void xl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void xl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void xl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const Bl={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded"},Kl=new jl(3e4,6e4);function zl(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Wl(i,s,o,a,e={}){return $l(i,e,()=>{let e={},t={};a&&("GET"===s?t=a:e={body:JSON.stringify(a)});var n=js(Object.assign({key:i.config.apiKey},t)).slice(1);const r=new(Vl.headers());return r.set("Content-Type","application/json"),r.set("X-Client-Version",i._getSdkClientVersion()),i.languageCode&&r.set("X-Firebase-Locale",i.languageCode),Vl.fetch()(Gl(i,i.config.apiHost,o,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function $l(t,e,n){t._canInitEmulator=!1;e=Object.assign(Object.assign({},Bl),e);try{const i=new Ql(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();var r=await s.json();if("needConfirmation"in r)throw Yl(t,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const o=s.ok?r.errorMessage:r.error.message,a=o.split(" : ")[0];if("FEDERATED_USER_ID_ALREADY_LINKED"===a)throw Yl(t,"credential-already-in-use",r);if("EMAIL_EXISTS"===a)throw Yl(t,"email-already-in-use",r);Al(t,e[a]||a.toLowerCase().replace(/[_\s]+/g,"-"))}}catch(e){if(e instanceof Ss)throw e;Al(t,"network-request-failed")}}async function Hl(e,t,n,r,i={}){i=await Wl(e,t,n,r,i);return"mfaPendingCredential"in i&&Al(e,"multi-factor-auth-required",{serverResponse:i}),i}function Gl(e,t,n,r){r=`${t}${n}?${r}`;return e.config.emulator?ql(e.config,r):`${e.config.apiScheme}://${r}`}class Ql{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Nl(this.auth,"timeout")),Kl.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Yl(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Nl(e,t,r);return i.customData._tokenResponse=n,i}function Jl(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Xl(e){return 1e3*Number(e)}function Zl(e){var[t,n,e]=e.split(".");if(void 0===t||void 0===n||void 0===e)return Cl("JWT malformed, contained fewer than 3 sections"),null;try{var r=cs(n);return r?JSON.parse(r):(Cl("Failed to decode base64 JWT payload"),null)}catch(e){return Cl("Caught error parsing JWT payload as JSON",e),null}}async function eu(t,n,e=!1){if(e)return n;try{return await n}catch(e){throw e instanceof Ss&&([{code:n}]=[e],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class tu{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){this.isRunning&&(e=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},e))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class nu{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jl(this.lastLoginAt),this.creationTime=Jl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ru(e){var t=e.auth,n=await e.getIdToken(),r=await eu(e,async function(e,t){return Wl(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));Pl(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var{providerId:t}=e,e=Gi(e,["providerId"]);return{providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}}):[],r=function(e,n){e=e.filter(t=>!n.some(e=>e.providerId===t.providerId));return[...e,...n]}(e.providerData,t),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!=r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new nu(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class iu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Pl(e.idToken,"internal-error"),Pl(void 0!==e.idToken,"internal-error"),Pl(void 0!==e.refreshToken,"internal-error");var t,t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(Pl(t=Zl(t=e.idToken),"internal-error"),Pl(void 0!==t.exp,"internal-error"),Pl(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Pl(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var r,i,{accessToken:t,refreshToken:e,expiresIn:n}=(i=t,await{accessToken:(n=await $l(r=e,{},()=>{var e=js({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:t,apiKey:n}=r.config,n=Gl(r,t,"/v1/token",`key=${n}`);return Vl.fetch()(n,{method:"POST",headers:{"X-Client-Version":r._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:e})})).access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token});this.updateTokensAndExpiration(t,e,Number(n))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:t}=t;const i=new iu;return n&&(Pl("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(Pl("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),t&&(Pl("number"==typeof t,"internal-error",{appName:e}),i.expirationTime=t),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new iu,this.toJSON())}_performRefresh(){return xl("not implemented")}}function su(e,t){Pl("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ou{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,e=Gi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new tu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=e.displayName||null,this.email=e.email||null,this.phoneNumber=e.phoneNumber||null,this.photoURL=e.photoURL||null,this.isAnonymous=e.isAnonymous||!1,this.metadata=new nu(e.createdAt||void 0,e.lastLoginAt||void 0)}async getIdToken(e){e=await eu(this,this.stsTokenManager.getToken(this.auth,e));return Pl(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(e){return async function(e,t=!1){const n=io(e);var r=await n.getIdToken(t),i=Zl(r);return Pl(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error"),e="object"==typeof i.firebase?i.firebase:void 0,t=null==e?void 0:e.sign_in_provider,{claims:i,token:r,authTime:Jl(Xl(i.auth_time)),issuedAtTime:Jl(Xl(i.iat)),expirationTime:Jl(Xl(i.exp)),signInProvider:t||null,signInSecondFactor:(null==e?void 0:e.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=io(e);await ru(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Pl(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new ou(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){Pl(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ru(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await eu(this,async function(e,t){return Wl(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(l=t.displayName)&&void 0!==l?l:void 0,r=null!==(o=t.email)&&void 0!==o?o:void 0,i=null!==(c=t.phoneNumber)&&void 0!==c?c:void 0,s=null!==(a=t.photoURL)&&void 0!==a?a:void 0,o=null!==(l=t.tenantId)&&void 0!==l?l:void 0,a=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=t;Pl(u&&p,e,"internal-error");t=iu.fromJSON(this.name,p);Pl("string"==typeof u,e,"internal-error"),su(n,e.name),su(r,e.name),Pl("boolean"==typeof h,e,"internal-error"),Pl("boolean"==typeof d,e,"internal-error"),su(i,e.name),su(s,e.name),su(o,e.name),su(a,e.name),su(c,e.name),su(l,e.name);const g=new ou({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:t,createdAt:c,lastLoginAt:l});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>Object.assign({},e))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){const r=new iu;r.updateFromServerResponse(t);n=new ou({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ru(n),n}}class au{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){e=this.storage[e];return void 0===e?null:e}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}au.type="NONE";const cu=au;function lu(e,t,n){return`firebase:${e}:${t}:${n}`}class uu{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:e,name:n}=this.auth;this.fullUserKey=lu(this.userKey,e.apiKey,n),this.fullPersistenceKey=lu("persistence",e.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?ou._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new uu(Ll(cu),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Ll(cu);const s=lu(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{var a=await u._get(s);if(a){var c=ou._fromJSON(e,a);u!==i&&(o=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new uu(i,e,n)}}function hu(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(gu(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(du(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(yu(t))return"Blackberry";if(vu(t))return"Webos";if(fu(t))return"Safari";if((t.includes("chrome/")||pu(t))&&!t.includes("edge/"))return"Chrome";if(mu(t))return"Android";e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==e?void 0:e.length)?e[1]:"Other"}function du(e=fs()){return/firefox\//i.test(e)}function fu(e=fs()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function pu(e=fs()){return/crios\//i.test(e)}function gu(e=fs()){return/iemobile/i.test(e)}function mu(e=fs()){return/android/i.test(e)}function yu(e=fs()){return/blackberry/i.test(e)}function vu(e=fs()){return/webos/i.test(e)}function _u(e=fs()){return/iphone|ipad|ipod/i.test(e)}function wu(e=fs()){return _u(e)||mu(e)||vu(e)||yu(e)||/windows phone/i.test(e)||gu(e)}function bu(e,t=[]){let n;switch(e){case"Browser":n=hu(fs());break;case"Worker":n=`${hu(fs())}-${e}`;break;default:n=e}t=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Mo}/${t}`}class Iu{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Eu(this),this.idTokenSubscription=new Eu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Sl,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Ll(n)),this._initializationPromise=this.queue(async()=>{var e;this._deleted||(this.persistenceManager=await uu.create(this,t),this._deleted||(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(n),this._deleted||(this._isInitialized=!0)))}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var t,n;let r=await this.assertedPersistence.getCurrentUser();return e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId,n=null===r||void 0===r?void 0:r._redirectEventId,e=await this.tryRedirectSignIn(e),t&&t!==n||null==e||!e.user||(r=e.user)),r?r._redirectEventId?(Pl(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)):this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ru(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?io(e):null;return t&&Pl(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&Pl(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Ll(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Cs("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){return this.redirectPersistenceManager||(Pl(e=e&&Ll(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await uu.create(this,[Ll(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Pl(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Pl(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=bu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function Tu(e){return io(e)}class Eu{constructor(e){this.auth=e,this.observer=null,this.addObserver=zs(e=>this.observer=e)}get next(){return Pl(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Su(e,t,n){const r=Tu(e);Pl(r._canInitEmulator,r,"emulator-config-failed"),Pl(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");e=!(null==n||!n.disableWarnings);const i=ku(t);var{host:n,port:t}=function(e){const t=ku(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:Cu(r.substr(s.length+1))}}var[e,s]=r.split(":");return{host:e,port:Cu(s)}}}(t);r.config.emulator={url:`${i}//${n}${null===t?"":`:${t}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:n,port:t,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:e})}),function(e){function t(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"==typeof window||"undefined"==typeof document||e||("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}(e)}function ku(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Cu(e){if(!e)return null;e=Number(e);return isNaN(e)?null:e}class Au{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return xl("not implemented")}_getIdTokenResponse(e){return xl("not implemented")}_linkToIdToken(e,t){return xl("not implemented")}_getReauthenticationResolver(e){return xl("not implemented")}}async function Nu(e,t){return Wl(e,"POST","/v1/accounts:resetPassword",zl(e,t))}async function Ru(e,t){return Wl(e,"POST","/v1/accounts:update",t)}async function Pu(e,t){return Wl(e,"POST","/v1/accounts:sendOobCode",zl(e,t))}class xu extends Au{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new xu(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new xu(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){e="string"==typeof e?JSON.parse(e):e;if(null!=e&&e.email&&null!=e&&e.password){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Hl(e,"POST","/v1/accounts:signInWithPassword",zl(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Hl(e,"POST","/v1/accounts:signInWithEmailLink",zl(e,t))}(e,{email:this._email,oobCode:this._password});default:Al(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ru(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Hl(e,"POST","/v1/accounts:signInWithEmailLink",zl(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Al(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ou(e,t){return Hl(e,"POST","/v1/accounts:signInWithIdp",zl(e,t))}class Du extends Au{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Du(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Al("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:e}=t,t=Gi(t,["providerId","signInMethod"]);if(!n||!e)return null;e=new Du(n,e);return Object.assign(e,t),e}_getIdTokenResponse(e){return Ou(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ou(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ou(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=js(t)}return e}}const Lu={USER_NOT_FOUND:"user-not-found"};class Mu extends Au{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Mu({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Mu({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Hl(e,"POST","/v1/accounts:signInWithPhoneNumber",zl(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){if((t=await Hl(e,"POST","/v1/accounts:signInWithPhoneNumber",zl(e,t))).temporaryProof)throw Yl(e,"account-exists-with-different-credential",t);return t}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Hl(e,"POST","/v1/accounts:signInWithPhoneNumber",zl(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Lu)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||e?new Mu({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}):null}}class Fu{constructor(e){var t=qs(Vs(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(e=t.oobCode)&&void 0!==e?e:null,e=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(e=t.mode)&&void 0!==e?e:null);Pl(n&&r&&e,"argument-error"),this.apiKey=n,this.operation=e,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(n=qs(Vs(t=e)).link,r=n?qs(Vs(n)).deep_link_id:null,((e=qs(Vs(t)).deep_link_id)?qs(Vs(e)).link:null)||e||r||n||t);try{return new Fu(t)}catch(e){return null}}}class Uu{constructor(){this.providerId=Uu.PROVIDER_ID}static credential(e,t){return xu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){t=Fu.parseLink(t);return Pl(t,"argument-error"),xu._fromEmailAndCode(e,t.code,t.tenantId)}}Uu.PROVIDER_ID="password",Uu.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Uu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ju{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class qu extends ju{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Vu extends qu{static credentialFromJSON(e){e="string"==typeof e?JSON.parse(e):e;return Pl("providerId"in e&&"signInMethod"in e,"argument-error"),Du._fromParams(e)}credential(e){return this._credential(e)}_credential(e){return Pl(e.idToken||e.accessToken,"argument-error"),Du._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Vu.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Vu.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:e}=e;if(!(n||r||t||i))return null;if(!e)return null;try{return new Vu(e)._credential({idToken:t,accessToken:n,rawNonce:s,pendingToken:i})}catch(e){return null}}}class Bu extends qu{constructor(){super("facebook.com")}static credential(e){return Du._fromParams({providerId:Bu.PROVIDER_ID,signInMethod:Bu.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Bu.credentialFromTaggedObject(e)}static credentialFromError(e){return Bu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Bu.credential(e.oauthAccessToken)}catch(e){return null}}}Bu.FACEBOOK_SIGN_IN_METHOD="facebook.com",Bu.PROVIDER_ID="facebook.com";class Ku extends qu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Du._fromParams({providerId:Ku.PROVIDER_ID,signInMethod:Ku.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ku.credentialFromTaggedObject(e)}static credentialFromError(e){return Ku.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:e}=e;if(!t&&!e)return null;try{return Ku.credential(t,e)}catch(e){return null}}}Ku.GOOGLE_SIGN_IN_METHOD="google.com",Ku.PROVIDER_ID="google.com";class zu extends qu{constructor(){super("github.com")}static credential(e){return Du._fromParams({providerId:zu.PROVIDER_ID,signInMethod:zu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zu.credentialFromTaggedObject(e)}static credentialFromError(e){return zu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return zu.credential(e.oauthAccessToken)}catch(e){return null}}}zu.GITHUB_SIGN_IN_METHOD="github.com",zu.PROVIDER_ID="github.com";class Wu extends Au{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Ou(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ou(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ou(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:e}="string"==typeof e?JSON.parse(e):e;return t&&n&&e&&t===n?new Wu(t,e):null}static _create(e,t){return new Wu(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class $u extends qu{constructor(){super("twitter.com")}static credential(e,t){return Du._fromParams({providerId:$u.PROVIDER_ID,signInMethod:$u.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return $u.credentialFromTaggedObject(e)}static credentialFromError(e){return $u.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:e}=e;if(!t||!e)return null;try{return $u.credential(t,e)}catch(e){return null}}}$u.TWITTER_SIGN_IN_METHOD="twitter.com",$u.PROVIDER_ID="twitter.com";async function Hu(e,t){return Hl(e,"POST","/v1/accounts:signUp",zl(e,t))}class Gu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){e=await ou._fromIdTokenResponse(e,n,r),r=Qu(n);return new Gu({user:e,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Qu(n);return new Gu({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Qu(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Yu extends Ss{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,this.name="FirebaseError",Object.setPrototypeOf(this,Yu.prototype),this.appName=e.name,this.code=t.code,this.tenantId=null!==(e=e.tenantId)&&void 0!==e?e:void 0,this.serverResponse=t.customData.serverResponse}static _fromErrorAndOperation(e,t,n,r){return new Yu(e,t,n,r)}}function Ju(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Yu._fromErrorAndOperation(t,e,n,r);throw e})}function Xu(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Zu(e,t){const n=io(e);await th(!0,n,t);var{providerUserInfo:t}=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await Wl(e,"POST","/v1/accounts:update",t));const r=Xu(t||[]);return n.providerData=n.providerData.filter(e=>r.has(e.providerId)),r.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function eh(e,t,n=!1){n=await eu(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Gu._forOperation(e,"link",n)}async function th(e,t,n){await ru(t);const r=Xu(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";Pl(r.has(n)===e,t.auth,i)}async function nh(e,t,n=!1){var{auth:r}=e,i="reauthenticate";try{var s=await eu(e,Ju(r,i,t,e),n);Pl(s.idToken,r,"internal-error");var o=Zl(s.idToken);Pl(o,r,"internal-error");var{sub:a}=o;return Pl(e.uid===a,r,"user-mismatch"),Gu._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Al(r,"user-mismatch"),e}}async function rh(e,t,n=!1){t=await Ju(e,"signIn",t),t=await Gu._fromIdTokenResponse(e,"signIn",t);return n||await e._updateCurrentUser(t.user),t}async function ih(e,t){return rh(Tu(e),t)}async function sh(e,t){e=io(e);return await th(!1,e,t.providerId),eh(e,t)}async function oh(e,t){return nh(io(e),t)}async function ah(e,t){const n=Tu(e);t=await Hl(n,"POST","/v1/accounts:signInWithCustomToken",zl(n,{token:t,returnSecureToken:!0})),t=await Gu._fromIdTokenResponse(n,"signIn",t);return await n._updateCurrentUser(t.user),t}class ch{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?lh._fromServerResponse(e,t):Al(e,"internal-error")}}class lh extends ch{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new lh(t)}}function uh(e,t,n){var r;Pl(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),Pl(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Pl(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iosBundleId=n.iOS.bundleId),n.android&&(Pl(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function hh(e,t,n){e=io(e),t={requestType:"PASSWORD_RESET",email:t};n&&uh(e,t,n),await Pu(e,t)}async function dh(e,t){await Wl(e=io(e),"POST","/v1/accounts:update",zl(e,{oobCode:t}))}async function fh(e,t){var n=io(e),r=await Nu(n,{oobCode:t}),t=r.requestType;switch(Pl(t,n,"internal-error"),t){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Pl(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Pl(r.mfaInfo,n,"internal-error");default:Pl(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=ch._fromServerResponse(Tu(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:t}}async function ph(e,t,n){e=io(e),t={requestType:"EMAIL_SIGNIN",email:t};Pl(n.handleCodeInApp,e,"argument-error"),n&&uh(e,t,n),await Pu(e,t)}async function gh(e,t){var n=Fl()?Ml():"http://localhost",{signinMethods:n}=await Wl(e=io(e),"POST","/v1/accounts:createAuthUri",zl(e,{identifier:t,continueUri:n}));return n||[]}async function mh(e,t){var n=io(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&uh(n.auth,r,t);var{email:r}=await Pu(n.auth,r);r!==e.email&&await e.reload()}async function yh(e,t,n){var r=io(e),t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&uh(r.auth,t,n);var{email:t}=await Pu(r.auth,t);t!==e.email&&await e.reload()}async function vh(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const r=io(e);e=await r.getIdToken(),n=await eu(r,async function(e,t){return Wl(e,"POST","/v1/accounts:update",t)}(r.auth,{idToken:e,displayName:t,photoUrl:n,returnSecureToken:!0}));r.displayName=n.displayName||null,r.photoURL=n.photoUrl||null;const i=r.providerData.find(({providerId:e})=>"password"===e);i&&(i.displayName=r.displayName,i.photoURL=r.photoURL),await r._updateTokensIfNecessary(n)}}async function _h(e,t,n){var{auth:r}=e;const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await eu(e,Ru(r,i));await e._updateTokensIfNecessary(r,!0)}class wh{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class bh extends wh{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Ih extends wh{constructor(e,t){super(e,"facebook.com",t)}}class Th extends bh{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Eh extends wh{constructor(e,t){super(e,"google.com",t)}}class Sh extends bh{constructor(e,t,n){super(e,"twitter.com",t,n)}}function kh(e){var{user:t,_tokenResponse:e}=e;return t.isAnonymous&&!e?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var{providerId:t}=e,n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Zl(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new wh(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new Ih(r,n);case"github.com":return new Th(r,n);case"google.com":return new Eh(r,n);case"twitter.com":return new Sh(r,n,e.screenName||null);case"custom":case"anonymous":return new wh(r,null);default:return new wh(r,t,n)}}(e)}class Ch{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Ch("enroll",e)}static _fromMfaPendingCredential(e){return new Ch("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Ch._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Ch._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Ah{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,r){const i=Tu(e);e=(r.serverResponse.mfaInfo||[]).map(e=>ch._fromServerResponse(i,e));Pl(r.serverResponse.mfaPendingCredential,i,"internal-error");const s=Ch._fromMfaPendingCredential(r.serverResponse.mfaPendingCredential);return new Ah(s,e,async e=>{e=await e._process(i,s);delete r.serverResponse.mfaInfo,delete r.serverResponse.mfaPendingCredential;var t=Object.assign(Object.assign({},r.serverResponse),{idToken:e.idToken,refreshToken:e.refreshToken});switch(r.operationType){case"signIn":var n=await Gu._fromIdTokenResponse(i,r.operationType,t);return await i._updateCurrentUser(n.user),n;case"reauthenticate":return Pl(r.user,i,"internal-error"),Gu._forOperation(r.user,r.operationType,t);default:Al(i,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class Nh{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>ch._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Nh(e)}async getSession(){return Ch._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e;e=await this.getSession(),t=await eu(this.user,n._process(this.user.auth,e,t));return await this.user._updateTokensIfNecessary(t),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n=await this.user.getIdToken(),n=await eu(this.user,(e=this.user.auth,n={idToken:n,mfaEnrollmentId:t},Wl(e,"POST","/v2/accounts/mfaEnrollment:withdraw",Object.assign({tenantId:e.tenantId},n))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(n);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const Rh=new WeakMap;const Ph="__sak";class xh{constructor(e,t){this.storage=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ph,"1"),this.storage.removeItem(Ph),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){e=this.storage.getItem(e);return Promise.resolve(e?JSON.parse(e):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}}class Oh extends xh{constructor(){var e;super(window.localStorage,"LOCAL"),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(fu(e=fs())||_u(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=wu(),this._shouldAllowMigration=!0,this.boundEventHandler=this.onStorageEvent.bind(this)}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);vs()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Oh.type="LOCAL";const Dh=Oh;class Lh extends xh{constructor(){super(window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Lh.type="SESSION";const Mh=Lh;class Fh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new Fh(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;e=this.handlersMap[r];null!=e&&e.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),e=Array.from(e).map(async e=>e(t.origin,i)),e=await Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:e}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Uh(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Fh.receivers=[];class jh{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const a="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=Uh("",20);a.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},o);l={messageChannel:a,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),a.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[a.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function qh(){return window}function Vh(){return void 0!==qh().WorkerGlobalScope&&"function"==typeof qh().importScripts}const Bh="firebaseLocalStorageDb",Kh=1,zh="firebaseLocalStorage",Wh="fbase_key";class $h{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Hh(e,t){return e.transaction([zh],t?"readwrite":"readonly").objectStore(zh)}function Gh(){const r=indexedDB.open(Bh,Kh);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(zh,{keyPath:Wh})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(zh)?n(e):(e.close(),t=indexedDB.deleteDatabase(Bh),await new $h(t).toPromise(),n(await Gh()))})})}async function Qh(e,t,n){n=Hh(e,!0).put({[Wh]:t,value:n});return new $h(n).toPromise()}function Yh(e,t){t=Hh(e,!0).delete(t);return new $h(t).toPromise()}class Jh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Gh(),this.db)}async _withRetries(e){let t=0;for(;;)try{return await e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Vh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Fh._getInstance(Vh()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new jh(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await Gh();return await Qh(e,Ph,"1"),await Yh(e,Ph),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Qh(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){return t=Hh(e,!1).get(t),void 0===(t=await new $h(t).toPromise())?null:t.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Yh(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{e=Hh(e,!1).getAll();return new $h(e).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Jh.type="LOCAL";const Xh=Jh;function Zh(r){return new Promise((e,n)=>{const t=document.createElement("script");t.setAttribute("src",r),t.onload=e,t.onerror=e=>{const t=Nl("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(e=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==e?e:document).appendChild(t)})}function ed(e){return`__${e}${Math.floor(1e6*Math.random())}`}class td{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new nd(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t=e||1e12;null===(e=this._widgets.get(t))||void 0===e||e.delete(),this._widgets.delete(t)}getResponse(e){return(null===(e=this._widgets.get(e||1e12))||void 0===e?void 0:e.getResponse())||""}async execute(e){return null===(e=this._widgets.get(e||1e12))||void 0===e||e.execute(),""}}class nd{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};e="string"==typeof e?document.getElementById(e):e;Pl(e,"argument-error",{appName:t}),this.container=e,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(t){const n=[],r="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<t;e++)n.push(r.charAt(Math.floor(Math.random()*r.length)));return n.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const rd=ed("rcb"),id=new jl(3e4,6e4);class sd{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!qh().grecaptcha}load(s,o=""){var e;return Pl((e=o).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(o)?Promise.resolve(qh().grecaptcha):new Promise((t,r)=>{const i=qh().setTimeout(()=>{r(Nl(s,"network-request-failed"))},id.get());qh()[rd]=()=>{qh().clearTimeout(i),delete qh()[rd];const e=qh().grecaptcha;if(e){const n=e.render;e.render=(e,t)=>{t=n(e,t);return this.counter++,t},this.hostLanguage=o,t(e)}else r(Nl(s,"internal-error"))},Zh(`https://www.google.com/recaptcha/api.js??${js({onload:rd,render:"explicit",hl:o})}`).catch(()=>{clearTimeout(i),r(Nl(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!qh().grecaptcha&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class od{async load(e){return new td(e)}clearedOneInstance(){}}const ad="recaptcha",cd={theme:"light",type:"image"};class ld{constructor(e,t=Object.assign({},cd),n){this.parameters=t,this.type=ad,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Tu(n),this.isInvisible="invisible"===this.parameters.size,Pl("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");e="string"==typeof e?document.getElementById(e):e;Pl(e,this.auth,"argument-error"),this.container=e,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?od:sd),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Pl(!this.parameters.sitekey,this.auth,"argument-error"),Pl(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Pl("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=qh()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){Pl(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Pl(Fl()&&!Vh(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await Wl(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");Pl(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Pl(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ud{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){e=Mu._fromVerification(this.verificationId,e);return this.onConfirmation(e)}}async function hd(t,n,r){var i,s,o,a,c,l,u=await r.verify();try{Pl("string"==typeof u,t,"argument-error"),Pl(r.type===ad,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return Pl("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await Wl(c,"POST","/v2/accounts/mfaEnrollment:start",Object.assign({tenantId:c.tenantId},l))).phoneSessionInfo.sessionInfo;Pl("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return Pl(d,t,"missing-multi-factor-info"),(a={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await Wl(t,"POST","/v2/accounts/mfaSignIn:start",Object.assign({tenantId:t.tenantId},a))).phoneResponseInfo.sessionInfo}var{sessionInfo:f}=(s=t,o={phoneNumber:e.phoneNumber,recaptchaToken:u},await Wl(s,"POST","/v1/accounts:sendVerificationCode",zl(s,o)));return f}finally{r._reset()}}class dd{constructor(e){this.providerId=dd.PROVIDER_ID,this.auth=Tu(e)}verifyPhoneNumber(e,t){return hd(this.auth,e,io(t))}static credential(e,t){return Mu._fromVerification(e,t)}static credentialFromResult(e){return dd.credentialFromTaggedObject(e)}static credentialFromError(e){return dd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:e}=e;return t&&e?Mu._fromTokenResponse(t,e):null}}function fd(e,t){return t?Ll(t):(Pl(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}dd.PROVIDER_ID="phone",dd.PHONE_SIGN_IN_METHOD="phone";class pd extends Au{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ou(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ou(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ou(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function gd(e){return rh(e.auth,new pd(e),e.bypassAuthState)}function md(e){var{auth:t,user:n}=e;return Pl(n,t,"internal-error"),nh(n,new pd(e),e.bypassAuthState)}async function yd(e){var{auth:t,user:n}=e;return Pl(n,t,"internal-error"),eh(n,new pd(e),e.bypassAuthState)}class vd{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:e}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(e)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return gd;case"linkViaPopup":case"linkViaRedirect":return yd;case"reauthViaPopup":case"reauthViaRedirect":return md;default:Al(this.auth,"internal-error")}}resolve(e){Ol(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ol(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const _d=new jl(2e3,1e4);class wd extends vd{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,wd.currentPopupAction&&wd.currentPopupAction.cancel(),wd.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return Pl(e,this.auth,"internal-error"),e}async onExecution(){Ol(1===this.filter.length,"Popup operations only handle one event");var e=Uh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Nl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Nl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,wd.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Nl(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,_d.get())};t()}}wd.currentPopupAction=null;const bd="pendingRedirect",Id=new Map;class Td extends vd{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=Id.get(this.auth._key());if(!t){try{const i=(e=this.resolver,n=this.auth,r=kd(n),n="true"===await Sd(e)._get(r),await Sd(e)._remove(r),await n)?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}Id.set(this.auth._key(),t)}var e,n,r;return t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Ed(e,t){return Sd(e)._set(kd(t),"true")}function Sd(e){return Ll(e._redirectPersistence)}function kd(e){return lu(bd,e.config.apiKey,e.name)}function Cd(e,t,n){return async function(e,t,n){var r=Tu(e);Pl(t instanceof ju,e,"argument-error");const i=fd(r,n);return await Ed(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Ad(e,t,n){return async function(e,t,n){e=io(e);Pl(t instanceof ju,e.auth,"argument-error");const r=fd(e.auth,n);await Ed(r,e.auth);n=await Pd(e);return r._openRedirect(e.auth,t,"reauthViaRedirect",n)}(e,t,n)}function Nd(e,t,n){return async function(e,t,n){e=io(e);Pl(t instanceof ju,e.auth,"argument-error");const r=fd(e.auth,n);await th(!1,e,t.providerId),await Ed(r,e.auth);n=await Pd(e);return r._openRedirect(e.auth,t,"linkViaRedirect",n)}(e,t,n)}async function Rd(e,t,n=!1){const r=Tu(e);e=fd(r,t);const i=new Td(r,e,n),s=await i.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}async function Pd(e){var t=Uh(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class xd{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Dd(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Dd(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(Nl(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Od(e))}saveEventToCache(e){this.cachedEventUids.add(Od(e)),this.lastProcessedEventTime=Date.now()}}function Od(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Dd({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Ld(e,t={}){return Wl(e,"GET","/v1/projects",t)}const Md=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Fd=/^https?/;async function Ud(e){if(!e.config.emulator){var{authorizedDomains:t}=await Ld(e);for(const n of t)try{if(function(e){const t=Ml(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Fd.test(n))return!1;if(Md.test(e))return r===e;const s=e.replace(/\./g,"\\."),o=new RegExp("^(.+\\."+s+"|"+s+")$","i");return o.test(r)}(n))return}catch(e){}Al(e,"unauthorized-domain")}}const jd=new jl(3e4,6e4);function qd(){const t=qh().___jsl;if(null!==t&&void 0!==t&&t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Vd=null;function Bd(e){var i;return Vd=Vd||(i=e,new Promise((e,t)=>{function n(){qd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{qd(),t(Nl(i,"network-request-failed"))},timeout:jd.get()})}if(null!==(r=null===(r=qh().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=qh().gapi)||void 0===r||!r.load){var r=ed("iframefcb");return qh()[r]=()=>{gapi.load?n():t(Nl(i,"network-request-failed"))},Zh(`https://apis.google.com/js/api.js?onload=${r}`)}n()}}).catch(e=>{throw Vd=null,e})),Vd}const Kd=new jl(5e3,15e3),zd="__/auth/iframe",Wd="emulator/auth/iframe",$d={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},Hd=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Gd(o){const e=await Bd(o);var t=qh().gapi;return Pl(t,o,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;Pl(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?ql(t,Wd):`https://${e.config.authDomain}/${zd}`;const r={apiKey:t.apiKey,appName:e.name,v:Mo};(t=Hd.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${js(r).slice(1)}`}(o),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:$d,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=Nl(o,"network-request-failed"),r=qh().setTimeout(()=>{t(n)},Kd.get());function i(){qh().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const Qd={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Yd{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Jd(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Qd),{width:r.toString(),height:i.toString(),top:s,left:o});o=fs().toLowerCase();n&&(a=pu(o)?"_blank":n),du(o)&&(t=t||"http://localhost",c.scrollbars="yes");var l,n=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([o=fs()]=[o],_u(o)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Yd(null);const u=window.open(t||"",a,n);Pl(u,e,"popup-blocked");try{u.focus()}catch(e){}return new Yd(u)}const Xd="__/auth/handler",Zd="emulator/auth/handler";function ef(e,t,n,r,i,s){Pl(e.config.authDomain,e,"auth-domain-config-required"),Pl(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Mo,eventId:i};if(t instanceof ju){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Ls(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var[a,c]of Object.entries(s||{}))o[a]=c}if(t instanceof qu){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(o.scopes=u.join(","))}e.tenantId&&(o.tid=e.tenantId);const l=o;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${[{config:e}]=[e],e.emulator?ql(e,Zd):`https://${e.authDomain}/${Xd}`}?${js(l).slice(1)}`}const tf="webStorageSupport";const nf=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mh,this._completeRedirectFn=Rd}async _openPopup(e,t,n,r){var i;return Ol(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Jd(e,ef(e,t,n,Ml(),r),Uh())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=ef(e,t,n,Ml(),r),qh().location.href=r,new Promise(()=>{})}_initialize(e){var t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(Ol(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n}async initAndGetManager(t){const e=await Gd(t),n=new xd(t);return e.register("authEvent",e=>{return Pl(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,n){const e=this.iframes[t._key()];e.send(tf,{type:tf},e=>{e=null===(e=null==e?void 0:e[0])||void 0===e?void 0:e[tf];void 0!==e&&n(!!e),Al(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ud(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return wu()||fu()||_u()}};class rf extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return xl("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new rf(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},Wl(e,"POST","/v2/accounts/mfaEnrollment:finalize",Object.assign({tenantId:e.tenantId},n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},Wl(e,"POST","/v2/accounts/mfaSignIn:finalize",Object.assign({tenantId:e.tenantId},t))}}class sf{constructor(){}static assertion(e){return rf._fromCredential(e)}}var of;class af{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null===e||void 0===e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Pl(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function cf(){return window}of="Browser",xo(new so("auth",(e,{options:n})=>{e=e.getProvider("app").getImmediate();const{apiKey:r,authDomain:i}=e.options;return(e=>{Pl(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),Pl(!(null!==i&&void 0!==i&&i.includes(":")),"argument-error",{appName:e.name});var t={apiKey:r,authDomain:i,clientPlatform:of,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:bu(of)},t=new Iu(e,t);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(Ll);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(t,n),t})(e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),xo(new so("auth-internal",e=>{e=Tu(e.getProvider("auth").getImmediate());return e=e,new af(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),qo("@firebase/auth","0.17.1",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(of));async function lf(e,t,n){var{BuildInfo:r}=cf();Ol(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(t){if(Ol(/[0-9a-zA-Z]+/.test(t),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(t);const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return _u()?s.ibi=r.packageName:mu()?s.apn=r.packageName:Al(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,ef(e,n,t.type,void 0,null!==(t=t.eventId)&&void 0!==t?t:void 0,s)}function uf(r){const{cordova:i}=cf();return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=fs(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const hf=20;class df extends xd{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function ff(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<hf;e++){var r=Math.floor(Math.random()*n.length);t.push(n.charAt(r))}return t.join("")}(),postBody:null,tenantId:e.tenantId,error:Nl(e,"no-auth-event")}}async function pf(e){var t=await mf()._get(yf(e));return t&&await mf()._remove(yf(e)),t}function gf(e,t){var n,r,i;const s=(n=vf(o=t),r=n.link?decodeURIComponent(n.link):void 0,i=vf(r).link,t=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=vf(t).link)||t||i||r||o);if(s.includes("/__/auth/callback")){var o=vf(s),o=o.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(o.firebaseError)):null,o=null===(o=null===(o=null==o?void 0:o.code)||void 0===o?void 0:o.split("auth/"))||void 0===o?void 0:o[1],o=o?Nl(o):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function mf(){return Ll(Dh)}function yf(e){return lu("authEvent",e.config.apiKey,e.name)}function vf(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return qs(t.join("?"))}const _f=class{constructor(){this._redirectPersistence=Mh,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Rd}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new df(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){Al(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;a=e,s=cf(),Pl("function"==typeof(null===(i=null==s?void 0:s.universalLinks)||void 0===i?void 0:i.subscribe),a,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Pl(void 0!==(null===(i=null==s?void 0:s.BuildInfo)||void 0===i?void 0:i.packageName),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Pl("function"==typeof(null===(i=null===(i=null===(i=null==s?void 0:s.cordova)||void 0===i?void 0:i.plugins)||void 0===i?void 0:i.browsertab)||void 0===i?void 0:i.openUrl),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Pl("function"==typeof(null===(i=null===(i=null===(i=null==s?void 0:s.cordova)||void 0===i?void 0:i.plugins)||void 0===i?void 0:i.browsertab)||void 0===i?void 0:i.isAvailable),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Pl("function"==typeof(null===(s=null===(s=null==s?void 0:s.cordova)||void 0===s?void 0:s.InAppBrowser)||void 0===s?void 0:s.open),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),Id.clear(),await this._originValidation(e);var a=ff(e,n,r);n=e,r=a,await mf()._set(yf(n),r);t=await uf(await lf(e,a,t));return async function(o,a,c){const{cordova:l}=cf();let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(Nl(o,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}a.addPassiveListener(r),document.addEventListener("resume",i,!1),mu()&&document.addEventListener("visibilitychange",s,!1),u=()=>{a.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,o,t)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var{BuildInfo:t}=cf();const n={};_u()?n.iosBundleId=t.packageName:mu()?n.androidPackageName=t.packageName:Al(e,"operation-not-supported-in-this-environment"),await Ld(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=cf(),s=setTimeout(async()=>{await pf(r),i.onEvent(wf())},500),o=async e=>{clearTimeout(s);var t=await pf(r);let n=null;t&&null!=e&&e.url&&(n=gf(t,e.url)),i.onEvent(n||wf())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,o);const a=t,c=`${n.packageName.toLowerCase()}://`;cf().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function wf(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Nl("no-auth-event")}}var bf;function If(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Tf(e=fs()){return!("file:"!==If()&&"ionic:"!==If()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ef(e=fs()){return vs()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=fs()]=[e],/Edge\/\d+/.test(e))}function Sf(){try{const t=self.localStorage;var e=Uh();if(t)return t.setItem(e,"1"),t.removeItem(e),!Ef()||ws()}catch(e){return kf()&&ws()}return!1}function kf(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Cf(){return("http:"===If()||"https:"===If()||ms()||Tf())&&!(ys()||gs())&&Sf()&&!kf()}function Af(){return Tf()&&"undefined"!=typeof document}const Nf={LOCAL:"local",NONE:"none",SESSION:"session"},Rf=Pl,Pf="persistence";async function xf(e){await e._initializationPromise;const t=Of();var n=lu(Pf,e.config.apiKey,e.name);null!==t&&void 0!==t&&t.sessionStorage&&t.sessionStorage.setItem(n,e._getPersistence())}function Of(){return"undefined"!=typeof window?window:null}const Df=Pl;class Lf{constructor(){this.browserResolver=Ll(nf),this.cordovaResolver=Ll(_f),this.underlyingResolver=null,this._redirectPersistence=Mh,this._completeRedirectFn=Rd}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Af()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Df(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Af()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function Mf(e){return e.unwrap()}function Ff(e,t){var n,r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code){const s=t;s.resolver=new Vf(e,(n=t,e=io(i=e),Pl((i=n).operationType,e,"argument-error"),Pl(null===(n=i.serverResponse)||void 0===n?void 0:n.mfaPendingCredential,e,"argument-error"),Ah._fromError(e,i)))}else if(r){var i=Uf(t);const o=t;i&&(o.credential=i,o.tenantId=r.tenantId||void 0,o.email=r.email||void 0,o.phoneNumber=r.phoneNumber||void 0)}}function Uf(e){var{_tokenResponse:t}=e instanceof Ss?e.customData:e;if(!t)return null;if(!(e instanceof Ss)&&"temporaryProof"in t&&"phoneNumber"in t)return dd.credentialFromResult(e);const n=t.providerId;if(!n||n===Il.PASSWORD)return null;let r;switch(n){case Il.GOOGLE:r=Ku;break;case Il.FACEBOOK:r=Bu;break;case Il.GITHUB:r=zu;break;case Il.TWITTER:r=$u;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||i||a?a?n.startsWith("saml.")?Wu._create(n,a):Du._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:i,accessToken:s}):new Vu(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof Ss?r.credentialFromError(e):r.credentialFromResult(e)}async function jf(t,e){let n;try{n=await e}catch(e){throw e instanceof Ss&&Ff(t,e),e}var{operationType:e,user:t}=n;return{operationType:e,credential:Uf(n),additionalUserInfo:kh(n),user:Bf.getOrCreate(t)}}async function qf(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>jf(t,n.confirm(e))}}class Vf{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return jf(Mf(this.auth),this.resolver.resolveSignIn(e))}}class Bf{constructor(e){this._delegate=e,this.multiFactor=(e=io(e=e),Rh.has(e)||Rh.set(e,Nh._fromUser(e)),Rh.get(e))}static getOrCreate(e){return Bf.USER_MAP.has(e)||Bf.USER_MAP.set(e,new Bf(e)),Bf.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return jf(this.auth,sh(this._delegate,e))}async linkWithPhoneNumber(e,t){return qf(this.auth,async function(e,t,n){const r=io(e);return await th(!1,r,"phone"),n=await hd(r.auth,t,io(n)),new ud(n,e=>sh(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return jf(this.auth,async function(e,t,n){e=io(e),Pl(t instanceof ju,e.auth,"argument-error"),n=fd(e.auth,n);const r=new wd(e.auth,"linkViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,Lf))}async linkWithRedirect(e){return await xf(Tu(this.auth)),Nd(this._delegate,e,Lf)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return jf(this.auth,oh(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return qf(this.auth,async function(e,t,n){const r=io(e);return n=await hd(r.auth,t,io(n)),new ud(n,e=>oh(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return jf(this.auth,async function(e,t,n){e=io(e),Pl(t instanceof ju,e.auth,"argument-error"),n=fd(e.auth,n);const r=new wd(e.auth,"reauthViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,Lf))}async reauthenticateWithRedirect(e){return await xf(Tu(this.auth)),Ad(this._delegate,e,Lf)}sendEmailVerification(e){return mh(this._delegate,e)}async unlink(e){return await Zu(this._delegate,e),this}updateEmail(e){return _h(io(this._delegate),e,null)}updatePassword(e){return _h(io(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await eh(io(e),t)}(this._delegate,e)}updateProfile(e){return vh(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return yh(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Bf.USER_MAP=new WeakMap;const Kf=Pl;class zf{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var{apiKey:n}=e.options;Kf(n,"invalid-api-key",{appName:e.name});let r=[cu];if("undefined"!=typeof window){r=function(e,t){const n=Of();if(null===n||void 0===n||!n.sessionStorage)return[];switch(t=lu(Pf,e,t),n.sessionStorage.getItem(t)){case Nf.NONE:return[cu];case Nf.LOCAL:return[Xh,Mh];case Nf.SESSION:return[Mh];default:return[]}}(n,e.name);for(const i of[Xh,Dh,Mh])r.includes(i)||r.push(i)}Kf(n,"invalid-api-key",{appName:e.name});e="undefined"!=typeof window?Lf:void 0;this._delegate=t.initialize({options:{persistence:r,popupRedirectResolver:e}}),this._delegate._updateErrorMap(El),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Bf.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Su(this._delegate,e,t)}applyActionCode(e){return dh(this._delegate,e)}checkActionCode(e){return fh(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Nu(io(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return jf(this._delegate,async function(e,t,n){const r=Tu(e);return n=await Hu(r,{returnSecureToken:!0,email:t,password:n}),n=await Gu._fromIdTokenResponse(r,"signIn",n),await r._updateCurrentUser(n.user),n}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return gh(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(e=Fu.parseLink(e))?void 0:e.operation)}async getRedirectResult(){Kf(Cf(),this._delegate,"operation-not-supported-in-this-environment");var e,t,t=(e=this._delegate,t=Lf,await Tu(e)._initializationPromise,await Rd(e,t,!1));return t?jf(this._delegate,Promise.resolve(t)):{credential:null,user:null}}addFrameworkForLogging(e){Tu(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:e,error:t,complete:n}=Wf(e,t,n);return this._delegate.onAuthStateChanged(e,t,n)}onIdTokenChanged(e,t,n){var{next:e,error:t,complete:n}=Wf(e,t,n);return this._delegate.onIdTokenChanged(e,t,n)}sendSignInLinkToEmail(e,t){return ph(this._delegate,e,t)}sendPasswordResetEmail(e,t){return hh(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,Rf(Object.values(Nf).includes(n),t,"invalid-persistence-type"),ys()?Rf(n!==Nf.SESSION,t,"unsupported-persistence-type"):gs()?Rf(n===Nf.NONE,t,"unsupported-persistence-type"):kf()?Rf(n===Nf.NONE||n===Nf.LOCAL&&ws(),t,"unsupported-persistence-type"):Rf(n===Nf.NONE||Sf(),t,"unsupported-persistence-type");let r;switch(e){case Nf.SESSION:r=Mh;break;case Nf.LOCAL:var i=await Ll(Xh)._isAvailable();r=i?Xh:Dh;break;case Nf.NONE:r=cu;break;default:return Al("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return jf(this._delegate,async function(e){const t=Tu(e);return await t._initializationPromise,null!==(e=t.currentUser)&&void 0!==e&&e.isAnonymous?new Gu({user:t.currentUser,providerId:null,operationType:"signIn"}):(e=await Hu(t,{returnSecureToken:!0}),e=await Gu._fromIdTokenResponse(t,"signIn",e,!0),await t._updateCurrentUser(e.user),e)}(this._delegate))}signInWithCredential(e){return jf(this._delegate,ih(this._delegate,e))}signInWithCustomToken(e){return jf(this._delegate,ah(this._delegate,e))}signInWithEmailAndPassword(e,t){return jf(this._delegate,(n=this._delegate,e=e,t=t,ih(io(n),Uu.credential(e,t))));var n}signInWithEmailLink(e,t){return jf(this._delegate,async function(e,t,n){return e=io(e),Pl((n=Uu.credentialWithLink(t,n||Ml()))._tenantId===(e.tenantId||null),e,"tenant-id-mismatch"),ih(e,n)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return qf(this._delegate,async function(e,t,n){const r=Tu(e);return n=await hd(r,t,io(n)),new ud(n,e=>ih(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return Kf(Cf(),this._delegate,"operation-not-supported-in-this-environment"),jf(this._delegate,async function(e,t,n){var r=Tu(e);Pl(t instanceof ju,e,"argument-error"),n=fd(r,n);const i=new wd(r,"signInViaPopup",t,n);return i.executeNotNull()}(this._delegate,e,Lf))}async signInWithRedirect(e){return Kf(Cf(),this._delegate,"operation-not-supported-in-this-environment"),await xf(this._delegate),Cd(this._delegate,e,Lf)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var{data:t}=await fh(io(e),t);return t.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Wf(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Bf.getOrCreate(e)),error:t,complete:n}}zf.Persistence=Nf;class $f{constructor(){this.providerId="phone",this._delegate=new dd(Mf(Go.auth()))}static credential(e,t){return dd.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}$f.PHONE_SIGN_IN_METHOD=dd.PHONE_SIGN_IN_METHOD,$f.PROVIDER_ID=dd.PROVIDER_ID;const Hf=Pl;class Gf{constructor(e,t,n=Go.app()){var r;Hf(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new ld(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(bf=Go).INTERNAL.registerComponent(new so("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("auth");return new zf(t,e)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Tl.EMAIL_SIGNIN,PASSWORD_RESET:Tl.PASSWORD_RESET,RECOVER_EMAIL:Tl.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Tl.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Tl.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Tl.VERIFY_EMAIL}},EmailAuthProvider:Uu,FacebookAuthProvider:Bu,GithubAuthProvider:zu,GoogleAuthProvider:Ku,OAuthProvider:Vu,PhoneAuthProvider:$f,PhoneMultiFactorGenerator:sf,RecaptchaVerifier:Gf,TwitterAuthProvider:$u,Auth:zf,AuthCredential:Au,Error:Ss}).setInstantiationMode("LAZY").setMultipleInstances(!1)),bf.registerVersion("@firebase/auth-compat","0.1.1");let Qf="";function Yf(e){Qf=e}class Jf{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ps(t))}get(e){e=this.domStorage_.getItem(this.prefixedName_(e));return null==e?null:Rs(e)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Xf{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Os(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var Zf,ep,tp,np,rp,ip,qi=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Jf(t)}}catch(e){}return new Xf};const sp=qi("localStorage"),op=qi("sessionStorage"),ap=new _o("@firebase/database"),cp=function(){let e=1;return function(){return e++}}(),lp=function(e){e=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i,s=e.charCodeAt(r);55296<=s&&s<=56319&&(i=s-55296,is(++r<e.length,"Surrogate pair missing trail surrogate."),s=65536+(i<<10)+(e.charCodeAt(r)-56320)),s<128?t[n++]=s:(s<2048?t[n++]=s>>6|192:(s<65536?t[n++]=s>>12|224:(t[n++]=s>>18|240,t[n++]=s>>12&63|128),t[n++]=s>>6&63|128),t[n++]=63&s|128)}return t}(e);const t=new Bs;t.update(e);e=t.digest();return os.encodeByteArray(e)},up=function(...t){let n="";for(let e=0;e<t.length;e++){var r=t[e];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=up.apply(null,r):n+="object"==typeof r?Ps(r):r,n+=" "}return n};let hp=null,dp=!0;const fp=function(e,t){is(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(ap.logLevel=fo.VERBOSE,hp=ap.log.bind(ap),t&&op.set("logging_enabled",!0)):"function"==typeof e?hp=e:(hp=null,op.remove("logging_enabled"))},pp=function(...e){!0===dp&&(dp=!1,null===hp&&!0===op.get("logging_enabled")&&fp(!0)),hp&&(e=up.apply(null,e),hp(e))},gp=function(t){return function(...e){pp(t,...e)}},mp=function(...e){e="FIREBASE INTERNAL ERROR: "+up(...e);ap.error(e)},yp=function(...e){e=`FIREBASE FATAL ERROR: ${up(...e)}`;throw ap.error(e),new Error(e)},vp=function(...e){e="FIREBASE WARNING: "+up(...e);ap.warn(e)},_p=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},wp="[MIN_NAME]",bp="[MAX_NAME]",Ip=function(e,t){if(e===t)return 0;if(e===wp||t===bp)return-1;if(t===wp||e===bp)return 1;var n=xp(e),r=xp(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1},Tp=function(e,t){return e===t?0:e<t?-1:1},Ep=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Ps(t))},Sp=function(t){if("object"!=typeof t||null===t)return Ps(t);const n=[];for(const e in t)n.push(e);n.sort();let r="{";for(let e=0;e<n.length;e++)0!==e&&(r+=","),r+=Ps(n[e]),r+=":",r+=Sp(t[n[e]]);return r+="}",r},kp=function(t,n){var r=t.length;if(r<=n)return[t];const i=[];for(let e=0;e<r;e+=n)e+n>r?i.push(t.substring(e,r)):i.push(t.substring(e,e+n));return i};function Cp(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Ap=function(e){is(!_p(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const Np=new RegExp("^-?(0*)\\d{1,10}$"),Rp=-2147483648,Pp=2147483647,xp=function(e){if(Np.test(e)){e=Number(e);if(e>=Rp&&e<=Pp)return e}return null},Op=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw vp("Exception was thrown by user callback.",e),t},Math.floor(0))}},Dp=function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)},Lp=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class Mp{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){vp(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Fp{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(pp("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',vp(e)}}class Up{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Up.OWNER="owner";const jp=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,qp="websocket",Vp="long_polling";class Bp{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=sp.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&sp.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Kp(e,t,n){is("string"==typeof t,"typeof type must == string"),is("object"==typeof n,"typeof params must == object");let r;if(t===qp)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Vp)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Cp(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class zp{constructor(){this.counters_={}}incrementCounter(e,t=1){Os(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ls(void 0,this.counters_)}}const Wp={},$p={};function Hp(e){e=e.toString();return Wp[e]||(Wp[e]=new zp),Wp[e]}class Gp{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Op(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Qp{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=gp(e),this.stats_=Hp(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Kp(t,Vp,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Gp(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Yp((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&jp.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Qp.forceAllow_=!0}static forceDisallow(){Qp.forceDisallow_=!0}static isAvailable(){return!!Qp.forceAllow_||!(Qp.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){e=Ps(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var e=ts(e),t=kp(e,1840);for(let e=0;e<t.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){e=Ps(e).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Yp{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=cp(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Yp.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){pp("frame writing exception"),e.stack&&pp(e.stack),pp(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||pp("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{pp("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Jp=null;"undefined"!=typeof MozWebSocket?Jp=MozWebSocket:"undefined"!=typeof WebSocket&&(Jp=WebSocket);class Xp{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=gp(this.connId),this.stats_=Hp(t),this.connURL=Xp.connectionURL_(t,s,o,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&jp.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Kp(e,qp,i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,sp.set("previous_websocket_failure",!0);try{_s()||(n={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new Jp(this.connURL,[],n))}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");e=e.message||e.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Xp.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==Jp&&!Xp.forceDisallow_}static previouslyFailed(){return sp.isInMemoryStorage||!0===sp.get("previous_websocket_failure")}markConnectionHealthy(){sp.remove("previous_websocket_failure")}appendFrame_(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=Rs(e),this.onMessage(e))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(is(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(e):null!==(e=this.extractFrameCount_(e))&&this.appendFrame_(e))}send(e){this.resetKeepAlive();e=Ps(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=kp(e,16384);1<t.length&&this.sendString_(String(t.length));for(let e=0;e<t.length;e++)this.sendString_(t[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Xp.responsesRequiredToBeHealthy=2,Xp.healthyTimeout=3e4;class Zp{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Qp,Xp]}initTransports_(e){var t=Xp&&Xp.isAvailable();let n=t&&!Xp.previouslyFailed();if(e.webSocketOnly&&(t||vp("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Xp];else{const r=this.transports_=[];for(const i of Zp.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i)}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}class eg{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=gp("c:"+this.id+":"),this.transportManager_=new Zp(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=Lp(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=Ep("t",e),e=Ep("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=Ep("t",e),e=Ep("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=Ep("t",e);if("d"in e){e=e.d;if("h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?mp("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):mp("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&vp("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),e=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,e),Lp(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Lp(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(sp.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class tg{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class ng{constructor(e){this.allowedEvents_=e,this.listeners_={},is(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});e=this.getInitialEvent(e);e&&t.apply(n,e)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(t){is(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class rg extends ng{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ps()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new rg}getInitialEvent(e){return is("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const ig=32,sg=768;class og{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)0<this.pieces_[e].length&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function ag(){return new og("")}function cg(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function lg(e){return e.pieces_.length-e.pieceNum_}function ug(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new og(e.pieces_,t)}function hg(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function dg(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function fg(t){if(t.pieceNum_>=t.pieces_.length)return null;const n=[];for(let e=t.pieceNum_;e<t.pieces_.length-1;e++)n.push(t.pieces_[e]);return new og(n,0)}function pg(t,n){const r=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);if(n instanceof og)for(let e=n.pieceNum_;e<n.pieces_.length;e++)r.push(n.pieces_[e]);else{var i=n.split("/");for(let e=0;e<i.length;e++)0<i[e].length&&r.push(i[e])}return new og(r,0)}function gg(e){return e.pieceNum_>=e.pieces_.length}function mg(e,t){var n=cg(e),r=cg(t);if(null===n)return t;if(n===r)return mg(ug(e),ug(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function yg(e,t){var n=dg(e,0),r=dg(t,0);for(let e=0;e<n.length&&e<r.length;e++){var i=Ip(n[e],r[e]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function vg(n,r){if(lg(n)!==lg(r))return!1;for(let e=n.pieceNum_,t=r.pieceNum_;e<=n.pieces_.length;e++,t++)if(n.pieces_[e]!==r.pieces_[t])return!1;return!0}function _g(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(lg(e)>lg(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class wg{constructor(e,t){this.errorPrefix_=t,this.parts_=dg(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Xs(this.parts_[e]);bg(this)}}function bg(e){if(e.byteLength_>sg)throw new Error(e.errorPrefix_+"has a key path longer than "+sg+" bytes ("+e.byteLength_+").");if(e.parts_.length>ig)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ig+") or object contains a cycle "+Ig(e))}function Ig(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Tg extends ng{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new Tg}getInitialEvent(e){return is("visible"===e,"Unknown event type: "+e),[this.visible_]}}class Eg extends tg{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Eg.nextPersistentConnectionId_++,this.log_=gp("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!_s())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Tg.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&rg.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,t={r:r,a:e,b:t};this.log_(Ps(t)),is(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(t),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new us,r={p:e._path.toString(),q:e._queryObject},t={action:"g",request:r,onComplete:e=>{var t=e.d;"ok"===e.s?(this.onDataUpdate_(r.p,t,!1,null),n.resolve(t)):n.reject(t)}};this.outstandingGets_.push(t),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{var e=this.outstandingGets_[i];void 0!==e&&t===e&&(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),is(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),is(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");n={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,n),this.connected_&&this.sendListen_(n)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+s+" for "+o);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;Eg.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(o))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,o),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Os(e,"w")){const n=Ds(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),vp("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${e} at `+`${t} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){e=xs(e).claims;return"object"==typeof e&&!0===e.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_;var e=function(e){e=xs(e).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(n)?"auth":"gauth";const t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,e=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,e))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,e=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,e)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),is(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){n={p:t,d:n};this.log_("onDisconnect "+e,n),this.sendRequest(e,n,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;r=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(r):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,e=>{"ok"!==e.s&&(e=e.d,this.log_("reportStats","Error sending stats: "+e))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ps(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):mp("Unrecognized action received from server: "+Ps(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){is(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+Eg.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var o=function(){n?n.close():(t=!0,u())};this.realtime_={close:o,sendRequest:function(e){is(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var a=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(a),this.appCheckTokenProvider_.getToken(a)]);t?pp("getToken() completed but was canceled"):(pp("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new eg(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{vp(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&vp(e),o())}}}interrupt(e){pp("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){pp("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ls(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){e-=(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Sp(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){e=new og(e).toString();let n;if(this.listens.has(e)){const r=this.listens.get(e);n=r.get(t),r.delete(t),0===r.size&&this.listens.delete(e)}else n=void 0;return n}onAuthRevoked_(e,t){pp("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){pp("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Qf.replace(/\./g,"-")]=1,ps()?e["framework.cordova"]=1:ys()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=rg.getInstance().currentlyOnline();return Ls(this.interruptReasons_)&&e}}Eg.nextPersistentConnectionId_=0,Eg.nextConnectionId_=0;class Sg{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Sg(e,t)}}class kg{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){e=new Sg(wp,e),t=new Sg(wp,t);return 0!==this.compare(e,t)}minPost(){return Sg.MIN}}let Cg;class Ag extends kg{static get __EMPTY_NODE(){return Cg}static set __EMPTY_NODE(e){Cg=e}compare(e,t){return Ip(e.name,t.name)}isDefinedOn(e){throw ss("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Sg.MIN}maxPost(){return new Sg(bp,Cg)}makePost(e,t){return is("string"==typeof e,"KeyIndex indexValue must always be a string."),new Sg(e,Cg)}toString(){return".key"}}const Ng=new Ag;class Rg{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Pg{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Pg.RED,this.left=null!=r?r:xg.EMPTY_NODE,this.right=null!=i?i:xg.EMPTY_NODE}copy(e,t,n,r,i){return new Pg(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return xg.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return xg.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,Pg.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,Pg.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Pg.RED=!0,Pg.BLACK=!1;class xg{constructor(e,t=xg.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new xg(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Pg.BLACK,null,null))}remove(e){return new xg(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Pg.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Rg(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Rg(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Rg(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Rg(this.root_,null,this.comparator_,!0,e)}}function Og(e,t){return Ip(e.name,t.name)}function Dg(e,t){return Ip(e,t)}xg.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Pg(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let Lg;const Mg=function(e){return"number"==typeof e?"number:"+Ap(e):"string:"+e},Fg=function(e){var t;e.isLeafNode()?(t=e.val(),is("string"==typeof t||"number"==typeof t||"object"==typeof t&&Os(t,".sv"),"Priority must be a string or number.")):is(e===Lg||e.isEmpty(),"priority of unexpected type."),is(e===Lg||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Ug;class jg{constructor(e,t=jg.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,is(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Fg(this.priorityNode_)}static set __childrenNodeConstructor(e){Ug=e}static get __childrenNodeConstructor(){return Ug}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new jg(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:jg.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return gg(e)?this:".priority"===cg(e)?this.priorityNode_:jg.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:jg.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=cg(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(is(".priority"!==n||1===lg(e),".priority must be the last token in a path"),this.updateImmediateChild(n,jg.__childrenNodeConstructor.EMPTY_NODE.updateChild(ug(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Mg(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Ap(this.value_):this.value_,this.lazyHash_=lp(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===jg.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof jg.__childrenNodeConstructor?-1:(is(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=jg.VALUE_TYPE_ORDER.indexOf(t),i=jg.VALUE_TYPE_ORDER.indexOf(n);return is(0<=r,"Unknown leaf type: "+t),is(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}jg.VALUE_TYPE_ORDER=["object","boolean","number","string"];let qg,Vg;const Bg=new class extends kg{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?Ip(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Sg.MIN}maxPost(){return new Sg(bp,new jg("[PRIORITY-POST]",Vg))}makePost(e,t){e=qg(e);return new Sg(t,new jg("[PRIORITY-POST]",e))}toString(){return".priority"}},Kg=Math.log(2);class zg{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Kg,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Wg=function(l,e,u,t){l.sort(e);const h=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=l[e],i=u?u(r):r,new Pg(i,r.node,Pg.BLACK,null,null);n=parseInt(n/2,10)+e,e=h(e,n),t=h(n+1,t);return r=l[n],i=u?u(r):r,new Pg(i,r.node,Pg.BLACK,e,t)};var n=function(t){let n=null,r=null,i=l.length;function s(e,t){var n=i-e,r=i;i-=e,e=h(1+n,r),r=l[n],n=u?u(r):r,o(new Pg(n,r.node,t,null,e))}const o=function(e){n=(n?n.left=e:r=e,e)};for(let e=0;e<t.count;++e){var a=t.nextBitIsOne(),c=Math.pow(2,t.count-(e+1));a?s(c,Pg.BLACK):(s(c,Pg.BLACK),s(c,Pg.RED))}return r}(new zg(l.length));return new xg(t||e,n)};let $g;const Hg={};class Gg{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return is((Hg,Bg),"ChildrenNode.ts has not been loaded"),$g=$g||new Gg({".priority":Hg},{".priority":Bg}),$g}get(e){var t=Ds(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof xg?t:null}hasIndex(e){return Os(this.indexSet_,e.toString())}addIndex(e,t){is(e!==Ng,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(Sg.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let o;o=r?Wg(n,e.getCompare()):Hg;t=e.toString();const a=Object.assign({},this.indexSet_);a[t]=e;const c=Object.assign({},this.indexes_);return c[t]=o,new Gg(c,a)}addToIndexes(o,a){var e=Ms(this.indexes_,(t,n)=>{const r=Ds(this.indexSet_,n);if(is(r,"Missing index implementation for "+n),t===Hg){if(r.isDefinedOn(o.node)){const i=[],s=a.getIterator(Sg.Wrap);let e=s.getNext();for(;e;)e.name!==o.name&&i.push(e),e=s.getNext();return i.push(o),Wg(i,r.getCompare())}return Hg}{n=a.get(o.name);let e=t;return n&&(e=e.remove(new Sg(o.name,n))),e.insert(o,o.node)}});return new Gg(e,this.indexSet_)}removeFromIndexes(n,r){var e=Ms(this.indexes_,e=>{if(e===Hg)return e;var t=r.get(n.name);return t?e.remove(new Sg(n.name,t)):e});return new Gg(e,this.indexSet_)}}let Qg;class Yg{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Fg(this.priorityNode_),this.children_.isEmpty()&&is(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Qg=Qg||new Yg(new xg(Dg),null,Gg.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Qg}updatePriority(e){return this.children_.isEmpty()?this:new Yg(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();e=this.children_.get(e);return null===e?Qg:e}getChild(e){var t=cg(e);return null===t?this:this.getImmediateChild(t).getChild(ug(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(is(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new Sg(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Qg:this.priorityNode_;return new Yg(e,i,t)}}updateChild(e,t){var n=cg(e);if(null===n)return t;is(".priority"!==cg(e)||1===lg(e),".priority must be the last token in a path");t=this.getImmediateChild(n).updateChild(ug(e),t);return this.updateImmediateChild(n,t)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,o=!0;if(this.forEachChild(Bg,(e,t)=>{r[e]=t.val(n),i++,o&&Yg.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):o=!1}),!n&&o&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+Mg(this.getPriority().val())+":"),this.forEachChild(Bg,(e,t)=>{t=t.hash();""!==t&&(n+=":"+e+":"+t)}),this.lazyHash_=""===n?"":lp(n)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){t=r.getPredecessorKey(new Sg(e,t));return t?t.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){e=this.getFirstChildName(e);return e?new Sg(e,this.children_.get(e)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){e=this.getLastChildName(e);return e?new Sg(e,this.children_.get(e)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,Sg.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,Sg.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Xg?-1:0}withIndex(e){if(e===Ng||this.indexMap_.hasIndex(e))return this;e=this.indexMap_.addIndex(e,this.children_);return new Yg(this.children_,this.priorityNode_,e)}isIndexed(e){return e===Ng||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(Bg),i=n.getIterator(Bg);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===Ng?null:this.indexMap_.get(e.toString())}}Yg.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Jg extends Yg{constructor(){super(new xg(Dg),Yg.EMPTY_NODE,Gg.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Yg.EMPTY_NODE}isEmpty(){return!1}}const Xg=new Jg;Object.defineProperties(Sg,{MIN:{value:new Sg(wp,Yg.EMPTY_NODE)},MAX:{value:new Sg(bp,Xg)}}),Ag.__EMPTY_NODE=Yg.EMPTY_NODE,jg.__childrenNodeConstructor=Yg,Zf=Xg,Lg=Zf,ep=Xg,Vg=ep;const Zg=!0;function em(i,e=null){if(null===i)return Yg.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),is(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new jg(t,em(e))}if(i instanceof Array||!Zg){let r=Yg.EMPTY_NODE;return Cp(i,(e,t)=>{if(Os(i,e)&&"."!==e.substring(0,1)){const n=em(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(em(e))}{const s=[];let r=!1;if(Cp(i,(e,t)=>{if("."!==e.substring(0,1)){const n=em(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new Sg(e,n)))}}),0===s.length)return Yg.EMPTY_NODE;var n=Wg(s,Og,e=>e.name,Dg);if(r){t=Wg(s,Bg.getCompare());return new Yg(n,em(e),new Gg({".priority":t},{".priority":Bg}))}return new Yg(n,em(e),Gg.Default)}}qg=em;class tm extends kg{constructor(e){super(),this.indexPath_=e,is(!gg(e)&&".priority"!==cg(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?Ip(e.name,t.name):r}makePost(e,t){e=em(e),e=Yg.EMPTY_NODE.updateChild(this.indexPath_,e);return new Sg(t,e)}maxPost(){var e=Yg.EMPTY_NODE.updateChild(this.indexPath_,Xg);return new Sg(bp,e)}toString(){return dg(this.indexPath_,0).join("/")}}const nm=new class extends kg{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?Ip(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Sg.MIN}maxPost(){return Sg.MAX}makePost(e,t){e=em(e);return new Sg(t,e)}toString(){return".value"}},rm="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",im=function(){let s=0;const o=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=rm.charAt(e%64),e=Math.floor(e/64);is(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===o[n];n--)o[n]=0;o[n]++}else for(n=0;n<12;n++)o[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=rm.charAt(o[n]);return is(20===i.length,"nextPushId: Length should be 20."),i}}(),sm=function(t){if(t===""+Pp)return"-";var e=xp(t);if(null!=e)return""+(e+1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);if(n.length<786)return n.push("-"),n.join("");let r=n.length-1;for(;0<=r&&"z"===n[r];)r--;if(-1===r)return bp;e=n[r],e=rm.charAt(rm.indexOf(e)+1);return n[r]=e,n.slice(0,r+1).join("")},om=function(t){if(t===""+Rp)return wp;var e=xp(t);if(null!=e)return""+(e-1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);return"-"===n[n.length-1]?1===n.length?""+Pp:(delete n[n.length-1],n.join("")):(n[n.length-1]=rm.charAt(rm.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function am(e){return{type:"value",snapshotNode:e}}function cm(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function lm(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function um(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class hm{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){is(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(lm(t,o)):is(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(cm(t,n)):s.trackChildChange(um(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Bg,(e,t)=>{n.hasChild(e)||i.trackChildChange(lm(e,t))}),n.isLeafNode()||n.forEachChild(Bg,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(um(e,t,n))}else i.trackChildChange(cm(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Yg.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class dm{constructor(e){this.indexedFilter_=new hm(e.getIndex()),this.index_=e.getIndex(),this.startPost_=dm.getStartPost_(e),this.endPost_=dm.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new Sg(t,n))||(n=Yg.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?Yg.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(Yg.EMPTY_NODE);const i=this;return t.forEachChild(Bg,(e,t)=>{i.matches(new Sg(e,t))||(r=r.updateImmediateChild(e,Yg.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class fm{constructor(e){this.rangedFilter_=new dm(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new Sg(t,n))||(n=Yg.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,o,t){let a;if(o.isLeafNode()||o.isEmpty())a=Yg.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<o.numChildren()&&o.isIndexed(this.index_)){a=Yg.EMPTY_NODE.withIndex(this.index_);let t;t=this.reverse_?o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){var r=t.getNext();let e;if(e=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),r)<=0:this.index_.compare(r,this.rangedFilter_.getEndPost())<=0,!e)break;a=a.updateImmediateChild(r.name,r.node),n++}}else{a=o.withIndex(this.index_),a=a.updatePriority(Yg.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=a.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const l=this.index_.getCompare();n=(e,t)=>l(t,e)}else r=a.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var c=r.getNext();!s&&n(e,c)<=0&&(s=!0),s&&i<this.limit_&&n(c,t)<=0?i++:a=a.updateImmediateChild(c.name,Yg.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,a,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const o=e;is(o.numChildren()===this.limit_,"");var a=new Sg(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){var u=o.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||o.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,a);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(um(t,n,u)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(lm(t,u));const f=o.updateImmediateChild(t,Yg.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(cm(e.name,e.node)),f.updateImmediateChild(e.name,e.node)):f}}return!n.isEmpty()&&l&&0<=s(c,a)?(null!=i&&(i.trackChildChange(lm(c.name,c.node)),i.trackChildChange(cm(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,Yg.EMPTY_NODE)):e}}class pm{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Bg}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return is(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return is(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:wp}hasEnd(){return this.endSet_}getIndexEndValue(){return is(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return is(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:bp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return is(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Bg}copy(){const e=new pm;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function gm(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function mm(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function ym(e,t){const n=e.copy();return n.index_=t,n}function vm(e){const t={};if(e.isDefault())return t;let n;return n=e.index_===Bg?"$priority":e.index_===nm?"$value":e.index_===Ng?"$key":(is(e.index_ instanceof tm,"Unrecognized index type!"),e.index_.toString()),t.orderBy=Ps(n),e.startSet_&&(t.startAt=Ps(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Ps(e.indexStartName_))),e.endSet_&&(t.endAt=Ps(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Ps(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function _m(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==Bg&&(n.i=t.index_.toString()),n}class wm extends tg{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=gp("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(is(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=wm.getListenId_(e,r),a={};this.listens_[o]=a;e=vm(e._queryParams);this.restRequest_(s+".json",e,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),Ds(this.listens_,o)===a){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){t=wm.getListenId_(e,t);delete this.listens_[t]}get(e){var t=vm(e._queryParams);const r=e._path.toString(),i=new us;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},o){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+js(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(o&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=Rs(r.responseText)}catch(e){vp("Failed to parse JSON response for "+n+": "+r.responseText)}o(null,e)}else 401!==r.status&&404!==r.status&&vp("Got unsuccessful REST response for "+n+" Status: "+r.status),o(r.status);o=null}},r.open("GET",n,!0),r.send()})}}class bm{constructor(){this.rootNode_=Yg.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Im(){return{value:null,children:new Map}}function Tm(e,t,n){var r;gg(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=cg(t),e.children.has(r)||e.children.set(r,Im()),Tm(e.children.get(r),t=ug(t),n))}function Em(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{Em(t,new og(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class Sm{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Cp(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class km{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Sm(e);e=1e4+2e4*Math.random();Lp(this.reportStats_.bind(this),Math.floor(e))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Cp(e,(e,t)=>{0<t&&Os(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),Lp(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function Cm(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Am(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Nm(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(ur=tp=tp||{})[ur.OVERWRITE=0]="OVERWRITE",ur[ur.MERGE=1]="MERGE",ur[ur.ACK_USER_WRITE=2]="ACK_USER_WRITE",ur[ur.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class Rm{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=tp.ACK_USER_WRITE,this.source=Cm()}operationForChild(e){if(gg(this.path)){if(null!=this.affectedTree.value)return is(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new og(e));return new Rm(ag(),t,this.revert)}return is(cg(this.path)===e,"operationForChild called for unrelated child."),new Rm(ug(this.path),this.affectedTree,this.revert)}}class Pm{constructor(e,t){this.source=e,this.path=t,this.type=tp.LISTEN_COMPLETE}operationForChild(e){return gg(this.path)?new Pm(this.source,ag()):new Pm(this.source,ug(this.path))}}class xm{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=tp.OVERWRITE}operationForChild(e){return gg(this.path)?new xm(this.source,ag(),this.snap.getImmediateChild(e)):new xm(this.source,ug(this.path),this.snap)}}class Om{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=tp.MERGE}operationForChild(e){if(gg(this.path)){const t=this.children.subtree(new og(e));return t.isEmpty()?null:t.value?new xm(this.source,ag(),t.value):new Om(this.source,ag(),t)}return is(cg(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Om(this.source,ug(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Dm{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(gg(e))return this.isFullyInitialized()&&!this.filtered_;e=cg(e);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Lm{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Mm(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),Fm(n,i,"child_removed",e,r,t),Fm(n,i,"child_added",e,r,t),Fm(n,i,"child_moved",s,r,t),Fm(n,i,"child_changed",e,r,t),Fm(n,i,"value",e,r,t),i}function Fm(s,o,t,e,a,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw ss("Should only compare child_ events.");t=new Sg(t.childName,t.snapshotNode),n=new Sg(n.childName,n.snapshotNode);return e.index_.compare(t,n)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;a.forEach(e=>{e.respondsTo(t.type)&&o.push(e.createEvent(n,s.query_))})})}function Um(e,t){return{eventCache:e,serverCache:t}}function jm(e,t,n,r){return Um(new Dm(t,n,r),e.serverCache)}function qm(e,t,n,r){return Um(e.eventCache,new Dm(t,n,r))}function Vm(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Bm(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Km;class zm{constructor(e,t=(Km=Km||new xg(Tp),Km)){this.value=e,this.children=t}static fromObject(e){let n=new zm(null);return Cp(e,(e,t)=>{n=n.set(new og(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ag(),value:this.value};if(gg(e))return null;{var n=cg(e);const r=this.children.get(n);if(null===r)return null;t=r.findRootMostMatchingPathAndValue(ug(e),t);return null==t?null:{path:pg(new og(n),t.path),value:t.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(gg(e))return this;{var t=cg(e);const n=this.children.get(t);return null!==n?n.subtree(ug(e)):new zm(null)}}set(e,t){if(gg(e))return new zm(t,this.children);{var n=cg(e);const r=this.children.get(n)||new zm(null);t=r.set(ug(e),t),t=this.children.insert(n,t);return new zm(this.value,t)}}remove(t){if(gg(t))return this.children.isEmpty()?new zm(null):new zm(null,this.children);{var n=cg(t);const r=this.children.get(n);if(r){const i=r.remove(ug(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new zm(null):new zm(this.value,e)}return this}}get(e){if(gg(e))return this.value;{var t=cg(e);const n=this.children.get(t);return n?n.get(ug(e)):null}}setTree(t,n){if(gg(t))return n;{var r=cg(t);const i=this.children.get(r)||new zm(null),s=i.setTree(ug(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new zm(this.value,e)}}fold(e){return this.fold_(ag(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(pg(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,ag(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(gg(e))return null;{r=cg(e);const i=this.children.get(r);return i?i.findOnPath_(ug(e),pg(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ag(),t)}foreachOnPath_(e,t,n){if(gg(e))return this;{this.value&&n(t,this.value);var r=cg(e);const i=this.children.get(r);return i?i.foreachOnPath_(ug(e),pg(t,r),n):new zm(null)}}foreach(e){this.foreach_(ag(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(pg(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class Wm{constructor(e){this.writeTree_=e}static empty(){return new Wm(new zm(null))}}function $m(t,n,r){if(gg(n))return new Wm(new zm(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=mg(s,n);return e=e.updateChild(i,r),new Wm(t.writeTree_.set(s,e))}r=new zm(r),r=t.writeTree_.setTree(n,r);return new Wm(r)}function Hm(e,n,t){let r=e;return Cp(t,(e,t)=>{r=$m(r,pg(n,e),t)}),r}function Gm(e,t){if(gg(t))return Wm.empty();t=e.writeTree_.setTree(t,new zm(null));return new Wm(t)}function Qm(e,t){return null!=Ym(e,t)}function Ym(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(mg(n.path,t)):null}function Jm(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Bg,(e,t)=>{n.push(new Sg(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new Sg(e,t.value))}),n}function Xm(e,t){if(gg(t))return e;var n=Ym(e,t);return null!=n?new Wm(new zm(n)):new Wm(e.writeTree_.subtree(t))}function Zm(e){return e.writeTree_.isEmpty()}function ey(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(is(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(pg(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(pg(i,".priority"),n):s}}}(ag(),e.writeTree_,t)}function ty(e,t){return fy(t,e)}function ny(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);is(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&0<=a;){var c=t.allWrites[a];c.visible&&(a>=r&&function(e,t){{if(e.snap)return _g(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&_g(pg(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:_g(i.path,c.path)&&(o=!0)),a--}return!!s&&(o?((e=t).visibleWrites=iy(e.allWrites,ry,ag()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Gm(t.visibleWrites,i.path):Cp(i.children,e=>{t.visibleWrites=Gm(t.visibleWrites,pg(i.path,e))}),!0)}function ry(e){return e.visible}function iy(t,n,r){let i=Wm.empty();for(let e=0;e<t.length;++e){const o=t[e];if(n(o)){var s=o.path;let e;if(o.snap)_g(r,s)?(e=mg(r,s),i=$m(i,e,o.snap)):_g(s,r)&&(e=mg(s,r),i=$m(i,ag(),o.snap.getChild(e)));else{if(!o.children)throw ss("WriteRecord should have .snap or .children");if(_g(r,s))e=mg(r,s),i=Hm(i,e,o.children);else if(_g(s,r))if(e=mg(s,r),gg(e))i=Hm(i,ag(),o.children);else{const a=Ds(o.children,cg(e));a&&(s=a.getChild(ug(e)),i=$m(i,ag(),s))}}}}return i}function sy(e,t,n,r,i){if(r||i){var s=Xm(e.visibleWrites,t);if(!i&&Zm(s))return n;if(i||null!=n||Qm(s,ag()))return ey(iy(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(_g(e.path,t)||_g(t,e.path))},t),n||Yg.EMPTY_NODE);return null}s=Ym(e.visibleWrites,t);if(null!=s)return s;e=Xm(e.visibleWrites,t);return Zm(e)?n:null!=n||Qm(e,ag())?ey(e,n||Yg.EMPTY_NODE):null}function oy(e,t,n,r){return sy(e.writeTree,e.treePath,t,n,r)}function ay(e,t){return function(e,t,n){let r=Yg.EMPTY_NODE;const i=Ym(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Bg,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=Xm(e.visibleWrites,t);return n.forEachChild(Bg,(e,t)=>{t=ey(Xm(s,new og(e)),t);r=r.updateImmediateChild(e,t)}),Jm(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Jm(Xm(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function cy(e,t,n,r){return i=e.writeTree,e=e.treePath,t=t,r=r,is(n||r,"Either existingEventSnap or existingServerSnap must exist"),e=pg(e,t),Qm(i.visibleWrites,e)?null:Zm(e=Xm(i.visibleWrites,e))?r.getChild(t):ey(e,r.getChild(t));var i}function ly(e,t){return n=e.writeTree,t=pg(e.treePath,t),Ym(n.visibleWrites,t);var n}function uy(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;if(e=Xm(e.visibleWrites,t),null!=(t=Ym(e,ag())))a=t;else{if(null==n)return[];a=ey(e,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const c=[],l=o.getCompare(),u=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let e=u.getNext();for(;e&&c.length<i;)0!==l(e,r)&&c.push(e),e=u.getNext();return c}}(e.writeTree,e.treePath,t,n,r,i,s)}function hy(e,t,n){return r=e.writeTree,i=e.treePath,e=n,t=pg(i,n=t),null!=(i=Ym(r.visibleWrites,t))?i:e.isCompleteForChild(n)?ey(Xm(r.visibleWrites,t),e.getNode().getImmediateChild(n)):null;var r,i}function dy(e,t){return fy(pg(e.treePath,t),e.writeTree)}function fy(e,t){return{treePath:e,writeTree:t}}class py{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;is("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),is(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,um(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,lm(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,cm(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw ss("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,um(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const gy=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class my{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Dm(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return hy(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Bm(this.viewCache_),e=uy(this.writes_,r,t,1,n,e);return 0===e.length?null:e[0]}}function yy(e,t,n,r,i){const s=new py;let o,a;if(n.type===tp.OVERWRITE){var c=n;o=c.source.fromUser?wy(e,t,c.path,c.snap,r,i,s):(is(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!gg(c.path),_y(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===tp.MERGE){var l=n;o=l.source.fromUser?function(n,r,i,e,s,o,a){let c=r;return e.foreach((e,t)=>{e=pg(i,e);by(r,cg(e))&&(c=wy(n,c,e,t,s,o,a))}),e.foreach((e,t)=>{e=pg(i,e);by(r,cg(e))||(c=wy(n,c,e,t,s,o,a))}),c}(e,t,l.path,l.children,r,i,s):(is(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),Ty(e,t,l.path,l.children,r,i,a,s))}else if(n.type===tp.ACK_USER_WRITE){l=n;o=l.revert?function(n,r,i,s,o,a){let c;{if(null!=ly(s,i))return r;{o=new my(s,r,o);const u=r.eventCache.getNode();let t;if(gg(i)||".priority"===cg(i)){let e;e=r.serverCache.isFullyInitialized()?oy(s,Bm(r)):(l=r.serverCache.getNode(),is(l instanceof Yg,"serverChildren would be complete if leaf node"),ay(s,l)),e,t=n.filter.updateFullNode(u,e,a)}else{var l=cg(i);let e=hy(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,ug(i),o,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,Yg.EMPTY_NODE,ug(i),o,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(c=oy(s,Bm(r)),c.isLeafNode()&&(t=n.filter.updateFullNode(t,c,a)))}return c=r.serverCache.isFullyInitialized()||null!=ly(s,ag()),jm(r,t,c,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,o,a){if(null!=ly(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(gg(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return _y(e,t,i,l.getNode().getChild(i),s,o,c,a);if(gg(i)){let n=new zm(null);return l.getNode().forEachChild(Ng,(e,t)=>{n=n.set(new og(e),t)}),Ty(e,t,i,n,s,o,c,a)}return t}{let r=new zm(null);return n.foreach((e,t)=>{var n=pg(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),Ty(e,t,i,r,s,o,c,a)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==tp.LISTEN_COMPLETE)throw ss("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=qm(t,s.getNode(),s.isFullyInitialized()||gg(n),s.isFiltered());return vy(e,o,n,r,gy,i)}(e,t,n.path,r,s)}r=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=Vm(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(am(Vm(t)))}}(t,o,r),{viewCache:o,changes:r}}function vy(r,i,s,o,a,c){const l=i.eventCache;if(null!=ly(o,s))return i;{let t,n;if(gg(s)){var e;is(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=ay(o,(e=Bm(i))instanceof Yg?e:Yg.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=oy(o,Bm(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=cg(s);if(".priority"===u){is(1===lg(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=cy(o,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=ug(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=cy(o,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):hy(o,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,a,c):l.getNode()}}return jm(i,t,l.isFullyInitialized()||gg(s),r.filter.filtersNodes())}}function _y(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(gg(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{o=cg(n);if(!c.isCompleteForPath(n)&&1<lg(n))return t;h=ug(n);const d=c.getNode().getImmediateChild(o);r=d.updateChild(h,r);l=".priority"===o?u.updatePriority(c.getNode(),r):u.updateChild(c.getNode(),o,r,h,gy,null)}t=qm(t,l,c.isFullyInitialized()||gg(n),u.filtersNodes());return vy(e,t,n,i,new my(i,t,s),a)}function wy(t,n,r,i,e,s,o){const a=n.eventCache;let c,l;const u=new my(e,n,s);if(gg(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,o),c=jm(n,l,!0,t.filter.filtersNodes());else{s=cg(r);if(".priority"===s)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=jm(n,l,a.isFullyInitialized(),a.isFiltered());else{r=ug(r);const h=a.getNode().getImmediateChild(s);let e;if(gg(r))e=i;else{const d=u.getCompleteChild(s);e=null!=d?".priority"===hg(r)&&d.getChild(fg(r)).isEmpty()?d:d.updateChild(r,i):Yg.EMPTY_NODE}c=h.equals(e)?n:jm(n,t.filter.updateChild(a.getNode(),s,e,r,u,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return c}function by(e,t){return e.eventCache.isCompleteForChild(t)}function Iy(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function Ty(r,i,e,t,s,o,a,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=gg(e)?t:new zm(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{u.hasChild(e)&&(t=Iy(0,i.serverCache.getNode().getImmediateChild(e),t),l=_y(r,l,new og(e),t,s,o,a,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&void 0===t.value;u.hasChild(e)||n||(t=Iy(0,i.serverCache.getNode().getImmediateChild(e),t),l=_y(r,l,new og(e),t,s,o,a,c))}),l}class Ey{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new hm(n.getIndex()),i=(e=n).loadsAllData()?new hm(e.getIndex()):new(e.hasLimit()?fm:dm)(e);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache;e=r.updateFullNode(Yg.EMPTY_NODE,s.getNode(),null),t=i.updateFullNode(Yg.EMPTY_NODE,o.getNode(),null),e=new Dm(e,s.isFullyInitialized(),r.filtersNodes()),t=new Dm(t,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=Um(t,e),this.eventGenerator_=new Lm(this.query_)}get query(){return this.query_}}function Sy(e){return 0===e.eventRegistrations_.length}function ky(n,r,t){const i=[];if(t){is(null==r,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(e=>{e=e.createCancelEvent(t,s);e&&i.push(e)})}if(r){let t=[];for(let e=0;e<n.eventRegistrations_.length;++e){const o=n.eventRegistrations_[e];if(o.matches(r)){if(r.hasAnyCallback()){t=t.concat(n.eventRegistrations_.slice(e+1));break}}else t.push(o)}n.eventRegistrations_=t}else n.eventRegistrations_=[];return i}function Cy(e,t,n,r){t.type===tp.MERGE&&null!==t.source.queryId&&(is(Bm(e.viewCache_),"We should always have a full cache before handling merges"),is(Vm(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=yy(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,is(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),is(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),is(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Ay(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Ay(e,t,n,r){r=r?[r]:e.eventRegistrations_;return Mm(e.eventGenerator_,t,n,r)}let Ny;class Ry{constructor(){this.views=new Map}}function Py(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return is(null!=e,"SyncTree gave us an op for an invalid query."),Cy(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(Cy(s,n,r,i));return e}}function xy(e,n,r,i,s){var t=n._queryIdentifier,t=e.views.get(t);if(t)return t;{let e=oy(r,s?i:null),t=!1;t=!!e||(e=i instanceof Yg?ay(r,i):Yg.EMPTY_NODE,!1);s=Um(new Dm(e,t,!1),new Dm(i,s,!1));return new Ey(n,s)}}function Oy(e,t,n,r,i,s){s=xy(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),s.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(Bg,(e,t)=>{r.push(cm(e,t))})}return n.isFullyInitialized()&&r.push(am(n.getNode())),Ay(e,r,n.getNode(),t)}(s,n)}function Dy(e,t,n,r){var i=t._queryIdentifier;const s=[];let o=[];var a=jy(e);if("default"===i)for(var[c,l]of e.views.entries())o=o.concat(ky(l,n,r)),Sy(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(o=o.concat(ky(u,n,r)),Sy(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!jy(e)&&s.push((is(Ny,"Reference.ts has not been loaded"),new Ny(t._repo,t._path))),{removed:s,events:o}}function Ly(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function My(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=Bm(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!gg(t)&&!n.getImmediateChild(cg(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function Fy(e,t){const n=t._queryParams;if(n.loadsAllData())return qy(e);t=t._queryIdentifier;return e.views.get(t)}function Uy(e,t){return null!=Fy(e,t)}function jy(e){return null!=qy(e)}function qy(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Vy;let By=1;class Ky{constructor(e){this.listenProvider_=e,this.syncPointTree_=new zm(null),this.pendingWriteTree_={visibleWrites:Wm.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function zy(e,t,n,r,i){var s,o,a,c;return s=e.pendingWriteTree_,o=t,a=n,c=i,is((r=r)>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:o,snap:a,writeId:r,visible:c=void 0===c?!0:c}),c&&(s.visibleWrites=$m(s.visibleWrites,o,a)),s.lastWriteId=r,i?Xy(e,new xm(Cm(),t,n)):[]}function Wy(e,t,n,r){var i,s,o;i=e.pendingWriteTree_,s=t,o=n,is((r=r)>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:o,writeId:r,visible:!0}),i.visibleWrites=Hm(i.visibleWrites,s,o),i.lastWriteId=r;n=zm.fromObject(n);return Xy(e,new Om(Cm(),t,n))}function $y(e,t,n=!1){var r=function(t,n){for(let e=0;e<t.allWrites.length;e++){var r=t.allWrites[e];if(r.writeId===n)return r}return null}(e.pendingWriteTree_,t);if(ny(e.pendingWriteTree_,t)){let t=new zm(null);return null!=r.snap?t=t.set(ag(),!0):Cp(r.children,e=>{t=t.set(new og(e),!0)}),Xy(e,new Rm(r.path,t,n))}return[]}function Hy(e,t,n){return Xy(e,new xm(Am(),t,n))}function Gy(n,e,t,r){var i=e._path,s=n.syncPointTree_.get(i);let o=[];if(s&&("default"===e._queryIdentifier||Uy(s,e))){t=Dy(s,e,t,r);0===s.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=t.removed;o=t.events;s=-1!==u.findIndex(e=>e._queryParams.loadsAllData()),t=n.syncPointTree_.findOnPath(i,(e,t)=>jy(t));if(s&&!t){const h=n.syncPointTree_.subtree(i);if(!h.isEmpty()){var a=h.fold((e,t,r)=>{if(t&&jy(t))return[qy(t)];{let n=[];return t&&(n=Ly(t)),Cp(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<a.length;++e){var c=a[e],l=c.query,c=ev(n,c);n.listenProvider_.startListening(ov(l),tv(n,l),c.hashFn,c.onComplete)}}}!t&&0<u.length&&!r&&(s?(s=null,n.listenProvider_.stopListening(ov(e),s)):u.forEach(e=>{var t=n.queryToTagMap.get(nv(e));n.listenProvider_.stopListening(ov(e),t)})),function(t,n){for(let e=0;e<n.length;++e){const s=n[e];var r,i;s._queryParams.loadsAllData()||(r=nv(s),i=t.queryToTagMap.get(r),t.queryToTagMap.delete(r),t.tagToQueryMap.delete(i))}}(n,u)}return o}function Qy(e,t,n){const r=t._path;let i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(e,t)=>{e=mg(e,r);i=i||My(t,e),s=s||jy(t)});let o=e.syncPointTree_.get(r);o?(s=s||jy(o),i=i||My(o,ag())):(o=new Ry,e.syncPointTree_=e.syncPointTree_.set(r,o));let a;if(null!=i)a=!0;else{a=!1,i=Yg.EMPTY_NODE;const d=e.syncPointTree_.subtree(r);d.foreachChild((e,t)=>{t=My(t,ag());t&&(i=i.updateImmediateChild(e,t))})}var c,l=Uy(o,t);l||t._queryParams.loadsAllData()||(u=nv(t),is(!e.queryToTagMap.has(u),"View does not exist, but we have a tag"),c=By++,e.queryToTagMap.set(u,c),e.tagToQueryMap.set(c,u));var u=ty(e.pendingWriteTree_,r);let h=Oy(o,t,n,u,i,a);return l||s||(l=Fy(o,t),h=h.concat(function(t,e,n){const r=e._path,i=tv(t,e),s=ev(t,n),o=t.listenProvider_.startListening(ov(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)is(!jy(a.value),"If we're adding a query, it shouldn't be shadowed");else{var c=a.fold((e,t,r)=>{if(!gg(e)&&t&&jy(t))return[qy(t).query];{let n=[];return t&&(n=n.concat(Ly(t).map(e=>e.query))),Cp(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(ov(l),tv(t,l))}}return o}(e,t,l))),h}function Yy(e,n,t){var r=e.pendingWriteTree_,e=e.syncPointTree_.findOnPath(n,(e,t)=>{e=My(t,mg(e,n));if(e)return e});return sy(r,n,e,t,!0)}function Jy(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,(e,t)=>{e=mg(e,n);r=r||My(t,e)});let i=e.syncPointTree_.get(n);i?r=r||My(i,ag()):(i=new Ry,e.syncPointTree_=e.syncPointTree_.set(n,i));var s=null!=r;const o=s?new Dm(r,!0,!1):null;e=ty(e.pendingWriteTree_,t._path);return Vm(xy(i,t,e,s?o.getNode():Yg.EMPTY_NODE,s).viewCache_)}function Xy(e,t){return function t(n,r,i,s){{if(gg(n.path))return Zy(n,r,i,s);{const o=r.get(ag());null==i&&null!=o&&(i=My(o,ag()));let e=[];const a=cg(n.path),c=n.operationForChild(a),l=r.children.get(a);if(l&&c){const u=i?i.getImmediateChild(a):null,h=dy(s,a);e=e.concat(t(c,l,u,h))}return o&&(e=e.concat(Py(o,n,s,i))),e}}}(t,e.syncPointTree_,null,ty(e.pendingWriteTree_,ag()))}function Zy(i,e,s,o){var t=e.get(ag());null==s&&null!=t&&(s=My(t,ag()));let a=[];return e.children.inorderTraversal((e,t)=>{var n=s?s.getImmediateChild(e):null,r=dy(o,e),e=i.operationForChild(e);e&&(a=a.concat(Zy(e,t,n,r)))}),t&&(a=a.concat(Py(t,i,o,s))),a}function ev(r,t){const i=t.query,s=tv(r,i);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||Yg.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return s?function(e,t,n){var r=rv(e,n);if(r){n=iv(r),r=n.path,n=n.queryId,t=mg(r,t);return sv(e,r,new Pm(Nm(n),t))}return[]}(r,i._path,s):(t=r,n=i._path,Xy(t,new Pm(Am(),n)));var t,n,e=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,i);return Gy(r,i,null,e)}}}function tv(e,t){t=nv(t);return e.queryToTagMap.get(t)}function nv(e){return e._path.toString()+"$"+e._queryIdentifier}function rv(e,t){return e.tagToQueryMap.get(t)}function iv(e){var t=e.indexOf("$");return is(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new og(e.substr(0,t))}}function sv(e,t,n){var r=e.syncPointTree_.get(t);return is(r,"Missing sync point for query tag that we're tracking"),Py(r,n,ty(e.pendingWriteTree_,t),null)}function ov(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(is(Vy,"Reference.ts has not been loaded"),new Vy(e._repo,e._path)):e}class av{constructor(e){this.node_=e}getImmediateChild(e){e=this.node_.getImmediateChild(e);return new av(e)}node(){return this.node_}}class cv{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){e=pg(this.path_,e);return new cv(this.syncTree_,e)}node(){return Yy(this.syncTree_,this.path_)}}const lv=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},uv=function(e,t,n){return e&&"object"==typeof e?(is(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?hv(e[".sv"],t,n):"object"==typeof e[".sv"]?dv(e[".sv"],t):void is(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},hv=function(e,t,n){if("timestamp"===e)return n.timestamp;is(!1,"Unexpected server value: "+e)},dv=function(e,t,n){e.hasOwnProperty("increment")||is(!1,"Unexpected server value: "+JSON.stringify(e,null,2));e=e.increment;"number"!=typeof e&&is(!1,"Unexpected increment value: "+e);const r=t.node();if(is(null!==r&&void 0!==r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return e;const i=r;t=i.getValue();return"number"!=typeof t?e:t+e},fv=function(e,t,n,r){return gv(t,new cv(n,e),r)},pv=function(e,t,n){return gv(e,new av(t),n)};function gv(e,r,i){var t=e.getPriority().val(),n=uv(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const o=e;t=uv(o.getValue(),r,i);return t!==o.getValue()||n!==o.getPriority().val()?new jg(t,em(n)):e}{const a=e;return s=a,n!==a.getPriority().val()&&(s=s.updatePriority(new jg(n))),a.forEachChild(Bg,(e,t)=>{var n=gv(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class mv{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function yv(e,t){let n=t instanceof og?t:new og(t),r=e,i=cg(n);for(;null!==i;){var s=Ds(r.node.children,i)||{children:{},childCount:0};r=new mv(i,r,s),n=ug(n),i=cg(n)}return r}function vv(e){return e.node.value}function _v(e,t){e.node.value=t,Tv(e)}function wv(e){return 0<e.node.childCount}function bv(n,r){Cp(n.node.children,(e,t)=>{r(new mv(e,n,t))})}function Iv(e){return new og(null===e.parent?e.name:Iv(e.parent)+"/"+e.name)}function Tv(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,i=function(e){return void 0===vv(e)&&!wv(e)}(r=e),e=Os(t.node.children,n),i&&e?(delete t.node.children[n],t.node.childCount--,Tv(t)):i||e||(t.node.children[n]=r.node,t.node.childCount++,Tv(t)))}const Ev=/[\[\].#$\/\u0000-\u001F\u007F]/,Sv=/[\[\].#$\u0000-\u001F\u007F]/,kv=10485760,Cv=function(e){return"string"==typeof e&&0!==e.length&&!Ev.test(e)},Av=function(e){return"string"==typeof e&&0!==e.length&&!Sv.test(e)},Nv=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!_p(e)||e&&"object"==typeof e&&Os(e,".sv")},Rv=function(e,t,n,r){r&&void 0===t||Pv(Qs(e,"value"),t,n)},Pv=function(s,e,t){const o=t instanceof og?new wg(t,s):t;if(void 0===e)throw new Error(s+"contains undefined "+Ig(o));if("function"==typeof e)throw new Error(s+"contains a function "+Ig(o)+" with contents = "+e.toString());if(_p(e))throw new Error(s+"contains "+e.toString()+" "+Ig(o));if("string"==typeof e&&e.length>kv/3&&Xs(e)>kv)throw new Error(s+"contains a string greater than "+kv+" utf8 bytes "+Ig(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let r=!1,i=!1;if(Cp(e,(e,t)=>{if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!Cv(e)))throw new Error(s+" contains an invalid key ("+e+") "+Ig(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n;n=o,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Xs(e),bg(n),Pv(s,t,o),n=o,t=n.parts_.pop(),n.byteLength_-=Xs(t),0<n.parts_.length&&--n.byteLength_}),r&&i)throw new Error(s+' contains ".value" child '+Ig(o)+" in addition to actual children.")}},xv=function(e,t,r,n){if(!n||void 0!==t){const i=Qs(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Cp(t,(e,t)=>{const n=new og(e);if(Pv(i,t,pg(r,n)),".priority"===hg(n)&&!Nv(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];var i=dg(r);for(let e=0;e<i.length;e++)if((".priority"!==i[e]||e!==i.length-1)&&!Cv(i[e]))throw new Error(t+"contains an invalid key ("+i[e]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(yg);let s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&_g(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,s)}},Ov=function(e,t,n){if(!n||void 0!==t){if(_p(t))throw new Error(Qs(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Nv(t))throw new Error(Qs(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Dv=function(e,t,n,r){if(!(r&&void 0===n||Cv(n)))throw new Error(Qs(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Lv=function(e,t,n,r){if(!(r&&void 0===n||Av(n)))throw new Error(Qs(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Mv=function(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Lv(e,t,n,r)},Fv=function(e,t){if(".info"===cg(t))throw new Error(e+" failed = Can't modify data under /.info/")},Uv=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Cv(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&(n=(n=n)&&n.replace(/^\/*\.info(\/|$)/,"/"),!Av(n)))throw new Error(Qs(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class jv{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function qv(t,n){let r=null;for(let e=0;e<n.length;e++){const s=n[e];var i=s.getPath();null===r||vg(i,r.path)||(t.eventLists_.push(r),r=null),null===r&&(r={events:[],path:i}),r.events.push(s)}r&&t.eventLists_.push(r)}function Vv(e,t,n){qv(e,n),Kv(e,e=>vg(e,t))}function Bv(e,t,n){qv(e,n),Kv(e,e=>_g(e,t)||_g(t,e))}function Kv(t,n){t.recursionDepth_++;let r=!0;for(let e=0;e<t.eventLists_.length;e++){var i=t.eventLists_[e];i&&(n(i.path)?(function(t){for(let e=0;e<t.events.length;e++){const r=t.events[e];var n;null!==r&&(t.events[e]=null,n=r.getEventRunner(),hp&&pp("event: "+r.toString()),Op(n))}}(t.eventLists_[e]),t.eventLists_[e]=null):r=!1)}r&&(t.eventLists_=[]),t.recursionDepth_--}const zv="repo_interrupt",Wv=25;class $v{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new jv,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Im(),this.transactionQueueTree_=new mv,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Hv(o,e,t){if(o.stats_=Hp(o.repoInfo_),o.forceRestClient_||Dp())o.server_=new wm(o.repoInfo_,(e,t,n,r)=>{Yv(o,e,t,n,r)},o.authTokenProvider_,o.appCheckProvider_),setTimeout(()=>Jv(o,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ps(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}o.persistentConnection_=new Eg(o.repoInfo_,e,(e,t,n,r)=>{Yv(o,e,t,n,r)},e=>{Jv(o,e)},e=>{var n;n=o,Cp(e,(e,t)=>{Xv(n,e,t)})},o.authTokenProvider_,o.appCheckProvider_,t),o.server_=o.persistentConnection_}o.authTokenProvider_.addTokenChangeListener(e=>{o.server_.refreshAuthToken(e)}),o.appCheckProvider_.addTokenChangeListener(e=>{o.server_.refreshAppCheckToken(e.token)}),o.statsReporter_=(e=o.repoInfo_,t=()=>new km(o.stats_,o.server_),e=e.toString(),$p[e]||($p[e]=t()),$p[e]),o.infoData_=new bm,o.infoSyncTree_=new Ky({startListening:(e,t,n,r)=>{let i=[];const s=o.infoData_.getNode(e._path);return s.isEmpty()||(i=Hy(o.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Xv(o,"connected",!1),o.serverSyncTree_=new Ky({startListening:(n,e,t,r)=>(o.server_.listen(n,t,e,(e,t)=>{t=r(e,t);Bv(o.eventQueue_,n._path,t)}),[]),stopListening:(e,t)=>{o.server_.unlisten(e,t)}})}function Gv(e){const t=e.infoData_.getNode(new og(".info/serverTimeOffset"));e=t.val()||0;return(new Date).getTime()+e}function Qv(e){return lv({timestamp:Gv(e)})}function Yv(e,t,n,r,i){e.dataUpdateCount++;var s,o,a,c=new og(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let l=[];l=i?r?(s=Ms(n,e=>em(e)),function(e,t,n,r){var i=rv(e,r);if(i){r=iv(i),i=r.path,r=r.queryId,t=mg(i,t),n=zm.fromObject(n);return sv(e,i,new Om(Nm(r),t,n))}return[]}(e.serverSyncTree_,c,s,i)):(t=em(n),s=e.serverSyncTree_,o=c,a=t,null==(i=rv(s,t=i))?[]:(t=iv(i),i=t.path,t=t.queryId,o=mg(i,o),sv(s,i,new xm(Nm(t),o,a)))):r?(o=Ms(n,e=>em(e)),a=e.serverSyncTree_,r=c,o=o,o=zm.fromObject(o),Xy(a,new Om(Am(),r,o))):(n=em(n),Hy(e.serverSyncTree_,c,n));let u=c;0<l.length&&(u=l_(e,c)),Bv(e.eventQueue_,u,l)}function Jv(e,t){Xv(e,"connected",t),!1===t&&function(n){s_(n,"onDisconnectEvents");const r=Qv(n),i=Im();Em(n.onDisconnect_,ag(),(e,t)=>{t=fv(e,t,n.serverSyncTree_,r);Tm(i,e,t)});let s=[];Em(i,ag(),(e,t)=>{s=s.concat(Hy(n.serverSyncTree_,e,t));e=f_(n,e);l_(n,e)}),n.onDisconnect_=Im(),Bv(n.eventQueue_,ag(),s)}(e)}function Xv(e,t,n){t=new og("/.info/"+t),n=em(n);e.infoData_.updateSnapshot(t,n);n=Hy(e.infoSyncTree_,t,n);Bv(e.eventQueue_,t,n)}function Zv(e){return e.nextWriteId_++}function e_(r,i,e,t,s){s_(r,"set",{path:i.toString(),value:e,priority:t});var n=Qv(r);const o=em(e,t);t=Yy(r.serverSyncTree_,i),n=pv(o,t,n);const a=Zv(r);n=zy(r.serverSyncTree_,i,n,a,!0);qv(r.eventQueue_,n),r.server_.put(i.toString(),o.val(!0),(e,t)=>{var n="ok"===e;n||vp("set at "+i+" failed: "+e);n=$y(r.serverSyncTree_,a,!n);Bv(r.eventQueue_,i,n),o_(0,s,e,t)});n=f_(r,i);l_(r,n),Bv(r.eventQueue_,n,[])}function t_(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(gg(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(Bg,(e,t)=>{Tm(n,new og(e),t)}),e(n,t)}}if(0<n.children.size){var r=cg(t);return t=ug(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),o_(0,i,e,t)})}function n_(n,r,e,i){const s=em(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&Tm(n.onDisconnect_,r,s),o_(0,i,e,t)})}function r_(e,t,n){let r;r=".info"===cg(t._path)?Gy(e.infoSyncTree_,t,n):Gy(e.serverSyncTree_,t,n),Vv(e.eventQueue_,t._path,r)}function i_(e){e.persistentConnection_&&e.persistentConnection_.interrupt(zv)}function s_(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),pp(n,...t)}function o_(e,r,i,s){r&&Op(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function a_(e,t,n){return Yy(e.serverSyncTree_,t,n)||Yg.EMPTY_NODE}function c_(t,e=t.transactionQueueTree_){if(e||d_(t,e),vv(e)){const n=h_(t,e);is(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,o){const e=o.map(e=>e.currentWriteId),t=a_(i,s,e);let n=t;var r=t.hash();for(let e=0;e<o.length;e++){const u=o[e];is(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var a=mg(s,u.path);n=n.updateChild(a,u.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{s_(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<o.length;e++)o[e].status=2,n=n.concat($y(i.serverSyncTree_,o[e].currentWriteId)),o[e].onComplete&&r.push(()=>o[e].onComplete(null,!0,o[e].currentOutputSnapshotResolved)),o[e].unwatcher();d_(i,yv(i.transactionQueueTree_,s)),c_(i,i.transactionQueueTree_),Bv(i.eventQueue_,s,n);for(let e=0;e<r.length;e++)Op(r[e])}else{if("datastale"===t)for(let e=0;e<o.length;e++)3===o[e].status?o[e].status=4:o[e].status=0;else{vp("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<o.length;e++)o[e].status=4,o[e].abortReason=t}l_(i,s)}},r)}(t,Iv(e),n)}else wv(e)&&bv(e,e=>{c_(t,e)})}function l_(e,t){var n=u_(e,t),t=Iv(n);return function(i,s,o){if(0!==s.length){const l=[];let r=[];const e=s.filter(e=>0===e.status),u=e.map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){const h=s[n];var a=mg(o,h.path);let e=!1,t;if(is(null!==a,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,r=r.concat($y(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=Wv)e=!0,t="maxretry",r=r.concat($y(i.serverSyncTree_,h.currentWriteId,!0));else{const d=a_(i,h.path,u);h.currentInputSnapshot=d;var c=s[n].update(d.val());if(void 0!==c){Pv("transaction failed: Data returned ",c,h.path);let e=em(c);"object"==typeof c&&null!=c&&Os(c,".priority")||(e=e.updatePriority(d.getPriority()));a=h.currentWriteId,c=Qv(i),c=pv(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=Zv(i),u.splice(u.indexOf(a),1),r=r.concat(zy(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),r=r.concat($y(i.serverSyncTree_,a,!0))}else e=!0,t="nodata",r=r.concat($y(i.serverSyncTree_,h.currentWriteId,!0))}Bv(i.eventQueue_,o,r),r=[],e&&(s[n].status=2,function(e){setTimeout(e,Math.floor(0))}(s[n].unwatcher),s[n].onComplete&&("nodata"===t?l.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):l.push(()=>s[n].onComplete(new Error(t),!1,null))))}d_(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Op(l[e]);c_(i,i.transactionQueueTree_)}}(e,h_(e,n),t),t}function u_(e,t){let n,r=e.transactionQueueTree_;for(n=cg(t);null!==n&&void 0===vv(r);)r=yv(r,n),t=ug(t),n=cg(t);return r}function h_(e,t){const n=[];return function t(n,e,r){const i=vv(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);bv(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function d_(t,e){const n=vv(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,_v(e,0<n.length?n:void 0)}bv(e,e=>{d_(t,e)})}function f_(t,e){var n=Iv(u_(t,e)),e=yv(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(e,e=>{p_(t,e)}),p_(t,e),function t(e,n,r,i){r&&!i&&n(e),bv(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(e,e=>{p_(t,e)}),n}function p_(r,e){const i=vv(e);if(i){const s=[];let t=[],n=-1;for(let e=0;e<i.length;e++)3===i[e].status||(1===i[e].status?(is(n===e-1,"All SENT items should be at beginning of queue."),n=e,i[e].status=3,i[e].abortReason="set"):(is(0===i[e].status,"Unexpected transaction status in abort"),i[e].unwatcher(),t=t.concat($y(r.serverSyncTree_,i[e].currentWriteId,!0)),i[e].onComplete&&s.push(i[e].onComplete.bind(null,new Error("set"),!1,null))));-1===n?_v(e,void 0):i.length=n+1,Bv(r.eventQueue_,Iv(e),t);for(let e=0;e<s.length;e++)Op(s[e])}}const g_=function(e,t){var n=m_(e),r=n.namespace;"firebase.com"===n.domain&&yp(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||yp("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&vp("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");e="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Bp(n.host,n.secure,r,t,e,"",r!==n.subdomain),path:new og(n.pathString)}},m_=function(r){let i="",s="",o="",a="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(a=function(e){let n="";var r=e.split("/");for(let t=0;t<r.length;t++)if(0<r[t].length){let e=r[t];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}n+="/"+e}return n}(r.substring(t,n)));var d=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):vp(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(r=i.indexOf("."),o=i.substring(0,r).toLowerCase(),s=i.substring(r+1),c=o),"ns"in d&&(c=d.ns)}return{host:i,port:h,domain:s,subdomain:o,secure:l,scheme:u,pathString:a,namespace:c}};class y_{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ps(this.snapshot.exportVal())}}class v_{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class __{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return is(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class w_{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new us;return t_(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Fv("OnDisconnect.remove",this._path);const e=new us;return n_(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Fv("OnDisconnect.set",this._path),Rv("OnDisconnect.set",e,this._path,!1);const t=new us;return n_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Fv("OnDisconnect.setWithPriority",this._path),Rv("OnDisconnect.setWithPriority",e,this._path,!1),Ov("OnDisconnect.setWithPriority",t,!1);const n=new us;return function(n,r,e,t,i){const s=em(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&Tm(n.onDisconnect_,r,s),o_(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){Fv("OnDisconnect.update",this._path),xv("OnDisconnect.update",e,this._path,!1);const t=new us;return function(n,r,i,s){if(Ls(i))return pp("onDisconnect().update() called with empty data.  Don't do anything."),o_(0,s,"ok",void 0);n.server_.onDisconnectMerge(r.toString(),i,(e,t)=>{"ok"===e&&Cp(i,(e,t)=>{t=em(t);Tm(n.onDisconnect_,pg(r,e),t)}),o_(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class b_{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return gg(this._path)?null:hg(this._path)}get ref(){return new S_(this._repo,this._path)}get _queryIdentifier(){var e=_m(this._queryParams),e=Sp(e);return"{}"===e?"default":e}get _queryObject(){return _m(this._queryParams)}isEqual(e){if(!((e=io(e))instanceof b_))return!1;var t=this._repo===e._repo,n=vg(this._path,e._path),e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let n="";for(let e=t.pieceNum_;e<t.pieces_.length;e++)""!==t.pieces_[e]&&(n+="/"+encodeURIComponent(String(t.pieces_[e])));return n||"/"}(this._path)}}function I_(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function T_(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Ng){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==wp)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==bp)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Bg){if(null!=t&&!Nv(t)||null!=n&&!Nv(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(is(e.getIndex()instanceof tm||e.getIndex()===nm,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function E_(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class S_ extends b_{constructor(e,t){super(e,t,new pm,!1)}get parent(){var e=fg(this._path);return null===e?null:new S_(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class k_{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new og(e),e=N_(this.ref,e);return new k_(this._node.getChild(t),e,Bg)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new k_(t,N_(this.ref,e),Bg)))}hasChild(e){e=new og(e);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function C_(e,t){return(e=io(e))._checkNotDeleted("ref"),void 0!==t?N_(e._root,t):e._root}function A_(e,t){(e=io(e))._checkNotDeleted("refFromURL");const n=g_(t,e._repo.repoInfo_.nodeAdmin);Uv("refFromURL",n);t=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||yp("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),C_(e,n.path.toString())}function N_(e,t){return(null===cg((e=io(e))._path)?Mv:Lv)("child","path",t,!1),new S_(e._repo,pg(e._path,t))}function R_(e,t){e=io(e),Fv("set",e._path),Rv("set",t,e._path,!1);const n=new us;return e_(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function P_(e,t){xv("update",t,e._path,!1);const n=new us;return function(i,s,e,o){s_(i,"update",{path:s.toString(),value:e});let n=!0;const r=Qv(i),a={};if(Cp(e,(e,t)=>{n=!1,a[e]=fv(pg(s,e),em(t),i.serverSyncTree_,r)}),n)pp("update() called with empty data.  Don't do anything."),o_(0,o,"ok",void 0);else{const c=Zv(i);var t=Wy(i.serverSyncTree_,s,a,c);qv(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||vp("update at "+s+" failed: "+e);var r=$y(i.serverSyncTree_,c,!n),n=0<r.length?l_(i,s):s;Bv(i.eventQueue_,n,r),o_(0,o,e,t)}),Cp(e,e=>{e=f_(i,pg(s,e));l_(i,e)}),Bv(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function x_(t){return t=io(t),n=t._repo,r=t,(null!=(e=Jy(n.serverSyncTree_,r))?Promise.resolve(e):n.server_.get(r).then(e=>{var t=em(e).withIndex(r._queryParams.getIndex()),e=Hy(n.serverSyncTree_,r._path,t);return Vv(n.eventQueue_,r._path,e),Promise.resolve(t)},e=>(s_(n,"get for query "+Ps(r)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new k_(e,new S_(t._repo,t._path),t._queryParams.getIndex()));var n,r,e}class O_{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new y_("value",this,new k_(e.snapshotNode,new S_(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new v_(this,e,t):null}matches(e){return e instanceof O_&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class D_{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new v_(this,e,t):null}createEvent(e,t){is(null!=e.childName,"Child events should have a childName.");var n=N_(new S_(t._repo,t._path),e.childName),t=t._queryParams.getIndex();return new y_(e.type,this,new k_(e.snapshotNode,n,t),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof D_&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function L_(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const a=t;i=(e,t)=>{r_(n._repo,n,o),a(e,t)};i.userCallback=t.userCallback,i.context=t.context,t=i}t=new __(t,s||void 0);const o="value"===e?new O_(t):new D_(e,t);return function(e,t,n){let r;r=".info"===cg(t._path)?Qy(e.infoSyncTree_,t,n):Qy(e.serverSyncTree_,t,n),Vv(e.eventQueue_,t._path,r)}(n._repo,n,o),()=>r_(n._repo,n,o)}function M_(e,t,n,r){return L_(e,"value",t,n,r)}function F_(e,t,n,r){return L_(e,"child_added",t,n,r)}function U_(e,t,n,r){return L_(e,"child_changed",t,n,r)}function j_(e,t,n,r){return L_(e,"child_moved",t,n,r)}function q_(e,t,n,r){return L_(e,"child_removed",t,n,r)}function V_(e,t,n){let r=null;n=n?new __(n):null;"value"===t?r=new O_(n):t&&(r=new D_(t,n)),r_(e._repo,e,r)}class B_{}class K_ extends B_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Rv("endAt",this._value,e._path,!0);var t=mm(e._queryParams,this._value,this._key);if(E_(t),T_(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new b_(e._repo,e._path,t,e._orderByCalled)}}class z_ extends B_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Rv("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r,i;return i=e.index_===Ng?mm(e,t="string"==typeof t?om(t):t,n):(r=null==n?wp:om(n),mm(e,t,r)),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(E_(t),T_(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new b_(e._repo,e._path,t,e._orderByCalled)}}class W_ extends B_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Rv("startAt",this._value,e._path,!0);var t=gm(e._queryParams,this._value,this._key);if(E_(t),T_(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new b_(e._repo,e._path,t,e._orderByCalled)}}class $_ extends B_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Rv("startAfter",this._value,e._path,!1);var t=function(t,n,r){let i;if(t.index_===Ng)"string"==typeof n&&(n=sm(n)),i=gm(t,n,r);else{let e;e=null==r?bp:sm(r),i=gm(t,n,e)}return i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(E_(t),T_(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new b_(e._repo,e._path,t,e._orderByCalled)}}class H_ extends B_{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new b_(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class G_ extends B_{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new b_(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Q_ extends B_{constructor(e){super(),this._path=e}_apply(e){I_(e,"orderByChild");var t=new og(this._path);if(gg(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new tm(t),t=ym(e._queryParams,t);return T_(t),new b_(e._repo,e._path,t,!0)}}class Y_ extends B_{_apply(e){I_(e,"orderByKey");var t=ym(e._queryParams,Ng);return T_(t),new b_(e._repo,e._path,t,!0)}}class J_ extends B_{_apply(e){I_(e,"orderByPriority");var t=ym(e._queryParams,Bg);return T_(t),new b_(e._repo,e._path,t,!0)}}class X_ extends B_{_apply(e){I_(e,"orderByValue");var t=ym(e._queryParams,nm);return T_(t),new b_(e._repo,e._path,t,!0)}}class Z_ extends B_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Rv("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new K_(this._value,this._key)._apply(new W_(this._value,this._key)._apply(e))}}function ew(e,...t){let n=io(e);for(const r of t)n=r._apply(n);return n}np=S_,is(!Ny,"__referenceConstructor has already been defined"),Ny=np,rp=S_,is(!Vy,"__referenceConstructor has already been defined"),Vy=rp;const tw="FIREBASE_DATABASE_EMULATOR_HOST",nw={};let rw=!1;function iw(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||yp("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pp("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=g_(s,i),a=o.repoInfo,c,l=void 0;"undefined"!=typeof process&&(l=process.env[tw]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=g_(s,i),a=o.repoInfo):c=!o.repoInfo.secure;t=i&&c?new Up(Up.OWNER):new Fp(e.name,e.options,t);Uv("Invalid Firebase Database URL",o),gg(o.path)||yp("Database URL must point to the root of a Firebase Database (not including a child path).");n=function(e,t,n,r){let i=nw[t.name];i||(i={},nw[t.name]=i);t=i[e.toURLString()];t&&yp("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return t=new $v(e,rw,n,r),i[e.toURLString()]=t}(a,e,t,new Mp(e.name,n));return new sw(n,e)}class sw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Hv(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new S_(this._repo,ag())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=nw[t];n&&n[e.key]===e||yp(`Database ${t}(${e.repoInfo_}) has already been deleted.`),i_(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&yp("Cannot call "+e+" on a deleted database.")}}function ow(e,t,n,r={}){(e=io(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&yp("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let o=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&yp('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Up(Up.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:ds(r.mockUserToken,e.app.options.projectId),o=new Up(i)),i=s,s=t,t=n,n=o,i.repoInfo_=new Bp(`${s}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams),n&&(i.authTokenProvider_=n)}function aw(e){(e=io(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(zv)}function cw(e,t){fp(e,t)}const lw={".sv":"timestamp"};class uw{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function hw(i,e,t){if(i=io(i),Fv("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";t=null===(n=null==t?void 0:t.applyLocally)||void 0===n||n;const s=new us;var n=M_(i,()=>{});return function(t,n,e,r,i,s){s_(t,"transaction on "+n);const o={path:n,update:e,onComplete:r,status:null,order:cp(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=a_(t,n,void 0);if(o.currentInputSnapshot=a,void 0===(s=o.update(a.val())))o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Pv("transaction failed: Data returned ",s,o.path),o.status=0;i=yv(t.transactionQueueTree_,n);const c=vv(i)||[];c.push(o),_v(i,c);let e;if("object"==typeof s&&null!==s&&Os(s,".priority"))e=Ds(s,".priority"),is(Nv(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const l=Yy(t.serverSyncTree_,n)||Yg.EMPTY_NODE;e=l.getPriority().val()}i=Qv(t),s=em(s,e),i=pv(s,a,i);o.currentOutputSnapshotRaw=s,o.currentOutputSnapshotResolved=i,o.currentWriteId=Zv(t);i=zy(t.serverSyncTree_,n,i,o.currentWriteId,o.applyLocally);Bv(t.eventQueue_,n,i),c_(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new k_(n,new S_(i._repo,i._path),Bg),s.resolve(new uw(t,r)))},n,t),s.promise}Eg.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Eg.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Yf(Mo),xo(new so("database",(e,{instanceIdentifier:t})=>{return iw(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),qo("@firebase/database","0.12.0",ip);const dw=new _o("@firebase/database-compat"),fw=function(e){e="FIREBASE WARNING: "+e;dw.warn(e)};class pw{constructor(e){this._delegate=e}cancel(t){Gs("OnDisconnect.cancel",0,1,arguments.length),Ys("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Gs("OnDisconnect.remove",0,1,arguments.length),Ys("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Gs("OnDisconnect.set",1,2,arguments.length),Ys("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Gs("OnDisconnect.setWithPriority",2,3,arguments.length),Ys("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Gs("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,fw("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ys("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class gw{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Gs("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class mw{constructor(e,t){this._database=e,this._delegate=t}val(){return Gs("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Gs("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Gs("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Gs("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Gs("DataSnapshot.child",0,1,arguments.length),e=String(e),Lv("DataSnapshot.child","path",e,!1),new mw(this._database,this._delegate.child(e))}hasChild(e){return Gs("DataSnapshot.hasChild",1,1,arguments.length),Lv("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Gs("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Gs("DataSnapshot.forEach",1,1,arguments.length),Ys("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new mw(this._database,e)))}hasChildren(){return Gs("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Gs("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Gs("DataSnapshot.ref",0,0,arguments.length),new vw(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class yw{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){Gs("Query.on",2,4,arguments.length),Ys("Query.on","callback",n,!1);const i=yw.getCancelAndContextArgs_("Query.on",t,r);var s=(e,t)=>{n.call(i.context,new mw(this.database,e),t)};s.userCallback=n,s.context=i.context;var o=null===(r=i.cancel)||void 0===r?void 0:r.bind(i.context);switch(e){case"value":return M_(this._delegate,s,o),n;case"child_added":return F_(this._delegate,s,o),n;case"child_removed":return q_(this._delegate,s,o),n;case"child_changed":return U_(this._delegate,s,o),n;case"child_moved":return j_(this._delegate,s,o),n;default:throw new Error(Qs("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Gs("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Qs(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Ys("Query.off","callback",t,!0),Js("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,V_(this._delegate,e,r)):V_(this._delegate,e)}get(){return x_(this._delegate).then(e=>new mw(this.database,e))}once(e,n,t,r){Gs("Query.once",1,4,arguments.length),Ys("Query.once","callback",n,!0);const i=yw.getCancelAndContextArgs_("Query.once",t,r),s=new us;var o=(e,t)=>{e=new mw(this.database,e);n&&n.call(i.context,e,t),s.resolve(e)};o.userCallback=n,o.context=i.context;var a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":M_(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":F_(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":q_(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":U_(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":j_(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(Qs("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Gs("Query.limitToFirst",1,1,arguments.length),new yw(this.database,ew(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new H_(e)}(e)))}limitToLast(e){return Gs("Query.limitToLast",1,1,arguments.length),new yw(this.database,ew(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new G_(e)}(e)))}orderByChild(e){return Gs("Query.orderByChild",1,1,arguments.length),new yw(this.database,ew(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Lv("orderByChild","path",e,!1),new Q_(e)}(e)))}orderByKey(){return Gs("Query.orderByKey",0,0,arguments.length),new yw(this.database,ew(this._delegate,new Y_))}orderByPriority(){return Gs("Query.orderByPriority",0,0,arguments.length),new yw(this.database,ew(this._delegate,new J_))}orderByValue(){return Gs("Query.orderByValue",0,0,arguments.length),new yw(this.database,ew(this._delegate,new X_))}startAt(e=null,t){return Gs("Query.startAt",0,2,arguments.length),new yw(this.database,ew(this._delegate,([e=null,t]=[e,t],Dv("startAt","key",t,!0),new W_(e,t))))}startAfter(e=null,t){return Gs("Query.startAfter",0,2,arguments.length),new yw(this.database,ew(this._delegate,(e=e,t=t,Dv("startAfter","key",t,!0),new $_(e,t))))}endAt(e=null,t){return Gs("Query.endAt",0,2,arguments.length),new yw(this.database,ew(this._delegate,(e=e,t=t,Dv("endAt","key",t,!0),new K_(e,t))))}endBefore(e=null,t){return Gs("Query.endBefore",0,2,arguments.length),new yw(this.database,ew(this._delegate,(e=e,t=t,Dv("endBefore","key",t,!0),new z_(e,t))))}equalTo(e,t){return Gs("Query.equalTo",1,2,arguments.length),new yw(this.database,ew(this._delegate,(e=e,t=t,Dv("equalTo","key",t,!0),new Z_(e,t))))}toString(){return Gs("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Gs("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Gs("Query.isEqual",1,1,arguments.length),e instanceof yw)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Ys(e,"cancel",r.cancel,!0),r.context=n,Js(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Qs(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new vw(this.database,new S_(this._delegate._repo,this._delegate._path))}}class vw extends yw{constructor(e,t){super(e,new b_(t._repo,t._path,new pm,!1)),this.database=e,this._delegate=t}getKey(){return Gs("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Gs("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new vw(this.database,N_(this._delegate,e))}getParent(){Gs("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new vw(this.database,e):null}getRoot(){return Gs("Reference.root",0,0,arguments.length),new vw(this.database,this._delegate.root)}set(e,t){Gs("Reference.set",1,2,arguments.length),Ys("Reference.set","onComplete",t,!0);const n=R_(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Gs("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,fw("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Fv("Reference.update",this._delegate._path),Ys("Reference.update","onComplete",n,!0);const e=P_(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Gs("Reference.setWithPriority",2,3,arguments.length),Ys("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(Fv("setWithPriority",e._path),Rv("setWithPriority",t,e._path,!1),Ov("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new us;return e_(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Gs("Reference.remove",0,1,arguments.length),Ys("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,Fv("remove",n._path),R_(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Gs("Reference.transaction",1,3,arguments.length),Ys("Reference.transaction","transactionUpdate",e,!1),Ys("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Qs(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=hw(this._delegate,e,{applyLocally:n}).then(e=>new gw(e.committed,new mw(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Gs("Reference.setPriority",1,2,arguments.length),Ys("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=io(e),Fv("setPriority",e._path),Ov("setPriority",t,!1);const n=new us;return e_(e._repo,pg(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Gs("Reference.push",0,2,arguments.length),Ys("Reference.push","onComplete",t,!0);const n=function(e,t){e=io(e),Fv("push",e._path),Rv("push",t,e._path,!0);var n=Gv(e._repo),n=im(n);const r=N_(e,n),i=N_(e,n);let s;return s=null!=t?R_(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new vw(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new vw(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return Fv("Reference.onDisconnect",this._delegate._path),new pw(new w_(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class _w{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete()}}useEmulator(e,t,n={}){ow(this._delegate,e,t,n)}ref(e){if(Gs("database.ref",0,1,arguments.length),e instanceof vw){var t=A_(this._delegate,e.toString());return new vw(this,t)}e=C_(this._delegate,e);return new vw(this,e)}refFromURL(e){Gs("database.refFromURL",1,1,arguments.length);e=A_(this._delegate,e);return new vw(this,e)}goOffline(){var e;Gs("database.goOffline",0,0,arguments.length),(e=io(e=this._delegate))._checkNotDeleted("goOffline"),i_(e._repo)}goOnline(){return Gs("database.goOnline",0,0,arguments.length),aw(this._delegate)}}_w.ServerValue={TIMESTAMP:lw,increment:e=>({".sv":{increment:e}})};var ww,bw=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Yf(n);const o=new co("auth-internal",new uo("database-standalone"));return o.setComponent(new so("auth-internal",()=>r,"PRIVATE")),{instance:new _w(iw(e,o,void 0,t,s),e),namespace:i}}});const Iw=_w.ServerValue;(ww=Go).INTERNAL.registerComponent(new so("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("database").getImmediate({identifier:t});return new _w(t,n)},"PUBLIC").setServiceProps({Reference:vw,Query:yw,Database:_w,DataSnapshot:mw,enableLogging:cw,INTERNAL:bw,ServerValue:Iw}).setMultipleInstances(!0)),ww.registerVersion("@firebase/database-compat","0.1.0");var Tw=function(e,t){return(Tw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Ew(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Sw={},kw=E||self;function Cw(){}function Aw(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Nw(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Rw="closure_uid_"+(1e9*Math.random()>>>0),Pw=0;function xw(e,t,n){return e.call.apply(e.bind,arguments)}function Ow(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function Dw(e,t,n){return(Dw=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?xw:Ow).apply(null,arguments)}function Lw(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Mw(e,s){function t(){}t.prototype=s.prototype,e.Z=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function Fw(){this.s=this.s,this.o=this.o}var Uw={};Fw.prototype.s=!1,Fw.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,e=Object.prototype.hasOwnProperty.call(e,Rw)&&e[Rw]||(e[Rw]=++Pw),delete Uw[e])},Fw.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var jw=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},qw=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function Vw(){return Array.prototype.concat.apply([],arguments)}function Bw(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function Kw(e){return/^[\s\xa0]*$/.test(e)}var zw,Ww=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function $w(e,t){return-1!=e.indexOf(t)}function Hw(e,t){return e<t?-1:t<e?1:0}e:{var Gw=kw.navigator;if(Gw){Gw=Gw.userAgent;if(Gw){zw=Gw;break e}}zw=""}function Qw(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Yw(e){var t,n={};for(t in e)n[t]=e[t];return n}var Jw="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Xw(e){for(var t,n,r=1;r<arguments.length;r++){for(t in n=arguments[r])e[t]=n[t];for(var i=0;i<Jw.length;i++)t=Jw[i],Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}}function Zw(e){return Zw[" "](e),e}Zw[" "]=Cw;var eb,tb=$w(zw,"Opera"),nb=$w(zw,"Trident")||$w(zw,"MSIE"),rb=$w(zw,"Edge"),ib=rb||nb,sb=$w(zw,"Gecko")&&!($w(zw.toLowerCase(),"webkit")&&!$w(zw,"Edge"))&&!($w(zw,"Trident")||$w(zw,"MSIE"))&&!$w(zw,"Edge"),ob=$w(zw.toLowerCase(),"webkit")&&!$w(zw,"Edge");function ab(){var e=kw.document;return e?e.documentMode:void 0}e:{var cb="",lb=(lb=zw,sb?/rv:([^\);]+)(\)|;)/.exec(lb):rb?/Edge\/([\d\.]+)/.exec(lb):nb?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lb):ob?/WebKit\/(\S+)/.exec(lb):tb?/(?:Version)[ \/]?(\S+)/.exec(lb):void 0);if(lb&&(cb=lb?lb[1]:""),nb){lb=ab();if(null!=lb&&lb>parseFloat(cb)){eb=String(lb);break e}}eb=cb}var ub={};function hb(){return e=function(){for(var e=0,t=Ww(String(eb)).split("."),n=Ww("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++)for(var s=t[i]||"",o=n[i]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],(0!=s[0].length||0!=o[0].length)&&(e=Hw(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||Hw(0==s[2].length,0==o[2].length)||Hw(s[2],o[2]),s=s[3],o=o[3],0==e););return 0<=e},t=ub,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var db=kw.document&&nb&&(ab()||parseInt(eb,10))||void 0,fb=function(){if(!kw.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{kw.addEventListener("test",Cw,t),kw.removeEventListener("test",Cw,t)}catch(e){}return e}();function pb(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function gb(e,t){if(pb.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(sb){e:{try{Zw(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:mb[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&gb.Z.h.call(this)}}pb.prototype.h=function(){this.defaultPrevented=!0},Mw(gb,pb);var mb={2:"touch",3:"pen",4:"mouse"};gb.prototype.h=function(){gb.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var yb="closure_listenable_"+(1e6*Math.random()|0),vb=0;function _b(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++vb,this.ca=this.fa=!1}function wb(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function bb(e){this.src=e,this.g={},this.h=0}function Ib(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=jw(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(wb(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function Tb(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}bb.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Tb(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new _b(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Eb="closure_lm_"+(1e6*Math.random()|0),Sb={};function kb(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}r=Ob(r);return t&&t[yb]?t.O(n,r,Nw(i)?!!i.capture:!!i,s):Cb(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)kb(e,t[s],n,r,i);return null}return n=Ob(n),e&&e[yb]?e.N(t,n,Nw(r)?!!r.capture:!!r,i):Cb(e,t,n,!1,r,i)}function Cb(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o,a=Nw(i)?!!i.capture:!!i,c=Pb(e);if(c||(e[Eb]=c=new bb(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(o=Rb,(n.proxy=r=function e(t){return o.call(e.src,e.listener,t)}).src=e,r.listener=n,e.addEventListener)void 0===(i=!fb?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Nb(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ab(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[yb]?Ib(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Nb(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Pb(t))?(Ib(n,e),0==n.h&&(n.src=null,t[Eb]=null)):wb(e)))}function Nb(e){return e in Sb?Sb[e]:Sb[e]="on"+e}function Rb(e,t){var n,r;return e=!!e.ca||(t=new gb(t,this),n=e.listener,r=e.ia||e.src,e.fa&&Ab(e),n.call(r,t))}function Pb(e){return(e=e[Eb])instanceof bb?e:null}var xb="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ob(t){return"function"==typeof t?t:(t[xb]||(t[xb]=function(e){return t.handleEvent(e)}),t[xb])}function Db(){Fw.call(this),this.i=new bb(this),(this.P=this).I=null}function Lb(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new pb(t,e):t instanceof pb?t.target=t.target||e:(o=t,Xw(t=new pb(r,e),o)),o=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],o=Mb(s,r,!0,t)&&o;if(o=Mb(s=t.g=e,r,!0,t)&&o,o=Mb(s,r,!1,t)&&o,n)for(i=0;i<n.length;i++)o=Mb(s=t.g=n[i],r,!1,t)&&o}function Mb(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o,a,c=t[s];c&&!c.ca&&c.capture==n&&(o=c.listener,a=c.ia||c.src,c.fa&&Ib(e.i,c),i=!1!==o.call(a,r)&&i)}return i&&!r.defaultPrevented}Mw(Db,Fw),Db.prototype[yb]=!0,Db.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else i=Nw(i)?!!i.capture:!!i,r=Ob(r),t&&t[yb]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Tb(o=t.g[n],r,i,s))&&(wb(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&Pb(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?Tb(n,r,i,s):t)?n[t]:null)&&Ab(r))}(this,e,t,n,r)},Db.prototype.M=function(){if(Db.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)wb(n[r]);delete t.g[e],t.h--}}this.I=null},Db.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Db.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Fb=kw.JSON.stringify;Ub.prototype.add=function(e,t){var n=jb.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n},o=Ub;function Ub(){this.h=this.g=null}var jb=(qb.prototype.get=function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e},new qb(function(){return new Bb},function(e){return e.reset()}));function qb(e,t){this.i=e,this.j=t,this.h=0,this.g=null}var Vb,Bb=(Kb.prototype.set=function(e,t){this.h=e,this.g=t,this.next=null},Kb.prototype.reset=function(){this.next=this.g=this.h=null},Kb);function Kb(){this.next=this.g=this.h=null}function zb(e,t){var n;Vb||(n=kw.Promise.resolve(void 0),Vb=function(){n.then(Hb)}),Wb||(Vb(),Wb=!0),$b.add(e,t)}var Wb=!1,$b=new o;function Hb(){for(var e;t=e=void 0,t=null,(e=$b).g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),e=t;){try{e.h.call(e.g)}catch(e){!function(e){kw.setTimeout(function(){throw e},0)}(e)}var t=jb;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Wb=!1}function Gb(e,t){Db.call(this),this.h=e||1,this.g=t||kw,this.j=Dw(this.kb,this),this.l=Date.now()}function Qb(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Yb(e,t,n){if("function"==typeof e)n&&(e=Dw(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Dw(e.handleEvent,e)}return 2147483647<Number(t)?-1:kw.setTimeout(e,t||0)}Mw(Gb,Db),(qi=Gb.prototype).da=!1,qi.S=null,qi.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Lb(this,"tick"),this.da&&(Qb(this),this.start())))},qi.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},qi.M=function(){Gb.Z.M.call(this),Qb(this),delete this.g};var Jb,Xb=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Tw(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(Zb,Jb=Fw),Zb.prototype.l=function(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Yb(function(){t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)},Zb.prototype.M=function(){Jb.prototype.M.call(this),this.g&&(kw.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},Zb);function Zb(e,t){var n=Jb.call(this)||this;return n.m=e,n.j=t,n.h=null,n.i=!1,n.g=null,n}function eI(e){Fw.call(this),this.h=e,this.g={}}Mw(eI,Fw);var tI=[];function nI(e,t,n,r){Array.isArray(n)||(n&&(tI[0]=n.toString()),n=tI);for(var i=0;i<n.length;i++){var s=kb(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function rI(e){Qw(e.g,function(e,t){this.g.hasOwnProperty(t)&&Ab(e)},e),e.g={}}function iI(){this.g=!0}function sI(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Fb(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eI.prototype.M=function(){eI.Z.M.call(this),rI(this)},eI.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},iI.prototype.Aa=function(){this.g=!1},iI.prototype.info=function(){};var oI={},aI=null;function cI(){return aI=aI||new Db}function lI(e){pb.call(this,oI.Ma,e)}function uI(){var e=cI();Lb(e,new lI(e))}function hI(e,t){pb.call(this,oI.STAT_EVENT,e),this.stat=t}function dI(e){var t=cI();Lb(t,new hI(t,e))}function fI(e,t){pb.call(this,oI.Na,e),this.size=t}function pI(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return kw.setTimeout(function(){e()},t)}oI.Ma="serverreachability",Mw(lI,pb),oI.STAT_EVENT="statevent",Mw(hI,pb),oI.Na="timingevent",Mw(fI,pb);ur={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},E={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function gI(){}function mI(e){return e.h||(e.h=e.i())}function yI(){}gI.prototype.h=null;o={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function vI(){pb.call(this,"d")}function _I(){pb.call(this,"c")}function wI(){}function bI(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new eI(this),this.P=EI,this.W=new Gb(e=ib?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new II}function II(){this.i=null,this.g="",this.h=!1}Mw(vI,pb),Mw(_I,pb),Mw(wI,gI),wI.prototype.g=function(){return new XMLHttpRequest},wI.prototype.i=function(){return{}};var TI=new wI,EI=45e3,SI={},kI={};function CI(e,t,n){e.K=1,e.v=QI(KI(t)),e.s=n,e.U=!0,AI(e,null)}function AI(e,t){e.F=Date.now(),PI(e),e.A=KI(e.v);var o,a,c,l,u,h,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),cT(n.h,"t",r),e.C=0,n=e.l.H,e.h=new II,e.g=l0(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Xb(Dw(e.Ia,e,e.g),e.O)),nI(e.V,e.g,"readystatechange",e.gb),t=e.H?Yw(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),uI(),o=e.j,a=e.u,c=e.A,l=e.m,u=e.X,h=e.s,o.info(function(){if(o.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+a+"\n"+c+"\n"+e})}function NI(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function RI(e,t,n){for(var r,i,s,o,a,c=!0;!e.I&&e.C<n.length;){if(s=n,a=o=void 0,o=(i=e).C,(r=-1==(a=s.indexOf("\n",o))?kI:(o=Number(s.substring(o,a)),isNaN(o)?SI:(a+=1)+o>s.length?kI:(s=s.substr(a,o),i.C=a+o,s)))==kI){4==t&&(e.o=4,dI(14),c=!1),sI(e.j,e.m,null,"[Incomplete Response]");break}if(r==SI){e.o=4,dI(15),sI(e.j,e.m,n,"[Invalid Chunk]"),c=!1;break}sI(e.j,e.m,r,null),MI(e,r)}NI(e)&&r!=kI&&r!=SI&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,dI(16),c=!1),e.i=e.i&&c,c?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),t0(t),t.L=!0,dI(11))):(sI(e.j,e.m,n,"[Invalid Chunked Response]"),LI(e),DI(e))}function PI(e){e.Y=Date.now()+e.P,xI(e,e.P)}function xI(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=pI(Dw(e.eb,e),t)}function OI(e){e.B&&(kw.clearTimeout(e.B),e.B=null)}function DI(e){0==e.l.G||e.I||i0(e.l,e)}function LI(e){OI(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Qb(e.W),rI(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function MI(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||mT(n.i,e)))if(n.I=e.N,!e.J&&mT(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(g){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;r0(n),$T(n)}e0(n),dI(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=pI(Dw(n.ab,n),6e3));if(gT(n.i)<=1&&n.ka){try{n.ka()}catch(g){}n.ka=void 0}}else o0(n,11)}else if(!e.J&&n.g!=e||r0(n),!Kw(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var s,o,a,c,l,u,h,d,f,p,g=i[t];n.U=g[0],g=g[1],2==n.G?"c"==g[0]?(n.J=g[1],n.la=g[2],null!=(s=g[3])&&(n.ma=s,n.h.info("VER="+n.ma)),null!=(o=g[4])&&(n.za=o,n.h.info("SVER="+n.za)),null!=(a=g[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(c=e.g)&&(!(l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=r.i).g&&($w(l,"spdy")||$w(l,"quic")||$w(l,"h2"))&&(u.j=u.l,u.g=new Set,u.h&&(yT(u,u.h),u.h=null)),!r.D||(h=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=h,GI(r.F,r.D,h))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms")),d=e,(r=n).oa=c0(r,r.H?r.la:null,r.W),d.J?(vT(r.i,d),f=d,(p=r.K)&&f.setTimeout(p),f.B&&(OI(f),PI(f)),r.g=d):ZT(r),0<n.l.length&&QT(n)):"stop"!=g[0]&&"close"!=g[0]||o0(n,7):3==n.G&&("stop"==g[0]||"close"==g[0]?"stop"==g[0]?o0(n,7):WT(n):"noop"!=g[0]&&n.j&&n.j.wa(g),n.A=0)}uI()}catch(g){}}function FI(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Aw(e)||"string"==typeof e)qw(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(Aw(e)||"string"==typeof e)for(var n=[],r=e.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,e)n[r++]=i;for(var i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(Aw(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function UI(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof UI)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function jI(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];qI(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var i={},n=t=0;t<e.g.length;)qI(i,r=e.g[t])||(i[e.g[n++]=r]=1),t++;e.g.length=n}}function qI(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(qi=bI.prototype).setTimeout=function(e){this.P=e},qi.gb=function(e){e=e.target;var t=this.L;t&&3==qT(e)?t.l():this.Ia(e)},qi.Ia=function(e){try{if(e==this.g)e:{var t=qT(this.g),n=this.g.Da();this.g.ba();if(!(t<3)&&(3!=t||ib||this.g&&(this.h.h||this.g.ga()||VT(this.g)))){this.I||4!=t||7==n||uI(),OI(this);var r=this.g.ba();this.N=r;t:if(NI(this)){var i=VT(this.g);e="";var s=i.length,o=4==qT(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){LI(this),DI(this);var a="";break t}this.h.i=new kw.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,h=this.j,d=this.u,f=this.A,p=this.m,g=this.X,m=t,y=r,h.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+g+"]: "+d+"\n"+f+"\n"+m+" "+y}),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Kw(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,dI(12),LI(this),DI(this);break e}sI(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,MI(this,r)}this.U?(RI(this,t,a),ib&&this.i&&3==t&&(nI(this.V,this.W,"tick",this.fb),this.W.start())):(sI(this.j,this.m,a,null),MI(this,a)),4==t&&LI(this),this.i&&!this.I&&(4==t?i0(this.l,this):(this.i=!1,PI(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,dI(12)):(this.o=0,dI(13)),LI(this),DI(this)}}}catch(t){}var h,d,f,p,g,m,y},qi.fb=function(){var e,t;this.g&&(e=qT(this.g),t=this.g.ga(),this.C<t.length&&(OI(this),RI(this,e,t),this.i&&4!=e&&PI(this)))},qi.cancel=function(){this.I=!0,LI(this)},qi.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(uI(),dI(17)),LI(this),this.o=2,DI(this)):xI(this,this.Y-n)},(qi=UI.prototype).R=function(){jI(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},qi.T=function(){return jI(this),this.g.concat()},qi.get=function(e,t){return qI(this.h,e)?this.h[e]:t},qi.set=function(e,t){qI(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},qi.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var VI=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function BI(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof BI?(this.g=void 0!==t?t:e.g,zI(this,e.j),this.s=e.s,WI(this,e.i),$I(this,e.m),this.l=e.l,t=e.h,(n=new iT).i=t.i,t.g&&(n.g=new UI(t.g),n.h=t.h),HI(this,n),this.o=e.o):e&&(n=String(e).match(VI))?(this.g=!!t,zI(this,n[1]||"",!0),this.s=YI(n[2]||""),WI(this,n[3]||"",!0),$I(this,n[4]),this.l=YI(n[5]||"",!0),HI(this,n[6]||"",!0),this.o=YI(n[7]||"")):(this.g=!!t,this.h=new iT(null,this.g))}function KI(e){return new BI(e)}function zI(e,t,n){e.j=n?YI(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function WI(e,t,n){e.i=n?YI(t,!0):t}function $I(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function HI(e,t,n){var r,i;t instanceof iT?(e.h=t,r=e.h,(i=e.g)&&!r.j&&(sT(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(oT(this,t),cT(this,n,e))},r)),r.j=i):(n||(t=JI(t,nT)),e.h=new iT(t,e.g))}function GI(e,t,n){e.h.set(t,n)}function QI(e){return GI(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function YI(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function JI(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,XI),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function XI(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}BI.prototype.toString=function(){var e=[],t=this.j;t&&e.push(JI(t,ZI,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(JI(t,ZI,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(JI(n,"/"==n.charAt(0)?tT:eT,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",JI(n,rT)),e.join("")};var ZI=/[#\/\?@]/g,eT=/[#\?:]/g,tT=/[#\?]/g,nT=/[#\?@]/g,rT=/#/g;function iT(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function sT(n){n.g||(n.g=new UI,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function oT(e,t){sT(e),t=lT(e,t),qI(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,qI((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&jI(e)))}function aT(e,t){return sT(e),t=lT(e,t),qI(e.g.h,t)}function cT(e,t,n){oT(e,t),0<n.length&&(e.i=null,e.g.set(lT(e,t),Bw(n)),e.h+=n.length)}function lT(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(qi=iT.prototype).add=function(e,t){sT(this),this.i=null,e=lT(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},qi.forEach=function(n,r){sT(this),this.g.forEach(function(e,t){qw(e,function(e){n.call(r,e,t,this)},this)},this)},qi.T=function(){sT(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},qi.R=function(e){sT(this);var t=[];if("string"==typeof e)aT(this,e)&&(t=Vw(t,this.g.get(lT(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Vw(t,e[n])}return t},qi.set=function(e,t){return sT(this),this.i=null,aT(this,e=lT(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},qi.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},qi.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.R(r),s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}return this.i=e.join("&")};var uT=function(e,t){this.h=e,this.g=t};function hT(e){this.l=e||fT,e=kw.PerformanceNavigationTiming?0<(e=kw.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(kw.g&&kw.g.Ea&&kw.g.Ea()&&kw.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var dT,fT=10;function pT(e){return e.h||e.g&&e.g.size>=e.j}function gT(e){return e.h?1:e.g?e.g.size:0}function mT(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function yT(e,t){e.g?e.g.add(t):e.h=t}function vT(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function _T(e){var t,n;if(null!=e.h)return e.i.concat(e.h.D);if(null==e.g||0===e.g.size)return Bw(e.i);var r=e.i;try{for(var i=Ew(e.g.values()),s=i.next();!s.done;s=i.next())var o=s.value,r=r.concat(o.D)}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function wT(){}function bT(){this.g=new wT}function IT(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function TT(e){this.l=e.$b||null,this.j=e.ib||!1}function ET(e,t){Db.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=ST,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}hT.prototype.cancel=function(){var t,e;if(this.i=_T(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=Ew(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},wT.prototype.stringify=function(e){return kw.JSON.stringify(e,void 0)},wT.prototype.parse=function(e){return kw.JSON.parse(e,void 0)},Mw(TT,gI),TT.prototype.g=function(){return new ET(this.l,this.j)},TT.prototype.i=(dT={},function(){return dT}),Mw(ET,Db);var ST=0;function kT(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function CT(e){e.readyState=4,e.l=null,e.j=null,e.A=null,AT(e)}function AT(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(qi=ET.prototype).open=function(e,t){if(this.readyState!=ST)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,AT(this)},qi.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||kw).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},qi.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,CT(this)),this.readyState=ST},qi.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,AT(this)),this.g&&(this.readyState=3,AT(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==kw.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;kT(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},qi.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?CT:AT)(this),3==this.readyState&&kT(this))},qi.Ua=function(e){this.g&&(this.response=this.responseText=e,CT(this))},qi.Ta=function(e){this.g&&(this.response=e,CT(this))},qi.ha=function(){this.g&&CT(this)},qi.setRequestHeader=function(e,t){this.v.append(e,t)},qi.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},qi.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ET.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var NT=kw.JSON.parse;function RT(e){Db.call(this),this.headers=new UI,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=PT,this.K=this.L=!1}Mw(RT,Db);var PT="",xT=/^https?$/i,OT=["POST","PUT"];function DT(e){return"content-type"==e.toLowerCase()}function LT(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,MT(e),UT(e)}function MT(e){e.D||(e.D=!0,Lb(e,"complete"),Lb(e,"error"))}function FT(e){if(e.h&&void 0!==Sw&&(!e.C[1]||4!=qT(e)||2!=e.ba()))if(e.v&&4==qT(e))Yb(e.Fa,0,e);else if(Lb(e,"readystatechange"),4==qT(e)){e.h=!1;try{var t,n,r,i,s=e.ba();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===s)&&(!(i=String(e.H).match(VI)[1]||null)&&kw.self&&kw.self.location&&(i=(r=kw.self.location.protocol).substr(0,r.length-1)),n=!xT.test(i?i.toLowerCase():"")),t=n),t)Lb(e,"complete"),Lb(e,"success");else{e.m=6;try{var a=2<qT(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",MT(e)}}finally{UT(e)}}}function UT(e,t){if(e.g){jT(e);var n=e.g,r=e.C[0]?Cw:null;e.g=null,e.C=null,t||Lb(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function jT(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(kw.clearTimeout(e.A),e.A=null)}function qT(e){return e.g?e.g.readyState:0}function VT(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case PT:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function BT(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}var i;r||(i="",Qw(n,function(e,t){i+=t,i+=":",i+=e,i+="\r\n"}),n=i,"string"==typeof e?null!=n&&encodeURIComponent(String(n)):GI(e,t,n))}function KT(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function zT(e){this.za=0,this.l=[],this.h=new iI,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=KT("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=KT("baseRetryDelayMs",5e3,e),this.$a=KT("retryDelaySeedMs",1e4,e),this.Ya=KT("forwardChannelMaxRetries",2,e),this.ra=KT("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new hT(e&&e.concurrentRequestLimit),this.Ca=new bT,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function WT(e){var t,n;HT(e),3==e.G&&(t=e.V++,GI(n=KI(e.F),"SID",e.J),GI(n,"RID",t),GI(n,"TYPE","terminate"),JT(e,n),(t=new bI(e,e.h,t,void 0)).K=2,t.v=QI(KI(n)),n=!1,!(n=kw.navigator&&kw.navigator.sendBeacon?kw.navigator.sendBeacon(t.v.toString(),""):n)&&kw.Image&&((new Image).src=t.v,n=!0),n||(t.g=l0(t.l,null),t.g.ea(t.v)),t.F=Date.now(),PI(t)),a0(e)}function $T(e){e.g&&(t0(e),e.g.cancel(),e.g=null)}function HT(e){$T(e),e.u&&(kw.clearTimeout(e.u),e.u=null),r0(e),e.i.cancel(),e.m&&("number"==typeof e.m&&kw.clearTimeout(e.m),e.m=null)}function GT(e,t){e.l.push(new uT(e.Za++,t)),3==e.G&&QT(e)}function QT(e){pT(e.i)||e.m||(e.m=!0,zb(e.Ha,e),e.C=0)}function YT(e,t){var n=t?t.m:e.V++,r=KI(e.F);GI(r,"SID",e.J),GI(r,"RID",n),GI(r,"AID",e.U),JT(e,r),e.o&&e.s&&BT(r,e.o,e.s),n=new bI(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=XT(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),yT(e.i,n),CI(n,r,t)}function JT(e,n){e.j&&FI({},function(e,t){GI(n,t,e)})}function XT(e,t,n){n=Math.min(e.l.length,n);var r=e.j?Dw(e.j.Oa,e.j,e):null;e:for(var i=e.l,s=-1;;){var o=["count="+n];-1==s?0<n?(s=i[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);for(var a=!0,c=0;c<n;c++){var l=i[c].h,u=i[c].g;if((l-=s)<0)s=Math.max(0,i[c].h-100),a=!1;else try{!function(e,r,t){var i=t||"";try{FI(e,function(e,t){var n=e;Nw(e)&&(n=Fb(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(u,o,"req"+l+"_")}catch(e){r&&r(u)}}if(a){r=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function ZT(e){e.g||e.u||(e.Y=1,zb(e.Ga,e),e.A=0)}function e0(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=pI(Dw(e.Ga,e),s0(e,e.A)),e.A++,1)}function t0(e){null!=e.B&&(kw.clearTimeout(e.B),e.B=null)}function n0(e){e.g=new bI(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=KI(e.oa);GI(t,"RID","rpc"),GI(t,"SID",e.J),GI(t,"CI",e.N?"0":"1"),GI(t,"AID",e.U),JT(e,t),GI(t,"TYPE","xmlhttp"),e.o&&e.s&&BT(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=QI(KI(t)),n.s=null,n.U=!0,AI(n,e)}function r0(e){null!=e.v&&(kw.clearTimeout(e.v),e.v=null)}function i0(e,t){var n,r,i,s=null;if(e.g==t){r0(e),t0(e),e.g=null;var o=2}else{if(!mT(e.i,t))return;s=t.D,vT(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,Lb(o=cI(),new fI(o,s)),QT(e)):ZT(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(i=t,gT((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=pI(Dw(r.Ha,r,i),s0(r,r.C)),r.C++,0))))&&(2!=o||!e0(e)))switch(s&&0<s.length&&(t=e.i,t.i=t.i.concat(s)),n){case 1:o0(e,5);break;case 4:o0(e,10);break;case 3:o0(e,6);break;default:o0(e,2)}}function s0(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function o0(e,t){var n,r,i,s;e.h.info("Error code "+t),2==t?(r=null,e.j&&(r=null),s=Dw(e.jb,e),r||(r=new BI("//www.google.com/images/cleardot.gif"),kw.location&&"http"==kw.location.protocol||zI(r,"https"),QI(r)),n=r.toString(),r=s,s=new iI,kw.Image?((i=new Image).onload=Lw(IT,s,i,"TestLoadImage: loaded",!0,r),i.onerror=Lw(IT,s,i,"TestLoadImage: error",!1,r),i.onabort=Lw(IT,s,i,"TestLoadImage: abort",!1,r),i.ontimeout=Lw(IT,s,i,"TestLoadImage: timeout",!1,r),kw.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):dI(2),e.G=0,e.j&&e.j.va(t),a0(e),HT(e)}function a0(e){e.G=0,e.I=-1,e.j&&(0==_T(e.i).length&&0==e.l.length||(e.i.i.length=0,Bw(e.l),e.l.length=0),e.j.ua())}function c0(e,t,n){var r,i,s,o,a,c=(o=n)instanceof BI?KI(o):new BI(o,void 0);return""!=c.i?(t&&WI(c,t+"."+c.i),$I(c,c.m)):(a=kw.location,r=a.protocol,i=t?t+"."+a.hostname:a.hostname,s=+a.port,o=n,a=new BI(null,void 0),r&&zI(a,r),i&&WI(a,i),s&&$I(a,s),o&&(a.l=o),c=a),e.aa&&Qw(e.aa,function(e,t){GI(c,t,e)}),t=e.D,n=e.sa,t&&n&&GI(c,t,n),GI(c,"VER",e.ma),JT(e,c),c}function l0(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new RT(new TT({ib:!0})):new RT(e.qa)).L=e.H,t}function u0(){}function h0(){if(nb&&!(10<=Number(db)))throw Error("Environmental error: no available transport.")}function d0(e,t){Db.call(this),this.g=new zT(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Kw(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Kw(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new g0(this)}function f0(e){vI.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function p0(){_I.call(this),this.status=1}function g0(e){this.g=e}(qi=RT.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||TI).g(),this.C=this.u?mI(this.u):mI(TI),this.g.onreadystatechange=Dw(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void LT(this,e)}e=n||"";var i,s=new UI(this.headers);r&&FI(r,function(e,t){s.set(t,e)}),r=function(e){e:{for(var t=DT,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return t<0?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),n=kw.FormData&&e instanceof kw.FormData,0<=jw(OT,t)&&!r&&!n&&s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{jT(this),0<this.B&&((this.K=(i=this.g,nb&&hb()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=Dw(this.pa,this)):this.A=Yb(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){LT(this,e)}},qi.pa=function(){void 0!==Sw&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Lb(this,"timeout"),this.abort(8))},qi.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Lb(this,"complete"),Lb(this,"abort"),UT(this))},qi.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),UT(this,!0)),RT.Z.M.call(this)},qi.Fa=function(){this.s||(this.F||this.v||this.l?FT(this):this.cb())},qi.cb=function(){FT(this)},qi.ba=function(){try{return 2<qT(this)?this.g.status:-1}catch(e){return-1}},qi.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},qi.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),NT(t)}},qi.Da=function(){return this.m},qi.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(qi=zT.prototype).ma=8,qi.G=1,qi.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},qi.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new bI(this,this.h,e,void 0),n=this.s;if(this.P&&(n?Xw(n=Yw(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var s=this.l[i];if("__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(r+=s)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=XT(this,t,r),GI(i=KI(this.F),"RID",e),GI(i,"CVER",22),this.D&&GI(i,"X-HTTP-Session-Id",this.D),JT(this,i),this.o&&n&&BT(i,this.o,n),yT(this.i,t),this.Ra&&GI(i,"TYPE","init"),this.ja?(GI(i,"$req",r),GI(i,"SID","null"),t.$=!0,CI(t,i,null)):CI(t,i,r),this.G=2}}else 3==this.G&&(e?YT(this,e):0==this.l.length||pT(this.i)||YT(this))},qi.Ga=function(){var e;this.u=null,n0(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=pI(Dw(this.bb,this),e))},qi.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,dI(10),$T(this),n0(this))},qi.ab=function(){null!=this.v&&(this.v=null,$T(this),e0(this),dI(19))},qi.jb=function(e){e?(this.h.info("Successfully pinged google.com"),dI(2)):(this.h.info("Failed to ping google.com"),dI(1))},(qi=u0.prototype).xa=function(){},qi.wa=function(){},qi.va=function(){},qi.ua=function(){},qi.Oa=function(){},h0.prototype.g=function(e,t){return new d0(e,t)},Mw(d0,Db),d0.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),zb(Dw(e.hb,e,t))),dI(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=c0(e,null,e.W),QT(e)},d0.prototype.close=function(){WT(this.g)},d0.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,GT(this.g,t)):this.v?((t={}).__data__=Fb(e),GT(this.g,t)):GT(this.g,e)},d0.prototype.M=function(){this.g.j=null,delete this.j,WT(this.g),delete this.g,d0.Z.M.call(this)},Mw(f0,vI),Mw(p0,_I),Mw(g0,u0),g0.prototype.xa=function(){Lb(this.g,"a")},g0.prototype.wa=function(e){Lb(this.g,new f0(e))},g0.prototype.va=function(e){Lb(this.g,new p0)},g0.prototype.ua=function(){Lb(this.g,"b")},h0.prototype.createWebChannel=h0.prototype.g,d0.prototype.send=d0.prototype.u,d0.prototype.open=d0.prototype.m,ur.NO_ERROR=0,ur.TIMEOUT=8,ur.HTTP_ERROR=6,E.COMPLETE="complete",(yI.EventType=o).OPEN="a",o.CLOSE="b",o.ERROR="c",o.MESSAGE="d",Db.prototype.listen=Db.prototype.N,RT.prototype.listenOnce=RT.prototype.O,RT.prototype.getLastError=RT.prototype.La,RT.prototype.getLastErrorCode=RT.prototype.Da,RT.prototype.getStatus=RT.prototype.ba,RT.prototype.getResponseJson=RT.prototype.Qa,RT.prototype.getResponseText=RT.prototype.ga,RT.prototype.send=RT.prototype.ea;var m0,y0=cI,v0=ur,_0=E,w0=oI,b0=10,I0=11,T0=TT,E0=yI,S0=RT;class k0{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}k0.UNAUTHENTICATED=new k0(null),k0.GOOGLE_CREDENTIALS=new k0("google-credentials-uid"),k0.FIRST_PARTY=new k0("first-party-uid"),k0.MOCK_USER=new k0("mock-user");let C0="9.0.1";const A0=new _o("@firebase/firestore");function N0(){return A0.logLevel}function R0(e,...t){A0.logLevel<=fo.DEBUG&&(t=t.map(O0),A0.debug(`Firestore (${C0}): ${e}`,...t))}function P0(e,...t){A0.logLevel<=fo.ERROR&&(t=t.map(O0),A0.error(`Firestore (${C0}): ${e}`,...t))}function x0(e,...t){A0.logLevel<=fo.WARN&&(t=t.map(O0),A0.warn(`Firestore (${C0}): ${e}`,...t))}function O0(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function D0(e="Unexpected state"){e=`FIRESTORE (${C0}) INTERNAL ASSERTION FAILED: `+e;throw P0(e),new Error(e)}function L0(e){e||D0()}const M0={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F0 extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class U0{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class j0{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class q0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(k0.UNAUTHENTICATED))}shutdown(){}}class V0{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class B0{constructor(e){this.t=e,this.currentUser=k0.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new U0;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new U0,t.enqueueRetryable(()=>i(this.currentUser))};const o=e=>{t.enqueueRetryable(async()=>{R0("FirebaseCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),await s.promise,await i(this.currentUser)})};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(R0("FirebaseCredentialsProvider","Auth not yet detected"),s.resolve(),s=new U0))},0),t.enqueueRetryable(async()=>{0===this.i&&(await s.promise,await i(this.currentUser))})}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(R0("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(L0("string"==typeof e.accessToken),new j0(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return L0(null===e||"string"==typeof e),new k0(e)}}class K0{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=k0.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class z0{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new K0(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(k0.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class W0{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.g(e),this.p=e=>t.writeSequenceNumber(e))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.p&&this.p(e),e}}W0.T=-1;class $0{static I(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function H0(e,t){return e<t?-1:t<e?1:0}function G0(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Q0(e){return e+"\0"}class Y0{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new F0(M0.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new F0(M0.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new F0(M0.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new F0(M0.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Y0.fromMillis(Date.now())}static fromDate(e){return Y0.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new Y0(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?H0(this.nanoseconds,e.nanoseconds):H0(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class J0{constructor(e){this.timestamp=e}static fromTimestamp(e){return new J0(e)}static min(){return new J0(new Y0(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function X0(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Z0(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function eE(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tE{constructor(e,t,n){void 0===t?t=0:t>e.length&&D0(),void 0===n?n=e.length-t:n>e.length-t&&D0(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===tE.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof tE?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),i=n.get(e);if(r<i)return-1;if(r>i)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class nE extends tE{construct(e,t,n){return new nE(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new F0(M0.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new nE(t)}static emptyPath(){return new nE([])}}const rE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class iE extends tE{construct(e,t,n){return new iE(e,t,n)}static isValidIdentifier(e){return rE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!iE.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new iE(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new F0(M0.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new F0(M0.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new F0(M0.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new F0(M0.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new iE(t)}static emptyPath(){return new iE([])}}class sE{constructor(e){(this.fields=e).sort(iE.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return G0(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class oE{constructor(e){this.binaryString=e}static fromBase64String(e){e=atob(e);return new oE(e)}static fromUint8Array(e){e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e);return new oE(e)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H0(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}oE.EMPTY_BYTE_STRING=new oE("");const aE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cE(t){if(L0(!!t),"string"!=typeof t)return{seconds:lE(t.seconds),nanos:lE(t.nanos)};{let e=0;var n=aE.exec(t);L0(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function lE(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function uE(e){return"string"==typeof e?oE.fromBase64String(e):oE.fromUint8Array(e)}function hE(e){return"server_timestamp"===(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function dE(e){e=cE(e.mapValue.fields.__local_write_time__.timestampValue);return new Y0(e.seconds,e.nanos)}function fE(e){return null==e}function pE(e){return 0===e&&1/e==-1/0}function gE(e){return"number"==typeof e&&Number.isInteger(e)&&!pE(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class mE{constructor(e){this.path=e}static fromPath(e){return new mE(nE.fromString(e))}static fromName(e){return new mE(nE.fromString(e).popFirst(5))}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===nE.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return nE.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new mE(new nE(e.slice()))}}function yE(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?hE(e)?4:10:D0()}function vE(n,r){var e,t,i=yE(n);if(i!==yE(r))return!1;switch(i){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return dE(n).isEqual(dE(r));case 3:return function(e){if("string"==typeof n.timestampValue&&"string"==typeof e.timestampValue&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;var t=cE(n.timestampValue),e=cE(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return t=r,uE(n.bytesValue).isEqual(uE(t.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return e=r,lE((t=n).geoPointValue.latitude)===lE(e.geoPointValue.latitude)&&lE(t.geoPointValue.longitude)===lE(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return lE(e.integerValue)===lE(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){e=lE(e.doubleValue),t=lE(t.doubleValue);return e===t?pE(e)===pE(t):isNaN(e)&&isNaN(t)}return!1}(n,r);case 9:return G0(n.arrayValue.values||[],r.arrayValue.values||[],vE);case 10:return function(e){const t=e.mapValue.fields||{},n=r.mapValue.fields||{};if(X0(t)!==X0(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!vE(t[e],n[e])))return!1;return!0}(n);default:return D0()}}function _E(e,t){return void 0!==(e.values||[]).find(e=>vE(e,t))}function wE(e,t){var n,r,i,s=yE(e),o=yE(t);if(s!==o)return H0(s,o);switch(s){case 0:return 0;case 1:return H0(e.booleanValue,t.booleanValue);case 2:return r=t,i=lE(e.integerValue||e.doubleValue),r=lE(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return bE(e.timestampValue,t.timestampValue);case 4:return bE(dE(e),dE(t));case 5:return H0(e.stringValue,t.stringValue);case 6:return function(e,t){const n=uE(e),r=uE(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=H0(n[e],r[e]);if(0!==t)return t}return H0(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,i=t.geoPointValue,0!==(r=H0(lE(n.latitude),lE(i.latitude)))?r:H0(lE(n.longitude),lE(i.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=wE(n[e],r[e]);if(t)return t}return H0(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=H0(r[e],s[e]);if(0!==t)return t;var o=wE(n[r[e]],i[s[e]]);if(0!==o)return o}return H0(r.length,s.length)}(e.mapValue,t.mapValue);default:throw D0()}}function bE(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return H0(e,t);var n=cE(e),e=cE(t),t=H0(n.seconds,e.seconds);return 0!==t?t:H0(n.nanos,e.nanos)}function IE(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=cE(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?uE(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,mE.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):D0();var t}(e)}function TE(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function EE(e){return e&&"integerValue"in e}function SE(e){return!!e&&"arrayValue"in e}function kE(e){return e&&"nullValue"in e}function CE(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function AE(e){return e&&"mapValue"in e}function NE(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return Z0(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=NE(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=NE(t.arrayValue.values[e]);return r}return Object.assign({},t)}class RE{constructor(e){this.value=e}static empty(){return new RE({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(t=(t.mapValue.fields||{})[n.get(e)],!AE(t))return null;return t=(t.mapValue.fields||{})[n.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=NE(t)}setAll(e){let n=iE.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=NE(e):i.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,r,i)}delete(e){const t=this.field(e.popLast());AE(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vE(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];AE(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){Z0(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new RE(NE(this.value))}}class PE{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new PE(e,0,J0.min(),RE.empty(),0)}static newFoundDocument(e,t,n){return new PE(e,1,t,n,0)}static newNoDocument(e,t){return new PE(e,2,t,RE.empty(),0)}static newUnknownDocument(e,t){return new PE(e,3,t,RE.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=RE.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=RE.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof PE&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new PE(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xE{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.A=null}}function OE(e,t=null,n=[],r=[],i=null,s=null,o=null){return new xE(e,t,n,r,i,s,o)}function DE(e){const t=e;if(null===t.A){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+IE(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),fE(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=HE(t.startAt)),t.endAt&&(e+="|ub:",e+=HE(t.endAt)),t.A=e}return t.A}function LE(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],i=n.orderBy[e],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i,s,o;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(s=t.filters[e],o=n.filters[e],s.op!==o.op||!s.field.isEqual(o.field)||!vE(s.value,o.value))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!YE(t.startAt,n.startAt)&&YE(t.endAt,n.endAt)}function ME(e){return mE.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class FE extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,n):new UE(e,t,n):"array-contains"===t?new BE(e,n):"in"===t?new KE(e,n):"not-in"===t?new zE(e,n):"array-contains-any"===t?new WE(e,n):new FE(e,t,n)}static R(e,t,n){return new("in"===t?jE:qE)(e,n)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.P(wE(e,this.value)):null!==e&&yE(this.value)===yE(e)&&this.P(wE(e,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return D0()}}v(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class UE extends FE{constructor(e,t,n){super(e,t,n),this.key=mE.fromName(n.referenceValue)}matches(e){e=mE.comparator(e.key,this.key);return this.P(e)}}class jE extends FE{constructor(e,t){super(e,"in",t),this.keys=VE(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class qE extends FE{constructor(e,t){super(e,"not-in",t),this.keys=VE(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function VE(e,t){return((null===(t=t.arrayValue)||void 0===t?void 0:t.values)||[]).map(e=>mE.fromName(e.referenceValue))}class BE extends FE{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return SE(e)&&_E(e.arrayValue,this.value)}}class KE extends FE{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&_E(this.value.arrayValue,e)}}class zE extends FE{constructor(e,t){super(e,"not-in",t)}matches(e){if(_E(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!_E(this.value.arrayValue,e)}}class WE extends FE{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!SE(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>_E(this.value.arrayValue,e))}}class $E{constructor(e,t){this.position=e,this.before=t}}function HE(e){return`${e.before?"b":"a"}:${e.position.map(e=>IE(e)).join(",")}`}class GE{constructor(e,t="asc"){this.field=e,this.dir=t}}function QE(t,n,r){let i=0;for(let e=0;e<t.position.length;e++){const s=n[e],o=t.position[e];if(i=s.field.isKeyField()?mE.comparator(mE.fromName(o.referenceValue),r.key):wE(o,r.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return t.before?i<=0:i<0}function YE(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.before!==n.before||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!vE(t.position[e],n.position[e]))return!1;return!0}class JE{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.V=null,this.S=null,this.startAt,this.endAt}}function XE(e,t,n,r,i,s,o,a){return new JE(e,t,n,r,i,s,o,a)}function ZE(e){return new JE(e)}function eS(e){return!fE(e.limit)&&"F"===e.limitType}function tS(e){return!fE(e.limit)&&"L"===e.limitType}function nS(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function rS(e){for(const t of e.filters)if(t.v())return t.field;return null}function iS(e){return null!==e.collectionGroup}function sS(t){const n=t;if(null===n.V){n.V=[];const t=rS(n),e=nS(n);if(null!==t&&null===e)t.isKeyField()||n.V.push(new GE(t)),n.V.push(new GE(iE.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.V.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.V.push(new GE(iE.keyField(),t))}}}return n.V}function oS(e){const t=e;if(!t.S)if("F"===t.limitType)t.S=OE(t.path,t.collectionGroup,sS(t),t.filters,t.limit,t.startAt,t.endAt);else{const r=[];for(const i of sS(t)){const t="desc"===i.dir?"asc":"desc";r.push(new GE(i.field,t))}var n=t.endAt?new $E(t.endAt.position,!t.endAt.before):null,e=t.startAt?new $E(t.startAt.position,!t.startAt.before):null;t.S=OE(t.path,t.collectionGroup,r,t.filters,t.limit,n,e)}return t.S}function aS(e,t,n){return new JE(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function cS(e,t){return LE(oS(e),oS(t))&&e.limitType===t.limitType}function lS(e){return`${DE(oS(e))}|lt:${e.limitType}`}function uS(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(e=e).field.canonicalString()} ${e.op} ${IE(e.value)}`}).join(", ")}]`),fE(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+HE(e.startAt)),e.endAt&&(t+=", endAt: "+HE(e.endAt)),`Target(${t})`}(oS(e))}; limitType=${e.limitType})`}function hS(n,e){return e.isFoundDocument()&&(t=n,r=e.key.path,null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):mE.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(r=e,(!(e=n).startAt||QE(e.startAt,sS(e),r))&&(!e.endAt||!QE(e.endAt,sS(e),r)));var t,r}function dS(i){return(e,t)=>{let n=!1;for(const r of sS(i)){const i=function(e,r,t){var n=e.field.isKeyField()?mE.comparator(r.key,t.key):function(e,t){var n=r.data.field(e),e=t.data.field(e);return null!==n&&null!==e?wE(n,e):D0()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return D0()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function fS(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pE(t)?"-0":t}}function pS(e){return{integerValue:""+e}}function gS(e,t){return gE(t)?pS(t):fS(e,t)}class mS{constructor(){this._=void 0}}function yS(e,t){return e instanceof TS?EE(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class vS extends mS{}class _S extends mS{constructor(e){super(),this.elements=e}}function wS(e,t){const n=SS(t);for(const t of e.elements)n.some(e=>vE(e,t))||n.push(t);return{arrayValue:{values:n}}}class bS extends mS{constructor(e){super(),this.elements=e}}function IS(e,t){let n=SS(t);for(const t of e.elements)n=n.filter(e=>!vE(e,t));return{arrayValue:{values:n}}}class TS extends mS{constructor(e,t){super(),this.N=e,this.C=t}}function ES(e){return lE(e.integerValue||e.doubleValue)}function SS(e){return SE(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class kS{constructor(e,t){this.field=e,this.transform=t}}class CS{constructor(e,t){this.version=e,this.transformResults=t}}class AS{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new AS}static exists(e){return new AS(void 0,e)}static updateTime(e){return new AS(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function NS(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class RS{}function PS(e,t,n){e instanceof LS?function(e,t,n){const r=e.value.clone(),i=US(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof MS?function(e,t,n){if(!NS(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=US(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(FS(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function xS(e,t,n){e instanceof LS?function(e,t,n){if(NS(e.precondition,t)){const r=e.value.clone(),i=jS(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(DS(t),r).setHasLocalMutations()}}(e,t,n):e instanceof MS?function(e,t,n){if(NS(e.precondition,t)){const r=jS(e.fieldTransforms,n,t),i=t.data;i.setAll(FS(e)),i.setAll(r),t.convertToFoundDocument(DS(t),i).setHasLocalMutations()}}(e,t,n):(t=t,NS(e.precondition,t)&&t.convertToNoDocument(J0.min()))}function OS(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&G0(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof _S&&t instanceof _S||e instanceof bS&&t instanceof bS?G0(e.elements,t.elements,vE):e instanceof TS&&t instanceof TS?vE(e.C,t.C):e instanceof vS&&t instanceof vS)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function DS(e){return e.isFoundDocument()?e.version:J0.min()}class LS extends RS{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class MS extends RS{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function FS(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function US(t,n,r){const i=new Map;L0(t.length===r.length);for(let e=0;e<r.length;e++){var s=t[e],o=s.transform,a=n.data.field(s.field);i.set(s.field,(s=o,o=a,a=r[e],s instanceof _S?wS(s,o):s instanceof bS?IS(s,o):a))}return i}function jS(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,o=t,c=a=void 0,i instanceof vS?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof _S?wS(i,s):i instanceof bS?IS(i,s):(c=yS(a=i,s),i=ES(c)+ES(a.C),EE(c)&&EE(a.C)?pS(i):fS(a.N,i))))}var i,s,o,a,c;return r}class qS extends RS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class VS extends RS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class BS{constructor(e){this.count=e}}function KS(e){switch(e){case M0.OK:return D0(),0;case M0.CANCELLED:case M0.UNKNOWN:case M0.DEADLINE_EXCEEDED:case M0.RESOURCE_EXHAUSTED:case M0.INTERNAL:case M0.UNAVAILABLE:case M0.UNAUTHENTICATED:return;case M0.INVALID_ARGUMENT:case M0.NOT_FOUND:case M0.ALREADY_EXISTS:case M0.PERMISSION_DENIED:case M0.FAILED_PRECONDITION:case M0.ABORTED:case M0.OUT_OF_RANGE:case M0.UNIMPLEMENTED:case M0.DATA_LOSS:return 1;default:return D0(),0}}function zS(e){if(void 0===e)return P0("GRPC error has no .code"),M0.UNKNOWN;switch(e){case m0.OK:return M0.OK;case m0.CANCELLED:return M0.CANCELLED;case m0.UNKNOWN:return M0.UNKNOWN;case m0.DEADLINE_EXCEEDED:return M0.DEADLINE_EXCEEDED;case m0.RESOURCE_EXHAUSTED:return M0.RESOURCE_EXHAUSTED;case m0.INTERNAL:return M0.INTERNAL;case m0.UNAVAILABLE:return M0.UNAVAILABLE;case m0.UNAUTHENTICATED:return M0.UNAUTHENTICATED;case m0.INVALID_ARGUMENT:return M0.INVALID_ARGUMENT;case m0.NOT_FOUND:return M0.NOT_FOUND;case m0.ALREADY_EXISTS:return M0.ALREADY_EXISTS;case m0.PERMISSION_DENIED:return M0.PERMISSION_DENIED;case m0.FAILED_PRECONDITION:return M0.FAILED_PRECONDITION;case m0.ABORTED:return M0.ABORTED;case m0.OUT_OF_RANGE:return M0.OUT_OF_RANGE;case m0.UNIMPLEMENTED:return M0.UNIMPLEMENTED;case m0.DATA_LOSS:return M0.DATA_LOSS;default:return D0()}}(E=m0=m0||{})[E.OK=0]="OK",E[E.CANCELLED=1]="CANCELLED",E[E.UNKNOWN=2]="UNKNOWN",E[E.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",E[E.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",E[E.NOT_FOUND=5]="NOT_FOUND",E[E.ALREADY_EXISTS=6]="ALREADY_EXISTS",E[E.PERMISSION_DENIED=7]="PERMISSION_DENIED",E[E.UNAUTHENTICATED=16]="UNAUTHENTICATED",E[E.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",E[E.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",E[E.ABORTED=10]="ABORTED",E[E.OUT_OF_RANGE=11]="OUT_OF_RANGE",E[E.UNIMPLEMENTED=12]="UNIMPLEMENTED",E[E.INTERNAL=13]="INTERNAL",E[E.UNAVAILABLE=14]="UNAVAILABLE",E[E.DATA_LOSS=15]="DATA_LOSS";class WS{constructor(e,t){this.comparator=e,this.root=t||HS.EMPTY}insert(e,t){return new WS(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,HS.BLACK,null,null))}remove(e){return new WS(this.comparator,this.root.remove(e,this.comparator).copy(null,null,HS.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $S(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $S(this.root,e,this.comparator,!1)}getReverseIterator(){return new $S(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $S(this.root,e,this.comparator,!0)}}class $S{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class HS{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:HS.RED,this.left=null!=r?r:HS.EMPTY,this.right=null!=i?i:HS.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new HS(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return HS.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return HS.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,HS.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,HS.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw D0();if(this.right.isRed())throw D0();var e=this.left.check();if(e!==this.right.check())throw D0();return e+(this.isRed()?0:1)}}HS.EMPTY=null,HS.RED=!0,HS.BLACK=!1,HS.EMPTY=new class{constructor(){this.size=0}get key(){throw D0()}get value(){throw D0()}get color(){throw D0()}get left(){throw D0()}get right(){throw D0()}copy(e,t,n,r,i){return this}insert(e,t,n){return new HS(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class GS{constructor(e){this.comparator=e,this.data=new WS(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new QS(this.data.getIterator())}getIteratorFrom(e){return new QS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof GS))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new GS(this.comparator);return t.data=e,t}}class QS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const YS=new WS(mE.comparator);const JS=new WS(mE.comparator);const XS=new WS(mE.comparator);const ZS=new GS(mE.comparator);function ek(...e){let t=ZS;for(const n of e)t=t.add(n);return t}const tk=new GS(H0);class nk{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,rk.createSynthesizedTargetChangeForCurrentChange(e,t)),new nk(J0.min(),n,tk,YS,ek())}}class rk{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new rk(oE.EMPTY_BYTE_STRING,t,ek(),ek(),ek())}}class ik{constructor(e,t,n,r){this.k=e,this.removedTargetIds=t,this.key=n,this.$=r}}class sk{constructor(e,t){this.targetId=e,this.O=t}}class ok{constructor(e,t,n=oE.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ak{constructor(){this.F=0,this.M=uk(),this.L=oE.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){0<e.approximateByteSize()&&(this.U=!0,this.L=e)}W(){let n=ek(),r=ek(),i=ek();return this.M.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:D0()}}),new rk(this.L,this.B,n,r,i)}G(){this.U=!1,this.M=uk()}H(e,t){this.U=!0,this.M=this.M.insert(e,t)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){--this.F}Z(){this.U=!0,this.B=!0}}class ck{constructor(e){this.tt=e,this.et=new Map,this.nt=YS,this.st=lk(),this.it=new GS(H0)}rt(e){for(const t of e.k)e.$&&e.$.isFoundDocument()?this.ot(t,e.$):this.at(t,e.key,e.$);for(const n of e.removedTargetIds)this.at(n,e.key,e.$)}ct(n){this.forEachTarget(n,e=>{const t=this.ut(e);switch(n.state){case 0:this.ht(e)&&t.j(n.resumeToken);break;case 1:t.X(),t.q||t.G(),t.j(n.resumeToken);break;case 2:t.X(),t.q||this.removeTarget(e);break;case 3:this.ht(e)&&(t.Z(),t.j(n.resumeToken));break;case 4:this.ht(e)&&(this.lt(e),t.j(n.resumeToken));break;default:D0()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.et.forEach((e,t)=>{this.ht(t)&&n(t)})}ft(e){const t=e.targetId,n=e.O.count,r=this.dt(t);if(r){const e=r.target;if(ME(e))if(0===n){const n=new mE(e.path);this.at(t,n,PE.newNoDocument(n,J0.min()))}else L0(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}_t(r){const i=new Map;this.et.forEach((e,t)=>{var n=this.dt(t);if(n){if(e.current&&ME(n.target)){const i=new mE(n.target.path);null!==this.nt.get(i)||this.gt(t,i)||this.at(t,i,PE.newNoDocument(i,r))}e.K&&(i.set(t,e.W()),e.G())}});let s=ek();this.st.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{e=this.dt(e);return!e||2===e.purpose||(n=!1)}),n&&(s=s.add(e))});var e=new nk(r,i,this.it,this.nt,s);return this.nt=YS,this.st=lk(),this.it=new GS(H0),e}ot(e,t){var n;this.ht(e)&&(n=this.gt(e,t.key)?2:0,this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e)))}at(e,t,n){if(this.ht(e)){const r=this.ut(e);this.gt(e,t)?r.H(t,1):r.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}}removeTarget(e){this.et.delete(e)}wt(e){var t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let t=this.et.get(e);return t||(t=new ak,this.et.set(e,t)),t}yt(e){let t=this.st.get(e);return t||(t=new GS(H0),this.st=this.st.insert(e,t)),t}ht(e){var t=null!==this.dt(e);return t||R0("WatchChangeAggregator","Detected inactive target",e),t}dt(e){var t=this.et.get(e);return t&&t.q?null:this.tt.Et(e)}lt(t){this.et.set(t,new ak),this.tt.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,e,null)})}gt(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}function lk(){return new WS(mE.comparator)}function uk(){return new WS(mE.comparator)}const hk={asc:"ASCENDING",desc:"DESCENDING"},dk={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class fk{constructor(e,t){this.databaseId=e,this.D=t}}function pk(e,t){return e.D?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function gk(e,t){return e.D?t.toBase64():t.toUint8Array()}function mk(e){return L0(!!e),J0.fromTimestamp((e=cE(e),new Y0(e.seconds,e.nanos)))}function yk(e,t){return e=e,new nE(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function vk(e){e=nE.fromString(e);return L0(Uk(e)),e}function _k(e,t){return yk(e.databaseId,t.path)}function wk(e,t){const n=vk(t);if(n.get(1)!==e.databaseId.projectId)throw new F0(M0.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new F0(M0.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new mE(Ek(n))}function bk(e,t){return yk(e.databaseId,t)}function Ik(e){e=vk(e);return 4===e.length?nE.emptyPath():Ek(e)}function Tk(e){return new nE(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ek(e){return L0(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Sk(e,t,n){return{name:_k(e,t),fields:n.value.mapValue.fields}}function kk(e,t,n){const r=wk(e,t.name),i=mk(t.updateTime),s=new RE({mapValue:{fields:t.fields}}),o=PE.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Ck(e,t){let n;if(t instanceof LS)n={update:Sk(e,t.key,t.value)};else if(t instanceof qS)n={delete:_k(e,t.key)};else if(t instanceof MS)n={update:Sk(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof VS))return D0();n={verify:_k(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof vS)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof _S)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof bS)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof TS)return{fieldPath:e.field.canonicalString(),increment:t.C};throw D0()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(t=t.precondition).updateTime?{updateTime:pk(e,t.updateTime.toTimestamp())}:void 0!==t.exists?{exists:t.exists}:D0()),n}function Ak(t,n){const e=n.currentDocument?void 0!==(s=n.currentDocument).updateTime?AS.updateTime(mk(s.updateTime)):void 0!==s.exists?AS.exists(s.exists):AS.none():AS.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)L0("REQUEST_TIME"===t.setToServerValue),n=new vS;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new _S(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new bS(e)}else"increment"in t?n=new TS(e,t.increment):D0();t=iE.fromServerFormat(t.fieldPath);return new kS(t,n)}(t,e)):[];if(n.update){n.update.name;var i=wk(t,n.update.name),s=new RE({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new sE(e.map(e=>iE.fromServerFormat(e)))}();return new MS(i,s,t,e,r)}return new LS(i,s,e,r)}if(n.delete){const r=wk(t,n.delete);return new qS(r,e)}if(n.verify){const r=wk(t,n.verify);return new VS(r,e)}return D0()}function Nk(e,t){return{documents:[bk(e,t.path)]}}function Rk(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=bk(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=bk(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){e=e.map(e=>function(e){if("=="===e.op){if(CE(e.value))return{unaryFilter:{field:Dk(e.field),op:"IS_NAN"}};if(kE(e.value))return{unaryFilter:{field:Dk(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(CE(e.value))return{unaryFilter:{field:Dk(e.field),op:"IS_NOT_NAN"}};if(kE(e.value))return{unaryFilter:{field:Dk(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dk(e.field),op:(t=e.op,dk[t]),value:e.value}};var t}(e));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Dk(e.field),direction:(e=e.dir,hk[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);i=t.limit,i=e.D||fE(i)?i:{value:i};return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt=xk(t.startAt)),t.endAt&&(n.structuredQuery.endAt=xk(t.endAt)),n}function Pk(e){let t=Ik(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){L0(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[Fk(e)]:void 0!==e.fieldFilter?[Mk(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):D0():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new GE(Lk(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;n.limit&&(a=function(e){e="object"==typeof e?e.value:e;return fE(e)?null:e}(n.limit));let c=null;n.startAt&&(c=Ok(n.startAt));let l=null;return n.endAt&&(l=Ok(n.endAt)),XE(t,i,o,s,a,"F",c,l)}function xk(e){return{before:e.before,values:e.position}}function Ok(e){var t=!!e.before,e=e.values||[];return new $E(e,t)}function Dk(e){return{fieldPath:e.canonicalString()}}function Lk(e){return iE.fromServerFormat(e.fieldPath)}function Mk(e){return FE.create(Lk(e.fieldFilter.field),function(){switch(e.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return D0()}}(),e.fieldFilter.value)}function Fk(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Lk(e.unaryFilter.field);return FE.create(t,"==",{doubleValue:NaN});case"IS_NULL":t=Lk(e.unaryFilter.field);return FE.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Lk(e.unaryFilter.field);return FE.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Lk(e.unaryFilter.field);return FE.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return D0()}}function Uk(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function jk(t){let n="";for(let e=0;e<t.length;e++)0<n.length&&(n=qk(n)),n=function(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e),n);return qk(n)}function qk(e){return e+""}function Vk(n){const r=n.length;if(L0(2<=r),2===r)return L0(""===n.charAt(0)&&""===n.charAt(1)),nE.emptyPath();const i=r-2,s=[];let o="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>i)&&D0(),n.charAt(r+1)){case"":const i=n.substring(t,r);let e;0===o.length?e=i:(o+=i,e=o,o=""),s.push(e);break;case"":o+=n.substring(t,r),o+="\0";break;case"":o+=n.substring(t,r+1);break;default:D0()}t=r+2}return new nE(s)}class Bk{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Kk{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}Kk.store="owner",Kk.key="owner";class zk{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}zk.store="mutationQueues",zk.keyPath="userId";class Wk{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}Wk.store="mutations",Wk.keyPath="batchId",Wk.userMutationsIndex="userMutationsIndex",Wk.userMutationsKeyPath=["userId","batchId"];class $k{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,jk(t)]}static key(e,t,n){return[e,jk(t),n]}}$k.store="documentMutations",$k.PLACEHOLDER=new $k;class Hk{constructor(e,t){this.path=e,this.readTime=t}}class Gk{constructor(e,t){this.path=e,this.version=t}}class Qk{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}Qk.store="remoteDocuments",Qk.readTimeIndex="readTimeIndex",Qk.readTimeIndexPath="readTime",Qk.collectionReadTimeIndex="collectionReadTimeIndex",Qk.collectionReadTimeIndexPath=["parentPath","readTime"];class Yk{constructor(e){this.byteSize=e}}Yk.store="remoteDocumentGlobal",Yk.key="remoteDocumentGlobalKey";class Jk{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}Jk.store="targets",Jk.keyPath="targetId",Jk.queryTargetsIndexName="queryTargetsIndex",Jk.queryTargetsKeyPath=["canonicalId","targetId"];class Xk{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}Xk.store="targetDocuments",Xk.keyPath=["targetId","path"],Xk.documentTargetsIndex="documentTargetsIndex",Xk.documentTargetsKeyPath=["path","targetId"];class Zk{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}Zk.key="targetGlobalKey",Zk.store="targetGlobal";class eC{constructor(e,t){this.collectionId=e,this.parent=t}}eC.store="collectionParents",eC.keyPath=["collectionId","parent"];class tC{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}tC.store="clientMetadata",tC.keyPath="clientId";class nC{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}nC.store="bundles",nC.keyPath="bundleId";class rC{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}rC.store="namedQueries",rC.keyPath="name";const iC=[zk.store,Wk.store,$k.store,Qk.store,Jk.store,Kk.store,Zk.store,Xk.store,tC.store,Yk.store,eC.store,nC.store,rC.store],sC="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oC{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class aC{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&D0(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new aC((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof aC?t:aC.resolve(t)}catch(e){return aC.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):aC.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):aC.reject(t)}static resolve(n){return new aC((e,t)=>{e(n)})}static reject(n){return new aC((e,t)=>{t(n)})}static waitFor(e){return new aC((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=aC.resolve(!1);for(const n of e)t=t.next(e=>e?aC.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class cC{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Tt=new U0,this.transaction.oncomplete=()=>{this.Tt.resolve()},this.transaction.onabort=()=>{e.error?this.Tt.reject(new hC(t,e.error)):this.Tt.resolve()},this.transaction.onerror=e=>{e=mC(e.target.error);this.Tt.reject(new hC(t,e))}}static open(e,t,n,r){try{return new cC(t,e.transaction(r,n))}catch(e){throw new hC(t,e)}}get It(){return this.Tt.promise}abort(e){e&&this.Tt.reject(e),this.aborted||(R0("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){e=this.transaction.objectStore(e);return new fC(e)}}class lC{constructor(e,t,n){this.name=e,this.version=t,this.At=n,12.2===lC.Rt(fs())&&P0("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R0("SimpleDb","Removing database:",e),pC(window.indexedDB.deleteDatabase(e)).toPromise()}static Pt(){if("undefined"==typeof indexedDB)return!1;if(lC.bt())return!0;const e=fs(),t=lC.Rt(e),n=0<t&&t<10,r=lC.vt(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static bt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,t){return e.store(t)}static Rt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(i){return this.db||(R0("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result;t(e)},r.onblocked=()=>{n(new hC(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new F0(M0.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new hC(i,e))},r.onupgradeneeded=e=>{R0("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.At.Ct(t,r.transaction,e.oldVersion,this.version).next(()=>{R0("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Nt&&(this.db.onversionchange=e=>this.Nt(e)),this.db}xt(t){this.Nt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Dt(e);const t=cC.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch(e=>(t.abort(e),aC.reject(e))).toPromise();return s.catch(()=>{}),await t.It,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(R0("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class uC{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return pC(this.kt.delete())}}class hC extends F0{constructor(e,t){super(M0.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function dC(e){return"IndexedDbTransactionError"===e.name}class fC{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(R0("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(R0("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),pC(n)}add(e){return R0("SimpleDb","ADD",this.store.name,e,e),pC(this.store.add(e))}get(t){return pC(this.store.get(t)).next(e=>(R0("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return R0("SimpleDb","DELETE",this.store.name,e),pC(this.store.delete(e))}count(){return R0("SimpleDb","COUNT",this.store.name),pC(this.store.count())}Lt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Bt(n,(e,t)=>{r.push(t)}).next(()=>r)}Ut(e,t){R0("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.qt=!1;t=this.cursor(n);return this.Bt(t,(e,t,n)=>n.delete())}Kt(e,t){let n;t?n=e:(n={},t=e);e=this.cursor(n);return this.Bt(e,t)}jt(r){const e=this.cursor({});return new aC((n,t)=>{e.onerror=e=>{e=mC(e.target.error);t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}Bt(e,s){const o=[];return new aC((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new uC(t),r=s(t.primaryKey,t.value,n);if(r instanceof aC){const e=r.catch(e=>(n.done(),aC.reject(e)));o.push(e)}n.isDone?i():null===n.Ft?t.continue():t.continue(n.Ft)}else i()}}).next(()=>aC.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function pC(e){return new aC((t,n)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=mC(e.target.error);n(e)}})}let gC=!1;function mC(e){const t=lC.Rt(fs());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new F0("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return gC||(gC=!0,setTimeout(()=>{throw e},0)),e}}return e}class yC extends oC{constructor(e,t){super(),this.Qt=e,this.currentSequenceNumber=t}}function vC(e,t){return lC.St(e.Qt,t)}class _C{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&PS(r,t,n[e])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&xS(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&xS(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(J0.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ek())}isEqual(e){return this.batchId===e.batchId&&G0(this.mutations,e.mutations,(e,t)=>OS(e,t))&&G0(this.baseMutations,e.baseMutations,(e,t)=>OS(e,t))}}class wC{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){L0(e.mutations.length===n.length);let r=XS;var i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new wC(e,t,n,r)}}class bC{constructor(e,t,n,r,i=J0.min(),s=J0.min(),o=oE.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new bC(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new bC(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new bC(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class IC{constructor(e){this.Wt=e}}function TC(e,t){if(t.document)return kk(e.Wt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=mE.fromSegments(t.noDocument.path),n=AC(t.noDocument.readTime),r=PE.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=mE.fromSegments(t.unknownDocument.path),i=AC(t.unknownDocument.version);return PE.newUnknownDocument(e,i)}return D0()}function EC(e,t,n){var r=SC(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){const s={name:_k(n=e.Wt,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:pk(n,e.version.toTimestamp())},o=t.hasCommittedMutations;return new Qk(null,null,s,o,r,i)}if(t.isNoDocument()){const a=t.key.path.toArray(),s=CC(t.version),c=t.hasCommittedMutations;return new Qk(null,new Hk(a,s),null,c,r,i)}if(t.isUnknownDocument()){const a=t.key.path.toArray(),s=CC(t.version);return new Qk(new Gk(a,s),null,null,!0,r,i)}return D0()}function SC(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function kC(e){e=new Y0(e[0],e[1]);return J0.fromTimestamp(e)}function CC(e){e=e.toTimestamp();return new Bk(e.seconds,e.nanoseconds)}function AC(e){e=new Y0(e.seconds,e.nanoseconds);return J0.fromTimestamp(e)}function NC(t,n){const r=(n.baseMutations||[]).map(e=>Ak(t.Wt,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const i=n.mutations[e+1];r.updateTransforms=i.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const i=n.mutations.map(e=>Ak(t.Wt,e)),e=Y0.fromMillis(n.localWriteTimeMs);return new _C(n.batchId,e,r,i)}function RC(e){var t,n=AC(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?AC(e.lastLimboFreeSnapshotVersion):J0.min();let i;return i=void 0!==e.query.documents?(L0(1===(t=e.query).documents.length),oS(ZE(Ik(t.documents[0])))):oS(Pk(e.query)),new bC(i,e.targetId,0,e.lastListenSequenceNumber,n,r,oE.fromBase64String(e.resumeToken))}function PC(e,t){var n=CC(t.snapshotVersion),r=CC(t.lastLimboFreeSnapshotVersion),i=(ME(t.target)?Nk:Rk)(e.Wt,t.target),e=t.resumeToken.toBase64();return new Jk(t.targetId,DE(t.target),n,e,t.sequenceNumber,r,i)}function xC(e){var t=Pk({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?aS(t,t.limit,"L"):t}class OC{getBundleMetadata(e,t){return DC(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:AC(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return DC(e).put({bundleId:(t=t).id,createTime:CC(mk(t.createTime)),version:t.version})}getNamedQuery(e,t){return LC(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:xC(e.bundledQuery),readTime:AC(e.readTime)}})}saveNamedQuery(e,t){return LC(e).put({name:(t=t).name,readTime:CC(mk(t.readTime)),bundledQuery:t.bundledQuery})}}function DC(e){return vC(e,nC.store)}function LC(e){return vC(e,rC.store)}class MC{constructor(){this.Gt=new FC}addToCollectionParentIndex(e,t){return this.Gt.add(t),aC.resolve()}getCollectionParents(e,t){return aC.resolve(this.Gt.getEntries(t))}}class FC{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new GS(nE.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new GS(nE.comparator)).toArray()}}class UC{constructor(){this.zt=new FC}addToCollectionParentIndex(e,t){if(this.zt.has(t))return aC.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.zt.add(t)});r={collectionId:n,parent:jk(r)};return jC(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Q0(n),""],!1,!0);return jC(e).Lt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(Vk(t.parent))}return r})}}function jC(e){return vC(e,eC.store)}const qC={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class VC{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new VC(e,VC.DEFAULT_COLLECTION_PERCENTILE,VC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function BC(e,t,n){const r=e.store(Wk.store),i=e.store($k.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Kt({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{L0(1===a)}));const l=[];for(const e of n.mutations){const r=$k.key(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return aC.waitFor(s).next(()=>l)}function KC(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw D0();t=e.noDocument}return JSON.stringify(t).length}VC.DEFAULT_COLLECTION_PERCENTILE=10,VC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,VC.DEFAULT=new VC(41943040,VC.DEFAULT_COLLECTION_PERCENTILE,VC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),VC.DISABLED=new VC(-1,0,0);class zC{constructor(e,t,n,r){this.userId=e,this.N=t,this.Ht=n,this.referenceDelegate=r,this.Jt={}}static Yt(e,t,n,r){L0(""!==e.uid);e=e.isAuthenticated()?e.uid:"";return new zC(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $C(e).Kt({index:Wk.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,f){const p=HC(u),g=$C(u);return g.add({}).next(e=>{L0("number"==typeof e);const t=new _C(e,h,d,f),n=(i=this.N,s=this.userId,o=t,a=o.baseMutations.map(e=>Ck(i.Wt,e)),c=o.mutations.map(e=>Ck(i.Wt,e)),new Wk(s,o.batchId,o.localWriteTime.toMillis(),a,c)),r=[];var i,s,o,a,c;let l=new GS((e,t)=>H0(e.canonicalString(),t.canonicalString()));for(const u of f){const h=$k.key(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(p.put(h,$k.PLACEHOLDER))}return l.forEach(e=>{r.push(this.Ht.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.Jt[e]=t.keys()}),aC.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return $C(e).get(t).next(e=>e?(L0(e.userId===this.userId),NC(this.N,e)):null)}Xt(e,t){return this.Jt[t]?aC.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){e=e.keys();return this.Jt[t]=e}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return $C(e).Kt({index:Wk.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(L0(t.batchId>=r),i=NC(this.N,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return $C(e).Kt({index:Wk.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return $C(e).Lt(Wk.userMutationsIndex,t).next(e=>e.map(e=>NC(this.N,e)))}getAllMutationBatchesAffectingDocumentKey(s,o){const e=$k.prefixForPath(this.userId,o.path),t=IDBKeyRange.lowerBound(e),a=[];return HC(s).Kt({range:t},(e,t,n)=>{var[r,i,e]=e,i=Vk(i);if(r===this.userId&&o.path.isEqual(i))return $C(s).get(e).next(e=>{if(!e)throw D0();L0(e.userId===this.userId),a.push(NC(this.N,e))});n.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new GS(H0);const n=[];return e.forEach(s=>{var e=$k.prefixForPath(this.userId,s.path),e=IDBKeyRange.lowerBound(e),e=HC(t).Kt({range:e},(e,t,n)=>{var[r,i,e]=e,i=Vk(i);r===this.userId&&s.path.isEqual(i)?o=o.add(e):n.done()});n.push(e)}),aC.waitFor(n).next(()=>this.Zt(t,o))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,o=s.length+1,n=$k.prefixForPath(this.userId,s),r=IDBKeyRange.lowerBound(n);let a=new GS(H0);return HC(e).Kt({range:r},(e,t,n)=>{var[r,i,e]=e,i=Vk(i);r===this.userId&&s.isPrefixOf(i)?i.length===o&&(a=a.add(e)):n.done()}).next(()=>this.Zt(e,a))}Zt(t,e){const n=[],r=[];return e.forEach(e=>{r.push($C(t).get(e).next(e=>{if(null===e)throw D0();L0(e.userId===this.userId),n.push(NC(this.N,e))}))}),aC.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return BC(t.Qt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.te(n.batchId)}),aC.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}te(e){delete this.Jt[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return aC.resolve();const t=IDBKeyRange.lowerBound($k.prefixForUser(this.userId)),r=[];return HC(n).Kt({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=Vk(e[1]);r.push(t)}else n.done()}).next(()=>{L0(0===r.length)})})}containsKey(e,t){return WC(e,this.userId,t)}ee(e){return GC(e).get(this.userId).next(e=>e||new zk(this.userId,-1,""))}}function WC(e,i,t){const n=$k.prefixForPath(i,t.path),s=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return HC(e).Kt({range:r,qt:!0},(e,t,n)=>{var[r,e]=e;r===i&&e===s&&(o=!0),n.done()}).next(()=>o)}function $C(e){return vC(e,Wk.store)}function HC(e){return vC(e,$k.store)}function GC(e){return vC(e,zk.store)}class QC{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new QC(0)}static ie(){return new QC(-1)}}class YC{constructor(e,t){this.referenceDelegate=e,this.N=t}allocateTargetId(n){return this.re(n).next(e=>{const t=new QC(e.highestTargetId);return e.highestTargetId=t.next(),this.oe(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(e=>J0.fromTimestamp(new Y0(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.re(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.oe(t,e)))}addTargetData(t,n){return this.ae(t,n).next(()=>this.re(t).next(e=>(e.targetCount+=1,this.ce(n,e),this.oe(t,e))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>JC(t).delete(e.targetId)).next(()=>this.re(t)).next(e=>(L0(0<e.targetCount),--e.targetCount,this.oe(t,e)))}removeTargets(n,r,i){let s=0;const o=[];return JC(n).Kt((e,t)=>{t=RC(t);t.sequenceNumber<=r&&null===i.get(t.targetId)&&(s++,o.push(this.removeTargetData(n,t)))}).next(()=>aC.waitFor(o)).next(()=>s)}forEachTarget(e,n){return JC(e).Kt((e,t)=>{t=RC(t);n(t)})}re(e){return XC(e).get(Zk.key).next(e=>(L0(null!==e),e))}oe(e,t){return XC(e).put(Zk.key,t)}ae(e,t){return JC(e).put(PC(this.N,t))}ce(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.re(e).next(e=>e.targetCount)}getTargetData(e,r){var t=DE(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return JC(e).Kt({range:t,index:Jk.queryTargetsIndexName},(e,t,n)=>{t=RC(t);LE(r,t.target)&&(i=t,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const i=[],s=ZC(n);return e.forEach(e=>{var t=jk(e.path);i.push(s.put(new Xk(r,t))),i.push(this.referenceDelegate.addReference(n,r,e))}),aC.waitFor(i)}removeMatchingKeys(n,e,r){const i=ZC(n);return aC.forEach(e,e=>{var t=jk(e.path);return aC.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=ZC(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ZC(e);let i=ek();return r.Kt({range:n,qt:!0},(e,t,n)=>{e=Vk(e[1]),e=new mE(e);i=i.add(e)}).next(()=>i)}containsKey(e,t){t=jk(t.path),t=IDBKeyRange.bound([t],[Q0(t)],!1,!0);let r=0;return ZC(e).Kt({index:Xk.documentTargetsIndex,qt:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}Et(e,t){return JC(e).get(t).next(e=>e?RC(e):null)}}function JC(e){return vC(e,Jk.store)}function XC(e){return vC(e,Zk.store)}function ZC(e){return vC(e,Xk.store)}async function eA(e){if(e.code!==M0.FAILED_PRECONDITION||e.message!==sC)throw e;R0("LocalStore","Unexpectedly lost primary lease")}function tA([e,t],[n,r]){n=H0(e,n);return 0===n?H0(t,r):n}class nA{constructor(e){this.ue=e,this.buffer=new GS(tA),this.he=0}le(){return++this.he}fe(e){e=[e,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();tA(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class rA{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){var t=this.de?3e5:6e4;R0("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.we=null,this.de=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){dC(e)?R0("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await eA(e)}await this._e(e)})}}class iA{constructor(e,t){this.me=e,this.params=t}calculateTargetCount(e,t){return this.me.ge(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return aC.resolve(W0.T);const n=new nA(t);return this.me.forEachTarget(e,e=>n.fe(e.sequenceNumber)).next(()=>this.me.ye(e,e=>n.fe(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.me.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.me.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(R0("LruGarbageCollector","Garbage collection skipped; disabled"),aC.resolve(qC)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(R0("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qC):this.pe(t,n))}getCacheSize(e){return this.me.getCacheSize(e)}pe(t,n){let r,i,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(R0("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),N0()<=fo.DEBUG&&R0("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${s} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),aC.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class sA{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new iA(e,t))}ge(e){const n=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Ee(e){let t=0;return this.ye(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ye(e,n){return this.Te(e,(e,t)=>n(t))}addReference(e,t,n){return oA(e,n)}removeReference(e,t,n){return oA(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return oA(e,t)}Ie(t,n){let r=!1;return GC(t).jt(e=>WC(t,e,n).next(e=>(e&&(r=!0),aC.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let o=0;return this.Te(n,(t,e)=>{if(e<=r){const r=this.Ie(n,t).next(e=>{if(!e)return o++,i.getEntry(n,t).next(()=>(i.removeEntry(t),ZC(n).delete([0,jk(t.path)])))});s.push(r)}}).next(()=>aC.waitFor(s)).next(()=>i.apply(n)).next(()=>o)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return oA(e,t)}Te(e,r){const t=ZC(e);let i,s=W0.T;return t.Kt({index:Xk.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==W0.T&&r(new mE(Vk(i)),s),s=n,i=t):s=W0.T}).next(()=>{s!==W0.T&&r(new mE(Vk(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oA(e,t){return ZC(e).put((t=t,e=e.currentSequenceNumber,new Xk(0,jk(t.path),e)))}class aA{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),!0;return!1}forEach(r){Z0(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return eE(this.inner)}}class cA{constructor(){this.changes=new aA(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){e=this.changes.get(e);return e?e.readTime:J0.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:PE.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?aC.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lA{constructor(e,t){this.N=e,this.Ht=t}addEntry(e,t,n){return dA(e).put(fA(t),n)}removeEntry(e,t){const n=dA(e),r=fA(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Ae(t,e)))}getEntry(e,t){return dA(e).get(fA(t)).next(e=>this.Re(t,e))}Pe(e,t){return dA(e).get(fA(t)).next(e=>({document:this.Re(t,e),size:KC(e)}))}getEntries(e,t){let n=YS;return this.be(e,t,(e,t)=>{t=this.Re(e,t);n=n.insert(e,t)}).next(()=>n)}ve(e,t){let r=YS,i=new WS(mE.comparator);return this.be(e,t,(e,t)=>{var n=this.Re(e,t);r=r.insert(e,n),i=i.insert(e,KC(t))}).next(()=>({documents:r,Ve:i}))}be(e,t,i){if(t.isEmpty())return aC.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),s=t.getIterator();let o=s.getNext();return dA(e).Kt({range:n},(e,t,n)=>{for(var r=mE.fromSegments(e);o&&mE.comparator(o,r)<0;)i(o,null),o=s.getNext();o&&o.isEqual(r)&&(i(o,t),o=s.hasNext()?s.getNext():null),o?n.Mt(o.path.toArray()):n.done()}).next(()=>{for(;o;)i(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t){let i=YS;const s=r.path.length+1,n={};if(t.isEqual(J0.min())){const e=r.path.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=r.path.toArray(),i=SC(t);n.range=IDBKeyRange.lowerBound([e,i],!0),n.index=Qk.collectionReadTimeIndex}return dA(e).Kt(n,(e,t,n)=>{e.length===s&&(t=TC(this.N,t),r.path.isPrefixOf(t.key.path)?hS(r,t)&&(i=i.insert(t.key,t)):n.done())}).next(()=>i)}newChangeBuffer(e){return new uA(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return hA(e).get(Yk.key).next(e=>(L0(!!e),e))}Ae(e,t){return hA(e).put(Yk.key,t)}Re(e,t){if(t){const e=TC(this.N,t);if(!e.isNoDocument()||!e.version.isEqual(J0.min()))return e}return PE.newInvalidDocument(e)}}class uA extends cA{constructor(e,t){super(),this.Se=e,this.trackRemovals=t,this.De=new aA(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const s=[];let o=0,a=new GS((e,t)=>H0(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.De.get(e);if(t.document.isValidDocument()){var r=EC(this.Se.N,t.document,this.getReadTime(e));a=a.add(e.path.popLast());t=KC(r);o+=t-n,s.push(this.Se.addEntry(i,e,r))}else if(o-=n,this.trackRemovals){const o=EC(this.Se.N,PE.newNoDocument(e,J0.min()),this.getReadTime(e));s.push(this.Se.addEntry(i,e,o))}else s.push(this.Se.removeEntry(i,e))}),a.forEach(e=>{s.push(this.Se.Ht.addToCollectionParentIndex(i,e))}),s.push(this.Se.updateMetadata(i,o)),aC.waitFor(s)}getFromCache(e,t){return this.Se.Pe(e,t).next(e=>(this.De.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Se.ve(e,t).next(({documents:e,Ve:t})=>(t.forEach((e,t)=>{this.De.set(e,t)}),e))}}function hA(e){return vC(e,Yk.store)}function dA(e){return vC(e,Qk.store)}function fA(e){return e.path.toArray()}class pA{constructor(e){this.N=e}Ct(t,n,e,r){L0(e<r&&0<=e&&r<=11);const i=new cC("createOrUpgrade",n);var s;e<1&&1<=r&&(t.createObjectStore(Kk.store),(s=t).createObjectStore(zk.store,{keyPath:zk.keyPath}),s.createObjectStore(Wk.store,{keyPath:Wk.keyPath,autoIncrement:!0}).createIndex(Wk.userMutationsIndex,Wk.userMutationsKeyPath,{unique:!0}),s.createObjectStore($k.store),gA(t),t.createObjectStore(Qk.store));let o=aC.resolve();return e<3&&3<=r&&(0!==e&&((s=t).deleteObjectStore(Xk.store),s.deleteObjectStore(Jk.store),s.deleteObjectStore(Zk.store),gA(t)),o=o.next(()=>function(){const e=i.store(Zk.store),t=new Zk(0,0,J0.min().toTimestamp(),0);return e.put(Zk.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,i){return i.store(Wk.store).Lt().next(e=>{r.deleteObjectStore(Wk.store),r.createObjectStore(Wk.store,{keyPath:Wk.keyPath,autoIncrement:!0}).createIndex(Wk.userMutationsIndex,Wk.userMutationsKeyPath,{unique:!0});const t=i.store(Wk.store),n=e.map(e=>t.put(e));return aC.waitFor(n)})}(t,i))),o=o.next(()=>{t.createObjectStore(tC.store,{keyPath:tC.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.Ce(i))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(Yk.store),this.Ne(i)))),e<7&&7<=r&&(o=o.next(()=>this.xe(i))),e<8&&8<=r&&(o=o.next(()=>this.ke(t,i))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(Qk.store);e.createIndex(Qk.readTimeIndex,Qk.readTimeIndexPath,{unique:!1}),e.createIndex(Qk.collectionReadTimeIndex,Qk.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.$e(i))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(nC.store,{keyPath:nC.keyPath}),t.createObjectStore(rC.store,{keyPath:rC.keyPath})})),o}Ne(t){let n=0;return t.store(Qk.store).Kt((e,t)=>{n+=KC(t)}).next(()=>{var e=new Yk(n);return t.store(Yk.store).put(Yk.key,e)})}Ce(n){const e=n.store(zk.store),r=n.store(Wk.store);return e.Lt().next(e=>aC.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.Lt(Wk.userMutationsIndex,e).next(e=>aC.forEach(e,e=>{L0(e.userId===t.userId);e=NC(this.N,e);return BC(n,t.userId,e).next(()=>{})}))}))}xe(e){const o=e.store(Xk.store),t=e.store(Qk.store);return e.store(Zk.store).get(Zk.key).next(i=>{const s=[];return t.Kt((e,t)=>{const n=new nE(e),r=[0,jk(n)];s.push(o.get(r).next(e=>e?aC.resolve():(e=>o.put(new Xk(0,jk(e),i.highestListenSequenceNumber)))(n)))}).next(()=>aC.waitFor(s))})}ke(e,t){e.createObjectStore(eC.store,{keyPath:eC.keyPath});const n=t.store(eC.store),r=new FC,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:jk(r)})}};return t.store(Qk.store).Kt({qt:!0},(e,t)=>{const n=new nE(e);return i(n.popLast())}).next(()=>t.store($k.store).Kt({qt:!0},([,e],t)=>{const n=Vk(e);return i(n.popLast())}))}$e(e){const n=e.store(Jk.store);return n.Kt((e,t)=>{t=RC(t),t=PC(this.N,t);return n.put(t)})}}function gA(e){e.createObjectStore(Xk.store,{keyPath:Xk.keyPath}).createIndex(Xk.documentTargetsIndex,Xk.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Jk.store,{keyPath:Jk.keyPath}).createIndex(Jk.queryTargetsIndexName,Jk.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Zk.store)}const mA="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yA{constructor(e,t,n,r,i,s,o,a,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Oe=i,this.window=s,this.document=o,this.Fe=c,this.Me=l,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=e=>Promise.resolve(),!yA.Pt())throw new F0(M0.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sA(this,r),this.We=t+"main",this.N=new IC(a),this.Ge=new lC(this.We,11,new pA(this.N)),this.ze=new YC(this.referenceDelegate,this.N),this.Ht=new UC,this.He=(t=this.N,a=this.Ht,new lA(t,a)),this.Je=new OC,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===l&&P0("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new F0(M0.FAILED_PRECONDITION,mA);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new W0(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(t){return this.Qe=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ge.xt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget(async()=>{this.started&&await this.Xe()}))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>_A(t).put(new tC(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(t).next(e=>{e||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(t)).next(e=>this.isPrimary&&!e?this.on(t).next(()=>!1):!!e&&this.an(t).next(()=>!0))).catch(e=>{if(dC(e))return R0("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R0("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return vA(e).get(Kk.key).next(e=>aC.resolve(this.cn(e)))}un(e){return _A(e).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=vC(e,tC.store);return r.Lt().next(e=>{const t=this.fn(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return aC.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ye)for(const t of e)this.Ye.removeItem(this.dn(t.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(e){return!!e&&e.ownerId===this.clientId}rn(t){return this.Me?aC.resolve(!0):vA(t).get(Kk.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)){if(this.cn(e)&&this.networkEnabled)return!0;if(!this.cn(e)){if(!e.allowTabSynchronization)throw new F0(M0.FAILED_PRECONDITION,mA);return!1}}return!(!this.networkEnabled||!this.inForeground)||_A(t).Lt().next(e=>void 0===this.fn(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&R0("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[Kk.store,tC.store],e=>{const t=new yC(e,W0.T);return this.on(t).next(()=>this.un(t))}),this.Ge.close(),this.yn()}fn(e,t){return e.filter(e=>this.ln(e.updateTimeMs,t)&&!this.wn(e.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>_A(e).Lt().next(e=>this.fn(e,18e5).map(e=>e.clientId)))}get started(){return this.Be}getMutationQueue(e){return zC.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(t,n,r){R0("IndexedDbPersistence","Starting transaction:",t);let i;return this.Ge.runTransaction(t,"readonly"===n?"readonly":"readwrite",iC,e=>(i=new yC(e,this.Le?this.Le.next():W0.T),"readwrite-primary"===n?this.sn(i).next(e=>!!e||this.rn(i)).next(e=>{if(!e)throw P0(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new F0(M0.FAILED_PRECONDITION,sC);return r(i)}).next(e=>this.an(i).next(()=>e)):this.En(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}En(e){return vA(e).get(Kk.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)&&!this.cn(e)&&!(this.Me||this.allowTabSynchronization&&e.allowTabSynchronization))throw new F0(M0.FAILED_PRECONDITION,mA)})}an(e){var t=new Kk(this.clientId,this.allowTabSynchronization,Date.now());return vA(e).put(Kk.key,t)}static Pt(){return lC.Pt()}on(e){const t=vA(e);return t.get(Kk.key).next(e=>this.cn(e)?(R0("IndexedDbPersistence","Releasing primary lease."),t.delete(Kk.key)):aC.resolve())}ln(e,t){var n=Date.now();return!(e<n-t||n<e&&(P0(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),!gs()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var t;try{var n=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return R0("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return P0("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(e){P0("Failed to set zombie client id.",e)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(e){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function vA(e){return vC(e,Kk.store)}function _A(e){return vC(e,tC.store)}function wA(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class bA{constructor(e,t){this.progress=e,this.Tn=t}}class IA{constructor(e,t,n){this.He=e,this.In=t,this.Ht=n}An(t,n){return this.In.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.Rn(t,n,e))}Rn(e,t,n){return this.He.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Pn(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}bn(t,e){return this.He.getEntries(t,e).next(e=>this.vn(t,e).next(()=>e))}vn(e,t){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Pn(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,mE.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Vn(e,t.path):iS(t)?this.Sn(e,t,n):this.Dn(e,t,n);var r}Vn(e,t){return this.An(e,new mE(t)).next(e=>{let t=JS;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Sn(n,r,i){const s=r.collectionGroup;let o=JS;return this.Ht.getCollectionParents(n,s).next(e=>aC.forEach(e,e=>{var t,t=(t=r,e=e.child(s),new JE(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.Dn(n,t,i).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}Dn(t,n,e){let i,s;return this.He.getDocumentsMatchingQuery(t,n,e).next(e=>(i=e,this.In.getAllMutationBatchesAffectingQuery(t,n))).next(e=>(s=e,this.Cn(t,s,i).next(t=>{i=t;for(const t of s)for(const r of t.mutations){var n=r.key;let e=i.get(n);null==e&&(e=PE.newInvalidDocument(n),i=i.insert(n,e)),xS(r,e,t.localWriteTime),e.isFoundDocument()||(i=i.remove(n))}}))).next(()=>(i.forEach((e,t)=>{hS(n,t)||(i=i.remove(e))}),i))}Cn(e,t,n){let r=ek();for(const e of t)for(const t of e.mutations)t instanceof MS&&null===n.get(t.key)&&(r=r.add(t.key));let i=n;return this.He.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class TA{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Nn=n,this.xn=r}static kn(e,t){let n=ek(),r=ek();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new TA(e,t.fromCache,n,r)}}class EA{$n(e){this.On=e}getDocumentsMatchingQuery(t,r,i,s){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(J0.min())?this.Fn(t,r):this.On.bn(t,s).next(e=>{const n=this.Mn(r,e);return(eS(r)||tS(r))&&this.Ln(r.limitType,n,s,i)?this.Fn(t,r):(N0()<=fo.DEBUG&&R0("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),uS(r)),this.On.getDocumentsMatchingQuery(t,r,i).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))})}Mn(n,e){let r=new GS(dS(n));return e.forEach((e,t)=>{hS(n,t)&&(r=r.add(t))}),r}Ln(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Fn(e,t){return N0()<=fo.DEBUG&&R0("QueryEngine","Using full collection scan to execute query:",uS(t)),this.On.getDocumentsMatchingQuery(e,t,J0.min())}}class SA{constructor(e,t,n,r){this.persistence=e,this.Bn=t,this.N=r,this.Un=new WS(H0),this.qn=new aA(e=>DE(e),LE),this.Kn=J0.min(),this.In=e.getMutationQueue(n),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new IA(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Un))}}function kA(e,t,n,r){return new SA(e,t,n,r)}async function CA(e,t){const n=e;let r=n.In,o=n.Qn;e=await n.persistence.runTransaction("Handle user change","readonly",i=>{let s;return n.In.getAllMutationBatches(i).next(e=>(s=e,r=n.persistence.getMutationQueue(t),o=new IA(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=ek();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return o.bn(i,r).next(e=>({Wn:e,removedBatchIds:t,addedBatchIds:n}))})});return n.In=r,n.Qn=o,n.Bn.$n(n.Qn),e}function AA(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.ze.getLastRemoteSnapshotVersion(e))}function NA(e,n){const u=e,h=n.snapshotVersion;let d=u.Un;return u.persistence.runTransaction("Apply remote event","readwrite-primary",c=>{const e=u.jn.newChangeBuffer({trackRemovals:!0});d=u.Un;const l=[];n.targetChanges.forEach((e,t)=>{const n=d.get(t);if(n){l.push(u.ze.removeMatchingKeys(c,e.removedDocuments,t).next(()=>u.ze.addMatchingKeys(c,e.addedDocuments,t)));const a=e.resumeToken;var r,i,s,o;0<a.approximateByteSize()&&(r=n.withResumeToken(a,h).withSequenceNumber(c.currentSequenceNumber),d=d.insert(t,r),i=n,o=e,L0(0<(s=r).resumeToken.approximateByteSize()),0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||l.push(u.ze.updateTargetData(c,r)))}});let t=YS;if(n.documentUpdates.forEach((e,t)=>{n.resolvedLimboDocuments.has(e)&&l.push(u.persistence.referenceDelegate.updateLimboDocument(c,e))}),l.push(RA(c,e,n.documentUpdates,h,void 0).next(e=>{t=e})),!h.isEqual(J0.min())){const n=u.ze.getLastRemoteSnapshotVersion(c).next(e=>u.ze.setTargetsMetadata(c,c.currentSequenceNumber,h));l.push(n)}return aC.waitFor(l).next(()=>e.apply(c)).next(()=>u.Qn.vn(c,t)).next(()=>t)}).then(e=>(u.Un=d,e))}function RA(e,o,t,a,c){let n=ek();return t.forEach(e=>n=n.add(e)),o.getEntries(e,n).next(i=>{let s=YS;return t.forEach((e,t)=>{const n=i.get(e),r=(null==c?void 0:c.get(e))||a;t.isNoDocument()&&t.version.isEqual(J0.min())?(o.removeEntry(e,r),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(o.addEntry(t,r),s=s.insert(e,t)):R0("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),s})}function PA(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.ze.getTargetData(t,r).next(e=>e?(n=e,aC.resolve(n)):i.ze.allocateTargetId(t).next(e=>(n=new bC(r,e,0,t.currentSequenceNumber),i.ze.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Un.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Un=i.Un.insert(e.targetId,e),i.qn.set(r,e.targetId)),e})}async function xA(e,t,n){const r=e,i=r.Un.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!dC(e))throw e;R0("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Un=r.Un.remove(t),r.qn.delete(i.target)}function OA(e,n,r){const i=e;let s=J0.min(),o=ek();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.qn.get(n);return void 0!==i?aC.resolve(r.Un.get(i)):r.ze.getTargetData(t,n)}(i,t,oS(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.ze.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>i.Bn.getDocumentsMatchingQuery(t,n,r?s:J0.min(),r?o:ek())).next(e=>({documents:e,Gn:o})))}function DA(e,t){const n=e,r=n.ze,i=n.Un.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Et(e,t).next(e=>e?e.target:null))}function LA(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let i=YS,s=SC(n);const o=dA(t),a=IDBKeyRange.lowerBound(s,!0);return o.Kt({index:Qk.readTimeIndex,range:a},(e,t)=>{var n=TC(r.N,t);i=i.insert(n.key,n),s=t.readTime}).next(()=>({Tn:i,readTime:kC(s)}))}(n.jn,e,n.Kn)).then(({Tn:e,readTime:t})=>(n.Kn=t,e))}class MA{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return aC.resolve(this.Yn.get(t))}saveBundleMetadata(e,t){return this.Yn.set(t.id,{id:t.id,version:t.version,createTime:mk(t.createTime)}),aC.resolve()}getNamedQuery(e,t){return aC.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,{name:(t=t).name,query:xC(t.bundledQuery),readTime:mk(t.readTime)}),aC.resolve()}}class FA{constructor(){this.Zn=new GS(UA.ts),this.es=new GS(UA.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){t=new UA(e,t);this.Zn=this.Zn.add(t),this.es=this.es.add(t)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new UA(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}cs(e){const t=new mE(new nE([])),n=new UA(t,e),r=new UA(t,e+1),i=[];return this.es.forEachInRange([n,r],e=>{this.rs(e),i.push(e.key)}),i}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){var t=new mE(new nE([])),n=new UA(t,e),e=new UA(t,e+1);let r=ek();return this.es.forEachInRange([n,e],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new UA(e,0),t=this.Zn.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class UA{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return mE.comparator(e.key,t.key)||H0(e.ls,t.ls)}static ns(e,t){return H0(e.ls,t.ls)||mE.comparator(e.key,t.key)}}class jA{constructor(e,t){this.Ht=e,this.referenceDelegate=t,this.In=[],this.fs=1,this.ds=new GS(UA.ts)}checkEmpty(e){return aC.resolve(0===this.In.length)}addMutationBatch(e,t,n,r){var i=this.fs;this.fs++,0<this.In.length&&this.In[this.In.length-1];n=new _C(i,t,n,r);this.In.push(n);for(const t of r)this.ds=this.ds.add(new UA(t.key,i)),this.Ht.addToCollectionParentIndex(e,t.key.path.popLast());return aC.resolve(n)}lookupMutationBatch(e,t){return aC.resolve(this.ws(t))}getNextMutationBatchAfterBatchId(e,t){t=this._s(t+1),t=t<0?0:t;return aC.resolve(this.In.length>t?this.In[t]:null)}getHighestUnacknowledgedBatchId(){return aC.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return aC.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new UA(t,0),r=new UA(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,r],e=>{e=this.ws(e.ls);i.push(e)}),aC.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new GS(H0);return t.forEach(e=>{var t=new UA(e,0),e=new UA(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,e],e=>{n=n.add(e.ls)})}),aC.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;mE.isDocumentKey(i)||(i=i.child(""));t=new UA(new mE(i),0);let s=new GS(H0);return this.ds.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.ls)),!0)},t),aC.resolve(this.gs(s))}gs(e){const t=[];return e.forEach(e=>{e=this.ws(e);null!==e&&t.push(e)}),t}removeMutationBatch(n,r){L0(0===this.ys(r.batchId,"removed")),this.In.shift();let i=this.ds;return aC.forEach(r.mutations,e=>{var t=new UA(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ds=i})}te(e){}containsKey(e,t){var n=new UA(t,0),n=this.ds.firstAfterOrEqual(n);return aC.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.In.length,aC.resolve()}ys(e,t){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){e=this._s(e);return e<0||e>=this.In.length?null:this.In[e]}}class qA{constructor(e,t){this.Ht=e,this.ps=t,this.docs=new WS(mE.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ps(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-s,this.Ht.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return aC.resolve(n?n.document.clone():PE.newInvalidDocument(t))}getEntries(e,t){let n=YS;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():PE.newInvalidDocument(e))}),aC.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=YS;const i=new mE(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||hS(t,i)&&(r=r.insert(i.key,i.clone()))}return aC.resolve(r)}Es(e,t){return aC.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new VA(this)}getSize(e){return aC.resolve(this.size)}}class VA extends cA{constructor(e){super(),this.Se=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.document.isValidDocument()?r.push(this.Se.addEntry(n,t.document,this.getReadTime(e))):this.Se.removeEntry(e)}),aC.waitFor(r)}getFromCache(e,t){return this.Se.getEntry(e,t)}getAllFromCache(e,t){return this.Se.getEntries(e,t)}}class BA{constructor(e){this.persistence=e,this.Ts=new aA(e=>DE(e),LE),this.lastRemoteSnapshotVersion=J0.min(),this.highestTargetId=0,this.Is=0,this.As=new FA,this.targetCount=0,this.Rs=QC.se()}forEachTarget(e,n){return this.Ts.forEach((e,t)=>n(t)),aC.resolve()}getLastRemoteSnapshotVersion(e){return aC.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return aC.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),aC.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),aC.resolve()}ae(e){this.Ts.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new QC(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,aC.resolve()}updateTargetData(e,t){return this.ae(t),aC.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.cs(t.targetId),--this.targetCount,aC.resolve()}removeTargets(n,r,i){let s=0;const o=[];return this.Ts.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Ts.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),aC.waitFor(o).next(()=>s)}getTargetCount(e){return aC.resolve(this.targetCount)}getTargetData(e,t){t=this.Ts.get(t)||null;return aC.resolve(t)}addMatchingKeys(e,t,n){return this.As.ss(t,n),aC.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),aC.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.cs(t),aC.resolve()}getMatchingKeysForTargetId(e,t){t=this.As.hs(t);return aC.resolve(t)}containsKey(e,t){return aC.resolve(this.As.containsKey(t))}}class KA{constructor(e,t){var n;this.Ps={},this.Le=new W0(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new BA(this),this.Ht=new MC,this.He=(n=this.Ht,e=e=>this.referenceDelegate.bs(e),new qA(n,e)),this.N=new IC(t),this.Je=new MA(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new jA(this.Ht,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,t,n){R0("MemoryPersistence","Starting transaction:",e);const r=new zA(this.Le.next());return this.referenceDelegate.vs(),n(r).next(e=>this.referenceDelegate.Vs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ss(t,n){return aC.or(Object.values(this.Ps).map(e=>()=>e.containsKey(t,n)))}}class zA extends oC{constructor(e){super(),this.currentSequenceNumber=e}}class WA{constructor(e){this.persistence=e,this.Ds=new FA,this.Cs=null}static Ns(e){return new WA(e)}get xs(){if(this.Cs)return this.Cs;throw D0()}addReference(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),aC.resolve()}removeReference(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),aC.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),aC.resolve()}removeTarget(e,t){this.Ds.cs(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}vs(){this.Cs=new Set}Vs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return aC.forEach(this.xs,e=>{const t=mE.fromPath(e);return this.ks(n,t).next(e=>{e||r.removeEntry(t)})}).next(()=>(this.Cs=null,r.apply(n)))}updateLimboDocument(e,t){return this.ks(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}bs(e){return 0}ks(e,t){return aC.or([()=>aC.resolve(this.Ds.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ss(e,t)])}}function $A(e,t){return`firestore_clients_${e}_${t}`}function HA(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function GA(e,t){return`firestore_targets_${e}_${t}`}class QA{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new F0(r.error.code,r.error.message))),s?new QA(e,t,r.state,i):(P0("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class YA{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new F0(n.error.code,n.error.message))),i?new YA(e,n.state,r):(P0("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class JA{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=tk;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=gE(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new JA(e,i):(P0("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class XA{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new XA(t.clientId,t.onlineState):(P0("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ZA{constructor(){this.activeTargetIds=tk}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class eN{constructor(e,t,n,r,i){this.window=e,this.Oe=t,this.persistenceKey=n,this.Ls=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new WS(H0),this.started=!1,this.Ks=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.js=$A(this.persistenceKey,this.Ls),this.Qs=`firestore_sequence_number_${this.persistenceKey}`,this.qs=this.qs.insert(this.Ls,new ZA),this.Ws=new RegExp(`^firestore_clients_${n}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${n}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${n}_(\\d+)$`),this.Hs=`firestore_online_state_${this.persistenceKey}`,this.Js=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.Bs)}static Pt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.pn();for(const n of e)if(n!==this.Ls){const e=this.getItem($A(this.persistenceKey,n));var t;!e||(t=JA.$s(n,e))&&(this.qs=this.qs.insert(t.clientId,t))}this.Ys();const n=this.storage.getItem(this.Hs);if(n){const e=this.Xs(n);e&&this.Zs(e)}for(const e of this.Ks)this.Us(e);this.Ks=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(n){let r=!1;return this.qs.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,t,n){this.ei(e,t,n),this.ni(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(GA(this.persistenceKey,e)))||(n=YA.$s(e,n))&&(t=n.state)),this.si.Fs(e),this.Ys(),t}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(GA(this.persistenceKey,e))}updateQueryState(e,t,n){this.ii(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ni(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return R0("SharedClientState","READ",e,t),t}setItem(e,t){R0("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){R0("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){const r=e;r.storageArea===this.storage&&(R0("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.js?this.Oe.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Ws.test(r.key)){if(null==r.newValue){var e=this.ai(r.key);return this.ci(e,null)}e=this.ui(r.key,r.newValue);if(e)return this.ci(e.clientId,e)}else if(this.Gs.test(r.key)){if(null!==r.newValue){var t=this.hi(r.key,r.newValue);if(t)return this.li(t)}}else if(this.zs.test(r.key)){if(null!==r.newValue){t=this.fi(r.key,r.newValue);if(t)return this.di(t)}}else if(r.key===this.Hs){if(null!==r.newValue){var n=this.Xs(r.newValue);if(n)return this.Zs(n)}}else if(r.key===this.Qs){n=function(e){let t=W0.T;if(null!=e)try{var n=JSON.parse(e);L0("number"==typeof n),t=n}catch(e){P0("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue);n!==W0.T&&this.sequenceNumberHandler(n)}else if(r.key===this.Js)return this.syncEngine.wi()}else this.Ks.push(r)}):P0("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,t,n){const r=new QA(this.currentUser,e,t,n),i=HA(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Os())}ni(e){e=HA(this.persistenceKey,this.currentUser,e);this.removeItem(e)}ri(e){e={clientId:this.Ls,onlineState:e};this.storage.setItem(this.Hs,JSON.stringify(e))}ii(e,t,n){const r=GA(this.persistenceKey,e),i=new YA(e,t,n);this.setItem(r,i.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(e){e=this.Ws.exec(e);return e?e[1]:null}ui(e,t){e=this.ai(e);return JA.$s(e,t)}hi(e,t){var n=this.Gs.exec(e),e=Number(n[1]),n=void 0!==n[2]?n[2]:null;return QA.$s(new k0(n),e,t)}fi(e,t){e=this.zs.exec(e),e=Number(e[1]);return YA.$s(e,t)}Xs(e){return XA.$s(e)}async li(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine._i(e.batchId,e.state,e.error);R0("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ci(e,t){const n=t?this.qs.insert(e,t):this.qs.remove(e),r=this.ti(this.qs),i=this.ti(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.gi(s,o).then(()=>{this.qs=n})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let n=tk;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class tN{constructor(){this.yi=new ZA,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,t,n){this.pi[e]=t}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new ZA,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class nN{Ei(e){}shutdown(){}}class rN{constructor(){this.Ti=()=>this.Ii(),this.Ai=()=>this.Ri(),this.Pi=[],this.bi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ti),window.removeEventListener("offline",this.Ai)}bi(){window.addEventListener("online",this.Ti),window.addEventListener("offline",this.Ai)}Ii(){R0("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}Ri(){R0("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const iN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class sN{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class oN extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.Fi=t+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(t,e,n,r){const i=this.Bi(t,e);R0("RestConnection","Sending: ",i,n);e={};return this.Ui(e,r),this.qi(t,i,e,n).then(e=>(R0("RestConnection","Received: ",e),e),e=>{throw x0("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}Ki(e,t,n,r){return this.Li(e,t,n,r)}Ui(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+C0,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}Bi(e,t){e=iN[e];return`${this.Fi}/v1/${t}:${e}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(a,t,n,r){return new Promise((i,s)=>{const o=new S0;o.listenOnce(_0.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case v0.NO_ERROR:var e=o.getResponseJson();R0("Connection","XHR received:",JSON.stringify(e)),i(e);break;case v0.TIMEOUT:R0("Connection",'RPC "'+a+'" timed out'),s(new F0(M0.DEADLINE_EXCEEDED,"Request time out"));break;case v0.HTTP_ERROR:var t,n=o.getStatus();if(R0("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(M0).indexOf(r)?r:M0.UNKNOWN,s(new F0(t,a.message))):s(new F0(M0.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new F0(M0.UNAVAILABLE,"Connection failed."));break;default:D0()}}finally{R0("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}ji(e,t){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=new h0,i=y0(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new T0({})),this.Ui(s.initMessageHeaders,t),ps()||ys()||0<=fs().indexOf("Electron/")||vs()||0<=fs().indexOf("MSAppHost/")||ms()||(s.httpHeadersOverwriteParam="$httpHeaders");t=n.join("");R0("Connection","Creating WebChannel: "+t,s);const o=r.createWebChannel(t,s);let a=!1,c=!1;const l=new sN({vi:e=>{c?R0("Connection","Not sending because WebChannel is closed:",e):(a||(R0("Connection","Opening WebChannel transport."),o.open(),a=!0),R0("Connection","WebChannel sending:",e),o.send(e))},Vi:()=>o.close()}),u=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return u(o,E0.EventType.OPEN,()=>{c||R0("Connection","WebChannel transport opened.")}),u(o,E0.EventType.CLOSE,()=>{c||(c=!0,R0("Connection","WebChannel transport closed"),l.$i())}),u(o,E0.EventType.ERROR,e=>{c||(c=!0,x0("Connection","WebChannel transport errored:",e),l.$i(new F0(M0.UNAVAILABLE,"The operation could not be completed")))}),u(o,E0.EventType.MESSAGE,e=>{if(!c){e=e.data[0];L0(!!e);var n=e.error||(null===(n=e[0])||void 0===n?void 0:n.error);if(n){R0("Connection","WebChannel received error:",n);const r=n.status;let e=function(e){e=m0[e];if(void 0!==e)return zS(e)}(r),t=n.message;void 0===e&&(e=M0.INTERNAL,t="Unknown error status: "+r+" with message "+n.message),c=!0,l.$i(new F0(e,t)),o.close()}else R0("Connection","WebChannel received:",e),l.Oi(e)}}),u(i,w0.STAT_EVENT,e=>{e.stat===b0?R0("Connection","Detected buffering proxy"):e.stat===I0&&R0("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.ki()},0),l}}function aN(){return"undefined"!=typeof window?window:null}function cN(){return"undefined"!=typeof document?document:null}function lN(e){return new fk(e,!0)}class uN{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Oe=e,this.timerId=t,this.Qi=n,this.Wi=r,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();var t=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),r=Math.max(0,t-n);0<r&&R0("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.zi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,r,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class hN{constructor(e,t,n,r,i,s){this.Oe=e,this.er=n,this.nr=r,this.credentialsProvider=i,this.listener=s,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new uN(e,t)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}async stop(){this.ar()&&await this.close(0)}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(e){this._r(),this.stream.send(e)}async dr(){if(this.cr())return this.close(0)}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}async close(e,t){this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():t&&t.code===M0.RESOURCE_EXHAUSTED?(P0(t.toString()),P0("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):t&&t.code===M0.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ci(t)}mr(){}auth(){this.state=1;const e=this.gr(this.sr),t=this.sr;this.credentialsProvider.getToken().then(e=>{this.sr===t&&this.yr(e)},t=>{e(()=>{var e=new F0(M0.UNKNOWN,"Fetching auth token failed: "+t.message);return this.pr(e)})})}yr(e){const t=this.gr(this.sr);this.stream=this.Er(e),this.stream.Si(()=>{t(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(e=>{t(()=>this.pr(e))}),this.stream.onMessage(e=>{t(()=>this.onMessage(e))})}ur(){this.state=4,this.rr.Xi(async()=>{this.state=0,this.start()})}pr(e){return R0("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(3,e)}gr(t){return e=>{this.Oe.enqueueAndForget(()=>this.sr===t?e():(R0("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dN extends hN{constructor(e,t,n,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i),this.N=r}Er(e){return this.nr.ji("Listen",e)}onMessage(e){this.rr.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:D0(),i=t.targetChange.targetIds||[],s=(o=t.targetChange.resumeToken,e.D?(L0(void 0===o||"string"==typeof o),oE.fromBase64String(o||"")):(L0(void 0===o||o instanceof Uint8Array),oE.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?M0.UNKNOWN:zS(a.code),new F0(o,a.message||""));n=new ok(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var s=wk(e,c.document.name),l=mk(c.document.updateTime),a=new RE({mapValue:{fields:c.document.fields}}),l=PE.newFoundDocument(s,l,a),a=c.targetIds||[],c=c.removedTargetIds||[];n=new ik(a,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;c=t.documentDelete;c.document;var l=wk(e,c.document),u=c.readTime?mk(c.readTime):J0.min(),u=PE.newNoDocument(l,u),c=c.removedTargetIds||[];n=new ik([],c,u.key,u)}else if("documentRemove"in t){t.documentRemove;u=t.documentRemove;u.document;var h=wk(e,u.document),u=u.removedTargetIds||[];n=new ik([],u,h,null)}else{if(!("filter"in t))return D0();{t.filter;const e=t.filter;e.targetId;h=e.count||0,t=new BS(h),h=e.targetId;n=new sk(h,t)}}var a,s;return n}(this.N,e),e=function(e){if(!("targetChange"in e))return J0.min();e=e.targetChange;return(!e.targetIds||!e.targetIds.length)&&e.readTime?mk(e.readTime):J0.min()}(e);return this.listener.Tr(t,e)}Ir(e){const t={};t.database=Tk(this.N),t.addTarget=function(e,t){let n;var r=t.target;return n=ME(r)?{documents:Nk(e,r)}:{query:Rk(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=gk(e,t.resumeToken):0<t.snapshotVersion.compareTo(J0.min())&&(n.readTime=pk(e,t.snapshotVersion.toTimestamp())),n}(this.N,e);var n,e=(this.N,n=e,null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return D0()}}())?null:{"goog-listen-tags":e});e&&(t.labels=e),this.wr(t)}Ar(e){const t={};t.database=Tk(this.N),t.removeTarget=e,this.wr(t)}}class fN extends hN{constructor(e,t,n,r,i){super(e,"write_stream_connection_backoff","write_stream_idle",t,n,i),this.N=r,this.Rr=!1}get Pr(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.br([])}Er(e){return this.nr.ji("Write",e)}onMessage(e){if(L0(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Rr){this.rr.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(L0(void 0!==r),n.map(e=>function(e,t){let n=e.updateTime?mk(e.updateTime):mk(t);return n.isEqual(J0.min())&&(n=mk(t)),new CS(n,e.transformResults||[])}(e,r))):[]),n=mk(e.commitTime);return this.listener.vr(n,t)}var n,r;return L0(!e.writeResults||0===e.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const e={};e.database=Tk(this.N),this.wr(e)}br(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>Ck(this.N,e))};this.wr(e)}}class pN extends class{}{constructor(e,t,n){super(),this.credentials=e,this.nr=t,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new F0(M0.FAILED_PRECONDITION,"The client has already been terminated.")}Li(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Li(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===M0.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new F0(M0.UNKNOWN,e.toString())})}Ki(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Ki(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===M0.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new F0(M0.UNKNOWN,e.toString())})}terminate(){this.Dr=!0}}class gN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(e){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Fr("Offline")))}set(e){this.Br(),this.Nr=0,"Online"===e&&(this.$r=!1),this.Fr(e)}Fr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Mr(e){e=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.$r?(P0(e),this.$r=!1):R0("OnlineStateTracker",e)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class mN{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=i,this.Qr.Ei(e=>{n.enqueueAndForget(async()=>{SN(this)&&(R0("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Kr.add(4),await vN(t),t.Wr.set("Unknown"),t.Kr.delete(4),await yN(t)}(this))})}),this.Wr=new gN(n,r)}}async function yN(e){if(SN(e))for(const t of e.jr)await t(!0)}async function vN(e){for(const t of e.jr)await t(!1)}function _N(e,t){const n=e;n.qr.has(t.targetId)||(n.qr.set(t.targetId,t),EN(n)?TN(n):ON(n).cr()&&bN(n,t))}function wN(e,t){const n=e,r=ON(n);n.qr.delete(t),r.cr()&&IN(n,t),0===n.qr.size&&(r.cr()?r.lr():SN(n)&&n.Wr.set("Unknown"))}function bN(e,t){e.Gr.Y(t.targetId),ON(e).Ir(t)}function IN(e,t){e.Gr.Y(t),ON(e).Ar(t)}function TN(t){t.Gr=new ck({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.qr.get(e)||null}),ON(t).start(),t.Wr.Or()}function EN(e){return SN(e)&&!ON(e).ar()&&0<e.qr.size}function SN(e){return 0===e.Kr.size}function kN(e){e.Gr=void 0}async function CN(e,t,n){if(!dC(t))throw t;e.Kr.add(1),await vN(e),e.Wr.set("Offline"),n=n||(()=>AA(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{R0("RemoteStore","Retrying IndexedDB access"),await n(),e.Kr.delete(1),await yN(e)})}function AN(t,n){return n().catch(e=>CN(t,e,n))}async function NN(e){const t=e,n=DN(t);let r=0<t.Ur.length?t.Ur[t.Ur.length-1].batchId:-1;for(;SN(i=t)&&i.Ur.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Ur.length&&n.lr();break}r=e.batchId,function(e,t){e.Ur.push(t);const n=DN(e);n.cr()&&n.Pr&&n.br(t.mutations)}(t,e)}catch(e){await CN(t,e)}var i;RN(t)&&PN(t)}function RN(e){return SN(e)&&!DN(e).ar()&&0<e.Ur.length}function PN(e){DN(e).start()}async function xN(e,t){const n=e;t?(n.Kr.delete(2),await yN(n)):t||(n.Kr.add(2),await vN(n),n.Wr.set("Unknown"))}function ON(t){return t.zr||(t.zr=function(e,t,n){const r=e;return r.Cr(),new dN(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(n){n.qr.forEach((e,t)=>{bN(n,e)})}.bind(null,t),Ci:async function(e,t){kN(e),EN(e)?(e.Wr.Lr(t),TN(e)):e.Wr.set("Unknown")}.bind(null,t),Tr:async function(e,r,t){if(e.Wr.set("Online"),r instanceof ok&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.qr.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.qr.delete(n),e.Gr.removeTarget(n))}(e)}catch(t){R0("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await CN(e,t)}else if(r instanceof ik?e.Gr.rt(r):r instanceof sk?e.Gr.ft(r):e.Gr.ct(r),!t.isEqual(J0.min()))try{const r=await AA(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.Gr._t(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.qr.get(t);n&&r.qr.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.qr.get(e);t&&(r.qr.set(e,t.withResumeToken(oE.EMPTY_BYTE_STRING,t.snapshotVersion)),IN(r,e),e=new bC(t.target,e,1,t.sequenceNumber),bN(r,e))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){R0("RemoteStore","Failed to raise snapshot:",r),await CN(e,r)}}.bind(null,t)}),t.jr.push(async e=>{e?(t.zr.hr(),EN(t)?TN(t):t.Wr.set("Unknown")):(await t.zr.stop(),kN(t))})),t.zr}function DN(t){return t.Hr||(t.Hr=function(e,t,n){const r=e;return r.Cr(),new fN(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(e){DN(e).Sr()}.bind(null,t),Ci:async function(e,t){t&&DN(e).Pr&&await async function(e,t){if(KS(n=t.code)&&n!==M0.ABORTED){const n=e.Ur.shift();DN(e).hr(),await AN(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await NN(e)}var n}(e,t),RN(e)&&PN(e)}.bind(null,t),Vr:async function(e){const t=DN(e);for(const n of e.Ur)t.br(n.mutations)}.bind(null,t),vr:async function(e,t,n){const r=e.Ur.shift(),i=wC.from(r,t,n);await AN(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await NN(e)}.bind(null,t)}),t.jr.push(async e=>{e?(t.Hr.hr(),await NN(t)):(await t.Hr.stop(),0<t.Ur.length&&(R0("RemoteStore",`Stopping write stream with ${t.Ur.length} pending writes`),t.Ur=[]))})),t.Hr}class LN{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new U0,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new LN(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new F0(M0.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function MN(e,t){if(P0("AsyncQueue",`${t}: ${e}`),dC(e))return new F0(M0.UNAVAILABLE,`${t}: ${e}`);throw e}class FN{constructor(n){this.comparator=n?(e,t)=>n(e,t)||mE.comparator(e.key,t.key):(e,t)=>mE.comparator(e.key,t.key),this.keyedMap=JS,this.sortedSet=new WS(this.comparator)}static emptySet(e){return new FN(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof FN))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new FN;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class UN{constructor(){this.Jr=new WS(mE.comparator)}track(e){var t=e.doc.key,n=this.Jr.get(t);!n||0!==e.type&&3===n.type?this.Jr=this.Jr.insert(t,e):3===e.type&&1!==n.type?this.Jr=this.Jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jr=this.Jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jr=this.Jr.remove(t):1===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):D0()}Yr(){const n=[];return this.Jr.inorderTraversal((e,t)=>{n.push(t)}),n}}class jN{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new jN(e,t,FN.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&cS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class qN{constructor(){this.Xr=void 0,this.listeners=[]}}class VN{constructor(){this.queries=new aA(e=>lS(e),cS),this.onlineState="Unknown",this.Zr=new Set}}async function BN(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new qN),i)try{s.Xr=await n.onListen(r)}catch(e){const n=MN(e,`Initialization of query '${uS(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.eo(n.onlineState),!s.Xr||t.no(s.Xr)&&zN(n)}async function KN(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function zN(e){e.Zr.forEach(e=>{e.next()})}class WN{constructor(e,t,n){this.query=e,this.so=t,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new jN(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.io?this.oo(e)&&(this.so.next(e),t=!0):this.ao(e,this.onlineState)&&(this.co(e),t=!0),this.ro=e,t}onError(e){this.so.error(e)}eo(e){this.onlineState=e;let t=!1;return this.ro&&!this.io&&this.ao(this.ro,e)&&(this.co(this.ro),t=!0),t}ao(e,t){return!e.fromCache||!(this.options.uo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}oo(e){if(0<e.docChanges.length)return!0;var t=this.ro&&this.ro.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}co(e){e=jN.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.io=!0,this.so.next(e)}}class $N{constructor(e,t){this.payload=e,this.byteLength=t}ho(){return"metadata"in this.payload}}class HN{constructor(e){this.N=e}zn(e){return wk(this.N,e)}Hn(e){return e.metadata.exists?kk(this.N,e.document,!1):PE.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return mk(e)}}class GN{constructor(e,t,n){this.lo=e,this.localStore=t,this.N=n,this.queries=[],this.documents=[],this.progress=QN(e)}fo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}wo(e){const t=new Map,n=new HN(this.N);for(const i of e)if(i.metadata.queries){const e=n.zn(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||ek()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=ek(),o=YS,a=XS;for(const e of n){const n=t.zn(e.metadata.name);e.document&&(s=s.add(n)),o=o.insert(n,t.Hn(e)),a=a.insert(n,t.Jn(e.metadata.readTime))}const c=i.jn.newChangeBuffer({trackRemovals:!0}),l=await PA(i,(r=r,oS(ZE(nE.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>RA(t,c,o,J0.min(),a).next(e=>(c.apply(t),e)).next(e=>i.ze.removeMatchingKeysForTargetId(t,l.targetId).next(()=>i.ze.addMatchingKeys(t,s,l.targetId)).next(()=>i.Qn.vn(t,e)).next(()=>e)))}(this.localStore,new HN(this.N),this.documents,this.lo.id),t=this.wo(this.documents);for(const e of this.queries)await async function(e,n,r=ek()){const i=await PA(e,oS(xC(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=mk(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Je.saveNamedQuery(e,n);t=i.withResumeToken(oE.EMPTY_BYTE_STRING,t);return s.Un=s.Un.insert(t.targetId,t),s.ze.updateTargetData(e,t).next(()=>s.ze.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.ze.addMatchingKeys(e,r,i.targetId)).next(()=>s.Je.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new bA(Object.assign({},this.progress),e)}}function QN(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class YN{constructor(e){this.key=e}}class JN{constructor(e){this.key=e}}class XN{constructor(e,t){this.query=e,this._o=t,this.mo=null,this.current=!1,this.yo=ek(),this.mutatedKeys=ek(),this.po=dS(e),this.Eo=new FN(this.po)}get To(){return this._o}Io(e,t){const a=t?t.Ao:new UN,c=(t||this).Eo;let l=(t||this).mutatedKeys,u=c,h=!1;const d=eS(this.query)&&c.size===this.query.limit?c.last():null,f=tS(this.query)&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=hS(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(a.track({type:3,doc:r}),o=!0):this.Ro(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.po(r,d)||f&&this.po(r,f)<0)&&(h=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(h=!0)),o&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),eS(this.query)||tS(this.query))for(;u.size>this.query.limit;){const e=eS(this.query)?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),a.track({type:1,doc:e})}return{Eo:u,Ao:a,Ln:h,mutatedKeys:l}}Ro(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Eo;this.Eo=e.Eo,this.mutatedKeys=e.mutatedKeys;const i=e.Ao.Yr();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D0()}};return n(e)-n(t)}(e.type,t.type)||this.po(e.doc,t.doc)),this.Po(n);var s=t?this.bo():[],n=0===this.yo.size&&this.current?1:0,t=n!==this.mo;return this.mo=n,0!==i.length||t?{snapshot:new jN(this.query,e.Eo,r,i,e.mutatedKeys,0==n,t,!1),vo:s}:{vo:s}}eo(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new UN,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(e){return!this._o.has(e)&&!!this.Eo.has(e)&&!this.Eo.get(e).hasLocalMutations}Po(e){e&&(e.addedDocuments.forEach(e=>this._o=this._o.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._o=this._o.delete(e)),this.current=e.current)}bo(){if(!this.current)return[];const t=this.yo;this.yo=ek(),this.Eo.forEach(e=>{this.Vo(e.key)&&(this.yo=this.yo.add(e.key))});const n=[];return t.forEach(e=>{this.yo.has(e)||n.push(new JN(e))}),this.yo.forEach(e=>{t.has(e)||n.push(new YN(e))}),n}So(e){this._o=e.Gn,this.yo=ek();e=this.Io(e.documents);return this.applyChanges(e,!0)}Do(){return jN.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)}}class ZN{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class eR{constructor(e){this.key=e,this.Co=!1}}class tR{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.No={},this.xo=new aA(e=>lS(e),cS),this.ko=new Map,this.$o=new Set,this.Oo=new WS(mE.comparator),this.Fo=new Map,this.Mo=new FA,this.Lo={},this.Bo=new Map,this.Uo=QC.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}async function nR(n,e,t,r){n.Ko=(e,i,t)=>async function(e,t,n){let r=t.view.Io(i);r.Ln&&(r=await OA(e.localStore,t.query,!1).then(({documents:e})=>t.view.Io(e,r)));n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n);return hR(e,t.targetId,n.vo),n.snapshot}(n,e,t);const i=await OA(n.localStore,e,!0),s=new XN(e,i.Gn),o=s.Io(i.documents),a=rk.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=s.applyChanges(o,n.isPrimaryClient,a);hR(n,t,c.vo);r=new ZN(e,t,s);return n.xo.set(e,r),n.ko.has(t)?n.ko.get(t).push(e):n.ko.set(t,[e]),c.snapshot}async function rR(e,t,n){const r=vR(e);try{const e=await function(e,r){const i=e,s=Y0.now(),t=r.reduce((e,t)=>e.add(t.key),ek());let o;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>i.Qn.bn(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=yS(r.transform,e||null);null!=i&&(null==n&&(n=RE.empty()),n.set(r.field,i))}return n||null}(n,o.get(n.key));null!=r&&t.push(new MS(n.key,r,function r(e){const i=[];return Z0(e.fields,(e,t)=>{const n=new iE([e]);if(AE(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new sE(i)}(r.value.mapValue),AS.exists(!0)))}return i.In.addMutationBatch(n,s,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Lo[e.currentUser.toKey()];r=r||new WS(H0),r=r.insert(t,n),e.Lo[e.currentUser.toKey()]=r}(r,e.batchId,n),await fR(r,e.changes),await NN(r.remoteStore)}catch(e){const t=MN(e,"Failed to persist write");n.reject(t)}}async function iR(e,t){const r=e;try{const e=await NA(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Fo.get(t);n&&(L0(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Co=!0:0<e.modifiedDocuments.size?L0(n.Co):0<e.removedDocuments.size&&(L0(n.Co),n.Co=!1))}),await fR(r,e,t)}catch(e){await eA(e)}}function sR(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.xo.forEach((e,t)=>{t=t.view.eo(r);t.snapshot&&n.push(t.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.eo(n)&&(r=!0)}),r&&zN(t)}(t.eventManager,r),n.length&&t.No.Tr(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}async function oR(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let o=aC.resolve();return n.forEach(n=>{o=o.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);L0(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&i.addEntry(e,r.commitVersion))})}),o.next(()=>e.In.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.In.performConsistencyCheck(e)).next(()=>i.Qn.bn(e,t))})}(n.localStore,t);cR(n,r,null),aR(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await fR(n,e)}catch(e){await eA(e)}}function aR(e,t){(e.Bo.get(t)||[]).forEach(e=>{e.resolve()}),e.Bo.delete(t)}function cR(e,t,n){const r=e;let i=r.Lo[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Lo[r.currentUser.toKey()]=i}}function lR(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ko.get(e))t.xo.delete(r),n&&t.No.jo(r,n);t.ko.delete(e),t.isPrimaryClient&&t.Mo.cs(e).forEach(e=>{t.Mo.containsKey(e)||uR(t,e)})}function uR(e,t){e.$o.delete(t.path.canonicalString());var n=e.Oo.get(t);null!==n&&(wN(e.remoteStore,n),e.Oo=e.Oo.remove(t),e.Fo.delete(n),dR(e))}function hR(e,t,n){for(const r of n)r instanceof YN?(e.Mo.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.Oo.get(n)||e.$o.has(r)||(R0("SyncEngine","New document in limbo: "+n),e.$o.add(r),dR(e))}(e,r)):r instanceof JN?(R0("SyncEngine","Document no longer in limbo: "+r.key),e.Mo.removeReference(r.key,t),e.Mo.containsKey(r.key)||uR(e,r.key)):D0()}function dR(e){for(;0<e.$o.size&&e.Oo.size<e.maxConcurrentLimboResolutions;){var t=e.$o.values().next().value;e.$o.delete(t);var n=new mE(nE.fromString(t)),t=e.Uo.next();e.Fo.set(t,new eR(n)),e.Oo=e.Oo.insert(n,t),_N(e.remoteStore,new bC(oS(ZE(n.path)),t,2,W0.T))}}async function fR(e,n,r){const i=e,s=[],o=[],a=[];i.xo.isEmpty()||(i.xo.forEach((e,t)=>{a.push(i.Ko(t,n,r).then(e=>{e&&(i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),s.push(e),e=TA.kn(t.targetId,e),o.push(e))}))}),await Promise.all(a),i.No.Tr(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>aC.forEach(t,t=>aC.forEach(t.Nn,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>aC.forEach(t.xn,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!dC(e))throw e;R0("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Un.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Un=r.Un.insert(t,i)}}}(i.localStore,o))}async function pR(r,e){const i=r;if(yR(i),vR(i),!0===e&&!0!==i.qo){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await gR(i,r.toArray());i.qo=!0,await xN(i.remoteStore,!0);for(const r of e)_N(i.remoteStore,r)}else if(!1===e&&!1!==i.qo){const r=[];let n=Promise.resolve();i.ko.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(lR(i,t),xA(i.localStore,t,!0))),wN(i.remoteStore,t)}),await n,await gR(i,r),function(){const n=i;n.Fo.forEach((e,t)=>{wN(n.remoteStore,t)}),n.Mo.us(),n.Fo=new Map,n.Oo=new WS(mE.comparator)}(),i.qo=!1,await xN(i.remoteStore,!1)}}async function gR(t,n){const r=t,i=[],s=[];for(const t of n){let e;const l=r.ko.get(t);if(l&&0!==l.length){e=await PA(r.localStore,oS(l[0]));for(const t of l){const n=r.xo.get(t),l=(o=r,a=n,c=void 0,o=await OA((c=o).localStore,a.query,!0),o=a.view.So(o),c.isPrimaryClient&&hR(c,a.targetId,o.vo),await o);l.snapshot&&s.push(l.snapshot)}}else{const l=await DA(r.localStore,t);e=await PA(r.localStore,l),await nR(r,mR(l),t,!1)}i.push(e)}var o,a,c;return r.No.Tr(s),i}function mR(e){return XE(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function yR(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=iR.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.Fo.get(t);if(r&&r.Co)return ek().add(r.key);{let e=ek();const r=n.ko.get(t);if(!r)return e;for(const t of r){const r=n.xo.get(t);e=e.unionWith(r.view.To)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Fo.get(t),s=i&&i.key;if(s){let e=new WS(mE.comparator);e=e.insert(s,PE.newNoDocument(s,J0.min()));const n=ek().add(s),i=new nk(J0.min(),new Map,new GS(H0),e,n);await iR(r,i),r.Oo=r.Oo.remove(s),r.Fo.delete(t),dR(r)}else await xA(r.localStore,t,!1).then(()=>lR(r,t,n)).catch(eA)}.bind(null,t),t.No.Tr=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.no(e)&&(r=!0);i.Xr=e}}r&&zN(n)}.bind(null,t.eventManager),t.No.jo=function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function vR(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=oR.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.In.lookupMutationBatch(t,r).next(e=>(L0(null!==e),n=e.keys(),i.In.removeMutationBatch(t,e))).next(()=>i.In.performConsistencyCheck(t)).next(()=>i.Qn.bn(t,n))})}(r.localStore,t);cR(r,t,n),aR(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await fR(r,e)}catch(n){await eA(n)}}.bind(null,t),t}class _R{constructor(){this.synchronizeTabs=!1}async initialize(e){this.N=lN(e.databaseInfo.databaseId),this.sharedClientState=this.Wo(e),this.persistence=this.Go(e),await this.persistence.start(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e)}zo(e){return null}Ho(e){return kA(this.persistence,new EA,e.initialUser,this.N)}Go(e){return new KA(WA.Ns,this.N)}Wo(e){return new tN}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class wR extends _R{constructor(e,t,n){super(),this.Jo=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=dA(t);let r=J0.min();return e.Kt({index:Qk.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=kC(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.Kn=e})}(this.localStore),await this.Jo.initialize(this,e),await vR(this.Jo.syncEngine),await NN(this.Jo.remoteStore),await this.persistence.nn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ho(e){return kA(this.persistence,new EA,e.initialUser,this.N)}zo(e){var t=this.persistence.referenceDelegate.garbageCollector;return new rA(t,e.asyncQueue)}Go(e){var t=wA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?VC.withCacheSize(this.cacheSizeBytes):VC.DEFAULT;return new yA(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,aN(),cN(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(e){return new tN}}class bR extends wR{constructor(e,t){super(e,t,!1),this.Jo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.Jo.syncEngine;this.sharedClientState instanceof eN&&(this.sharedClientState.syncEngine={_i:async function(e,t,n,r){var i=e;null!==(e=await function(e,n){const r=e,i=r.In;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Xt(t,n).next(e=>e?r.Qn.bn(t,e):aC.resolve(null)))}(i.localStore,t))?("pending"===n?await NN(i.remoteStore):"acknowledged"===n||"rejected"===n?(cR(i,t,r||null),aR(i,t),i.localStore.In.te(t)):D0(),await fR(i,e)):R0("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),mi:async function(e,t,n,r){const i=e;if(i.qo)R0("SyncEngine","Ignoring unexpected query state notification.");else if(i.ko.has(t))switch(n){case"current":case"not-current":{const e=await LA(i.localStore),r=nk.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await fR(i,e,r);break}case"rejected":await xA(i.localStore,t,!0),lR(i,t,r);break;default:D0()}}.bind(null,e),gi:async function(e,t,n){const r=yR(e);if(r.qo){for(const e of t)if(r.ko.has(e))R0("SyncEngine","Adding an already active target "+e);else{const t=await DA(r.localStore,e),n=await PA(r.localStore,t);await nR(r,mR(t),n.targetId,!1),_N(r.remoteStore,n)}for(const e of n)r.ko.has(e)&&await xA(r.localStore,e,!1).then(()=>{wN(r.remoteStore,e),lR(r,e)}).catch(eA)}}.bind(null,e),pn:function(e){return e.localStore.persistence.pn()}.bind(null,e),wi:async function(e){const t=e;return LA(t.localStore).then(e=>fR(t,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.nn(async e=>{await pR(this.Jo.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Wo(e){var t=aN();if(!eN.Pt(t))throw new F0(M0.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=wA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new eN(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class IR{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>sR(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){R0("SyncEngine","User change. New user:",t.toKey());const r=await CA(n.localStore,t);n.currentUser=t,(e=n).Bo.forEach(e=>{e.forEach(e=>{e.reject(new F0(M0.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await fR(n,r.Wn)}}.bind(null,this.syncEngine),await xN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new VN}createDatastore(e){var t,n=lN(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new oN(t));return e=e.credentials,t=t,n=n,new pN(e,t,n)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>sR(this.syncEngine,e,0),e=new(rN.Pt()?rN:nN),new mN(t,n,r,i,e);var t,n,r,i}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new tR(e,t,n,r,i,s);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;R0("RemoteStore","RemoteStore shutting down."),t.Kr.add(5),await vN(t),t.Qr.shutdown(),t.Wr.set("Unknown")}(this.remoteStore)}}function TR(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class ER{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Yo(this.observer.next,e)}error(e){this.observer.error?this.Yo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Xo(){this.muted=!0}Yo(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class SR{constructor(e,t){this.Zo=e,this.N=t,this.metadata=new U0,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(e=>{e&&e.ho()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Zo.cancel()}async getMetadata(){return this.metadata.promise}async Qo(){return await this.getMetadata(),this.ea()}async ea(){var e=await this.na();if(null===e)return null;var t=this.ta.decode(e),n=Number(t);isNaN(n)&&this.sa(`length string (${t}) is not valid number`);t=await this.ia(n);return new $N(JSON.parse(t),e.length+n)}ra(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async na(){for(;this.ra()<0&&!await this.oa(););if(0===this.buffer.length)return null;var e=this.ra();e<0&&this.sa("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ia(e){for(;this.buffer.length<e;)await this.oa()&&this.sa("Reached the end of bundle when more is expected.");var t=this.ta.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}sa(e){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${e}`)}async oa(){var e=await this.Zo.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class kR{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new F0(M0.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=Tk(r.N)+"/documents",i={documents:t.map(e=>_k(r.N,e))},s=await r.Ki("BatchGetDocuments",n,i),o=new Map;s.forEach(e=>{const t=(n=r.N,"found"in(e=e)?function(e,t){L0(!!t.found),t.found.name,t.found.updateTime;var n=wk(e,t.found.name),e=mk(t.found.updateTime),t=new RE({mapValue:{fields:t.found.fields}});return PE.newFoundDocument(n,e,t)}(n,e):"missing"in e?function(e,t){L0(!!t.missing),L0(!!t.readTime);e=wk(e,t.missing),t=mk(t.readTime);return PE.newNoDocument(e,t)}(n,e):D0());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{e=o.get(e.toString());L0(!!e),a.push(e)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new qS(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=mE.fromPath(t);this.mutations.push(new VS(t,this.precondition(t)))}),await async function(e,t){const n=e,r=Tk(n.N)+"/documents",i={writes:t.map(e=>Ck(n.N,e))};await n.Li("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw D0();t=J0.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new F0(M0.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?AS.updateTime(t):AS.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return AS.exists(!0);if(t.isEqual(J0.min()))throw new F0(M0.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return AS.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class CR{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.aa=5,this.rr=new uN(this.asyncQueue,"transaction_retry")}run(){--this.aa,this.ca()}ca(){this.rr.Xi(async()=>{const t=new kR(this.datastore),e=this.ua(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.ha(e)}))}).catch(e=>{this.ha(e)})})}ua(e){try{var t=this.updateFunction(e);return!fE(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ha(e){0<this.aa&&this.la(e)?(--this.aa,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(e)}la(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||!KS(e)}}class AR{constructor(e,t,n){this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=k0.UNAUTHENTICATED,this.clientId=$0.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(t,async e=>{R0("FirestoreClient","Received user=",e.uid),await this.credentialListener(e),this.user=e})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new F0(M0.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new U0;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),n.resolve()}catch(e){var t=MN(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function NR(e,t){e.asyncQueue.verifyOperationInProgress(),R0("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await CA(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function RR(e,t){e.asyncQueue.verifyOperationInProgress();var n=await PR(e);R0("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>async function(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),R0("RemoteStore","RemoteStore received new credentials");e=SN(n);n.Kr.add(3),await vN(n),e&&n.Wr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Kr.delete(3),await yN(n)}(t.remoteStore,e)),e.onlineComponents=t}async function PR(e){return e.offlineComponents||(R0("FirestoreClient","Using default OfflineComponentProvider"),await NR(e,new _R)),e.offlineComponents}async function xR(e){return e.onlineComponents||(R0("FirestoreClient","Using default OnlineComponentProvider"),await RR(e,new IR)),e.onlineComponents}function OR(e){return PR(e).then(e=>e.persistence)}function DR(e){return PR(e).then(e=>e.localStore)}function LR(e){return xR(e).then(e=>e.remoteStore)}function MR(e){return xR(e).then(e=>e.syncEngine)}async function FR(e){const t=await xR(e),n=t.eventManager;return n.onListen=async function(e,t){const n=yR(e);let r,i;const s=n.xo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Do();else{const e=await PA(n.localStore,oS(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await nR(n,t,r,"current"===s),n.isPrimaryClient&&_N(n.remoteStore,e)}return i}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.xo.get(t),i=n.ko.get(r.targetId);if(1<i.length)return n.ko.set(r.targetId,i.filter(e=>!cS(e,t))),void n.xo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await xA(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),wN(n.remoteStore,r.targetId),lR(n,r.targetId)}).catch(eA)):(lR(n,r.targetId),await xA(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function UR(e,t,n={}){const r=new U0;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,o){const e=new ER({next:e=>{r.enqueueAndForget(()=>KN(n,a));var t=e.docs.has(i);!t&&e.fromCache?o.reject(new F0(M0.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?o.reject(new F0(M0.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new WN(ZE(i.path),e,{includeMetadataChanges:!0,uo:!0});return BN(n,a)}(await FR(e),e.asyncQueue,t,n,r)),r.promise}function jR(e,t,n={}){const r=new U0;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new ER({next:e=>{n.enqueueAndForget(()=>KN(t,o)),e.fromCache&&"server"===r.source?i.reject(new F0(M0.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),o=new WN(e,s,{includeMetadataChanges:!0,uo:!0});return BN(t,o)}(await FR(e),e.asyncQueue,t,n,r)),r.promise}function qR(e,t,n,r){const i=function(e,t){e="string"==typeof e?(new TextEncoder).encode(e):e;return e=function(e){if(e instanceof Uint8Array)return TR(e,void 0);if(e instanceof ArrayBuffer)return TR(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(e),t=t,new SR(e,t)}(n,lN(t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=mk(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Je.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes});r._updateProgress(QN(i));const o=new GN(i,t.localStore,n.N);let e=await n.Qo();for(;e;){const t=await o.fo(e);t&&r._updateProgress(t),e=await n.Qo()}var s=await o.complete();await fR(t,s.Tn,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Je.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress)}catch(t){x0("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(r,t,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await MR(e),i,r)})}class VR{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class BR{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof BR&&e.projectId===this.projectId&&e.database===this.database}}const KR=new Map;function zR(e,t,n){if(!n)throw new F0(M0.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function WR(e,t,n,r){if(!0===t&&!0===r)throw new F0(M0.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function $R(e){if(!mE.isDocumentKey(e))throw new F0(M0.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function HR(e){if(mE.isDocumentKey(e))throw new F0(M0.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function GR(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":D0();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?`a custom ${e} object`:"an object"}function QR(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new F0(M0.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=GR(e);throw new F0(M0.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}function YR(e,t){if(t<=0)throw new F0(M0.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class JR{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new F0(M0.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new F0(M0.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,WR("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class XR{constructor(e,t){this._credentials=t,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new JR({}),this._settingsFrozen=!1,e instanceof BR?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new F0(M0.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new BR(e.options.projectId)}(e))}get app(){if(!this._app)throw new F0(M0.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new F0(M0.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new JR(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new q0;switch(e.type){case"gapi":var t=e.client;return L0(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new z0(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new F0(M0.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=KR.get(e);t&&(R0("ComponentProvider","Removing Datastore"),KR.delete(e),t.terminate())}(this),Promise.resolve()}}class ZR{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tP(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ZR(this.firestore,e,this._key)}}class eP{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new eP(this.firestore,e,this._query)}}class tP extends eP{constructor(e,t,n){super(e,t,ZE(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ZR(this.firestore,null,new mE(e))}withConverter(e){return new tP(this.firestore,e,this._path)}}function nP(e,t,...n){if(e=io(e),zR("collection","path",t),e instanceof XR){var r=nE.fromString(t,...n);return HR(r),new tP(e,null,r)}if(!(e instanceof ZR||e instanceof tP))throw new F0(M0.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");t=nE.fromString(e.path,...n).child(nE.fromString(t));return HR(t),new tP(e.firestore,null,t)}function rP(e,t,...n){if(e=io(e),zR("doc","path",t=1===arguments.length?$0.I():t),e instanceof XR){var r=nE.fromString(t,...n);return $R(r),new ZR(e,null,new mE(r))}if(!(e instanceof ZR||e instanceof tP))throw new F0(M0.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=e._path.child(nE.fromString(t,...n));return $R(n),new ZR(e.firestore,e instanceof tP?e.converter:null,new mE(n))}function iP(e,t){return e=io(e),t=io(t),(e instanceof ZR||e instanceof tP)&&(t instanceof ZR||t instanceof tP)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function sP(e,t){return e=io(e),t=io(t),e instanceof eP&&t instanceof eP&&e.firestore===t.firestore&&cS(e._query,t._query)&&e.converter===t.converter}class oP{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new uN(this,"async_queue_retry"),this.Ea=()=>{var e=cN();e&&R0("AsyncQueue","Visibility state changed to "+e.visibilityState),this.rr.tr()};const e=cN();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ea)}get isShuttingDown(){return this.wa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ta(),this.Ia(e)}enterRestrictedMode(e){if(!this.wa){this.wa=!0,this.ya=e||!1;const t=cN();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ea)}}enqueue(e){if(this.Ta(),this.wa)return new Promise(()=>{});const t=new U0;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.da.push(e),this.Aa()))}async Aa(){if(0!==this.da.length){try{await this.da[0](),this.da.shift(),this.rr.reset()}catch(e){if(!dC(e))throw e;R0("AsyncQueue","Operation failed with retryable error: "+e)}0<this.da.length&&this.rr.Xi(()=>this.Aa())}}Ia(e){var t=this.fa.then(()=>(this.ga=!0,e().catch(e=>{throw this.ma=e,this.ga=!1,P0("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.ga=!1,e))));return this.fa=t}enqueueAfterDelay(e,t,n){this.Ta(),-1<this.pa.indexOf(e)&&(t=0);n=LN.createAndSchedule(this,e,t,n,e=>this.Ra(e));return this._a.push(n),n}Ta(){this.ma&&D0()}verifyOperationInProgress(){}async Pa(){for(var e;await(e=this.fa),e!==this.fa;);}ba(e){for(const t of this._a)if(t.timerId===e)return!0;return!1}va(t){return this.Pa().then(()=>{this._a.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this._a)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Pa()})}Va(e){this.pa.push(e)}Ra(e){e=this._a.indexOf(e);this._a.splice(e,1)}}function aP(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class cP{constructor(){this._progressObserver={},this._taskCompletionResolver=new U0,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var lP,uP;class hP extends XR{constructor(e,t){super(e,t),this.type="firestore",this._queue=new oP,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||fP(this),this._firestoreClient.terminate()}}function dP(e){return e._firestoreClient||fP(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function fP(e){var t,n,r,i=e._freezeSettings(),i=(t=e._databaseId,n=(null===(r=e._app)||void 0===r?void 0:r.options.appId)||"",r=e._persistenceKey,i=i,new VR(t,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new AR(e._credentials,e._queue,i)}function pP(e,n,r){const i=new U0;return e.asyncQueue.enqueue(async()=>{try{await NR(e,r),await RR(e,n),i.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===M0.FAILED_PRECONDITION||t.code===M0.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),i.reject(e)}var t}).then(()=>i.promise)}function gP(e){return function(e){const t=new U0;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;SN(n.remoteStore)||R0("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.In.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Bo.get(e)||[];r.push(t),n.Bo.set(e,r)}catch(e){const n=MN(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await MR(e),t)),t.promise}(dP(e=QR(e,hP)))}function mP(e){return(n=dP(e=QR(e,hP))).asyncQueue.enqueue(async()=>{const e=await OR(n),t=await LR(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Kr.delete(0),yN(e)}()});var n}function yP(e){return(n=dP(e=QR(e,hP))).asyncQueue.enqueue(async()=>{const e=await OR(n),t=await LR(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Kr.add(0),await vN(e),e.Wr.set("Offline")}()});var n}function vP(t,e){return n=dP(t=QR(t,hP)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Je.getNamedQuery(e,t))}(await DR(n),r)).then(e=>e?new eP(t,null,e.query):null);var n,r}function _P(e){if(e._initialized||e._terminated)throw new F0(M0.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class wP{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new F0(M0.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new iE(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class bP{constructor(e){this._byteString=e}static fromBase64String(e){try{return new bP(oE.fromBase64String(e))}catch(e){throw new F0(M0.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new bP(oE.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class IP{constructor(e){this._methodName=e}}class TP{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new F0(M0.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new F0(M0.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H0(this._lat,e._lat)||H0(this._long,e._long)}}const EP=/^__.*__$/;class SP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new MS(e,this.data,this.fieldMask,t,this.fieldTransforms):new LS(e,this.data,t,this.fieldTransforms)}}class kP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new MS(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function CP(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw D0()}}class AP{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.N=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sa(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(e){return new AP(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.ka(e),r}$a(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.Sa(),r}Oa(e){return this.Ca({path:void 0,xa:!0})}Fa(e){return GP(e,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Sa(){if(this.path)for(let e=0;e<this.path.length;e++)this.ka(this.path.get(e))}ka(e){if(0===e.length)throw this.Fa("Document fields must not be empty");if(CP(this.Da)&&EP.test(e))throw this.Fa('Document fields cannot begin and end with "__"')}}class NP{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.N=n||lN(e)}Ba(e,t,n,r=!1){return new AP({Da:e,methodName:t,La:n,path:iE.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function RP(e){var t=e._freezeSettings(),n=lN(e._databaseId);return new NP(e._databaseId,!!t.ignoreUndefinedProperties,n)}function PP(e,t,n,r,i,s={}){const o=e.Ba(s.merge||s.mergeFields?2:0,t,n,i);zP("Data must be an object, but it was:",o,r);r=BP(r,o);let a,c;if(s.merge)a=new sE(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const l of s.mergeFields){const i=WP(t,l,n);if(!o.contains(i))throw new F0(M0.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);QP(e,i)||e.push(i)}a=new sE(e),c=o.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,c=o.fieldTransforms;return new SP(new RE(r),a,c)}class xP extends IP{_toFieldTransform(e){if(2!==e.Da)throw 1===e.Da?e.Fa(`${this._methodName}() can only appear at the top level of your update data`):e.Fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof xP}}function OP(e,t,n){return new AP({Da:3,La:t.settings.La,methodName:e._methodName,xa:n},t.databaseId,t.N,t.ignoreUndefinedProperties)}class DP extends IP{_toFieldTransform(e){return new kS(e.path,new vS)}isEqual(e){return e instanceof DP}}class LP extends IP{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=OP(this,e,!0),n=this.Ua.map(e=>VP(e,t)),r=new _S(n);return new kS(e.path,r)}isEqual(e){return this===e}}class MP extends IP{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=OP(this,e,!0),n=this.Ua.map(e=>VP(e,t)),r=new bS(n);return new kS(e.path,r)}isEqual(e){return this===e}}class FP extends IP{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){var t=new TS(e.N,gS(e.N,this.qa));return new kS(e.path,t)}isEqual(e){return this===e}}function UP(e,i,s,t){const o=e.Ba(1,i,s);zP("Data must be an object, but it was:",o,t);const a=[],c=RE.empty();Z0(t,(e,t)=>{var n=HP(i,e,s);t=io(t);e=o.$a(n);if(t instanceof xP)a.push(n);else{const r=VP(t,e);null!=r&&(a.push(n),c.set(n,r))}});t=new sE(a);return new kP(c,t,o.fieldTransforms)}function jP(t,n,e,r,i,s){const o=t.Ba(1,n,e),a=[WP(n,r,e)],c=[i];if(s.length%2!=0)throw new F0(M0.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(WP(n,s[e])),c.push(s[e+1]);const l=[],u=RE.empty();for(let e=a.length-1;0<=e;--e)if(!QP(l,a[e])){const n=a[e];var h=io(h=c[e]);const r=o.$a(n);if(h instanceof xP)l.push(n);else{const t=VP(h,r);null!=t&&(l.push(n),u.set(n,t))}}i=new sE(l);return new kP(u,i,o.fieldTransforms)}function qP(e,t,n,r=!1){return VP(n,e.Ba(r?4:3,t))}function VP(s,e){if(KP(s=io(s)))return zP("Unsupported field value:",e,s),BP(s,e);if(s instanceof IP)return function(e,t){if(!CP(t.Da))throw t.Fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Fa(`${e._methodName}() is not currently supported inside arrays`);e=e._toFieldTransform(t);e&&t.fieldTransforms.push(e)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xa&&4!==e.Da)throw e.Fa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=VP(i,t.Oa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=io(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return gS(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Y0.fromDate(e);return{timestampValue:pk(t.N,n)}}if(e instanceof Y0){n=new Y0(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:pk(t.N,n)}}if(e instanceof TP)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof bP)return{bytesValue:gk(t.N,e._byteString)};if(e instanceof ZR){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.Fa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:yk(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Fa(`Unsupported field value: ${GR(e)}`)}(0,e)}function BP(e,n){const r={};return eE(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Z0(e,(e,t)=>{t=VP(t,n.Na(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function KP(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Y0||e instanceof TP||e instanceof bP||e instanceof ZR||e instanceof IP)}function zP(e,t,n){if(!KP(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=GR(n);throw"an object"===n?t.Fa(e+" a custom object"):t.Fa(e+" "+n)}var r}function WP(e,t,n){if((t=io(t))instanceof wP)return t._internalPath;if("string"==typeof t)return HP(e,t);throw GP("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const $P=new RegExp("[~\\*/\\[\\]]");function HP(t,n,r){if(0<=n.search($P))throw GP(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new wP(...n.split("."))._internalPath}catch(e){throw GP(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function GP(e,t,n,r,i){var s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new F0(M0.INVALID_ARGUMENT,a+e+c)}function QP(e,t){return e.some(e=>e.isEqual(t))}class YP{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ZR(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new JP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){e=this._document.data.field(XP("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class JP extends YP{data(){return super.data()}}function XP(e,t){return"string"==typeof t?HP(e,t):(t instanceof wP?t:t._delegate)._internalPath}class ZP{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ex extends YP{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new tx(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){e=this._document.data.field(XP("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class tx extends ex{data(e={}){return super.data(e)}}class nx{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ZP(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new tx(this._firestore,this._userDataWriter,e.key,e,new ZP(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new F0(M0.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let t=0;return s._snapshot.docChanges.map(e=>({type:"added",doc:new tx(s._firestore,s._userDataWriter,e.doc.key,e.doc,new ZP(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:t++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new tx(s._firestore,s._userDataWriter,e.doc.key,e.doc,new ZP(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D0()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function rx(e,t){return e instanceof ex&&t instanceof ex?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof nx&&t instanceof nx&&e._firestore===t._firestore&&sP(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function ix(e){if(tS(e)&&0===e.explicitOrderBy.length)throw new F0(M0.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class sx{}function ox(e,...t){for(const n of t)e=n._apply(e);return e}class ax extends sx{constructor(e,t,n){super(),this.Ka=e,this.ja=t,this.Qa=n,this.type="where"}_apply(e){var t=RP(e.firestore),t=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new F0(M0.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){px(o,s);const t=[];for(const n of o)t.push(fx(r,e,n));a={arrayValue:{values:t}}}else a=fx(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||px(o,s),a=qP(n,t,o,"in"===s||"not-in"===s);s=FE.create(i,s,a);return function(e,t){if(t.v()){const r=rS(e);if(null!==r&&!r.isEqual(t.field))throw new F0(M0.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=nS(e);null!==n&&gx(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new F0(M0.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new F0(M0.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,s),s}(e._query,"where",t,e.firestore._databaseId,this.Ka,this.ja,this.Qa);return new eP(e.firestore,e.converter,(e=e._query,t=e.filters.concat([t]),new JE(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class cx extends sx{constructor(e,t){super(),this.Ka=e,this.Wa=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new F0(M0.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new F0(M0.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new GE(t,n);return t=r,null!==nS(n=e)||null!==(e=rS(n))&&gx(0,e,t.field),r}(e._query,this.Ka,this.Wa);return new eP(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new JE(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class lx extends sx{constructor(e,t,n){super(),this.type=e,this.Ga=t,this.za=n}_apply(e){return new eP(e.firestore,e.converter,aS(e._query,this.Ga,this.za))}}class ux extends sx{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=dx(e,this.type,this.Ha,this.Ja);return new eP(e.firestore,e.converter,(e=e._query,t=t,new JE(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class hx extends sx{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=dx(e,this.type,this.Ha,this.Ja);return new eP(e.firestore,e.converter,(e=e._query,t=t,new JE(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function dx(e,t,n,r){if(n[0]=io(n[0]),n[0]instanceof YP)return function(e,t,n,r,i){if(!r)throw new F0(M0.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of sS(e))if(n.field.isKeyField())s.push(TE(t,r.key));else{const e=r.data.field(n.field);if(hE(e))throw new F0(M0.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new F0(M0.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new $E(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=RP(e.firestore);return function(t,n,r,i,s,e){const o=t.explicitOrderBy;if(s.length>o.length)throw new F0(M0.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let e=0;e<s.length;e++){const c=s[e];if(o[e].field.isKeyField()){if("string"!=typeof c)throw new F0(M0.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!iS(t)&&-1!==c.indexOf("/"))throw new F0(M0.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);const r=t.path.child(nE.fromString(c));if(!mE.isDocumentKey(r))throw new F0(M0.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${i}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const s=new mE(r);a.push(TE(n,s))}else{const t=qP(r,i,c);a.push(t)}}return new $E(a,e)}(e._query,e.firestore._databaseId,i,t,n,r)}function fx(e,t,n){if("string"==typeof(n=io(n))){if(""===n)throw new F0(M0.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!iS(t)&&-1!==n.indexOf("/"))throw new F0(M0.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);t=t.path.child(nE.fromString(n));if(!mE.isDocumentKey(t))throw new F0(M0.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`);return TE(e,new mE(t))}if(n instanceof ZR)return TE(e,n._key);throw new F0(M0.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${GR(n)}.`)}function px(e,t){if(!Array.isArray(e)||0===e.length)throw new F0(M0.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new F0(M0.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function gx(e,t,n){if(!n.isEqual(t))throw new F0(M0.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class mx{convertValue(e,t="none"){switch(yE(e)){case 0:return null;case 1:return e.booleanValue;case 2:return lE(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(uE(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw D0()}}convertObject(e,n){const r={};return Z0(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new TP(lE(e.latitude),lE(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields.__previous_value__;return hE(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(dE(e));default:return null}}convertTimestamp(e){e=cE(e);return new Y0(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=nE.fromString(e);L0(Uk(n));const r=new BR(n.get(1),n.get(3)),i=new mE(n.popFirst(5));return r.isEqual(t)||P0(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function yx(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class vx extends mx{constructor(e){super(),this.firestore=e}convertBytes(e){return new bP(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new ZR(this.firestore,null,e)}}class _x{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=RP(e)}set(e,t,n){this._verifyNotCommitted();const r=wx(e,this._firestore),i=yx(r.converter,t,n),s=PP(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,AS.none())),this}update(e,t,n,...r){this._verifyNotCommitted();e=wx(e,this._firestore);let i;return i="string"==typeof(t=io(t))||t instanceof wP?jP(this._dataReader,"WriteBatch.update",e._key,t,n,r):UP(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(i.toMutation(e._key,AS.exists(!0))),this}delete(e){this._verifyNotCommitted();e=wx(e,this._firestore);return this._mutations=this._mutations.concat(new qS(e._key,AS.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new F0(M0.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function wx(e,t){if((e=io(e)).firestore!==t)throw new F0(M0.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class bx extends mx{constructor(e){super(),this.firestore=e}convertBytes(e){return new bP(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new ZR(this.firestore,null,e)}}function Ix(t){t=QR(t,ZR);const n=QR(t.firestore,hP),e=dP(n),r=new bx(n);return function(e,t){const n=new U0;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.Qn.An(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new F0(M0.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=MN(e,`Failed to get document '${t} from cache`);n.reject(t)}}(await DR(e),t,n)),n.promise}(e,t._key).then(e=>new ex(n,r,t._key,e,new ZP(null!==e&&e.hasLocalMutations,!0),t.converter))}function Tx(t){t=QR(t,eP);const n=QR(t.firestore,hP),e=dP(n),r=new bx(n);return function(e,t){const n=new U0;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await OA(e,t,!0),i=new XN(t,r.Gn),s=i.Io(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){t=MN(e,`Failed to execute query '${t} against cache`);n.reject(t)}}(await DR(e),t,n)),n.promise}(e,t._query).then(e=>new nx(n,r,t,e))}function Ex(e,t,n){e=QR(e,ZR);var r=QR(e.firestore,hP),t=yx(e.converter,t,n);return Ax(r,[PP(RP(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,AS.none())])}function Sx(e,t,n,...r){e=QR(e,ZR);var i=QR(e.firestore,hP),s=RP(i);let o;return o="string"==typeof(t=io(t))||t instanceof wP?jP(s,"updateDoc",e._key,t,n,r):UP(s,"updateDoc",e._key,t),Ax(i,[o.toMutation(e._key,AS.exists(!0))])}function kx(t,...n){var e;t=io(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||aP(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(aP(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,c;if(t instanceof ZR)a=QR(t.firestore,hP),c=ZE(t._key.path),o={next:e=>{n[i]&&n[i](Nx(a,t,e))},error:n[i+1],complete:n[i+2]};else{const l=QR(t,eP);a=QR(l.firestore,hP),c=l._query;const u=new bx(a);o={next:e=>{n[i]&&n[i](new nx(a,u,l,e))},error:n[i+1],complete:n[i+2]},ix(t._query)}return function(e,t,n,r){const i=new ER(r),s=new WN(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>BN(await FR(e),s)),()=>{i.Xo(),e.asyncQueue.enqueueAndForget(async()=>KN(await FR(e),s))}}(dP(a),c,s,o)}function Cx(e,t){return function(e,t){const n=new ER(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.add(t),t.next()}(await FR(e),n)),()=>{n.Xo(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.delete(t)}(await FR(e),n))}}(dP(e=QR(e,hP)),aP(t)?t:{next:t})}function Ax(e,t){return function(e,t){const n=new U0;return e.asyncQueue.enqueueAndForget(async()=>rR(await MR(e),t,n)),n.promise}(dP(e),t)}function Nx(e,t,n){var r=n.docs.get(t._key),i=new bx(e);return new ex(e,i,t._key,r,new ZP(n.hasPendingWrites,n.fromCache),t.converter)}class Rx extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=RP(e)}get(e){const n=wx(e,this._firestore),r=new vx(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return D0();const t=e[0];if(t.isFoundDocument())return new YP(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new YP(this._firestore,r,n._key,null,n.converter);throw D0()})}set(e,t,n){e=wx(e,this._firestore),t=yx(e.converter,t,n),n=PP(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n);return this._transaction.set(e._key,n),this}update(e,t,n,...r){e=wx(e,this._firestore),t="string"==typeof(t=io(t))||t instanceof wP?jP(this._dataReader,"Transaction.update",e._key,t,n,r):UP(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,t),this}delete(e){e=wx(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=wx(e,this._firestore),n=new bx(this._firestore);return super.get(e).then(e=>new ex(this._firestore,n,t._key,e._document,new ZP(!1,!1),t.converter))}}function Px(t,n){return function(t,n){const r=new U0;return t.asyncQueue.enqueueAndForget(async()=>{var e=await xR(t).then(e=>e.datastore);new CR(t.asyncQueue,e,n,r).run()}),r.promise}(dP(t),e=>n(new Rx(t,e)))}E=Mo,C0=E,xo(new so("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new hP(n,new B0(e.getProvider("auth-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),qo("@firebase/firestore","3.0.1",void 0);function xx(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new F0("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Ox(){if("undefined"==typeof Uint8Array)throw new F0("unimplemented","Uint8Arrays are not available in this environment.")}function Dx(){if("undefined"==typeof atob)throw new F0("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Lx{constructor(e){this._delegate=e}static fromBase64String(e){return Dx(),new Lx(bP.fromBase64String(e))}static fromUint8Array(e){return Ox(),new Lx(bP.fromUint8Array(e))}toBase64(){return Dx(),this._delegate.toBase64()}toUint8Array(){return Ox(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Mx(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class Fx{enableIndexedDbPersistence(e,t){return function(e,t){_P(e=QR(e,hP));var n=dP(e),r=e._freezeSettings(),e=new IR;return pP(n,e,new wR(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){_P(e=QR(e,hP));var t=dP(e),n=e._freezeSettings(),e=new IR;return pP(t,e,new bR(e,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new F0(M0.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new U0;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!lC.Pt())return Promise.resolve();e+="main";await lC.delete(e)}(wA(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class Ux{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof BR||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||x0("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,r,i={}){const s=(n=QR(n,XR))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&x0("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${r}`,ssl:!1})),i.mockUserToken){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=k0.MOCK_USER;else{e=ds(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new F0(M0.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new k0(s)}n._credentials=new V0(new j0(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return mP(this._delegate)}disableNetwork(){return yP(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,WR("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return gP(this._delegate)}onSnapshotsInSync(e){return Cx(this._delegate,e)}get app(){if(!this._appCompat)throw new F0("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Xx(this,nP(this._delegate,e))}catch(e){throw zx(e,"collection()","Firestore.collection()")}}doc(e){try{return new Kx(this,rP(this._delegate,e))}catch(e){throw zx(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Qx(this,function(e,t){if(e=QR(e,XR),zR("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new F0(M0.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new eP(e,null,(t=t,new JE(nE.emptyPath(),t)))}(this._delegate,e))}catch(e){throw zx(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Px(this._delegate,e=>t(new qx(this,e)))}batch(){return dP(this._delegate),new Vx(new _x(this._delegate,e=>Ax(this._delegate,e)))}loadBundle(e){return t=this._delegate,n=e,r=dP(t=QR(t,hP)),e=new cP,qR(r,t._databaseId,n,e),e;var t,n,r}namedQuery(e){return vP(this._delegate,e).then(e=>e?new Qx(this,e):null)}}class jx extends mx{constructor(e){super(),this.firestore=e}convertBytes(e){return new Lx(new bP(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return Kx.forKey(e,this.firestore,null)}}class qx{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new jx(e)}get(e){const t=Zx(e);return this._delegate.get(t).then(e=>new Hx(this._firestore,new ex(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){e=Zx(e);return n?(xx("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=Zx(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=Zx(e);return this._delegate.delete(e),this}}class Vx{constructor(e){this._delegate=e}set(e,t,n){e=Zx(e);return n?(xx("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=Zx(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=Zx(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class Bx{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){e=new tx(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Gx(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Bx.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Bx(e,new jx(e),t),r.set(t,i)),i}}Bx.INSTANCES=new WeakMap;class Kx{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new jx(e)}static forPath(e,t,n){if(e.length%2!=0)throw new F0("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new Kx(t,new ZR(t._delegate,n,new mE(e)))}static forKey(e,t,n){return new Kx(t,new ZR(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Xx(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Xx(this.firestore,nP(this._delegate,e))}catch(e){throw zx(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=io(e))instanceof ZR&&iP(this._delegate,e)}set(e,t){t=xx("DocumentReference.set",t);try{return t?Ex(this._delegate,e,t):Ex(this._delegate,e)}catch(e){throw zx(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Sx(this._delegate,e):Sx(this._delegate,e,t,...n)}catch(e){throw zx(e,"updateDoc()","DocumentReference.update()")}}delete(){return Ax(QR((e=this._delegate).firestore,hP),[new qS(e._key,AS.none())]);var e}onSnapshot(...e){var t=Wx(e),e=$x(e,e=>new Hx(this.firestore,new ex(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return kx(this._delegate,t,e)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?Ix:"server"===(null==e?void 0:e.source)?function(t){t=QR(t,ZR);const n=QR(t.firestore,hP);return UR(dP(n),t._key,{source:"server"}).then(e=>Nx(n,t,e))}:function(t){t=QR(t,ZR);const n=QR(t.firestore,hP);return UR(dP(n),t._key).then(e=>Nx(n,t,e))})(this._delegate),t.then(e=>new Hx(this.firestore,new ex(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Kx(this.firestore,e?this._delegate.withConverter(Bx.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function zx(e,t,n){return e.message=e.message.replace(t,n),e}function Wx(e){for(const t of e)if("object"==typeof t&&!Mx(t))return t;return{}}function $x(e,t){let n;return n=Mx(e[0])?e[0]:Mx(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}class Hx{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Kx(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return rx(this._delegate,e._delegate)}}class Gx extends Hx{data(e){e=this._delegate.data(e);return void 0!==e||D0(),e}}class Qx{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new jx(e)}where(e,t,n){try{return new Qx(this.firestore,ox(this._delegate,(r=e,i=t,s=n,r=XP("where",e),new ax(r,i,s))))}catch(e){throw zx(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new Qx(this.firestore,ox(this._delegate,([n,r="asc"]=[e,t],n=XP("orderBy",n),new cx(n,r))))}catch(e){throw zx(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r}limit(e){try{return new Qx(this.firestore,ox(this._delegate,(YR("limit",t=e),new lx("limit",t,"F"))))}catch(e){throw zx(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Qx(this.firestore,ox(this._delegate,(YR("limitToLast",t=e),new lx("limitToLast",t,"L"))))}catch(e){throw zx(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Qx(this.firestore,ox(this._delegate,function(...e){return new ux("startAt",e,!0)}(...e)))}catch(e){throw zx(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Qx(this.firestore,ox(this._delegate,function(...e){return new ux("startAfter",e,!1)}(...e)))}catch(e){throw zx(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Qx(this.firestore,ox(this._delegate,function(...e){return new hx("endBefore",e,!0)}(...e)))}catch(e){throw zx(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Qx(this.firestore,ox(this._delegate,function(...e){return new hx("endAt",e,!1)}(...e)))}catch(e){throw zx(e,"endAt()","Query.endAt()")}}isEqual(e){return sP(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?Tx:"server"===(null==e?void 0:e.source)?function(t){t=QR(t,eP);const n=QR(t.firestore,hP),e=dP(n),r=new bx(n);return jR(e,t._query,{source:"server"}).then(e=>new nx(n,r,t,e))}:function(t){t=QR(t,eP);const n=QR(t.firestore,hP),e=dP(n),r=new bx(n);return ix(t._query),jR(e,t._query).then(e=>new nx(n,r,t,e))})(this._delegate),t.then(e=>new Jx(this.firestore,new nx(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=Wx(e),e=$x(e,e=>new Jx(this.firestore,new nx(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return kx(this._delegate,t,e)}withConverter(e){return new Qx(this.firestore,e?this._delegate.withConverter(Bx.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Yx{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Gx(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Jx{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Qx(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Gx(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Yx(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new Gx(this._firestore,e))})}isEqual(e){return rx(this._delegate,e._delegate)}}class Xx extends Qx{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new Kx(this.firestore,e):null}doc(e){try{return void 0===e?new Kx(this.firestore,rP(this._delegate)):new Kx(this.firestore,rP(this._delegate,e))}catch(e){throw zx(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=QR(e.firestore,hP),r=rP(e),i=yx(e.converter,t);return Ax(n,[PP(RP(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,AS.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Kx(this.firestore,e))}isEqual(e){return iP(this._delegate,e._delegate)}withConverter(e){return new Xx(this.firestore,e?this._delegate.withConverter(Bx.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Zx(e){return QR(e,ZR)}const eO={Firestore:Ux,GeoPoint:TP,Timestamp:Y0,Blob:Lx,Transaction:qx,WriteBatch:Vx,DocumentReference:Kx,DocumentSnapshot:Hx,Query:Qx,QueryDocumentSnapshot:Gx,QuerySnapshot:Jx,CollectionReference:Xx,FieldPath:class e{constructor(...e){this._delegate=new wP(...e)}static documentId(){return new e(iE.keyField().canonicalString())}isEqual(e){return(e=io(e))instanceof wP&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class n{constructor(e){this._delegate=e}static serverTimestamp(){const e=new DP("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){const e=new xP("deleteField");return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){const t=function(...e){return new LP("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){const t=function(...e){return new MP("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){const t=new FP("increment",e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,A0.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};lP=Go,uP=(e,t)=>new Ux(e,t,new Fx),lP.INTERNAL.registerComponent(new so("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return uP(t,e)},"PUBLIC").setServiceProps(Object.assign({},eO))),lP.registerVersion("@firebase/firestore-compat","0.1.1");const tO="type.googleapis.com/google.protobuf.Int64Value",nO="type.googleapis.com/google.protobuf.UInt64Value";function rO(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function iO(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case tO:case nO:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>iO(e)):"function"==typeof e||"object"==typeof e?rO(e,e=>iO(e)):e}const sO="functions",oO={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class aO extends Ss{constructor(e,t,n){super(`${sO}/${e}`,t||""),this.details=n}}function cO(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!oO[e])return new aO("internal","internal");n=oO[e],r=e}var o=s.message;"string"==typeof o&&(r=o),i=s.details,void 0!==i&&(i=iO(i))}}catch(e){}return"ok"===n?null:new aO(n,r,i)}class lO{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){return this.appCheck?(await this.appCheck.getToken()).token:null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const uO="us-central1";class hO{constructor(e,t,n,r,i=uO,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new lO(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var o=new URL(i);this.customDomain=o.origin,this.region=uO}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function dO(t,n,r){return e=>async function(e,t,n,r){const i=e._url(t),s={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return rO(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)},o={},a=await e.contextProvider.getContext();a.authToken&&(o.Authorization="Bearer "+a.authToken);a.messagingToken&&(o["Firebase-Instance-ID-Token"]=a.messagingToken);null!==a.appCheckToken&&(o["X-Firebase-AppCheck"]=a.appCheckToken);r=r.timeout||7e4,r=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(i,s,o,e.fetchImpl),function(n){return new Promise((e,t)=>{setTimeout(()=>{t(new aO("deadline-exceeded","deadline-exceeded"))},n)})}(r),e.cancelAllRequests]);if(!r)throw new aO("cancelled","Firebase Functions instance was deleted.");e=cO(r.status,r.json);if(e)throw e;if(!r.json)throw new aO("internal","Response is not valid JSON object.");let c=r.json.data;void 0===c&&(c=r.json.result);if(void 0===c)throw new aO("internal","Response is missing data field.");r=iO(c);return{data:r}}(t,n,e,r||{})}var fO;function pO(e,t,n){io(e).emulatorOrigin=`http://${t}:${n}`}fO=fetch.bind(self),xo(new so(sO,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),e=e.getProvider("app-check-internal");return new hO(n,r,i,e,t,fO)},"PUBLIC").setMultipleInstances(!0)),qo("@firebase/functions","0.7.0");var gO,mO,yO,vO;class _O{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return dO(io(this._delegate),e,t)}useFunctionsEmulator(e){e=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==e)throw new Ss("functions","No origin provided to useFunctionsEmulator()");if(null==e[2])throw new Ss("functions","Port missing in origin provided to useFunctionsEmulator()");return pO(this._delegate,e[1],Number(e[2]))}useEmulator(e,t){return pO(this._delegate,e,t)}}const wO=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("functions").getImmediate({identifier:null!=t?t:"us-central1"});return new _O(n,t)};gO={Functions:_O},Go.INTERNAL.registerComponent(new so("functions-compat",wO,"PUBLIC").setServiceProps(gO).setMultipleInstances(!0)),Go.registerVersion("@firebase/functions-compat","0.1.1");const bO="/firebase-messaging-sw.js",IO="/firebase-cloud-messaging-push-scope",TO="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",EO="https://fcmregistrations.googleapis.com/v1",SO="google.c.a.c_id",kO="google.c.a.c_l",CO="google.c.a.ts";function AO(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(E={})[E.DATA_MESSAGE=1]="DATA_MESSAGE",E[E.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(E=mO=mO||{}).PUSH_RECEIVED="push-received",E.NOTIFICATION_CLICKED="notification-clicked";const NO="fcm_token_details_db",RO=5,PO="fcm_token_object_Store";async function xO(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(NO))return null}let o=null;const e=await aa(NO,RO,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(PO)){const i=e.transaction.objectStore(PO);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:AO(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:AO(n.auth),p256dh:AO(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:AO(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:AO(r.auth),p256dh:AO(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:AO(r.vapidKey)}}))}});return e.close(),await ca(NO),await ca("fcm_vapid_details_db"),await ca("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const OO="firebase-messaging-database",DO=1,LO="firebase-messaging-store";let MO=null;function FO(){return MO=MO||aa(OO,DO,e=>{0===e.oldVersion&&e.createObjectStore(LO)}),MO}async function UO(e){var t=qO(e);const n=await FO();t=await n.transaction(LO).objectStore(LO).get(t);if(t)return t;t=await xO(e.appConfig.senderId);return t?(await jO(e,t),t):void 0}async function jO(e,t){e=qO(e);const n=await FO(),r=n.transaction(LO,"readwrite");return await r.objectStore(LO).put(t,e),await r.complete,t}function qO({appConfig:e}){return e.appId}const VO=new Cs("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function BO(e,t){var n={method:"DELETE",headers:await zO(e)};try{const s=await fetch(`${KO(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw VO.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw VO.create("token-unsubscribe-failed",{errorInfo:e})}}function KO({projectId:e}){return`${EO}/projects/${e}/registrations`}async function zO({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function WO({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==TO&&(i.web.applicationPubKey=r),i}const $O=6048e5;async function HO(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:AO(t.getKey("auth")),p256dh:AO(t.getKey("p256dh"))},a=await UO(e.firebaseDependencies);if(a){if(n=a.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,n=o.p256dh===n.p256dh,r&&i&&s&&n)return Date.now()>=a.createTime+$O?async function(t,e){try{var n=await async function(e,t){var n=await zO(e),r=WO(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${KO(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw VO.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw VO.create("token-update-failed",{errorInfo:r})}if(!i.token)throw VO.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await jO(t.firebaseDependencies,r),n}catch(e){throw await GO(t),e}}(e,{token:a.token,createTime:Date.now(),subscriptionOptions:o}):a.token;try{await BO(e.firebaseDependencies,a.token)}catch(e){console.warn(e)}return QO(e.firebaseDependencies,o)}return QO(e.firebaseDependencies,o)}async function GO(e){var t=await UO(e.firebaseDependencies);t&&(await BO(e.firebaseDependencies,t.token),await async function(e){e=qO(e);const t=await FO(),n=t.transaction(LO,"readwrite");await n.objectStore(LO).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function QO(e,t){t={token:await async function(e,t){var n=await zO(e),t=WO(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(KO(e.appConfig),t);r=await i.json()}catch(e){throw VO.create("token-subscribe-failed",{errorInfo:e})}if(r.error){t=r.error.message;throw VO.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw VO.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await jO(e,t),t.token}function YO(e){var t,n,r,i={from:e.from,collapseKey:e.collapse_key,messageId:e.fcm_message_id};return n=i,(r=e).notification&&(n.notification={},(t=r.notification.title)&&(n.notification.title=t),(t=r.notification.body)&&(n.notification.body=t),(r=r.notification.image)&&(n.notification.image=r)),n=i,(r=e).data&&(n.data=r.data),n=i,(r=e).fcmOptions&&(n.fcmOptions={},(e=r.fcmOptions.link)&&(n.fcmOptions.link=e),(r=r.fcmOptions.analytics_label)&&(n.fcmOptions.analyticsLabel=r)),i}function JO(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}function XO(e){return VO.create("missing-app-config-values",{valueName:e})}JO("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),JO("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class ZO{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw XO("App Configuration Object");if(!e.name)throw XO("App Name");var{options:t}=e;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw XO(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function eD(e){try{e.swRegistration=await navigator.serviceWorker.register(bO,{scope:IO}),e.swRegistration.update().catch(()=>{})}catch(e){throw VO.create("failed-service-worker-registration",{browserErrorMessage:e.message})}}async function tD(e,t){if(!navigator)throw VO.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw VO.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=TO)),await async function(e,t){if(t||e.swRegistration||await eD(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw VO.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),HO(e)}async function nD(e,t,n){t=function(e){switch(e){case mO.NOTIFICATION_CLICKED:return"notification_open";case mO.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const r=await e.firebaseDependencies.analyticsProvider.get();r.logEvent(t,{message_id:n[SO],message_name:n[kO],message_time:n[CO],message_device_time:Math.floor(Date.now()/1e3)})}async function rD(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===mO.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(YO(r)):e.onMessageHandler.next(YO(r))),n=r.data,"object"==typeof(t=n)&&t&&SO in t&&"1"===n["google.c.a.e"]&&await nD(e,r.messageType,n))}function iD(e){return async function(e){if(!navigator)throw VO.create("only-available-in-window");return e.swRegistration||await eD(e),GO(e)}(e=io(e))}function sD(e,t){return function(e,t){if(!navigator)throw VO.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=io(e),t)}xo(new so("messaging",e=>{const t=new ZO(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>rD(t,e)),t},"PUBLIC")),xo(new so("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>tD(t,e)}},"PRIVATE"));const oD="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",aD="https://fcmregistrations.googleapis.com/v1",cD="FCM_MSG",lD="google.c.a.c_id",uD=3,hD=1;function dD(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(E=yO=yO||{})[E.DATA_MESSAGE=1]="DATA_MESSAGE",E[E.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(E=vO=vO||{}).PUSH_RECEIVED="push-received",E.NOTIFICATION_CLICKED="notification-clicked";const fD="fcm_token_details_db",pD=5,gD="fcm_token_object_Store";async function mD(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(fD))return null}let o=null;const e=await aa(fD,pD,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(gD)){const i=e.transaction.objectStore(gD);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:dD(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:dD(n.auth),p256dh:dD(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:dD(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:dD(r.auth),p256dh:dD(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:dD(r.vapidKey)}}))}});return e.close(),await ca(fD),await ca("fcm_vapid_details_db"),await ca("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const yD="firebase-messaging-database",vD=1,_D="firebase-messaging-store";let wD=null;function bD(){return wD=wD||aa(yD,vD,e=>{0===e.oldVersion&&e.createObjectStore(_D)}),wD}async function ID(e){var t=ED(e);const n=await bD();t=await n.transaction(_D).objectStore(_D).get(t);if(t)return t;t=await mD(e.appConfig.senderId);return t?(await TD(e,t),t):void 0}async function TD(e,t){e=ED(e);const n=await bD(),r=n.transaction(_D,"readwrite");return await r.objectStore(_D).put(t,e),await r.complete,t}function ED({appConfig:e}){return e.appId}const SD=new Cs("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function kD(e,t){var n={method:"DELETE",headers:await AD(e)};try{const s=await fetch(`${CD(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw SD.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw SD.create("token-unsubscribe-failed",{errorInfo:e})}}function CD({projectId:e}){return`${aD}/projects/${e}/registrations`}async function AD({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function ND({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==oD&&(i.web.applicationPubKey=r),i}const RD=6048e5;async function PD(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:dD(t.getKey("auth")),p256dh:dD(t.getKey("p256dh"))},a=await ID(e.firebaseDependencies);if(a){if(n=a.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,n=o.p256dh===n.p256dh,r&&i&&s&&n)return Date.now()>=a.createTime+RD?async function(t,e){try{var n=await async function(e,t){var n=await AD(e),r=ND(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${CD(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw SD.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw SD.create("token-update-failed",{errorInfo:r})}if(!i.token)throw SD.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await TD(t.firebaseDependencies,r),n}catch(e){throw await xD(t),e}}(e,{token:a.token,createTime:Date.now(),subscriptionOptions:o}):a.token;try{await kD(e.firebaseDependencies,a.token)}catch(e){console.warn(e)}return OD(e.firebaseDependencies,o)}return OD(e.firebaseDependencies,o)}async function xD(e){var t=await ID(e.firebaseDependencies);t&&(await kD(e.firebaseDependencies,t.token),await async function(e){e=ED(e);const t=await bD(),n=t.transaction(_D,"readwrite");await n.objectStore(_D).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function OD(e,t){t={token:await async function(e,t){var n=await AD(e),t=ND(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(CD(e.appConfig),t);r=await i.json()}catch(e){throw SD.create("token-subscribe-failed",{errorInfo:e})}if(r.error){t=r.error.message;throw SD.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw SD.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await TD(e,t),t.token}LD("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),LD("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");async function DD(e,t){t=function(e,t){const n={};e.from&&(n.project_number=e.from);e.fcm_message_id&&(n.message_id=e.fcm_message_id);n.instance_id=t,e.notification?n.message_type=yO.DISPLAY_NOTIFICATION.toString():n.message_type=yO.DATA_MESSAGE.toString();n.sdk_platform=uD.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key);n.event=hD.toString(),null!==(t=e.fcmOptions)&&void 0!==t&&t.analytics_label&&(n.analytics_label=null===(e=e.fcmOptions)||void 0===e?void 0:e.analytics_label);return n}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,t)}function LD(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}async function MD(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await DD(t,n);var r,i,s=await UD();if(s.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=vO.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(s,n);n.notification&&await function(e){var{actions:t}=e,{maxActions:n}=Notification;t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[cD]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(i={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcm_message_id},e=i,(s=r).notification&&(e.notification={},(n=s.notification.title)&&(e.notification.title=n),(n=s.notification.body)&&(e.notification.body=n),(s=s.notification.image)&&(e.notification.image=s)),e=i,(s=r).data&&(e.data=s.data),e=i,(s=r).fcmOptions&&(e.fcmOptions={},(r=s.fcmOptions.link)&&(e.fcmOptions.link=r),(s=s.fcmOptions.analytics_label)&&(e.fcmOptions.analyticsLabel=s)),i=i,"function"==typeof t.onBackgroundMessageHandler?t.onBackgroundMessageHandler(i):t.onBackgroundMessageHandler.next(i))}}async function FD(e){const t=null===(i=null===(n=e.notification)||void 0===n?void 0:n.data)||void 0===i?void 0:i[cD];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&lD in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),e=new URL(self.location.origin);if(i.host===e.host){let e=await async function(e){var t=await UD();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=vO.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function UD(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function jD(e){return SD.create("missing-app-config-values",{valueName:e})}class qD{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw jD("App Configuration Object");if(!e.name)throw jD("App Name");var{options:t}=e;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw jD(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function VD(e,t){return function(e,t){if(void 0!==self.document)throw SD.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=io(e),t)}xo(new so("messaging-sw",e=>{const t=new qD(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(MD(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var{newSubscription:e}=e;e?(e=await ID(t.firebaseDependencies),await xD(t),t.vapidKey=null!==(e=null===(e=null==e?void 0:e.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==e?e:oD,await PD(t)):await xD(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(FD(e))}),t},"PUBLIC"));var BD,KD,zD;class WD{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return tD(e=io(e),t)}(this._delegate,e)}async deleteToken(){return iD(this._delegate)}onMessage(e){return sD(this._delegate,e)}onBackgroundMessage(e){return VD(this._delegate,e)}}const $D={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};Go.INTERNAL.registerComponent(new so("messaging-compat",e=>self&&"ServiceWorkerGlobalScope"in self?new WD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new WD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),"PUBLIC").setServiceProps($D)),Go.registerVersion("@firebase/messaging-compat","0.1.0"),(E=BD=BD||{})[E.NO_ERROR=0]="NO_ERROR",E[E.NETWORK_ERROR=1]="NETWORK_ERROR",E[E.ABORT=2]="ABORT";const HD="firebasestorage.googleapis.com",GD="storageBucket";class QD extends Ss{constructor(e,t){super(YD(e),`Firebase Storage: ${t} (${YD(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,QD.prototype)}_codeEquals(e){return YD(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function YD(e){return"storage/"+e}function JD(){return new QD("unknown","An unknown error occurred, please check the error payload for server response.")}function XD(){return new QD("canceled","User canceled the upload/download.")}function ZD(){return new QD("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function e1(e){return new QD("invalid-argument",e)}function t1(){return new QD("app-deleted","The Firebase app was deleted.")}function n1(e){return new QD("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function r1(e,t){return new QD("invalid-format","String does not match format '"+e+"': "+t)}function i1(e){throw new QD("internal-error","Internal error: "+e)}class s1{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=BD.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=BD.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=BD.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw i1("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw i1("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw i1("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponseText(){if(!this.sent_)throw i1("cannot .getResponseText() before sending");return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class o1{createConnection(){return new s1}}class a1{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=a1.makeFromUrl(t,e)}catch(e){return new a1(t,"")}if(""===n.path)return n;throw t=t,new QD("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(t,e){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var o=e.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),e=e===HD?"(?:storage.googleapis.com|storage.cloud.google.com)":e,a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${e}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<a.length;e++){const u=a[e];var c=u.regex.exec(t);if(c){var l=c[u.indices.bucket];let e=c[u.indices.path];e=e||"",n=new a1(l,e),u.postModify(n);break}}if(null==n)throw r=t,new QD("invalid-url","Invalid URL '"+r+"'.");return n}}class c1{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function l1(e){return"string"==typeof e||e instanceof String}function u1(e){return h1()&&e instanceof Blob}function h1(){return"undefined"!=typeof Blob}function d1(e,t,n,r){if(r<t)throw e1(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw e1(`Invalid value for '${e}'. Expected ${n} or less.`)}function f1(e,t){var n=t.match(/^(\w+):\/\/.+/);let r=null==(null==n?void 0:n[1])?`https://${t}`:t;return`${r}/v0${e}`}function p1(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}class g1{constructor(e,t,n,r,i,s,o,a,c,l,u){this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=s.slice(),this.callback_=o,this.errorCallback_=a,this.progressCallback_=l,this.timeout_=c,this.pool_=u,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const c=this;function e(e,t){const n=c.resolve_,r=c.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=c.callback_(i,i.getResponseText());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const a=JD();a.serverResponse=i.getResponseText(),c.errorCallback_?r(c.errorCallback_(i,a)):r(a)}else{var o;t.canceled?(o=(c.appDelete_?t1:XD)(),r(o)):(o=new QD("retry-limit-exceeded","Max retry time for operation exceeded, please try again."),r(o))}}this.canceled_?e(0,new m1(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=!1,o=0;function a(){return 2===o}let c=!1;function l(...e){c||(c=!0,n.apply(null,e))}function u(e){i=setTimeout(()=>{i=null,t(h,a())},e)}function h(e,...t){if(!c)if(e)l.call(null,e,...t);else if(a()||s)l.call(null,e,...t);else{r<64&&(r*=2);let e;e=1===o?(o=2,0):1e3*(r+Math.random()),u(e)}}let d=!1;function f(e){d||(d=!0,c||(null!==i?(e||(o=2),clearTimeout(i),u(0)):e||(o=1)))}return u(0),setTimeout(()=>{f(s=!0)},e),f}(function(r,e){if(e)r(!1,new m1(!1,null,!0));else{const s=c.pool_.createConnection();function i(e){var t=e.loaded,e=e.lengthComputable?e.total:-1;null!==c.progressCallback_&&c.progressCallback_(t,e)}c.pendingConnection_=s,null!==c.progressCallback_&&s.addUploadProgressListener(i),s.send(c.url_,c.method_,c.body_,c.headers_).then(()=>{null!==c.progressCallback_&&s.removeUploadProgressListener(i),c.pendingConnection_=null;var e,t=s.getErrorCode()===BD.NO_ERROR,n=s.getStatus();t&&!c.isRetryStatusCode_(n)?(e=-1!==c.successCodes_.indexOf(n),r(!0,new m1(e,s))):(e=s.getErrorCode()===BD.ABORT,r(!1,new m1(!1,null,e)))})}},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){var t=500<=e&&e<600,n=-1!==[408,429].indexOf(e),e=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||e}}class m1{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function y1(...t){const e="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(h1())return new Blob(t);throw new QD("unsupported-environment","This browser doesn't seem to support creating Blobs")}const v1={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class _1{constructor(e,t){this.data=e,this.contentType=t||null}}function w1(e,t){switch(e){case v1.RAW:return new _1(b1(t));case v1.BASE64:case v1.BASE64URL:return new _1(I1(e,t));case v1.DATA_URL:return new _1(function(e){e=new T1(e);return e.base64?I1(v1.BASE64,e.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw r1(v1.DATA_URL,"Malformed data URL.")}return b1(t)}(e.rest)}(t),function(e){e=new T1(e);return e.contentType}(t))}throw JD()}function b1(n){const r=[];for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var i,s;e<=127?r.push(e):e<=2047?r.push(192|e>>6,128|63&e):55296==(64512&e)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(i=e,s=n.charCodeAt(++t),e=65536|(1023&i)<<10|1023&s,r.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):r.push(239,191,189):56320==(64512&e)?r.push(239,191,189):r.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(r)}function I1(t,e){switch(t){case v1.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw r1(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case v1.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw r1(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=atob(e)}catch(e){throw r1(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let e=0;e<i.length;e++)s[e]=i.charCodeAt(e);return s}class T1{constructor(e){this.base64=!1,this.contentType=null;var t,n=e.match(/^data:([^,]+)?,/);if(null===n)throw r1(v1.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;null!=r&&(this.base64=(t=r,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)}}class E1{constructor(e,t){let n=0,r="";u1(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(u1(this.data_)){var n=this.data_,r=(i=e,r=t,(n=n).webkitSlice?n.webkitSlice(i,r):n.mozSlice?n.mozSlice(i,r):n.slice?n.slice(i,r):null);return null===r?null:new E1(r)}var i,r,e=new Uint8Array(this.data_.buffer,e,t-e);return new E1(e,!0)}static getBlob(...e){if(h1()){var t=e.map(e=>e instanceof E1?e.data_:e);return new E1(y1.apply(null,t))}{const r=e.map(e=>l1(e)?w1(v1.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(t=>{for(let e=0;e<t.length;e++)i[n++]=t[e]}),new E1(i,!0)}}uploadData(){return this.data_}}function S1(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function k1(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function C1(e,t){return t}class A1{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||C1}}let N1=null;function R1(){if(N1)return N1;const e=[];e.push(new A1("bucket")),e.push(new A1("generation")),e.push(new A1("metageneration")),e.push(new A1("name","fullPath",!0));const t=new A1("name");t.xform=function(e,t){return!l1(t=t)||t.length<2?t:k1(t)},e.push(t);const n=new A1("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new A1("timeCreated")),e.push(new A1("updated")),e.push(new A1("md5Hash",null,!0)),e.push(new A1("cacheControl",null,!0)),e.push(new A1("contentDisposition",null,!0)),e.push(new A1("contentEncoding",null,!0)),e.push(new A1("contentLanguage",null,!0)),e.push(new A1("contentType",null,!0)),e.push(new A1("metadata","customMetadata",!0)),N1=e,N1}function P1(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new a1(e,t);return r._makeStorageReference(t)}})}function x1(e,t,n){t=S1(t);return null===t?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let e=0;e<i;e++){const s=n[e];r[s.local]=s.xform(r,t[s.server])}return P1(r,e),r}(e,t,n)}function O1(t,n){const r={};var i=n.length;for(let e=0;e<i;e++){var s=n[e];s.writable&&(r[s.server]=t[s.local])}return JSON.stringify(r)}const D1="prefixes",L1="items";function M1(e,t,n){n=S1(n);return null===n?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[D1])for(const o of n[D1]){var i=o.replace(/\/$/,""),i=e._makeStorageReference(new a1(t,i));r.prefixes.push(i)}if(n[L1])for(const a of n[L1]){var s=e._makeStorageReference(new a1(t,a.name));r.items.push(s)}return r}(e,t,n)}class F1{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function U1(e){if(!e)throw JD()}function j1(n,r){return function(e,t){return U1(null!==(t=x1(n,t,r))),t}}function q1(n,r){return function(e,t){return U1(null!==(t=M1(n,r,t))),t}}function V1(r,i){return function(e,t){var n=x1(r,t,i);return U1(null!==n),function(r,e,i){if(null===(e=S1(e)))return null;if(!l1(e.downloadTokens))return null;const t=e.downloadTokens;if(0===t.length)return null;const s=encodeURIComponent,n=t.split(",");return n.map(e=>{var t=r.bucket,n=r.fullPath;return f1("/b/"+s(t)+"/o/"+s(n),i)+p1({alt:"media",token:e})})[0]}(n,t,r.host)}}function B1(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new QD("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new QD("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new QD("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(e=i.path,new QD("unauthorized","User does not have permission to access '"+e+"'.")):t,n.serverResponse=t.serverResponse,n}}function K1(r){const i=B1(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new QD("object-not-found","Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function z1(e,t,n){var r=f1(t.fullServerUrl(),e.host),i=e.maxOperationRetryTime;const s=new F1(r,"GET",j1(e,n),i);return s.errorHandler=K1(t),s}function W1(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function $1(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const o={"X-Goog-Upload-Protocol":"multipart"};var a=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;var c=W1(t,r,i),i="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+O1(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",a="\r\n--"+a+"--";const l=E1.getBlob(i,r,a);if(null===l)throw ZD();a={name:c.fullPath},c=f1(s,e.host),s=e.maxUploadRetryTime;const u=new F1(c,"POST",j1(e,n),s);return u.urlParams=a,u.headers=o,u.body=l.uploadData(),u.errorHandler=B1(t),u}class H1{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function G1(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){U1(!1)}const r=t||["active"];return U1(!!n&&-1!==r.indexOf(n)),n}function Q1(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=W1(t,r,i),i={name:o.fullPath},s=f1(s,e.host),r={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},n=O1(o,n),e=e.maxUploadRetryTime;const a=new F1(s,"POST",function(e){G1(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){U1(!1)}return U1(l1(t)),t},e);return a.urlParams=i,a.headers=r,a.body=n,a.errorHandler=B1(t),a}function Y1(e,t,n,r){e=e.maxUploadRetryTime;const i=new F1(n,"POST",function(e){var t=G1(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){U1(!1)}return n||U1(!1),e=Number(n),U1(!isNaN(e)),new H1(e,r.size(),"final"===t)},e);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=B1(t),i}function J1(e,o,t,a,n,c,r,i){const l=new H1(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=a.size()),a.size()!==l.total)throw new QD("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));r=l.current,n=r+u,s={"X-Goog-Upload-Command":u===s?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`};const h=a.slice(r,n);if(null===h)throw ZD();n=o.maxUploadRetryTime;const d=new F1(t,"POST",function(e,t){var n=G1(e,["active","final"]),r=l.current+u,i=a.size();let s;return s="final"===n?j1(o,c)(e,t):null,new H1(r,i,"final"===n,s)},n);return d.headers=s,d.body=h.uploadData(),d.progressCallback=i||null,d.errorHandler=B1(e),d}const X1={STATE_CHANGED:"state_changed"},Z1={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function eL(e){switch(e){case"running":case"pausing":case"canceling":return Z1.RUNNING;case"paused":return Z1.PAUSED;case"success":return Z1.SUCCESS;case"canceled":return Z1.CANCELED;case"error":default:return Z1.ERROR}}class tL{constructor(e,t,n){"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(e=e).next,this.error=e.error,this.complete=e.complete)}}function nL(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class rL{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=R1(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=Q1(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=Y1(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new H1(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=J1(this._ref._location,this._ref.storage,o,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=z1(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=$1(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=XD(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=eL(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new tL(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){e=this._observers.indexOf(e);-1!==e&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(eL(this._state)){case Z1.SUCCESS:nL(this._resolve.bind(null,this.snapshot))();break;case Z1.CANCELED:case Z1.ERROR:const t=this._reject;nL(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(eL(this._state)){case Z1.RUNNING:case Z1.PAUSED:e.next&&nL(e.next.bind(e,this.snapshot))();break;case Z1.SUCCESS:e.complete&&nL(e.complete.bind(e))();break;case Z1.CANCELED:case Z1.ERROR:e.error&&nL(e.error.bind(e,this._error))();break;default:e.error&&nL(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class iL{constructor(e,t){this._service=e,t instanceof a1?this._location=t:this._location=a1.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new iL(e,t)}get root(){var e=new a1(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return k1(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new a1(this._location.bucket,e);return new iL(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw n1(e)}}function sL(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await oL(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}async function oL(e,t){null!=t&&"number"==typeof t.maxResults&&d1("options.maxResults",1,1e3,t.maxResults);t=t||{},t=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i),r=f1(t.bucketOnlyServerUrl(),e.host),i=e.maxOperationRetryTime;const o=new F1(r,"GET",q1(e,t.bucket),i);return o.urlParams=s,o.errorHandler=B1(t),o}(e.storage,e._location,"/",t.pageToken,t.maxResults);return(await e.storage.makeRequestWithTokens(t)).getPromise()}async function aL(e,t){e._throwIfRoot("updateMetadata");t=function(e,t,n,r){var i=f1(t.fullServerUrl(),e.host),s=O1(n,r),n=e.maxOperationRetryTime;const o=new F1(i,"PATCH",j1(e,r),n);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=K1(t),o}(e.storage,e._location,t,R1());return(await e.storage.makeRequestWithTokens(t)).getPromise()}async function cL(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=f1(t.fullServerUrl(),e.host),i=e.maxOperationRetryTime;const s=new F1(r,"GET",V1(e,n),i);return s.errorHandler=K1(t),s}(e.storage,e._location,R1());return(await e.storage.makeRequestWithTokens(t)).getPromise().then(e=>{if(null===e)throw new QD("no-download-url","The given file does not have any download URLs.");return e})}async function lL(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=f1(t.fullServerUrl(),e.host),e=e.maxOperationRetryTime;const r=new F1(n,"DELETE",function(e,t){},e);return r.successCodes=[200,204],r.errorHandler=K1(t),r}(e.storage,e._location);return(await e.storage.makeRequestWithTokens(t)).getPromise()}function uL(e,t){var n,t=(n=e._location.path,t=(t=t).split("/").filter(e=>0<e.length).join("/"),0===n.length?t:n+"/"+t),t=new a1(e._location.bucket,t);return new iL(e.storage,t)}function hL(e,t){if(e instanceof pL){var n=e;if(null==n._bucket)throw new QD("no-default-bucket","No default bucket found. Did you set the '"+GD+"' property when initializing the app?");n=new iL(n,n._bucket);return null!=t?hL(n,t):n}return void 0!==t?uL(e,t):e}function dL(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof pL)return n=e,r=t,new iL(n,r);throw e1("To use ref(service, url), the first argument must be a Storage instance.")}return hL(e,t);var n,r}function fL(e,t){t=null==t?void 0:t[GD];return null==t?null:a1.makeFromBucketSpec(t,e)}class pL{constructor(e,t,n,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=HD,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?a1.makeFromBucketSpec(i,this._host):fL(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=a1.makeFromBucketSpec(this._url,e):this._bucket=fL(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){d1("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){d1("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new iL(this,e)}_makeRequest(e,t,n){if(this._deleted)return new c1(t1());{const l=(r=e,i=this._appId,s=t,o=n,a=this._pool,c=this._firebaseVersion,e=p1(r.urlParams),t=r.url+e,n=Object.assign({},r.headers),e=n,(i=i)&&(e["X-Firebase-GMPID"]=i),i=n,null!==(s=s)&&0<s.length&&(i.Authorization="Firebase "+s),c=c,n["X-Firebase-Storage-Version"]="webjs/"+(null!=c?c:"AppManager"),c=n,null!==(o=o)&&(c["X-Firebase-AppCheck"]=o),new g1(t,r.method,n,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a));return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}var r,i,s,o,a,c}async makeRequestWithTokens(e){var[t,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n)}}function gL(e,t,n){return e=io(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new rL(e,new E1(t),n)}function mL(e){return async function(e){e._throwIfRoot("getMetadata");var t=z1(e.storage,e._location,R1());return(await e.storage.makeRequestWithTokens(t)).getPromise()}(e=io(e))}function yL(e,t){return dL(e=io(e),t)}function vL(e,t,n,r={}){!function(e,t,n,r={}){e.host=`http://${t}:${n}`;var{mockUserToken:r}=r;r&&(e._overrideAuthToken="string"==typeof r?r:ds(r,e.app.options.projectId))}(e,t,n,r)}xo(new so("storage",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new pL(n,r,e,new o1,t,Mo)},"PUBLIC").setMultipleInstances(!0)),qo("@firebase/storage","0.8.1");class _L{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class wL{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new _L(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new _L(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new _L(e,this,this._ref)):{next:t.next?e=>t.next(new _L(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class bL{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new IL(e,this._service))}get items(){return this._delegate.items.map(e=>new IL(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class IL{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){e=uL(this._delegate,e);return new IL(e,this.storage)}get root(){return new IL(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new IL(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new wL(gL(this._delegate,e,t),this)}putString(e,t=v1.RAW,n){this._throwIfRoot("putString");e=w1(t,e);const r=Object.assign({},n);return null==r.contentType&&null!=e.contentType&&(r.contentType=e.contentType),new wL(new rL(this._delegate,new E1(e.data,!0),r),this)}listAll(){return sL(io(this._delegate)).then(e=>new bL(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,oL(t=io(t),e).then(e=>new bL(e,this.storage));var t}getMetadata(){return mL(this._delegate)}updateMetadata(e){return aL(io(this._delegate),e)}getDownloadURL(){return cL(io(this._delegate))}delete(){return this._throwIfRoot("delete"),lL(io(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw n1(e)}}class TL{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(EL(e))throw e1("ref() expected a child path but got a URL, use refFromURL instead.");return new IL(yL(this._delegate,e),this)}refFromURL(e){if(!EL(e))throw e1("refFromURL() expected a full URL but got a child path, use ref() instead.");try{a1.makeFromUrl(e,this._delegate.host)}catch(e){throw e1("refFromUrl() expected a valid full URL but got an invalid one.")}return new IL(yL(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){vL(this._delegate,e,t,n)}}function EL(e){return/^[A-Za-z]+:\/\//.test(e)}function SL(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("storage").getImmediate({identifier:t});return new TL(n,t)}KD=Go,zD={TaskState:Z1,TaskEvent:X1,StringFormat:v1,Storage:TL,Reference:IL},KD.INTERNAL.registerComponent(new so("storage-compat",SL,"PUBLIC").setServiceProps(zD).setMultipleInstances(!0)),KD.registerVersion("@firebase/storage-compat","0.1.1");const kL="0.5.0",CL="FB-PERF-TRACE-MEASURE",AL="@firebase/performance/config",NL="@firebase/performance/configexpire";var RL,PL,xL,E="Performance";const OL=new Cs("performance",E,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),DL=new _o(E);DL.logLevel=fo.INFO;let LL,ML;class FL{constructor(e){if(!(this.window=e))throw OL.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!ws()||(DL.info("IndexedDB is not supported by current browswer"),!1):(DL.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===LL&&(LL=new FL(ML)),LL}}let UL;function jL(t,n){var e=t.length-n.length;if(e<0||1<e)throw OL.create("invalid String merger input");const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),n.length>e&&r.push(n.charAt(e));return r.join("")}let qL;class VL{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=jL("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=jL("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===qL&&(qL=new VL),qL}}(E=RL=RL||{})[E.UNKNOWN=0]="UNKNOWN",E[E.VISIBLE=1]="VISIBLE",E[E.HIDDEN=2]="HIDDEN";const BL=["firebase_","google_","ga_"],KL=new RegExp("^[a-zA-Z]\\w*$");function zL(){switch(FL.getInstance().document.visibilityState){case"visible":return RL.VISIBLE;case"hidden":return RL.HIDDEN;default:return RL.UNKNOWN}}function WL(e){e=null===(e=e.options)||void 0===e?void 0:e.appId;if(!e)throw OL.create("no app id");return e}const $L="0.0.1",HL={loggingEnabled:!0},GL="FIREBASE_INSTALLATIONS_AUTH";function QL(e,t){var r,i,n=function(){const e=FL.getInstance().localStorage;if(e){var t=e.getItem(NL);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(AL);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(JL(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.projectId))throw OL.create("no project id");return e}(r.app),n=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.apiKey))throw OL.create("no api key");return e}(r.app),e=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${GL} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:WL(r.app),app_version:kL,sdk_version:$L})});return fetch(e).then(e=>{if(e.ok)return e.json();throw OL.create("RC response not ok")})}).catch(()=>{DL.info(YL)}).then(JL).then(e=>function(e){const t=FL.getInstance().localStorage;e&&t&&(t.setItem(AL,JSON.stringify(e)),t.setItem(NL,String(Date.now()+60*VL.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const YL="Could not fetch config, will use default configs";function JL(e){if(!e)return e;const t=VL.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=HL.loggingEnabled,n.fpr_log_source&&(t.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(t.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(t.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),t.logTraceAfterSampling=XL(t.tracesSamplingRate),t.logNetworkAfterSampling=XL(t.networkRequestsSamplingRate),e}function XL(e){return Math.random()<=e}let ZL=1,eM;function tM(e){var t;return ZL=2,eM=eM||(t=e,function(){const n=FL.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{UL=e}),t}(t.installations)).then(e=>QL(t,e)).then(()=>nM(),()=>nM())),eM}function nM(){ZL=3}const rM=1e4,iM=3,sM=1e3;let oM=iM,aM=[],cM=!1;function lM(e){setTimeout(()=>{if(0!==oM)return aM.length?void function(){const e=aM.splice(0,sM),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:VL.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=VL.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||DL.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=rM;isNaN(t)||(n=Math.max(t,n));e=e.logResponseDetails;Array.isArray(e)&&0<e.length&&"RETRY_REQUEST_LATER"===e[0].responseAction&&(aM=[...r,...aM],DL.info("Retry transport request later.")),oM=iM,lM(n)})}(n,e).catch(()=>{aM=[...e,...aM],oM--,DL.info(`Tries left: ${oM}.`),lM(rM)})}():lM(rM)},e)}function uM(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw OL.create("invalid cc log");aM=[...aM,e]}({message:t(...e),eventTime:Date.now()})}}let hM;function dM(e,t){hM=hM||uM(gM),hM(e,t)}function fM(e){var t=VL.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&FL.getInstance().requiredApisAvailable()&&(e.isAuto&&zL()!==RL.VISIBLE||(3===ZL?pM(e):tM(e.performanceController).then(()=>pM(e),()=>pM(e))))}function pM(e){var t;!UL||(t=VL.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>dM(e,1),0)}function gM(e,t){return 0===t?(t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},t={application_info:mM(e.performanceController.app),network_request_metric:t},JSON.stringify(t)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);e={application_info:mM(e.performanceController.app),trace_metric:t};return JSON.stringify(e)}(e)}function mM(e){return{google_app_id:WL(e),app_instance_id:UL,web_app_info:{sdk_version:kL,page_url:FL.getInstance().getUrl(),service_worker_status:"serviceWorker"in(e=FL.getInstance().navigator)?e.serviceWorker.controller?2:3:1,visibility_state:zL(),effective_connection_type:function(){var e=FL.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}const yM=["_fp","_fcp","_fid"];class vM{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=FL.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${CL}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw OL.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw OL.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),fM(this)}record(e,t,n){if(e<=0)throw OL.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw OL.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Number(Math.floor(n.metrics[r])));fM(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<yM.indexOf(n))&&n.startsWith("_"))throw OL.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=(e=t,(t=Math.floor(e))<e&&DL.info(`Metric value should be an Integer, setting the value as : ${t}.`),t)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!BL.some(e=>n.startsWith(e))&&!!n.match(KL)),r=0!==(r=t).length&&r.length<=100;if(i&&r)this.customAttributes[e]=t;else{if(!i)throw OL.create("invalid attribute name",{attributeName:e});if(!r)throw OL.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=FL.getInstance().getUrl();if(i){const s=new vM(e,"_wt_"+i,!0);i=Math.floor(1e3*FL.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((t=n.find(e=>"first-paint"===e.name))&&t.startTime&&s.putMetric("_fp",Math.floor(1e3*t.startTime)),(n=n.find(e=>"first-contentful-paint"===e.name))&&n.startTime&&s.putMetric("_fcp",Math.floor(1e3*n.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),fM(s)}}static createUserTimingTrace(e,t){fM(new vM(e,t,!1,t))}}function _M(e,t){const n=t;var r,i;n&&void 0!==n.responseStart&&(i=FL.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+i)),t=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,i=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=VL.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>dM(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:t,timeToResponseCompletedUs:i}))}const wM=5e3;function bM(e){UL&&(setTimeout(()=>function(n){const e=FL.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{vM.createOobTrace(n,r,i),t=void 0},wM);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),vM.createOobTrace(n,r,i,e))})}else vM.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=FL.getInstance(),n=e.getEntriesByType("resource");for(const r of n)_M(t,r);e.setupObserver("resource",e=>_M(t,e))}(e),0),setTimeout(()=>function(t){const e=FL.getInstance(),n=e.getEntriesByType("measure");for(const r of n)IM(t,r);e.setupObserver("measure",e=>IM(t,e))}(e),0))}function IM(e,t){const n=t.name;n.substring(0,CL.length)!==CL&&vM.createUserTimingTrace(e,n)}class TM{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),FL.getInstance().requiredApisAvailable()?bs().then(e=>{e&&(cM||(lM(5500),cM=!0),tM(this).then(()=>bM(this),()=>bM(this)),this.initialized=!0)}).catch(e=>{DL.info(`Environment doesn't support IndexedDB: ${e}`)}):DL.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){VL.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return VL.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){VL.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return VL.getInstance().dataCollectionEnabled}}xo(new so("performance",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw OL.create("FB not default");if("undefined"==typeof window)throw OL.create("no window");e=window,ML=e;const i=new TM(n,r);return i._init(t),i},"PUBLIC")),qo("@firebase/performance","0.5.0");class EM{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=io(t),new vM(t,e);var t}}function SM(e){var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("performance").getImmediate();return new EM(t,e)}(PL=Go).INTERNAL.registerComponent(new so("performance-compat",SM,"PUBLIC")),PL.registerVersion("@firebase/performance-compat","0.1.0");const kM="@firebase/remote-config";class CM{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const AM=new Cs("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}."});const NM=["1","true","t","yes","y","on"];class RM{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=NM.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function PM(e){const t=io(e);var[n,e]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==e)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function xM(e){const t=io(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function OM(t){const n=io(t),e=new CM;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){r=(r="fetch-throttle",(t=e)instanceof Ss&&-1!==t.code.indexOf(r)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var r}function DM(n){const e=io(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=LM(n,t),e),{});var t,r}function LM(e,t){const n=io(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");e=n._storageCache.getActiveConfig();return e&&void 0!==e[t]?new RM("remote",e[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new RM("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new RM("static"))}class MM{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,t=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${t}.`),t}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;e=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===e.status&&r.push(this.storage.setLastSuccessfulFetchResponse(e)),await Promise.all(r),e}}class FM{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var[e,t]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),r=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,i={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},t={sdk_version:this.sdkVersion,app_instance_id:e,app_instance_id_token:t,app_id:this.appId,language_code:(t=navigator).languages&&t.languages[0]||t.language},t={method:"POST",headers:i,body:JSON.stringify(t)},r=fetch(r,t),t=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let s;try{await Promise.race([r,t]),s=await r}catch(e){let t="fetch-client-network";throw"AbortError"===e.name&&(t="fetch-timeout"),AM.create(t,{originalErrorMessage:e.message})}let o=s.status;r=s.headers.get("ETag")||void 0;let a,c;if(200===s.status){let e;try{e=await s.json()}catch(e){throw AM.create("fetch-client-parse",{originalErrorMessage:e.message})}a=e.entries,c=e.state}if("INSTANCE_STATE_UNSPECIFIED"===c?o=500:"NO_CHANGE"===c?o=304:"NO_TEMPLATE"!==c&&"EMPTY_CONFIG"!==c||(a={}),304!==o&&200!==o)throw AM.create("fetch-status",{httpStatus:o});return{status:o,eTag:r,config:a}}}class UM{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(AM.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof Ss&&e.customData){e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}}(e))throw e;n={throttleEndTimeMillis:Date.now()+ro(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(n),this.attemptFetch(t,n)}}}class jM{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function qM(e,t){e=e.target.error||void 0;return AM.create(t,{originalErrorMessage:e&&e.message})}const VM="app_namespace_store";class BM{constructor(e,t,n,r=function(){return new Promise((t,n)=>{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(qM(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(VM,{keyPath:"compositeKey"})}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(o){const a=await this.openDbPromise;return new Promise((t,n)=>{const e=a.transaction([VM],"readonly"),r=e.objectStore(VM);var i=this.createCompositeKey(o);try{const s=r.get(i);s.onerror=e=>{n(qM(e,"storage-get"))},s.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)}}catch(e){n(AM.create("storage-get",{originalErrorMessage:e&&e.message}))}})}async set(o,a){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([VM],"readwrite"),r=n.objectStore(VM);var i=this.createCompositeKey(o);try{const s=r.put({compositeKey:i,value:a});s.onerror=e=>{t(qM(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(AM.create("storage-set",{originalErrorMessage:e&&e.message}))}})}async delete(o){const a=await this.openDbPromise;return new Promise((e,t)=>{const n=a.transaction([VM],"readwrite"),r=n.objectStore(VM);var i=this.createCompositeKey(o);try{const s=r.delete(i);s.onerror=e=>{t(qM(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(AM.create("storage-delete",{originalErrorMessage:e&&e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class KM{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}xo(new so("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw AM.create("registration-window");var{projectId:i,apiKey:s,appId:e}=n.options;if(!i)throw AM.create("registration-project-id");if(!s)throw AM.create("registration-api-key");if(!e)throw AM.create("registration-app-id");t=t||"firebase";const o=new BM(e,n.name,t),a=new KM(o),c=new _o(kM);c.logLevel=fo.ERROR;e=new FM(r,Mo,t,i,s,e),e=new UM(e,o),e=new MM(e,o,a,c),e=new jM(n,e,a,o,c);return xM(e),e},"PUBLIC").setMultipleInstances(!0)),qo(kM,"0.2.0");class zM{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return PM(this._delegate)}ensureInitialized(){return xM(this._delegate)}fetch(){return OM(this._delegate)}fetchAndActivate(){return async function(e){return await OM(e=io(e)),PM(e)}(this._delegate)}getAll(){return DM(this._delegate)}getBoolean(e){return LM(io(this._delegate),e).asBoolean()}getNumber(e){return LM(io(this._delegate),e).asNumber()}getString(e){return LM(io(this._delegate),e).asString()}getValue(e){return LM(this._delegate,e)}setLogLevel(e){!function(e,t){const n=io(e);switch(t){case"debug":n._logger.logLevel=fo.DEBUG;break;case"silent":n._logger.logLevel=fo.SILENT;break;default:n._logger.logLevel=fo.ERROR}}(this._delegate,e)}}function WM(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("remote-config").getImmediate({identifier:t});return new zM(n,t)}return(xL=Go).INTERNAL.registerComponent(new so("remoteConfig-compat",WM,"PUBLIC").setMultipleInstances(!0)),xL.registerVersion("@firebase/remote-config-compat","0.1.0"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Go.registerVersion("firebase","9.0.1","compat-cdn"),Go});
//# sourceMappingURL=firebase-compat.js.map
